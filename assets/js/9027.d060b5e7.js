"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9027],{9027:(t,i,s)=>{s.r(i),s.d(i,{ColorType:()=>as,CrosshairMode:()=>ht,LastPriceAnimationMode:()=>os,LineStyle:()=>n,LineType:()=>e,MismatchDirection:()=>Ci,PriceLineSource:()=>ls,PriceScaleMode:()=>Wi,TickMarkType:()=>ns,TrackingModeExitMode:()=>rs,createChart:()=>Ph,isBusinessDay:()=>ms,isUTCTimestamp:()=>vs,version:()=>Uh});var h={allowDownsampling:!0};var e,n,r,o=function(){function t(t,i){var s=this;this._resolutionMediaQueryList=null,this._resolutionListener=function(t){return s._onResolutionChanged()},this._canvasConfiguredListeners=[],this.canvas=t,this._canvasSize={width:this.canvas.clientWidth,height:this.canvas.clientHeight},this._options=i,this._configureCanvas(),this._installResolutionListener()}return t.prototype.destroy=function(){this._canvasConfiguredListeners.length=0,this._uninstallResolutionListener(),this.canvas=null},Object.defineProperty(t.prototype,"canvasSize",{get:function(){return{width:this._canvasSize.width,height:this._canvasSize.height}},enumerable:!0,configurable:!0}),t.prototype.resizeCanvas=function(t){this._canvasSize={width:t.width,height:t.height},this._configureCanvas()},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");return t.devicePixelRatio>1||this._options.allowDownsampling?t.devicePixelRatio:1},enumerable:!0,configurable:!0}),t.prototype.subscribeCanvasConfigured=function(t){this._canvasConfiguredListeners.push(t)},t.prototype.unsubscribeCanvasConfigured=function(t){this._canvasConfiguredListeners=this._canvasConfiguredListeners.filter((function(i){return i!=t}))},t.prototype._configureCanvas=function(){var t=this.pixelRatio;this.canvas.style.width=this._canvasSize.width+"px",this.canvas.style.height=this._canvasSize.height+"px",this.canvas.width=this._canvasSize.width*t,this.canvas.height=this._canvasSize.height*t,this._emitCanvasConfigured()},t.prototype._emitCanvasConfigured=function(){var t=this;this._canvasConfiguredListeners.forEach((function(i){return i.call(t)}))},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");var i=t.devicePixelRatio;this._resolutionMediaQueryList=t.matchMedia("all and (resolution: "+i+"dppx)"),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},t.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},t.prototype._onResolutionChanged=function(){this._configureCanvas(),this._reinstallResolutionListener()},t}();function l(t,i){const s={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(s)}function a(t,i,s,h){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(s,i+e),t.lineTo(h,i+e),t.stroke()}function u(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function c(t){if(void 0===t)throw new Error("Value is undefined");return t}function f(t){if(null===t)throw new Error("Value is null");return t}function d(t){return f(c(t))}(r=e||(e={}))[r.Simple=0]="Simple",r[r.WithSteps=1]="WithSteps",r[r.Curved=2]="Curved",function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(n||(n={}));const p={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function m(t){return t<0?0:t>255?255:Math.round(t)||0}function v(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const g=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,b=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,M=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,w=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function y(t){(t=t.toLowerCase())in p&&(t=p[t]);{const i=w.exec(t)||M.exec(t);if(i)return[m(parseInt(i[1],10)),m(parseInt(i[2],10)),m(parseInt(i[3],10)),v(i.length<5?1:parseFloat(i[4]))]}{const i=b.exec(t);if(i)return[m(parseInt(i[1],16)),m(parseInt(i[2],16)),m(parseInt(i[3],16)),1]}{const i=g.exec(t);if(i)return[m(17*parseInt(i[1],16)),m(17*parseInt(i[2],16)),m(17*parseInt(i[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function _(t){const i=y(t);return{t:`rgb(${i[0]}, ${i[1]}, ${i[2]})`,i:(s=i,.199*s[0]+.687*s[1]+.114*s[2]>160?"black":"white")};var s}class C{constructor(){this.h=[]}l(t,i,s){const h={o:t,_:i,u:!0===s};this.h.push(h)}p(t){const i=this.h.findIndex((i=>t===i.o));i>-1&&this.h.splice(i,1)}v(t){this.h=this.h.filter((i=>i._!==t))}m(t,i){const s=[...this.h];this.h=this.h.filter((t=>!t.u)),s.forEach((s=>s.o(t,i)))}g(){return this.h.length>0}M(){this.h=[]}}function E(t){for(var i=arguments.length,s=new Array(i>1?i-1:0),h=1;h<i;h++)s[h-1]=arguments[h];for(const e of s)for(const i in e)void 0!==e[i]&&("object"!=typeof e[i]||void 0===t[i]?t[i]=e[i]:E(t[i],e[i]));return t}function x(t){return"number"==typeof t&&isFinite(t)}function T(t){return"number"==typeof t&&t%1==0}function V(t){return"string"==typeof t}function F(t){return"boolean"==typeof t}function S(t){const i=t;if(!i||"object"!=typeof i)return i;let s,h,e;for(h in s=Array.isArray(i)?[]:{},i)i.hasOwnProperty(h)&&(e=i[h],s[h]=e&&"object"==typeof e?S(e):e);return s}function R(t){return null!==t}function N(t){return null===t?void 0:t}const k="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function L(t,i,s){return void 0===i&&(i=k),`${s=void 0!==s?`${s} `:""}${t}px ${i}`}class D{constructor(t){this.S={k:1,C:5,T:NaN,D:"",P:"",R:"",A:"",O:0,L:0,I:0,B:0,V:0},this.N=t}F(){const t=this.S,i=this.W(),s=this.j();return t.T===i&&t.P===s||(t.T=i,t.P=s,t.D=L(i,s),t.B=2.5/12*i,t.O=t.B,t.L=i/12*t.C,t.I=i/12*t.C,t.V=0),t.R=this.$(),t.A=this.H(),this.S}$(){return this.N.F().layout.textColor}H(){return this.N.U()}W(){return this.N.F().layout.fontSize}j(){return this.N.F().layout.fontFamily}}class P{constructor(){this.q=[]}Y(t){this.q=t}X(t,i,s,h){this.q.forEach((e=>{t.save(),e.X(t,i,s,h),t.restore()}))}}class U{X(t,i,s,h){t.save(),t.scale(i,i),this.Z(t,s,h),t.restore()}K(t,i,s,h){t.save(),t.scale(i,i),this.G(t,s,h),t.restore()}G(t,i,s){}}class $ extends U{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J||null===this.J.it)return;const i=this.J.it,s=this.J,h=h=>{t.beginPath();for(let e=i.to-1;e>=i.from;--e){const i=s.st[e];t.moveTo(i.nt,i.et),t.arc(i.nt,i.et,h,0,2*Math.PI)}t.fill()};t.fillStyle=s.rt,h(s.ht+2),t.fillStyle=s.lt,h(s.ht)}}function I(){return{st:[{nt:0,et:0,ot:0,_t:0}],lt:"",rt:"",ht:0,it:null}}const O={from:0,to:1};class B{constructor(t,i){this.ut=new P,this.ct=[],this.dt=[],this.ft=!0,this.N=t,this.vt=i,this.ut.Y(this.ct)}bt(t){const i=this.N.wt();i.length!==this.ct.length&&(this.dt=i.map(I),this.ct=this.dt.map((t=>{const i=new $;return i.tt(t),i})),this.ut.Y(this.ct)),this.ft=!0}gt(t,i,s){return this.ft&&(this.Mt(t),this.ft=!1),this.ut}Mt(t){const i=this.N.wt(),s=this.vt.St(),h=this.N.yt();i.forEach(((i,e)=>{var n;const r=this.dt[e],o=i.kt(s);if(null===o||!i.Ct())return void(r.it=null);const l=f(i.xt());r.lt=o.Tt,r.ht=o.ht,r.st[0]._t=o._t,r.st[0].et=i.Pt().Dt(o._t,l.Rt),r.rt=null!==(n=o.At)&&void 0!==n?n:this.N.Ot(r.st[0].et/t),r.st[0].ot=s,r.st[0].nt=h.Lt(s),r.it=O}))}}class Y{constructor(t){this.Et=t}X(t,i,s,h){if(null===this.Et)return;const e=this.Et.It.Ct,n=this.Et.Bt.Ct;if(!e&&!n)return;t.save();const r=Math.round(this.Et.nt*i),o=Math.round(this.Et.et*i),u=Math.ceil(this.Et.Vt*i),c=Math.ceil(this.Et.Nt*i);t.lineCap="butt",e&&r>=0&&(t.lineWidth=Math.floor(this.Et.It.Ft*i),t.strokeStyle=this.Et.It.R,t.fillStyle=this.Et.It.R,l(t,this.Et.It.Wt),function(t,i,s,h){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(i+e,0),t.lineTo(i+e,h),t.stroke()}(t,r,0,c)),n&&o>=0&&(t.lineWidth=Math.floor(this.Et.Bt.Ft*i),t.strokeStyle=this.Et.Bt.R,t.fillStyle=this.Et.Bt.R,l(t,this.Et.Bt.Wt),a(t,o,0,u)),t.restore()}}class A{constructor(t){this.ft=!0,this.zt={It:{Ft:1,Wt:0,R:"",Ct:!1},Bt:{Ft:1,Wt:0,R:"",Ct:!1},Vt:0,Nt:0,nt:0,et:0},this.jt=new Y(this.zt),this.$t=t}bt(){this.ft=!0}gt(t,i){return this.ft&&(this.Mt(),this.ft=!1),this.jt}Mt(){const t=this.$t.Ct(),i=f(this.$t.Ht()),s=i.Ut().F().crosshair,h=this.zt;h.Bt.Ct=t&&this.$t.qt(i),h.It.Ct=t&&this.$t.Yt(),h.Bt.Ft=s.horzLine.width,h.Bt.Wt=s.horzLine.style,h.Bt.R=s.horzLine.color,h.It.Ft=s.vertLine.width,h.It.Wt=s.vertLine.style,h.It.R=s.vertLine.color,h.Vt=i.Xt(),h.Nt=i.Zt(),h.nt=this.$t.Kt(),h.et=this.$t.Gt()}}function z(t,i,s,h,e,n){t.fillRect(i+n,s,h-2*n,n),t.fillRect(i+n,s+e-n,h-2*n,n),t.fillRect(i,s,n,e),t.fillRect(i+h-n,s,n,e)}function W(t,i,s){t.save(),t.scale(i,i),s(),t.restore()}function q(t,i,s,h,e,n){t.save(),t.globalCompositeOperation="copy",t.fillStyle=n,t.fillRect(i,s,h,e),t.restore()}function X(t,i){return Array.isArray(t)?t.map((t=>0===t?t:t+i)):t+i}function j(t,i,s,h,e,n){let r,o,l,a;if(Array.isArray(n))if(2===n.length){const t=Math.max(0,n[0]),i=Math.max(0,n[1]);r=t,o=t,l=i,a=i}else{if(4!==n.length)throw new Error("Wrong border radius - it should be like css border radius");r=Math.max(0,n[0]),o=Math.max(0,n[1]),l=Math.max(0,n[2]),a=Math.max(0,n[3])}else{const t=Math.max(0,n);r=t,o=t,l=t,a=t}t.beginPath(),t.moveTo(i+r,s),t.lineTo(i+h-o,s),0!==o&&t.arcTo(i+h,s,i+h,s+o,o),t.lineTo(i+h,s+e-l),0!==l&&t.arcTo(i+h,s+e,i+h-l,s+e,l),t.lineTo(i+a,s+e),0!==a&&t.arcTo(i,s+e,i,s+e-a,a),t.lineTo(i,s+r),0!==r&&t.arcTo(i,s,i+r,s,r)}function G(t,i,s,h,e,n,r,o,l){if(void 0===r&&(r=0),void 0===o&&(o=0),void 0===l&&(l=""),t.save(),!r||!l||l===n)return j(t,i,s,h,e,o),t.fillStyle=n,t.fill(),void t.restore();const a=r/2;"transparent"!==n&&(j(t,i+r,s+r,h-2*r,e-2*r,X(o,-r)),t.fillStyle=n,t.fill()),"transparent"!==l&&(j(t,i+a,s+a,h-r,e-r,X(o,-a)),t.lineWidth=r,t.strokeStyle=l,t.closePath(),t.stroke())}function J(t,i,s,h,e,n,r){t.save(),t.globalCompositeOperation="copy";const o=t.createLinearGradient(0,0,0,e);o.addColorStop(0,n),o.addColorStop(1,r),t.fillStyle=o,t.fillRect(i,s,h,e),t.restore()}class Q{constructor(t,i){this.tt(t,i)}tt(t,i){this.Et=t,this.Jt=i}X(t,i,s,h,e,n){if(!this.Et.Ct)return;t.font=i.D;const r=this.Qt(t,i,s,h,e,n),o=this.Et.R||this.Jt.R,l=this.Jt.t;if(t.fillStyle=this.Jt.t,this.Et.ti){const s=(i,s)=>{r.ii?G(t,r.si,r.ni,r.ei,r.ri,i,r.hi,[r.ht,0,0,r.ht],s):G(t,r.li,r.ni,r.ei,r.ri,i,r.hi,[0,r.ht,r.ht,0],s)};s(l,"transparent"),this.Et.ai&&(t.fillStyle=o,t.fillRect(r.li,r.oi,r._i-r.li,r.ui)),s("transparent",l),this.Et.ci&&(t.fillStyle=i.A,t.fillRect(r.ii?r.di-r.hi:0,r.ni,r.hi,r.fi-r.ni)),t.save(),t.translate(r.pi,(r.ni+r.fi)/2+r.vi),W(t,n,(()=>{t.fillStyle=o,t.fillText(this.Et.ti,0,0)})),t.restore()}}Zt(t,i){return this.Et.Ct?t.T+t.B+t.O:0}Qt(t,i,s,h,e,n){const r=this.Et.ai||!this.Et.mi?i.C:0,o=i.k,l=i.B+this.Jt.bi,a=i.O+this.Jt.wi,u=i.L,c=i.I,f=this.Et.ti,d=i.T,p=s.gi(t,f)*n,m=d+l+a,v=o+u+c+Math.ceil(s.Mi(t,f))+r,g=Math.max(1,Math.floor(n));let b=Math.round(m*n);b%2!=g%2&&(b+=1);const M=this.Et.Si?Math.max(1,Math.floor(o*n)):0,w=Math.round(v*n),y=Math.round(r*n),_=Math.ceil(h*n),C=Math.ceil(u*n);let E=this.Jt.yi;this.Jt.ki&&(E=this.Jt.ki),E=Math.round(E*n)-Math.floor(.5*n);const x=Math.floor(E+g/2-b/2),T=x+b,V="right"===e,F=V?_-M:M,S=_;let R,N,k=F;const L=2*n;return t.textAlign=V?"right":"left",t.textBaseline="middle",V?(k=F-w,R=F-y,N=F-y-C-1):(k=F+w,R=F+y,N=F+y+C),{ii:V,ni:x,oi:E,fi:T,ei:w,ri:b,ht:L,hi:M,si:k,li:F,_i:R,pi:N,ui:g,di:S,vi:p}}}class Z{constructor(t){this.Ci={yi:0,R:"#FFF",t:"#000",wi:0,bi:0},this.xi={ti:"",Ct:!1,ai:!0,mi:!1,At:"",R:"#FFF",ci:!1,Si:!1},this.Ti={ti:"",Ct:!1,ai:!1,mi:!0,At:"",R:"#FFF",ci:!0,Si:!0},this.ft=!0,this.Di=new(t||Q)(this.xi,this.Ci),this.Pi=new(t||Q)(this.Ti,this.Ci)}ti(){return this.Ri(),this.xi.ti}yi(){return this.Ri(),this.Ci.yi}bt(){this.ft=!0}Zt(t,i){return void 0===i&&(i=!1),Math.max(this.Di.Zt(t,i),this.Pi.Zt(t,i))}Ai(){return this.Ci.ki||0}Oi(t){this.Ci.ki=t}Li(){return this.Ri(),this.xi.Ct||this.Ti.Ct}Ei(){return this.Ri(),this.xi.Ct}gt(t){return this.Ri(),this.xi.ai=this.xi.ai&&t.F().ticksVisible,this.Ti.ai=this.Ti.ai&&t.F().ticksVisible,this.Di.tt(this.xi,this.Ci),this.Pi.tt(this.Ti,this.Ci),this.Di}Ii(){return this.Ri(),this.Di.tt(this.xi,this.Ci),this.Pi.tt(this.Ti,this.Ci),this.Pi}Ri(){this.ft&&(this.xi.ai=!0,this.Ti.ai=!1,this.Bi(this.xi,this.Ti,this.Ci))}}class K extends Z{constructor(t,i,s){super(),this.$t=t,this.Vi=i,this.Ni=s}Bi(t,i,s){t.Ct=!1;const h=this.$t.F().horzLine;if(!h.labelVisible)return;const e=this.Vi.xt();if(!this.$t.Ct()||this.Vi.Fi()||null===e)return;const n=_(h.labelBackgroundColor);s.t=n.t,s.R=n.i;const r=2/12*this.Vi.T();s.bi=r,s.wi=r;const o=this.Ni(this.Vi);s.yi=o.yi,t.ti=this.Vi.Wi(o._t,e),t.Ct=!0}}const H=/[1-9]/g;class tt{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,s){if(null===this.Et||!1===this.Et.Ct||0===this.Et.ti.length)return;t.font=i.D;const h=Math.round(i.zi.Mi(t,this.Et.ti,H));if(h<=0)return;t.save();const e=i.ji,n=h+2*e,r=n/2,o=this.Et.Xt;let l=this.Et.yi,a=Math.floor(l-r)+.5;a<0?(l+=Math.abs(0-a),a=Math.floor(l-r)+.5):a+n>o&&(l-=Math.abs(o-(a+n)),a=Math.floor(l-r)+.5);const u=a+n,c=Math.ceil(0+i.k+i.C+i.B+i.T+i.O);t.fillStyle=this.Et.t;const d=Math.round(a*s),p=Math.round(0*s),m=Math.round(u*s),v=Math.round(c*s),g=Math.round(2*s);if(t.beginPath(),t.moveTo(d,p),t.lineTo(d,v-g),t.arcTo(d,v,d+g,v,g),t.lineTo(m-g,v),t.arcTo(m,v,m,v-g,g),t.lineTo(m,p),t.fill(),this.Et.ai){const h=Math.round(this.Et.yi*s),e=p,n=Math.round((e+i.C)*s);t.fillStyle=this.Et.R;const r=Math.max(1,Math.floor(s)),o=Math.floor(.5*s);t.fillRect(h-o,e,r,n-e)}const b=0+i.k+i.C+i.B+i.T/2;t.textAlign="left",t.textBaseline="middle",t.fillStyle=this.Et.R;const M=i.zi.gi(t,"Apr0");t.translate((a+e)*s,(b+M)*s),W(t,s,(()=>t.fillText(f(this.Et).ti,0,0))),t.restore()}}class it{constructor(t,i,s){this.ft=!0,this.jt=new tt,this.zt={Ct:!1,t:"#4c525e",R:"white",ti:"",Xt:0,yi:NaN,ai:!0},this.vt=t,this.$i=i,this.Ni=s}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.jt.tt(this.zt),this.jt}Mt(){const t=this.zt;t.Ct=!1;const i=this.vt.F().vertLine;if(!i.labelVisible)return;const s=this.$i.yt();if(s.Fi())return;t.Xt=s.Xt();const h=this.Ni();if(!h.ot)return;t.yi=h.yi;const e=s.Hi(this.vt.St());t.ti=s.Ui(f(e)),t.Ct=!0;const n=_(i.labelBackgroundColor);t.t=n.t,t.R=n.i,t.ai=s.F().ticksVisible}}class st{constructor(){this.qi=null,this.Yi=0}Xi(){return this.Yi}Zi(t){this.Yi=t}Pt(){return this.qi}Ki(t){this.qi=t}Gi(t){return[]}Ji(){return[]}Ct(){return!0}}var ht;!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(ht||(ht={}));class et extends st{constructor(t,i){super(),this.Qi=null,this.ts=NaN,this.ss=0,this.ns=!0,this.es=new Map,this.rs=!1,this.hs=NaN,this.ls=NaN,this.os=NaN,this._s=NaN,this.$i=t,this.us=i,this.cs=new B(t,this),this.ds=((t,i)=>s=>{const h=i(),e=t();if(s===f(this.Qi).fs())return{_t:e,yi:h};{const t=f(s.xt());return{_t:s.ps(h,t),yi:h}}})((()=>this.ts),(()=>this.ls));const s=((t,i)=>()=>({ot:this.$i.yt().vs(t()),yi:i()}))((()=>this.ss),(()=>this.Kt()));this.bs=new it(this,t,s),this.ws=new A(this)}F(){return this.us}gs(t,i){this.os=t,this._s=i}Ms(){this.os=NaN,this._s=NaN}Ss(){return this.os}ys(){return this._s}ks(t,i,s){this.rs||(this.rs=!0),this.ns=!0,this.Cs(t,i,s)}St(){return this.ss}Kt(){return this.hs}Gt(){return this.ls}Ct(){return this.ns}xs(){this.ns=!1,this.Ts(),this.ts=NaN,this.hs=NaN,this.ls=NaN,this.Qi=null,this.Ms()}Ds(t){return null!==this.Qi?[this.ws,this.cs]:[]}qt(t){return t===this.Qi&&this.us.horzLine.visible}Yt(){return this.us.vertLine.visible}Ps(t,i){this.ns&&this.Qi===t||this.es.clear();const s=[];return this.Qi===t&&s.push(this.Rs(this.es,i,this.ds)),s}Ji(){return this.ns?[this.bs]:[]}Ht(){return this.Qi}As(){this.ws.bt(),this.es.forEach((t=>t.bt())),this.bs.bt(),this.cs.bt()}Os(t){return t&&!t.fs().Fi()?t.fs():null}Cs(t,i,s){this.Ls(t,i,s)&&this.As()}Ls(t,i,s){const h=this.hs,e=this.ls,n=this.ts,r=this.ss,o=this.Qi,l=this.Os(s);this.ss=t,this.hs=isNaN(t)?NaN:this.$i.yt().Lt(t),this.Qi=s;const a=null!==l?l.xt():null;return null!==l&&null!==a?(this.ts=i,this.ls=l.Dt(i,a)):(this.ts=NaN,this.ls=NaN),h!==this.hs||e!==this.ls||r!==this.ss||n!==this.ts||o!==this.Qi}Ts(){const t=this.$i.wt().map((t=>t.Is().Es())).filter(R),i=0===t.length?null:Math.max(...t);this.ss=null!==i?i:NaN}Rs(t,i,s){let h=t.get(i);return void 0===h&&(h=new K(this,i,s),t.set(i,h)),h}}function nt(t){return"left"===t||"right"===t}class rt{constructor(t){this.Bs=new Map,this.Vs=[],this.Ns=t}Fs(t,i){const s=function(t,i){return void 0===t?i:{Ws:Math.max(t.Ws,i.Ws),zs:t.zs||i.zs}}(this.Bs.get(t),i);this.Bs.set(t,s)}js(){return this.Ns}$s(t){const i=this.Bs.get(t);return void 0===i?{Ws:this.Ns}:{Ws:Math.max(this.Ns,i.Ws),zs:i.zs}}Hs(){this.Us(),this.Vs=[{qs:0}]}Ys(t){this.Us(),this.Vs=[{qs:1,Rt:t}]}Xs(t){this.Zs(),this.Vs.push({qs:5,Rt:t})}Us(){this.Zs(),this.Vs.push({qs:6})}Ks(){this.Us(),this.Vs=[{qs:4}]}Gs(t){this.Us(),this.Vs.push({qs:2,Rt:t})}Js(t){this.Us(),this.Vs.push({qs:3,Rt:t})}Qs(){return this.Vs}tn(t){for(const i of t.Vs)this.sn(i);this.Ns=Math.max(this.Ns,t.Ns),t.Bs.forEach(((t,i)=>{this.Fs(i,t)}))}static nn(){return new rt(2)}static en(){return new rt(3)}sn(t){switch(t.qs){case 0:this.Hs();break;case 1:this.Ys(t.Rt);break;case 2:this.Gs(t.Rt);break;case 3:this.Js(t.Rt);break;case 4:this.Ks();break;case 5:this.Xs(t.Rt);break;case 6:this.Zs()}}Zs(){const t=this.Vs.findIndex((t=>5===t.qs));-1!==t&&this.Vs.splice(t,1)}}function ot(t,i){if(!x(t))return"n/a";if(!T(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");return 0===i?t.toString():("0000000000000000"+t.toString()).slice(-i)}class lt{constructor(t,i){if(i||(i=1),x(t)&&T(t)||(t=100),t<0)throw new TypeError("invalid base");this.Vi=t,this.rn=i,this.hn()}format(t){const i=t<0?"\u2212":"";return t=Math.abs(t),i+this.ln(t)}hn(){if(this.an=0,this.Vi>0&&this.rn>0){let t=this.Vi;for(;t>1;)t/=10,this.an++}}ln(t){const i=this.Vi/this.rn;let s=Math.floor(t),h="";const e=void 0!==this.an?this.an:NaN;if(i>1){let n=+(Math.round(t*i)-s*i).toFixed(this.an);n>=i&&(n-=i,s+=1),h="."+ot(+n.toFixed(this.an)*this.rn,e)}else s=Math.round(s*i)/i,e>0&&(h="."+ot(0,e));return s.toFixed(0)+h}}class at extends lt{constructor(t){void 0===t&&(t=100),super(t)}format(t){return`${super.format(t)}%`}}class ut{constructor(t){this.on=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this._n(t):t<999995?i+this._n(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this._n(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this._n(t/1e9)+"B")}_n(t){let i;const s=Math.pow(10,this.on);return i=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this.on).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,((t,i)=>i))}}function ct(t,i,s,h,e,n,r){if(0===i.length||h.from>=i.length)return;const o=i[h.from];let l=n(t,o),a=o;if(h.to-h.from<2){const i=e/2;t.beginPath();const s={nt:o.nt-i,et:o.et},h={nt:o.nt+i,et:o.et};return t.moveTo(s.nt,s.et),t.lineTo(h.nt,h.et),void r(t,l,s,h)}const u=(i,s)=>{r(t,l,a,s),t.beginPath(),l=i,a=s};let c=a;t.beginPath(),t.moveTo(o.nt,o.et);for(let f=h.from+1;f<h.to;++f){c=i[f];const h=n(t,c);switch(s){case 0:t.lineTo(c.nt,c.et);break;case 1:t.lineTo(c.nt,i[f-1].et),h!==l&&(u(h,c),t.lineTo(c.nt,i[f-1].et)),t.lineTo(c.nt,c.et);break;case 2:{const[s,h]=pt(i,f-1,f);t.bezierCurveTo(s.nt,s.et,h.nt,h.et,c.nt,c.et);break}}1!==s&&h!==l&&(u(h,c),t.moveTo(c.nt,c.et))}(a!==c||a===c&&1===s)&&r(t,l,a,c)}function ft(t,i){return{nt:t.nt-i.nt,et:t.et-i.et}}function dt(t,i){return{nt:t.nt/i,et:t.et/i}}function pt(t,i,s){const h=Math.max(0,i-1),e=Math.min(t.length-1,s+1);var n,r;return[(n=t[i],r=dt(ft(t[s],t[h]),6),{nt:n.nt+r.nt,et:n.et+r.et}),ft(t[s],dt(ft(t[e],t[i]),6))]}function mt(t,i,s,h,e){i.lineTo(e.nt,t),i.lineTo(h.nt,t),i.closePath(),i.fillStyle=s,i.fill()}class vt extends U{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J)return;const{st:i,it:s,un:h,Ft:e,Wt:n,cn:r,dn:o}=this.J;null!==s&&(t.lineCap="butt",t.lineJoin="round",t.lineWidth=e,l(t,n),t.lineWidth=1,ct(t,i,r,s,h,this.fn.bind(this),mt.bind(null,o)))}}class gt extends vt{constructor(){super(...arguments),this.pn=null}fn(t,i){const s=this.J,{vn:h,mn:e}=i,n=s.bn;if(null!==this.pn&&this.pn.topColor===h&&this.pn.bottomColor===e&&this.pn.bottom===n)return this.pn.fillStyle;const r=t.createLinearGradient(0,0,0,n);return r.addColorStop(0,h),r.addColorStop(1,e),this.pn={topColor:h,bottomColor:e,fillStyle:r,bottom:n},r}}function bt(t,i){t.strokeStyle=i,t.stroke()}class Mt extends U{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J)return;const{st:i,it:s,un:h,cn:e,Ft:n,Wt:r}=this.J;null!==s&&(t.lineCap="butt",t.lineWidth=n,l(t,r),t.lineJoin="round",ct(t,i,e,s,h,this.wn.bind(this),bt))}}class wt extends Mt{wn(t,i){return i.lt}}function yt(t,i,s,h,e){void 0===h&&(h=0),void 0===e&&(e=t.length);let n=e-h;for(;0<n;){const e=n>>1,r=h+e;s(t[r],i)?(h=r+1,n-=e+1):n=e}return h}function _t(t,i,s,h,e){void 0===h&&(h=0),void 0===e&&(e=t.length);let n=e-h;for(;0<n;){const e=n>>1,r=h+e;s(i,t[r])?n=e:(h=r+1,n-=e+1)}return h}function Ct(t,i){return t.ot<i}function Et(t,i){return t<i.ot}function xt(t,i,s){const h=i.gn(),e=i.Mn(),n=yt(t,h,Ct),r=_t(t,e,Et);if(!s)return{from:n,to:r};let o=n,l=r;return n>0&&n<t.length&&t[n].ot>=h&&(o=n-1),r>0&&r<t.length&&t[r-1].ot<=e&&(l=r+1),{from:o,to:l}}class Tt{constructor(t,i,s){this.Sn=!0,this.yn=!0,this.kn=!0,this.Cn=[],this.xn=null,this.Tn=t,this.Dn=i,this.Pn=s}bt(t){this.Sn=!0,"data"===t&&(this.yn=!0),"options"===t&&(this.kn=!0)}gt(t,i){return this.Tn.Ct()?(this.Rn(i,t),null===this.xn?null:this.An):null}On(){this.Cn=this.Cn.map((t=>Object.assign(Object.assign({},t),this.Tn.En().Ln(t.ot))))}In(){this.xn=null}Rn(t,i){this.yn&&(this.Bn(),this.yn=!1),this.kn&&(this.On(),this.kn=!1),this.Sn&&(this.Vn(t,i),this.Sn=!1)}Vn(t,i){const s=this.Tn.Pt(),h=this.Dn.yt();if(this.In(),h.Fi()||s.Fi())return;const e=h.Nn();if(null===e)return;if(0===this.Tn.Is().Fn())return;const n=this.Tn.xt();null!==n&&(this.xn=xt(this.Cn,e,this.Pn),this.Wn(s,h,n.Rt),this.zn(t,i))}}class Vt extends Tt{constructor(t,i){super(t,i,!0)}Wn(t,i,s){i.jn(this.Cn,N(this.xn)),t.$n(this.Cn,s,N(this.xn))}Hn(t,i){return{ot:t,_t:i,nt:NaN,et:NaN}}Bn(){const t=this.Tn.En();this.Cn=this.Tn.Is().Un().map((i=>{const s=i.Rt[3];return this.qn(i.Yn,s,t)}))}}class Ft extends Vt{constructor(t,i){super(t,i),this.An=new P,this.Xn=new gt,this.Zn=new wt,this.An.Y([this.Xn,this.Zn])}qn(t,i,s){return Object.assign(Object.assign({},this.Hn(t,i)),s.Ln(t))}zn(t,i){const s=this.Tn.F();this.Xn.tt({cn:s.lineType,st:this.Cn,Wt:s.lineStyle,Ft:s.lineWidth,dn:i,bn:i,it:this.xn,un:this.Dn.yt().Kn()}),this.Zn.tt({cn:s.lineType,st:this.Cn,Wt:s.lineStyle,Ft:s.lineWidth,it:this.xn,un:this.Dn.yt().Kn()})}}class St{constructor(){this.Et=null,this.Gn=0,this.Jn=0}tt(t){this.Et=t}X(t,i,s,h){if(null===this.Et||0===this.Et.Is.length||null===this.Et.it)return;this.Gn=this.Qn(i),this.Gn>=2&&Math.max(1,Math.floor(i))%2!=this.Gn%2&&this.Gn--,this.Jn=this.Et.te?Math.min(this.Gn,Math.floor(i)):this.Gn;let e=null;const n=this.Jn<=this.Gn&&this.Et.Kn>=Math.floor(1.5*i);for(let r=this.Et.it.from;r<this.Et.it.to;++r){const s=this.Et.Is[r];e!==s.ie&&(t.fillStyle=s.ie,e=s.ie);const h=Math.floor(.5*this.Jn),o=Math.round(s.nt*i),l=o-h,a=this.Jn,u=l+a-1,c=Math.min(s.se,s.ne),f=Math.max(s.se,s.ne),d=Math.round(c*i)-h,p=Math.round(f*i)+h,m=Math.max(p-d,this.Jn);t.fillRect(l,d,a,m);const v=Math.ceil(1.5*this.Gn);if(n){if(this.Et.ee){const e=o-v;let n=Math.max(d,Math.round(s.re*i)-h),r=n+a-1;r>d+m-1&&(r=d+m-1,n=r-a+1),t.fillRect(e,n,l-e,r-n+1)}const e=o+v;let n=Math.max(d,Math.round(s.he*i)-h),r=n+a-1;r>d+m-1&&(r=d+m-1,n=r-a+1),t.fillRect(u+1,n,e-u,r-n+1)}}}Qn(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(f(this.Et).Kn,t)))}}class Rt extends Tt{constructor(t,i){super(t,i,!1)}Wn(t,i,s){i.jn(this.Cn,N(this.xn)),t.le(this.Cn,s,N(this.xn))}ae(t,i,s){return{ot:t,oe:i.Rt[0],_e:i.Rt[1],ue:i.Rt[2],ce:i.Rt[3],nt:NaN,re:NaN,se:NaN,ne:NaN,he:NaN}}Bn(){const t=this.Tn.En();this.Cn=this.Tn.Is().Un().map((i=>this.qn(i.Yn,i,t)))}}class Nt extends Rt{constructor(){super(...arguments),this.An=new St}qn(t,i,s){return Object.assign(Object.assign({},this.ae(t,i,s)),s.Ln(t))}zn(){const t=this.Tn.F();this.An.tt({Is:this.Cn,Kn:this.Dn.yt().Kn(),ee:t.openVisible,te:t.thinBars,it:this.xn})}}function kt(t,i,s){return Math.min(Math.max(t,i),s)}function Lt(t,i,s){return i-t<=s}function Dt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function Pt(t){const i=Math.ceil(t);return i%2==0?i-1:i}class Ut extends vt{constructor(){super(...arguments),this.pn=null}fn(t,i){const s=this.J,{de:h,fe:e,pe:n,ve:r}=i,{dn:o,bn:l}=s;if(null!==this.pn&&this.pn.topFillColor1===h&&this.pn.topFillColor2===e&&this.pn.bottomFillColor1===n&&this.pn.bottomFillColor2===r&&this.pn.baseLevelCoordinate===o&&this.pn.bottom===l)return this.pn.fillStyle;const a=t.createLinearGradient(0,0,0,l),u=kt(o/l,0,1);return a.addColorStop(0,h),a.addColorStop(u,e),a.addColorStop(u,n),a.addColorStop(1,r),this.pn={topFillColor1:h,topFillColor2:e,bottomFillColor1:n,bottomFillColor2:r,fillStyle:a,baseLevelCoordinate:o,bottom:l},a}}class $t extends Mt{constructor(){super(...arguments),this.me=null}wn(t,i){const s=this.J,{be:h,we:e}=i,{dn:n,bn:r}=s;if(null!==this.me&&this.me.topLineColor===h&&this.me.bottomLineColor===e&&this.me.baseLevelCoordinate===n&&this.me.bottom===r)return this.me.strokeStyle;const o=t.createLinearGradient(0,0,0,r),l=kt(n/r,0,1);return o.addColorStop(0,h),o.addColorStop(l,h),o.addColorStop(l,e),o.addColorStop(1,e),this.me={topLineColor:h,bottomLineColor:e,strokeStyle:o,baseLevelCoordinate:n,bottom:r},o}}class It extends Vt{constructor(t,i){super(t,i),this.An=new P,this.ge=new Ut,this.Me=new $t,this.An.Y([this.ge,this.Me])}qn(t,i,s){return Object.assign(Object.assign({},this.Hn(t,i)),s.Ln(t))}zn(t,i){const s=this.Tn.xt();if(null===s)return;const h=this.Tn.F(),e=this.Tn.Pt().Dt(h.baseValue.price,s.Rt),n=this.Dn.yt().Kn();this.ge.tt({st:this.Cn,Ft:h.lineWidth,Wt:h.lineStyle,cn:h.lineType,dn:e,bn:i,it:this.xn,un:n}),this.Me.tt({st:this.Cn,Ft:h.lineWidth,Wt:h.lineStyle,cn:h.lineType,dn:e,bn:i,it:this.xn,un:n})}}class Ot{constructor(){this.Et=null,this.Gn=0}tt(t){this.Et=t}X(t,i,s,h){if(null===this.Et||0===this.Et.Is.length||null===this.Et.it)return;this.Gn=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const s=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),h=Math.floor(t*s*i),e=Math.floor(t*i),n=Math.min(h,e);return Math.max(Math.floor(i),n)}(this.Et.Kn,i),this.Gn>=2&&Math.floor(i)%2!=this.Gn%2&&this.Gn--;const e=this.Et.Is;this.Et.Se&&this.ye(t,e,this.Et.it,i),this.Et.ci&&this.ke(t,e,this.Et.it,this.Et.Kn,i);const n=this.Ce(i);(!this.Et.ci||this.Gn>2*n)&&this.xe(t,e,this.Et.it,i)}ye(t,i,s,h){if(null===this.Et)return;let e="",n=Math.min(Math.floor(h),Math.floor(this.Et.Kn*h));n=Math.max(Math.floor(h),Math.min(n,this.Gn));const r=Math.floor(.5*n);let o=null;for(let l=s.from;l<s.to;l++){const s=i[l];s.Te!==e&&(t.fillStyle=s.Te,e=s.Te);const a=Math.round(Math.min(s.re,s.he)*h),u=Math.round(Math.max(s.re,s.he)*h),c=Math.round(s.se*h),f=Math.round(s.ne*h);let d=Math.round(h*s.nt)-r;const p=d+n-1;null!==o&&(d=Math.max(o+1,d),d=Math.min(d,p));const m=p-d+1;t.fillRect(d,c,m,a-c),t.fillRect(d,u+1,m,f-u),o=p}}Ce(t){let i=Math.floor(1*t);this.Gn<=2*i&&(i=Math.floor(.5*(this.Gn-1)));const s=Math.max(Math.floor(t),i);return this.Gn<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}ke(t,i,s,h,e){if(null===this.Et)return;let n="";const r=this.Ce(e);let o=null;for(let l=s.from;l<s.to;l++){const s=i[l];s.De!==n&&(t.fillStyle=s.De,n=s.De);let h=Math.round(s.nt*e)-Math.floor(.5*this.Gn);const a=h+this.Gn-1,u=Math.round(Math.min(s.re,s.he)*e),c=Math.round(Math.max(s.re,s.he)*e);if(null!==o&&(h=Math.max(o+1,h),h=Math.min(h,a)),this.Et.Kn*e>2*r)z(t,h,u,a-h+1,c-u+1,r);else{const i=a-h+1;t.fillRect(h,u,i,c-u+1)}o=a}}xe(t,i,s,h){if(null===this.Et)return;let e="";const n=this.Ce(h);for(let r=s.from;r<s.to;r++){const s=i[r];let o=Math.round(Math.min(s.re,s.he)*h),l=Math.round(Math.max(s.re,s.he)*h),a=Math.round(s.nt*h)-Math.floor(.5*this.Gn),u=a+this.Gn-1;if(s.ie!==e){const i=s.ie;t.fillStyle=i,e=i}this.Et.ci&&(a+=n,o+=n,u-=n,l-=n),o>l||t.fillRect(a,o,u-a+1,l-o+1)}}}class Bt extends Rt{constructor(){super(...arguments),this.An=new Ot}qn(t,i,s){return Object.assign(Object.assign({},this.ae(t,i,s)),s.Ln(t))}zn(){const t=this.Tn.F();this.An.tt({Is:this.Cn,Kn:this.Dn.yt().Kn(),Se:t.wickVisible,ci:t.borderVisible,it:this.xn})}}class Yt{constructor(){this.Et=null,this.Pe=[]}tt(t){this.Et=t,this.Pe=[]}X(t,i,s,h){if(null===this.Et||0===this.Et.st.length||null===this.Et.it)return;this.Pe.length||this.Re(i);const e=Math.max(1,Math.floor(i)),n=Math.round(this.Et.Ae*i)-Math.floor(e/2),r=n+e;for(let o=this.Et.it.from;o<this.Et.it.to;o++){const s=this.Et.st[o],h=this.Pe[o-this.Et.it.from],l=Math.round(s.et*i);let a,u;t.fillStyle=s.ie,l<=n?(a=l,u=r):(a=n,u=l-Math.floor(e/2)+e),t.fillRect(h.gn,a,h.Mn-h.gn+1,u-a)}}Re(t){if(null===this.Et||0===this.Et.st.length||null===this.Et.it)return void(this.Pe=[]);const i=Math.ceil(this.Et.Kn*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.Et.Kn*t)-i;this.Pe=new Array(this.Et.it.to-this.Et.it.from);for(let e=this.Et.it.from;e<this.Et.it.to;e++){const i=this.Et.st[e],h=Math.round(i.nt*t);let n,r;if(s%2){const t=(s-1)/2;n=h-t,r=h+t}else{const t=s/2;n=h-t,r=h+t-1}this.Pe[e-this.Et.it.from]={gn:n,Mn:r,Oe:h,Le:i.nt*t,ot:i.ot}}for(let e=this.Et.it.from+1;e<this.Et.it.to;e++){const t=this.Pe[e-this.Et.it.from],s=this.Pe[e-this.Et.it.from-1];t.ot===s.ot+1&&t.gn-s.Mn!==i+1&&(s.Oe>s.Le?s.Mn=t.gn-i-1:t.gn=s.Mn+i+1)}let h=Math.ceil(this.Et.Kn*t);for(let e=this.Et.it.from;e<this.Et.it.to;e++){const t=this.Pe[e-this.Et.it.from];t.Mn<t.gn&&(t.Mn=t.gn);const i=t.Mn-t.gn+1;h=Math.min(i,h)}if(i>0&&h<4)for(let e=this.Et.it.from;e<this.Et.it.to;e++){const t=this.Pe[e-this.Et.it.from];t.Mn-t.gn+1>h&&(t.Oe>t.Le?t.Mn-=1:t.gn+=1)}}}class At extends Vt{constructor(){super(...arguments),this.An=new Yt}qn(t,i,s){return Object.assign(Object.assign({},this.Hn(t,i)),s.Ln(t))}zn(){const t={st:this.Cn,Kn:this.Dn.yt().Kn(),it:this.xn,Ae:this.Tn.Pt().Dt(this.Tn.F().base,f(this.Tn.xt()).Rt)};this.An.tt(t)}}class zt extends Vt{constructor(){super(...arguments),this.An=new wt}qn(t,i,s){return Object.assign(Object.assign({},this.Hn(t,i)),s.Ln(t))}zn(){const t=this.Tn.F(),i={st:this.Cn,Wt:t.lineStyle,cn:t.lineType,Ft:t.lineWidth,it:this.xn,un:this.Dn.yt().Kn()};this.An.tt(i)}}const Wt=/[2-9]/g;class qt{constructor(t){void 0===t&&(t=50),this.Ee=0,this.Ie=1,this.Be=1,this.Ve={},this.Ne=new Map,this.Fe=t}We(){this.Ee=0,this.Ne.clear(),this.Ie=1,this.Be=1,this.Ve={}}Mi(t,i,s){return this.ze(t,i,s).width}gi(t,i,s){const h=this.ze(t,i,s);return((h.actualBoundingBoxAscent||0)-(h.actualBoundingBoxDescent||0))/2}ze(t,i,s){const h=s||Wt,e=String(i).replace(h,"0");if(this.Ne.has(e))return c(this.Ne.get(e)).je;if(this.Ee===this.Fe){const t=this.Ve[this.Be];delete this.Ve[this.Be],this.Ne.delete(t),this.Be++,this.Ee--}t.save(),t.textBaseline="middle";const n=t.measureText(e);return t.restore(),0===n.width&&i.length||(this.Ne.set(e,{je:n,$e:this.Ie}),this.Ve[this.Ie]=e,this.Ee++,this.Ie++),n}}class Xt{constructor(t){this.He=null,this.S=null,this.Ue="right",this.qe=0,this.Ye=t}Xe(t,i,s,h){this.He=t,this.S=i,this.qe=s,this.Ue=h}X(t,i){null!==this.S&&null!==this.He&&this.He.X(t,this.S,this.Ye,this.qe,this.Ue,i)}}class jt{constructor(t,i,s){this.Ze=t,this.Ye=new qt(50),this.Ke=i,this.N=s,this.W=-1,this.jt=new Xt(this.Ye)}gt(t,i){const s=this.N.Ge(this.Ke);if(null===s)return null;const h=s.Je(this.Ke)?s.Qe():this.Ke.Pt();if(null===h)return null;const e=s.tr(h);if("overlay"===e)return null;const n=this.N.ir();return n.T!==this.W&&(this.W=n.T,this.Ye.We()),this.jt.Xe(this.Ze.Ii(),n,i,e),this.jt}}class Gt{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,s,h){if(null===this.Et)return;if(!1===this.Et.Ct)return;const e=Math.round(this.Et.et*i);if(e<0||e>Math.ceil(this.Et.Zt*i))return;const n=Math.ceil(this.Et.Xt*i);t.lineCap="butt",t.strokeStyle=this.Et.R,t.lineWidth=Math.floor(this.Et.Ft*i),l(t,this.Et.Wt),a(t,e,0,n)}}class Jt{constructor(t){this.sr={Xt:0,Zt:0,et:0,R:"rgba(0, 0, 0, 0)",Ft:1,Wt:0,Ct:!1},this.nr=new Gt,this.ft=!0,this.Tn=t,this.Dn=t.Ut(),this.nr.tt(this.sr)}bt(){this.ft=!0}gt(t,i){return this.Tn.Ct()?(this.ft&&(this.er(t,i),this.ft=!1),this.nr):null}}class Qt extends Jt{constructor(t){super(t)}er(t,i){this.sr.Ct=!1;const s=this.Tn.Pt(),h=s.rr().rr;if(2!==h&&3!==h)return;const e=this.Tn.F();if(!e.baseLineVisible||!this.Tn.Ct())return;const n=this.Tn.xt();null!==n&&(this.sr.Ct=!0,this.sr.et=s.Dt(n.Rt,n.Rt),this.sr.Xt=i,this.sr.Zt=t,this.sr.R=e.baseLineColor,this.sr.Ft=e.baseLineWidth,this.sr.Wt=e.baseLineStyle)}}class Zt{constructor(){this.Et=null}tt(t){this.Et=t}hr(){return this.Et}X(t,i,s,h){const e=this.Et;if(null===e)return;t.save();const n=Math.max(1,Math.floor(i)),r=n%2/2,o=Math.round(e.Le.x*i)+r,l=e.Le.y*i;t.fillStyle=e.lr,t.beginPath();const a=Math.max(2,1.5*e.ar)*i;t.arc(o,l,a,0,2*Math.PI,!1),t.fill(),t.fillStyle=e._r,t.beginPath(),t.arc(o,l,e.ht*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=n,t.strokeStyle=e.ur,t.beginPath(),t.arc(o,l,e.ht*i+n/2,0,2*Math.PI,!1),t.stroke(),t.restore()}}const Kt=[{cr:0,dr:.25,pr:4,vr:10,mr:.25,br:0,wr:.4,gr:.8},{cr:.25,dr:.525,pr:10,vr:14,mr:0,br:0,wr:.8,gr:0},{cr:.525,dr:1,pr:14,vr:14,mr:0,br:0,wr:0,gr:0}];function Ht(t,i,s,h){return function(t,i){if("transparent"===t)return t;const s=y(t),h=s[3];return`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${i*h})`}(t,s+(h-s)*i)}function ti(t,i){const s=t%2600/2600;let h;for(const l of Kt)if(s>=l.cr&&s<=l.dr){h=l;break}u(void 0!==h,"Last price animation internal logic error");const e=(s-h.cr)/(h.dr-h.cr);return{_r:Ht(i,e,h.mr,h.br),ur:Ht(i,e,h.wr,h.gr),ht:(n=e,r=h.pr,o=h.vr,r+(o-r)*n)};var n,r,o}class ii{constructor(t){this.jt=new Zt,this.ft=!0,this.Mr=!0,this.Sr=performance.now(),this.yr=this.Sr-1,this.kr=t}Cr(){this.yr=this.Sr-1,this.bt()}Tr(){if(this.bt(),2===this.kr.F().lastPriceAnimation){const t=performance.now(),i=this.yr-t;if(i>0)return void(i<650&&(this.yr+=2600));this.Sr=t,this.yr=t+2600}}bt(){this.ft=!0}Dr(){this.Mr=!0}Ct(){return 0!==this.kr.F().lastPriceAnimation}Pr(){switch(this.kr.F().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.yr}}gt(t,i){return this.ft?(this.Mt(t,i),this.ft=!1,this.Mr=!1):this.Mr&&(this.Rr(),this.Mr=!1),this.jt}Mt(t,i){this.jt.tt(null);const s=this.kr.Ut().yt(),h=s.Nn(),e=this.kr.xt();if(null===h||null===e)return;const n=this.kr.Ar(!0);if(n.Or||!h.Lr(n.Yn))return;const r={x:s.Lt(n.Yn),y:this.kr.Pt().Dt(n._t,e.Rt)},o=n.R,l=this.kr.F().lineWidth,a=ti(this.Er(),o);this.jt.tt({lr:o,ar:l,_r:a._r,ur:a.ur,ht:a.ht,Le:r})}Rr(){const t=this.jt.hr();if(null!==t){const i=ti(this.Er(),t.lr);t._r=i._r,t.ur=i.ur,t.ht=i.ht}}Er(){return this.Pr()?performance.now()-this.Sr:2599}}function si(t,i){return Pt(Math.min(Math.max(t,12),30)*i)}function hi(t,i){switch(t){case"arrowDown":case"arrowUp":return si(i,1);case"circle":return si(i,.8);case"square":return si(i,.7)}}function ei(t){return function(t){const i=Math.ceil(t);return i%2!=0?i-1:i}(si(t,1))}function ni(t){return Math.max(si(t,.1),3)}function ri(t,i,s,h,e){const n=hi("square",s),r=(n-1)/2,o=t-r,l=i-r;return h>=o&&h<=o+n&&e>=l&&e<=l+n}function oi(t,i,s,h,e){const n=(hi("arrowUp",e)-1)/2,r=(Pt(e/2)-1)/2;i.beginPath(),t?(i.moveTo(s-n,h),i.lineTo(s,h-n),i.lineTo(s+n,h),i.lineTo(s+r,h),i.lineTo(s+r,h+n),i.lineTo(s-r,h+n),i.lineTo(s-r,h)):(i.moveTo(s-n,h),i.lineTo(s,h+n),i.lineTo(s+n,h),i.lineTo(s+r,h),i.lineTo(s+r,h-n),i.lineTo(s-r,h-n),i.lineTo(s-r,h)),i.fill()}class li extends U{constructor(){super(...arguments),this.Et=null,this.Ye=new qt,this.W=-1,this.j="",this.Ir=""}tt(t){this.Et=t}Xe(t,i){this.W===t&&this.j===i||(this.W=t,this.j=i,this.Ir=L(t,i),this.Ye.We())}Br(t,i){if(null===this.Et||null===this.Et.it)return null;for(let s=this.Et.it.from;s<this.Et.it.to;s++){const h=this.Et.st[s];if(ui(h,t,i))return{Vr:h.Nr,Fr:h.Fr}}return null}Z(t,i,s){if(null!==this.Et&&null!==this.Et.it){t.textBaseline="middle",t.font=this.Ir;for(let i=this.Et.it.from;i<this.Et.it.to;i++){const s=this.Et.st[i];void 0!==s.ti&&(s.ti.Xt=this.Ye.Mi(t,s.ti.Wr),s.ti.Zt=this.W),ai(s,t)}}}}function ai(t,i){i.fillStyle=t.R,void 0!==t.ti&&function(t,i,s,h){t.fillText(i,s,h)}(i,t.ti.Wr,t.nt-t.ti.Xt/2,t.ti.et),function(t,i){if(0!==t.Fn){switch(t.zr){case"arrowDown":return void oi(!1,i,t.nt,t.et,t.Fn);case"arrowUp":return void oi(!0,i,t.nt,t.et,t.Fn);case"circle":return void function(t,i,s,h){const e=(hi("circle",h)-1)/2;t.beginPath(),t.arc(i,s,e,0,2*Math.PI,!1),t.fill()}(i,t.nt,t.et,t.Fn);case"square":return void function(t,i,s,h){const e=hi("square",h),n=(e-1)/2,r=i-n,o=s-n;t.fillRect(r,o,e,e)}(i,t.nt,t.et,t.Fn)}t.zr}}(t,i)}function ui(t,i,s){return!(void 0===t.ti||!function(t,i,s,h,e,n){const r=h/2;return e>=t&&e<=t+s&&n>=i-r&&n<=i+r}(t.nt,t.ti.et,t.ti.Xt,t.ti.Zt,i,s))||function(t,i,s){if(0===t.Fn)return!1;switch(t.zr){case"arrowDown":case"arrowUp":return function(t,i,s,h,e,n){return ri(i,s,h,e,n)}(0,t.nt,t.et,t.Fn,i,s);case"circle":return function(t,i,s,h,e){const n=2+hi("circle",s)/2,r=t-h,o=i-e;return Math.sqrt(r*r+o*o)<=n}(t.nt,t.et,t.Fn,i,s);case"square":return ri(t.nt,t.et,t.Fn,i,s)}}(t,i,s)}function ci(t,i,s,h,e,n,r,o,l){const a=x(s)?s:s.ce,u=x(s)?s:s._e,c=x(s)?s:s.ue,f=x(i.size)?Math.max(i.size,0):1,d=ei(o.Kn())*f,p=d/2;switch(t.Fn=d,i.position){case"inBar":return t.et=r.Dt(a,l),void(void 0!==t.ti&&(t.ti.et=t.et+p+n+.6*e));case"aboveBar":return t.et=r.Dt(u,l)-p-h.jr,void 0!==t.ti&&(t.ti.et=t.et-p-.6*e,h.jr+=1.2*e),void(h.jr+=d+n);case"belowBar":return t.et=r.Dt(c,l)+p+h.$r,void 0!==t.ti&&(t.ti.et=t.et+p+n+.6*e,h.$r+=1.2*e),void(h.$r+=d+n)}i.position}class fi{constructor(t,i){this.ft=!0,this.Hr=!0,this.Ur=!0,this.qr=null,this.jt=new li,this.kr=t,this.$i=i,this.Et={st:[],it:null}}bt(t){this.ft=!0,this.Ur=!0,"data"===t&&(this.Hr=!0)}gt(t,i,s){if(!this.kr.Ct())return null;this.ft&&this.Yr();const h=this.$i.F().layout;return this.jt.Xe(h.fontSize,h.fontFamily),this.jt.tt(this.Et),this.jt}Xr(){if(this.Ur){if(this.kr.Zr().length>0){const t=this.$i.yt().Kn(),i=ni(t),s=1.5*ei(t)+2*i;this.qr={above:s,below:s}}else this.qr=null;this.Ur=!1}return this.qr}Yr(){const t=this.kr.Pt(),i=this.$i.yt(),s=this.kr.Zr();this.Hr&&(this.Et.st=s.map((t=>({ot:t.time,nt:0,et:0,Fn:0,zr:t.shape,R:t.color,Nr:t.internalId,Fr:t.id,ti:void 0}))),this.Hr=!1);const h=this.$i.F().layout;this.Et.it=null;const e=i.Nn();if(null===e)return;const n=this.kr.xt();if(null===n)return;if(0===this.Et.st.length)return;let r=NaN;const o=ni(i.Kn()),l={jr:o,$r:o};this.Et.it=xt(this.Et.st,e,!0);for(let a=this.Et.it.from;a<this.Et.it.to;a++){const e=s[a];e.time!==r&&(l.jr=o,l.$r=o,r=e.time);const u=this.Et.st[a];u.nt=i.Lt(e.time),void 0!==e.text&&e.text.length>0&&(u.ti={Wr:e.text,et:0,Xt:0,Zt:0});const c=this.kr.Kr(e.time);null!==c&&ci(u,e,c,l,h.fontSize,o,t,i,n.Rt)}this.ft=!1}}class di extends Jt{constructor(t){super(t)}er(t,i){const s=this.sr;s.Ct=!1;const h=this.Tn.F();if(!h.priceLineVisible||!this.Tn.Ct())return;const e=this.Tn.Ar(0===h.priceLineSource);e.Or||(s.Ct=!0,s.et=e.yi,s.R=this.Tn.Gr(e.R),s.Xt=i,s.Zt=t,s.Ft=h.priceLineWidth,s.Wt=h.priceLineStyle)}}class pi extends Z{constructor(t){super(),this.$t=t}Bi(t,i,s){t.Ct=!1,i.Ct=!1;const h=this.$t;if(!h.Ct())return;const e=h.F(),n=e.lastValueVisible,r=""!==h.Jr(),o=0===e.seriesLastValueMode,l=h.Ar(!1);if(l.Or)return;n&&(t.ti=this.Qr(l,n,o),t.Ct=0!==t.ti.length),(r||o)&&(i.ti=this.th(l,n,r,o),i.Ct=i.ti.length>0);const a=h.Gr(l.R),u=_(a);s.t=u.t,s.R=u.i,s.yi=l.yi,i.At=h.Ut().Ot(l.yi/h.Pt().Zt()),t.At=a,t.R=s.R,i.R=s.R}th(t,i,s,h){let e="";const n=this.$t.Jr();return s&&0!==n.length&&(e+=`${n} `),i&&h&&(e+=this.$t.Pt().ih()?t.sh:t.nh),e.trim()}Qr(t,i,s){return i?s?this.$t.Pt().ih()?t.nh:t.sh:t.ti:""}}class mi{constructor(t,i){this.eh=t,this.rh=i}hh(t){return null!==t&&this.eh===t.eh&&this.rh===t.rh}lh(){return new mi(this.eh,this.rh)}ah(){return this.eh}oh(){return this.rh}_h(){return this.rh-this.eh}Fi(){return this.rh===this.eh||Number.isNaN(this.rh)||Number.isNaN(this.eh)}tn(t){return null===t?this:new mi(Math.min(this.ah(),t.ah()),Math.max(this.oh(),t.oh()))}uh(t){if(!x(t))return;if(0==this.rh-this.eh)return;const i=.5*(this.rh+this.eh);let s=this.rh-i,h=this.eh-i;s*=t,h*=t,this.rh=i+s,this.eh=i+h}dh(t){x(t)&&(this.rh+=t,this.eh+=t)}fh(){return{minValue:this.eh,maxValue:this.rh}}static ph(t){return null===t?null:new mi(t.minValue,t.maxValue)}}class vi{constructor(t,i){this.mh=t,this.bh=i||null}wh(){return this.mh}gh(){return this.bh}fh(){return null===this.mh?null:{priceRange:this.mh.fh(),margins:this.bh||void 0}}static ph(t){return null===t?null:new vi(mi.ph(t.priceRange),t.margins)}}class gi extends Jt{constructor(t,i){super(t),this.Mh=i}er(t,i){const s=this.sr;s.Ct=!1;const h=this.Mh.F();if(!this.Tn.Ct()||!h.lineVisible)return;const e=this.Mh.Sh();null!==e&&(s.Ct=!0,s.et=e,s.R=h.color,s.Xt=i,s.Zt=t,s.Ft=h.lineWidth,s.Wt=h.lineStyle)}}class bi extends Z{constructor(t,i){super(),this.kr=t,this.Mh=i}Bi(t,i,s){t.Ct=!1,i.Ct=!1;const h=this.Mh.F(),e=h.axisLabelVisible,n=""!==h.title,r=this.kr;if(!e||!r.Ct())return;const o=this.Mh.Sh();if(null===o)return;n&&(i.ti=h.title,i.Ct=!0),i.At=r.Ut().Ot(o/r.Pt().Zt()),t.ti=this.yh(h.price),t.Ct=!0;const l=_(h.color);s.t=l.t,s.R=l.i,s.yi=o}yh(t){const i=this.kr.xt();return null===i?"":this.kr.Pt().Wi(t,i.Rt)}}class Mi{constructor(t,i){this.kr=t,this.us=i,this.kh=new gi(t,this),this.Ze=new bi(t,this),this.Ch=new jt(this.Ze,t,t.Ut())}xh(t){E(this.us,t),this.bt(),this.kr.Ut().Th()}F(){return this.us}Dh(){return this.kh}Ph(){return this.Ch}Rh(){return this.Ze}bt(){this.kh.bt(),this.Ze.bt()}Sh(){const t=this.kr,i=t.Pt();if(t.Ut().yt().Fi()||i.Fi())return null;const s=t.xt();return null===s?null:i.Dt(this.us.price,s.Rt)}}class wi extends st{constructor(t){super(),this.$i=t}Ut(){return this.$i}}const yi={Bar:(t,i,s,h)=>{var e;const n=i.upColor,r=i.downColor,o=f(t(s,h)),l=d(o.Rt[0])<=d(o.Rt[3]);return{ie:null!==(e=o.R)&&void 0!==e?e:l?n:r}},Candlestick:(t,i,s,h)=>{var e,n,r;const o=i.upColor,l=i.downColor,a=i.borderUpColor,u=i.borderDownColor,c=i.wickUpColor,p=i.wickDownColor,m=f(t(s,h)),v=d(m.Rt[0])<=d(m.Rt[3]);return{ie:null!==(e=m.R)&&void 0!==e?e:v?o:l,De:null!==(n=m.At)&&void 0!==n?n:v?a:u,Te:null!==(r=m.Ah)&&void 0!==r?r:v?c:p}},Area:(t,i,s,h)=>{var e,n,r,o;const l=f(t(s,h));return{ie:null!==(e=l.lt)&&void 0!==e?e:i.lineColor,lt:null!==(n=l.lt)&&void 0!==n?n:i.lineColor,vn:null!==(r=l.vn)&&void 0!==r?r:i.topColor,mn:null!==(o=l.mn)&&void 0!==o?o:i.bottomColor}},Baseline:(t,i,s,h)=>{var e,n,r,o,l,a;const u=f(t(s,h));return{ie:u.Rt[3]>=i.baseValue.price?i.topLineColor:i.bottomLineColor,be:null!==(e=u.be)&&void 0!==e?e:i.topLineColor,we:null!==(n=u.we)&&void 0!==n?n:i.bottomLineColor,de:null!==(r=u.de)&&void 0!==r?r:i.topFillColor1,fe:null!==(o=u.fe)&&void 0!==o?o:i.topFillColor2,pe:null!==(l=u.pe)&&void 0!==l?l:i.bottomFillColor1,ve:null!==(a=u.ve)&&void 0!==a?a:i.bottomFillColor2}},Line:(t,i,s,h)=>{var e,n;const r=f(t(s,h));return{ie:null!==(e=r.R)&&void 0!==e?e:i.color,lt:null!==(n=r.R)&&void 0!==n?n:i.color}},Histogram:(t,i,s,h)=>{var e;return{ie:null!==(e=f(t(s,h)).R)&&void 0!==e?e:i.color}}};class _i{constructor(t){this.Oh=(t,i)=>void 0!==i?i.Rt:this.kr.Is().Lh(t),this.kr=t,this.Eh=yi[t.Ih()]}Ln(t,i){return this.Eh(this.Oh,this.kr.F(),t,i)}}var Ci;!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.None=0]="None",t[t.NearestRight=1]="NearestRight"}(Ci||(Ci={}));class Ei{constructor(){this.Bh=[],this.Vh=new Map,this.Nh=new Map}Fh(){return this.Fn()>0?this.Bh[this.Bh.length-1]:null}Wh(){return this.Fn()>0?this.zh(0):null}Es(){return this.Fn()>0?this.zh(this.Bh.length-1):null}Fn(){return this.Bh.length}Fi(){return 0===this.Fn()}Lr(t){return null!==this.jh(t,0)}Lh(t){return this.$h(t)}$h(t,i){void 0===i&&(i=0);const s=this.jh(t,i);return null===s?null:Object.assign(Object.assign({},this.Hh(s)),{Yn:this.zh(s)})}Un(){return this.Bh}Uh(t,i,s){if(this.Fi())return null;let h=null;for(const e of s)h=xi(h,this.qh(t,i,e));return h}tt(t){this.Nh.clear(),this.Vh.clear(),this.Bh=t}zh(t){return this.Bh[t].Yn}Hh(t){return this.Bh[t]}jh(t,i){const s=this.Yh(t);if(null===s&&0!==i)switch(i){case-1:return this.Xh(t);case 1:return this.Zh(t);default:throw new TypeError("Unknown search mode")}return s}Xh(t){let i=this.Kh(t);return i>0&&(i-=1),i!==this.Bh.length&&this.zh(i)<t?i:null}Zh(t){const i=this.Gh(t);return i!==this.Bh.length&&t<this.zh(i)?i:null}Yh(t){const i=this.Kh(t);return i===this.Bh.length||t<this.Bh[i].Yn?null:i}Kh(t){return yt(this.Bh,t,((t,i)=>t.Yn<i))}Gh(t){return _t(this.Bh,t,((t,i)=>i.Yn>t))}Jh(t,i,s){let h=null;for(let e=t;e<i;e++){const t=this.Bh[e].Rt[s];Number.isNaN(t)||(null===h?h={Qh:t,tl:t}:(t<h.Qh&&(h.Qh=t),t>h.tl&&(h.tl=t)))}return h}qh(t,i,s){if(this.Fi())return null;let h=null;const e=f(this.Wh()),n=f(this.Es()),r=Math.max(t,e),o=Math.min(i,n),l=30*Math.ceil(r/30),a=Math.max(l,30*Math.floor(o/30));{const t=this.Kh(r),e=this.Gh(Math.min(o,l,i));h=xi(h,this.Jh(t,e,s))}let u=this.Vh.get(s);void 0===u&&(u=new Map,this.Vh.set(s,u));for(let c=Math.max(l+1,r);c<a;c+=30){const t=Math.floor(c/30);let i=u.get(t);if(void 0===i){const h=this.Kh(30*t),e=this.Gh(30*(t+1)-1);i=this.Jh(h,e,s),u.set(t,i)}h=xi(h,i)}{const t=this.Kh(a),i=this.Gh(o);h=xi(h,this.Jh(t,i,s))}return h}}function xi(t,i){return null===t?i:null===i?t:{Qh:Math.min(t.Qh,i.Qh),tl:Math.max(t.tl,i.tl)}}class Ti extends wi{constructor(t,i,s){super(t),this.Et=new Ei,this.kh=new di(this),this.il=[],this.sl=new Qt(this),this.nl=null,this.el=null,this.rl=[],this.hl=[],this.ll=null,this.us=i,this.al=s;const h=new pi(this);this.es=[h],this.Ch=new jt(h,this,t),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(this.nl=new ii(this)),this.ol(),this._l()}M(){null!==this.ll&&clearTimeout(this.ll)}Gr(t){return this.us.priceLineColor||t}Ar(t){const i={Or:!0},s=this.Pt();if(this.Ut().yt().Fi()||s.Fi()||this.Et.Fi())return i;const h=this.Ut().yt().Nn(),e=this.xt();if(null===h||null===e)return i;let n,r;if(t){const t=this.Et.Fh();if(null===t)return i;n=t,r=t.Yn}else{const t=this.Et.$h(h.Mn(),-1);if(null===t)return i;if(n=this.Et.Lh(t.Yn),null===n)return i;r=t.Yn}const o=n.Rt[3],l=this.En().Ln(r,{Rt:n}),a=s.Dt(o,e.Rt);return{Or:!1,_t:o,ti:s.Wi(o,e.Rt),sh:s.ul(o),nh:s.cl(o,e.Rt),R:l.ie,yi:a,Yn:r}}En(){return null!==this.el||(this.el=new _i(this)),this.el}F(){return this.us}xh(t){const i=t.priceScaleId;void 0!==i&&i!==this.us.priceScaleId&&this.Ut().dl(this,i),E(this.us,t),void 0!==t.priceFormat&&(this.ol(),this.Ut().fl()),this.Ut().pl(this),this.Ut().vl(),this.ws.bt("options")}tt(t,i){this.Et.tt(t),this.ml(),this.ws.bt("data"),this.cs.bt("data"),null!==this.nl&&(i&&i.bl?this.nl.Tr():0===t.length&&this.nl.Cr());const s=this.Ut().Ge(this);this.Ut().wl(s),this.Ut().pl(this),this.Ut().vl(),this.Ut().Th()}gl(t){this.rl=t,this.ml();const i=this.Ut().Ge(this);this.cs.bt("data"),this.Ut().wl(i),this.Ut().pl(this),this.Ut().vl(),this.Ut().Th()}Ml(){return this.rl}Zr(){return this.hl}Sl(t){const i=new Mi(this,t);return this.il.push(i),this.Ut().pl(this),i}yl(t){const i=this.il.indexOf(t);-1!==i&&this.il.splice(i,1),this.Ut().pl(this)}Ih(){return this.al}xt(){const t=this.kl();return null===t?null:{Rt:t.Rt[3],Cl:t.ot}}kl(){const t=this.Ut().yt().Nn();if(null===t)return null;const i=t.gn();return this.Et.$h(i,1)}Is(){return this.Et}Kr(t){const i=this.Et.Lh(t);return null===i?null:"Bar"===this.al||"Candlestick"===this.al?{oe:i.Rt[0],_e:i.Rt[1],ue:i.Rt[2],ce:i.Rt[3]}:i.Rt[3]}xl(t){const i=this.nl;return null!==i&&i.Ct()?(null===this.ll&&i.Pr()&&(this.ll=setTimeout((()=>{this.ll=null,this.Ut().Tl()}),0)),i.Dr(),[i]):[]}Ds(){const t=[];this.Dl()||t.push(this.sl),t.push(this.ws,this.kh,this.cs);const i=this.il.map((t=>t.Dh()));return t.push(...i),t}Gi(t){return[this.Ch,...this.il.map((t=>t.Ph()))]}Ps(t,i){if(i!==this.qi&&!this.Dl())return[];const s=[...this.es];for(const h of this.il)s.push(h.Rh());return s}Pl(t,i){if(void 0!==this.us.autoscaleInfoProvider){const s=this.us.autoscaleInfoProvider((()=>{const s=this.Rl(t,i);return null===s?null:s.fh()}));return vi.ph(s)}return this.Rl(t,i)}Al(){return this.us.priceFormat.minMove}Ol(){return this.Ll}As(){var t;this.ws.bt(),this.cs.bt();for(const i of this.es)i.bt();for(const i of this.il)i.bt();this.kh.bt(),this.sl.bt(),null===(t=this.nl)||void 0===t||t.bt()}Pt(){return f(super.Pt())}kt(t){if("Line"!==this.al&&"Area"!==this.al&&"Baseline"!==this.al||!this.us.crosshairMarkerVisible)return null;const i=this.Et.Lh(t);return null===i?null:{_t:i.Rt[3],ht:this.El(),At:this.Il(),Tt:this.Bl(t)}}Jr(){return this.us.title}Ct(){return this.us.visible}Dl(){return!nt(this.Pt().Vl())}Rl(t,i){if(!T(t)||!T(i)||this.Et.Fi())return null;const s="Line"===this.al||"Area"===this.al||"Baseline"===this.al||"Histogram"===this.al?[3]:[2,1],h=this.Et.Uh(t,i,s);let e=null!==h?new mi(h.Qh,h.tl):null;if("Histogram"===this.Ih()){const t=this.us.base,i=new mi(t,t);e=null!==e?e.tn(i):i}return new vi(e,this.cs.Xr())}El(){switch(this.al){case"Line":case"Area":case"Baseline":return this.us.crosshairMarkerRadius}return 0}Il(){switch(this.al){case"Line":case"Area":case"Baseline":{const t=this.us.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}Bl(t){switch(this.al){case"Line":case"Area":case"Baseline":{const t=this.us.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.En().Ln(t).ie}ol(){switch(this.us.priceFormat.type){case"custom":this.Ll={format:this.us.priceFormat.formatter};break;case"volume":this.Ll=new ut(this.us.priceFormat.precision);break;case"percent":this.Ll=new at(this.us.priceFormat.precision);break;default:{const t=Math.pow(10,this.us.priceFormat.precision);this.Ll=new lt(t,this.us.priceFormat.minMove*t)}}null!==this.qi&&this.qi.Nl()}ml(){const t=this.Ut().yt();if(t.Fi()||0===this.Et.Fn())return void(this.hl=[]);const i=f(this.Et.Wh());this.hl=this.rl.map(((s,h)=>{const e=f(t.Fl(s.time,!0)),n=e<i?1:-1;return{time:f(this.Et.$h(e,n)).Yn,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:h,text:s.text,size:s.size}}))}_l(){switch(this.cs=new fi(this,this.Ut()),this.al){case"Bar":this.ws=new Nt(this,this.Ut());break;case"Candlestick":this.ws=new Bt(this,this.Ut());break;case"Line":this.ws=new zt(this,this.Ut());break;case"Area":this.ws=new Ft(this,this.Ut());break;case"Baseline":this.ws=new It(this,this.Ut());break;case"Histogram":this.ws=new At(this,this.Ut());break;default:throw Error("Unknown chart style assigned: "+this.al)}}}class Vi{constructor(t){this.us=t}Wl(t,i,s){let h=t;if(0===this.us.mode)return h;const e=s.fs(),n=e.xt();if(null===n)return h;const r=e.Dt(t,n),o=s.zl().filter((t=>t instanceof Ti)).reduce(((t,h)=>{if(s.Je(h)||!h.Ct())return t;const e=h.Pt(),n=h.Is();if(e.Fi()||!n.Lr(i))return t;const r=n.Lh(i);if(null===r)return t;const o=d(h.xt());return t.concat([e.Dt(r.Rt[3],o.Rt)])}),[]);if(0===o.length)return h;o.sort(((t,i)=>Math.abs(t-r)-Math.abs(i-r)));const l=o[0];return h=e.ps(l,n),h}}class Fi{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,s,h){if(null===this.Et)return;const e=Math.max(1,Math.floor(i));t.lineWidth=e;const n=Math.ceil(this.Et.Nt*i),r=Math.ceil(this.Et.Vt*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(()=>{const s=f(this.Et);if(s.jl){t.strokeStyle=s.$l,l(t,s.Hl),t.beginPath();for(const h of s.Ul){const s=Math.round(h.ql*i);t.moveTo(s,-e),t.lineTo(s,n+e)}t.stroke()}if(s.Yl){t.strokeStyle=s.Xl,l(t,s.Zl),t.beginPath();for(const h of s.Kl){const s=Math.round(h.ql*i);t.moveTo(-e,s),t.lineTo(r+e,s)}t.stroke()}}))}}class Si{constructor(t){this.jt=new Fi,this.ft=!0,this.Qi=t}bt(){this.ft=!0}gt(t,i){if(this.ft){const s=this.Qi.Ut().F().grid,h={Nt:t,Vt:i,Yl:s.horzLines.visible,jl:s.vertLines.visible,Xl:s.horzLines.color,$l:s.vertLines.color,Zl:s.horzLines.style,Hl:s.vertLines.style,Kl:this.Qi.fs().Gl(),Ul:this.Qi.Ut().yt().Gl()||[]};this.jt.tt(h),this.ft=!1}return this.jt}}class Ri{constructor(t){this.ws=new Si(t)}Dh(){return this.ws}}const Ni={Jl:4,Ql:1e-4};function ki(t,i){const s=100*(t-i)/i;return i<0?-s:s}function Li(t,i){const s=ki(t.ah(),i),h=ki(t.oh(),i);return new mi(s,h)}function Di(t,i){const s=100*(t-i)/i+100;return i<0?-s:s}function Pi(t,i){const s=Di(t.ah(),i),h=Di(t.oh(),i);return new mi(s,h)}function Ui(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const h=Dt(s+i.Ql)+i.Jl;return t<0?-h:h}function $i(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const h=Math.pow(10,s-i.Jl)-i.Ql;return t<0?-h:h}function Ii(t,i){if(null===t)return null;const s=Ui(t.ah(),i),h=Ui(t.oh(),i);return new mi(s,h)}function Oi(t,i){if(null===t)return null;const s=$i(t.ah(),i),h=$i(t.oh(),i);return new mi(s,h)}function Bi(t){if(null===t)return Ni;const i=Math.abs(t.oh()-t.ah());if(i>=1||i<1e-15)return Ni;const s=Math.ceil(Math.abs(Math.log10(i))),h=Ni.Jl+s;return{Jl:h,Ql:1/Math.pow(10,h)}}class Yi{constructor(t,i){if(this.ta=t,this.ia=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.ta))this.sa=[2,2.5,2];else{this.sa=[];for(let t=this.ta;1!==t;){if(t%2==0)this.sa.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.sa.push(2,2.5),t/=5}if(this.sa.length>100)throw new Error("something wrong with base")}}}na(t,i,s){const h=0===this.ta?0:1/this.ta;let e=Math.pow(10,Math.max(0,Math.ceil(Dt(t-i)))),n=0,r=this.ia[0];for(;;){const t=Lt(e,h,1e-14)&&e>h+1e-14,i=Lt(e,s*r,1e-14),o=Lt(e,1,1e-14);if(!(t&&i&&o))break;e/=r,r=this.ia[++n%this.ia.length]}if(e<=h+1e-14&&(e=h),e=Math.max(1,e),this.sa.length>0&&(o=e,1,1e-14,Math.abs(o-1)<1e-14))for(n=0,r=this.sa[0];Lt(e,s*r,1e-14)&&e>h+1e-14;)e/=r,r=this.sa[++n%this.sa.length];var o;return e}}class Ai{constructor(t,i,s,h){this.ea=[],this.Vi=t,this.ta=i,this.ra=s,this.ha=h}na(t,i){if(t<i)throw new Error("high < low");const s=this.Vi.Zt(),h=(t-i)*this.la()/s,e=new Yi(this.ta,[2,2.5,2]),n=new Yi(this.ta,[2,2,2.5]),r=new Yi(this.ta,[2.5,2,2]),o=[];return o.push(e.na(t,i,h),n.na(t,i,h),r.na(t,i,h)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let s=1;s<t.length;++s)t[s]<i&&(i=t[s]);return i}(o)}aa(){const t=this.Vi,i=t.xt();if(null===i)return void(this.ea=[]);const s=t.Zt(),h=this.ra(s-1,i),e=this.ra(0,i),n=this.Vi.F().entireTextOnly?this.oa()/2:0,r=n,o=s-1-n,l=Math.max(h,e),a=Math.min(h,e);if(l===a)return void(this.ea=[]);let u=this.na(l,a),c=l%u;c+=c<0?u:0;const f=l>=a?1:-1;let d=null,p=0;for(let m=l-c;m>a;m-=u){const s=this.ha(m,i,!0);null!==d&&Math.abs(s-d)<this.la()||s<r||s>o||(p<this.ea.length?(this.ea[p].ql=s,this.ea[p]._a=t.ua(m)):this.ea.push({ql:s,_a:t.ua(m)}),p++,d=s,t.ca()&&(u=this.na(m*f,a)))}this.ea.length=p}Gl(){return this.ea}oa(){return this.Vi.T()}la(){return Math.ceil(2.5*this.oa())}}function zi(t){return t.slice().sort(((t,i)=>f(t.Xi())-f(i.Xi())))}var Wi;!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(Wi||(Wi={}));const qi=new at,Xi=new lt(100,1);class ji{constructor(t,i,s,h){this.da=0,this.fa=null,this.mh=null,this.pa=null,this.va={ma:!1,ba:null},this.wa=0,this.ga=0,this.Ma=new C,this.Sa=new C,this.ya=[],this.ka=null,this.Ca=null,this.xa=null,this.Ta=null,this.Ll=Xi,this.Da=Bi(null),this.Pa=t,this.us=i,this.Ra=s,this.Aa=h,this.Oa=new Ai(this,100,this.La.bind(this),this.Ea.bind(this))}Vl(){return this.Pa}F(){return this.us}xh(t){if(E(this.us,t),this.Nl(),void 0!==t.mode&&this.Ia({rr:t.mode}),void 0!==t.scaleMargins){const i=c(t.scaleMargins.top),s=c(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(s<0||s>1||i+s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(i+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+s}`);this.Ba(),this.Ca=null}}Va(){return this.us.autoScale}ca(){return 1===this.us.mode}ih(){return 2===this.us.mode}Na(){return 3===this.us.mode}rr(){return{zs:this.us.autoScale,Fa:this.us.invertScale,rr:this.us.mode}}Ia(t){const i=this.rr();let s=null;void 0!==t.zs&&(this.us.autoScale=t.zs),void 0!==t.rr&&(this.us.mode=t.rr,2!==t.rr&&3!==t.rr||(this.us.autoScale=!0),this.va.ma=!1),1===i.rr&&t.rr!==i.rr&&(function(t,i){if(null===t)return!1;const s=$i(t.ah(),i),h=$i(t.oh(),i);return isFinite(s)&&isFinite(h)}(this.mh,this.Da)?(s=Oi(this.mh,this.Da),null!==s&&this.Wa(s)):this.us.autoScale=!0),1===t.rr&&t.rr!==i.rr&&(s=Ii(this.mh,this.Da),null!==s&&this.Wa(s));const h=i.rr!==this.us.mode;h&&(2===i.rr||this.ih())&&this.Nl(),h&&(3===i.rr||this.Na())&&this.Nl(),void 0!==t.Fa&&i.Fa!==t.Fa&&(this.us.invertScale=t.Fa,this.za()),this.Sa.m(i,this.rr())}ja(){return this.Sa}T(){return this.Ra.fontSize}Zt(){return this.da}$a(t){this.da!==t&&(this.da=t,this.Ba(),this.Ca=null)}Ha(){if(this.fa)return this.fa;const t=this.Zt()-this.Ua()-this.qa();return this.fa=t,t}wh(){return this.Ya(),this.mh}Wa(t,i){const s=this.mh;(i||null===s&&null!==t||null!==s&&!s.hh(t))&&(this.Ca=null,this.mh=t)}Fi(){return this.Ya(),0===this.da||!this.mh||this.mh.Fi()}Xa(t){return this.Fa()?t:this.Zt()-1-t}Dt(t,i){return this.ih()?t=ki(t,i):this.Na()&&(t=Di(t,i)),this.Ea(t,i)}$n(t,i,s){this.Ya();const h=this.qa(),e=f(this.wh()),n=e.ah(),r=e.oh(),o=this.Ha()-1,l=this.Fa(),a=o/(r-n),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.Za();for(let f=u;f<c;f++){const s=t[f],e=s._t;if(isNaN(e))continue;let r=e;null!==d&&(r=d(s._t,i));const o=h+a*(r-n),u=l?o:this.da-1-o;s.et=u}}le(t,i,s){this.Ya();const h=this.qa(),e=f(this.wh()),n=e.ah(),r=e.oh(),o=this.Ha()-1,l=this.Fa(),a=o/(r-n),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.Za();for(let f=u;f<c;f++){const s=t[f];let e=s.oe,r=s._e,o=s.ue,u=s.ce;null!==d&&(e=d(s.oe,i),r=d(s._e,i),o=d(s.ue,i),u=d(s.ce,i));let c=h+a*(e-n),p=l?c:this.da-1-c;s.re=p,c=h+a*(r-n),p=l?c:this.da-1-c,s.se=p,c=h+a*(o-n),p=l?c:this.da-1-c,s.ne=p,c=h+a*(u-n),p=l?c:this.da-1-c,s.he=p}}ps(t,i){const s=this.La(t,i);return this.Ka(s,i)}Ka(t,i){let s=t;return this.ih()?s=function(t,i){return i<0&&(t=-t),t/100*i+i}(s,i):this.Na()&&(s=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(s,i)),s}zl(){return this.ya}Ga(){if(this.ka)return this.ka;let t=[];for(let i=0;i<this.ya.length;i++){const s=this.ya[i];null===s.Xi()&&s.Zi(i+1),t.push(s)}return t=zi(t),this.ka=t,this.ka}Ja(t){-1===this.ya.indexOf(t)&&(this.ya.push(t),this.Nl(),this.Qa())}io(t){const i=this.ya.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.ya.splice(i,1),0===this.ya.length&&(this.Ia({zs:!0}),this.Wa(null)),this.Nl(),this.Qa()}xt(){let t=null;for(const i of this.ya){const s=i.xt();null!==s&&(null===t||s.Cl<t.Cl)&&(t=s)}return null===t?null:t.Rt}Fa(){return this.us.invertScale}Gl(){const t=null===this.xt();if(null!==this.Ca&&(t||this.Ca.so===t))return this.Ca.Gl;this.Oa.aa();const i=this.Oa.Gl();return this.Ca={Gl:i,so:t},this.Ma.m(),i}no(){return this.Ma}eo(t){this.ih()||this.Na()||null===this.xa&&null===this.pa&&(this.Fi()||(this.xa=this.da-t,this.pa=f(this.wh()).lh()))}ro(t){if(this.ih()||this.Na())return;if(null===this.xa)return;this.Ia({zs:!1}),(t=this.da-t)<0&&(t=0);let i=(this.xa+.2*(this.da-1))/(t+.2*(this.da-1));const s=f(this.pa).lh();i=Math.max(i,.1),s.uh(i),this.Wa(s)}ho(){this.ih()||this.Na()||(this.xa=null,this.pa=null)}lo(t){this.Va()||null===this.Ta&&null===this.pa&&(this.Fi()||(this.Ta=t,this.pa=f(this.wh()).lh()))}ao(t){if(this.Va())return;if(null===this.Ta)return;const i=f(this.wh())._h()/(this.Ha()-1);let s=t-this.Ta;this.Fa()&&(s*=-1);const h=s*i,e=f(this.pa).lh();e.dh(h),this.Wa(e,!0),this.Ca=null}oo(){this.Va()||null!==this.Ta&&(this.Ta=null,this.pa=null)}Ol(){return this.Ll||this.Nl(),this.Ll}Wi(t,i){switch(this.us.mode){case 2:return this.Ol().format(ki(t,i));case 3:return this.Ol().format(Di(t,i));default:return this.yh(t)}}ua(t){switch(this.us.mode){case 2:case 3:return this.Ol().format(t);default:return this.yh(t)}}ul(t){return this.yh(t,f(this._o()).Ol())}cl(t,i){return t=ki(t,i),qi.format(t)}uo(){return this.ya}co(t){this.va={ba:t,ma:!1}}As(){this.ya.forEach((t=>t.As()))}Nl(){this.Ca=null;const t=this._o();let i=100;null!==t&&(i=Math.round(1/t.Al())),this.Ll=Xi,this.ih()?(this.Ll=qi,i=100):this.Na()?(this.Ll=new lt(100,1),i=100):null!==t&&(this.Ll=t.Ol()),this.Oa=new Ai(this,i,this.La.bind(this),this.Ea.bind(this)),this.Oa.aa()}Qa(){this.ka=null}_o(){return this.ya[0]||null}Ua(){return this.Fa()?this.us.scaleMargins.bottom*this.Zt()+this.ga:this.us.scaleMargins.top*this.Zt()+this.wa}qa(){return this.Fa()?this.us.scaleMargins.top*this.Zt()+this.wa:this.us.scaleMargins.bottom*this.Zt()+this.ga}Ya(){this.va.ma||(this.va.ma=!0,this.do())}Ba(){this.fa=null}Ea(t,i){if(this.Ya(),this.Fi())return 0;t=this.ca()&&t?Ui(t,this.Da):t;const s=f(this.wh()),h=this.qa()+(this.Ha()-1)*(t-s.ah())/s._h();return this.Xa(h)}La(t,i){if(this.Ya(),this.Fi())return 0;const s=this.Xa(t),h=f(this.wh()),e=h.ah()+h._h()*((s-this.qa())/(this.Ha()-1));return this.ca()?$i(e,this.Da):e}za(){this.Ca=null,this.Oa.aa()}do(){const t=this.va.ba;if(null===t)return;let i=null;const s=this.uo();let h=0,e=0;for(const o of s){if(!o.Ct())continue;const s=o.xt();if(null===s)continue;const n=o.Pl(t.gn(),t.Mn());let r=n&&n.wh();if(null!==r){switch(this.us.mode){case 1:r=Ii(r,this.Da);break;case 2:r=Li(r,s.Rt);break;case 3:r=Pi(r,s.Rt)}if(i=null===i?r:i.tn(f(r)),null!==n){const t=n.gh();null!==t&&(h=Math.max(h,t.above),e=Math.max(h,t.below))}}}if(h===this.wa&&e===this.ga||(this.wa=h,this.ga=e,this.Ca=null,this.Ba()),null!==i){if(i.ah()===i.oh()){const t=this._o(),s=5*(null===t||this.ih()||this.Na()?1:t.Al());this.ca()&&(i=Oi(i,this.Da)),i=new mi(i.ah()-s,i.oh()+s),this.ca()&&(i=Ii(i,this.Da))}if(this.ca()){const t=Oi(i,this.Da),s=Bi(t);if(n=s,r=this.Da,n.Jl!==r.Jl||n.Ql!==r.Ql){const h=null!==this.pa?Oi(this.pa,this.Da):null;this.Da=s,i=Ii(t,s),null!==h&&(this.pa=Ii(h,s))}}this.Wa(i)}else null===this.mh&&(this.Wa(new mi(-.5,.5)),this.Da=Bi(null));var n,r;this.va.ma=!0}Za(){return this.ih()?ki:this.Na()?Di:this.ca()?t=>Ui(t,this.Da):null}yh(t,i){return void 0===this.Aa.priceFormatter?(void 0===i&&(i=this.Ol()),i.format(t)):this.Aa.priceFormatter(t)}}class Gi{constructor(t,i){this.ya=[],this.fo=new Map,this.da=0,this.qe=0,this.po=1e3,this.ka=null,this.vo=new C,this.mo=t,this.$i=i,this.bo=new Ri(this);const s=i.F();this.wo=this.Mo("left",s.leftPriceScale),this.So=this.Mo("right",s.rightPriceScale),this.wo.ja().l(this.yo.bind(this,this.wo),this),this.So.ja().l(this.yo.bind(this,this.So),this),this.ko(s)}ko(t){if(t.leftPriceScale&&this.wo.xh(t.leftPriceScale),t.rightPriceScale&&this.So.xh(t.rightPriceScale),t.localization&&(this.wo.Nl(),this.So.Nl()),t.overlayPriceScales){const i=Array.from(this.fo.values());for(const s of i){const i=f(s[0].Pt());i.xh(t.overlayPriceScales),t.localization&&i.Nl()}}}Co(t){switch(t){case"left":return this.wo;case"right":return this.So}return this.fo.has(t)?c(this.fo.get(t))[0].Pt():null}M(){this.Ut().xo().v(this),this.wo.ja().v(this),this.So.ja().v(this),this.ya.forEach((t=>{t.M&&t.M()})),this.vo.m()}To(){return this.po}Do(t){this.po=t}Ut(){return this.$i}Xt(){return this.qe}Zt(){return this.da}Po(t){this.qe=t,this.Ro()}$a(t){this.da=t,this.wo.$a(t),this.So.$a(t),this.ya.forEach((i=>{if(this.Je(i)){const s=i.Pt();null!==s&&s.$a(t)}})),this.Ro()}zl(){return this.ya}Je(t){const i=t.Pt();return null===i||this.wo!==i&&this.So!==i}Ja(t,i,s){const h=void 0!==s?s:this.Oo().Ao+1;this.Lo(t,i,h)}io(t){const i=this.ya.indexOf(t);u(-1!==i,"removeDataSource: invalid data source"),this.ya.splice(i,1);const s=f(t.Pt()).Vl();if(this.fo.has(s)){const i=c(this.fo.get(s)),h=i.indexOf(t);-1!==h&&(i.splice(h,1),0===i.length&&this.fo.delete(s))}const h=t.Pt();h&&h.zl().indexOf(t)>=0&&h.io(t),null!==h&&(h.Qa(),this.Eo(h)),this.ka=null}tr(t){return t===this.wo?"left":t===this.So?"right":"overlay"}Io(){return this.wo}Bo(){return this.So}Vo(t,i){t.eo(i)}No(t,i){t.ro(i),this.Ro()}Fo(t){t.ho()}Wo(t,i){t.lo(i)}zo(t,i){t.ao(i),this.Ro()}jo(t){t.oo()}Ro(){this.ya.forEach((t=>{t.As()}))}fs(){let t=null;return this.$i.F().rightPriceScale.visible&&0!==this.So.zl().length?t=this.So:this.$i.F().leftPriceScale.visible&&0!==this.wo.zl().length?t=this.wo:0!==this.ya.length&&(t=this.ya[0].Pt()),null===t&&(t=this.So),t}Qe(){let t=null;return this.$i.F().rightPriceScale.visible?t=this.So:this.$i.F().leftPriceScale.visible&&(t=this.wo),t}Eo(t){null!==t&&t.Va()&&this.$o(t)}Ho(t){const i=this.mo.Nn();t.Ia({zs:!0}),null!==i&&t.co(i),this.Ro()}Uo(){this.$o(this.wo),this.$o(this.So)}qo(){this.Eo(this.wo),this.Eo(this.So),this.ya.forEach((t=>{this.Je(t)&&this.Eo(t.Pt())})),this.Ro(),this.$i.Th()}Ga(){return null===this.ka&&(this.ka=zi(this.ya)),this.ka}Yo(){return this.vo}Xo(){return this.bo}$o(t){const i=t.uo();if(i&&i.length>0&&!this.mo.Fi()){const i=this.mo.Nn();null!==i&&t.co(i)}t.As()}Oo(){const t=this.Ga();if(0===t.length)return{Zo:0,Ao:0};let i=0,s=0;for(let h=0;h<t.length;h++){const e=t[h].Xi();null!==e&&(e<i&&(i=e),e>s&&(s=e))}return{Zo:i,Ao:s}}Lo(t,i,s){let h=this.Co(i);if(null===h&&(h=this.Mo(i,this.$i.F().overlayPriceScales)),this.ya.push(t),!nt(i)){const s=this.fo.get(i)||[];s.push(t),this.fo.set(i,s)}h.Ja(t),t.Ki(h),t.Zi(s),this.Eo(h),this.ka=null}yo(t,i,s){i.rr!==s.rr&&this.$o(t)}Mo(t,i){const s=Object.assign({visible:!0,autoScale:!0},S(i)),h=new ji(t,s,this.$i.F().layout,this.$i.F().localization);return h.$a(this.Zt()),h}}const Ji=t=>t.getUTCFullYear();class Qi{constructor(t,i){void 0===t&&(t="yyyy-MM-dd"),void 0===i&&(i="default"),this.Ko=t,this.Go=i}Jo(t){return function(t,i,s){return i.replace(/yyyy/g,(t=>ot(Ji(t),4))(t)).replace(/yy/g,(t=>ot(Ji(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,s)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,s)).replace(/MM/g,(t=>ot((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>ot((t=>t.getUTCDate())(t),2))(t))}(t,this.Ko,this.Go)}}class Zi{constructor(t){this.Qo=t||"%h:%m:%s"}Jo(t){return this.Qo.replace("%h",ot(t.getUTCHours(),2)).replace("%m",ot(t.getUTCMinutes(),2)).replace("%s",ot(t.getUTCSeconds(),2))}}const Ki={t_:"yyyy-MM-dd",i_:"%h:%m:%s",s_:" ",n_:"default"};class Hi{constructor(t){void 0===t&&(t={});const i=Object.assign(Object.assign({},Ki),t);this.e_=new Qi(i.t_,i.n_),this.r_=new Zi(i.i_),this.h_=i.s_}Jo(t){return`${this.e_.Jo(t)}${this.h_}${this.r_.Jo(t)}`}}class ts{constructor(t,i){void 0===i&&(i=50),this.Ee=0,this.Ie=1,this.Be=1,this.Ne=new Map,this.Ve=new Map,this.l_=t,this.Fe=i}Jo(t){const i=t.ot,s=void 0===i.a_?new Date(1e3*i.o_).getTime():new Date(Date.UTC(i.a_.year,i.a_.month-1,i.a_.day)).getTime(),h=this.Ne.get(s);if(void 0!==h)return h.__;if(this.Ee===this.Fe){const t=this.Ve.get(this.Be);this.Ve.delete(this.Be),this.Ne.delete(c(t)),this.Be++,this.Ee--}const e=this.l_(t);return this.Ne.set(s,{__:e,$e:this.Ie}),this.Ve.set(this.Ie,s),this.Ee++,this.Ie++,e}}class is{constructor(t,i){u(t<=i,"right should be >= left"),this.u_=t,this.c_=i}gn(){return this.u_}Mn(){return this.c_}d_(){return this.c_-this.u_+1}Lr(t){return this.u_<=t&&t<=this.c_}hh(t){return this.u_===t.gn()&&this.c_===t.Mn()}}function ss(t,i){return null===t||null===i?t===i:t.hh(i)}class hs{constructor(){this.f_=new Map,this.Ne=null}p_(t,i){this.v_(i),this.Ne=null;for(let s=i;s<t.length;++s){const i=t[s];let h=this.f_.get(i.m_);void 0===h&&(h=[],this.f_.set(i.m_,h)),h.push({Yn:s,ot:i.ot,b_:i.m_,w_:i.w_})}}g_(t,i){const s=Math.ceil(i/t);return null!==this.Ne&&this.Ne.M_===s||(this.Ne={Gl:this.S_(s),M_:s}),this.Ne.Gl}v_(t){if(0===t)return void this.f_.clear();const i=[];this.f_.forEach(((s,h)=>{t<=s[0].Yn?i.push(h):s.splice(yt(s,t,(i=>i.Yn<t)),1/0)}));for(const s of i)this.f_.delete(s)}S_(t){let i=[];for(const s of Array.from(this.f_.keys()).sort(((t,i)=>i-t))){if(!this.f_.get(s))continue;const h=i;i=[];const e=h.length;let n=0;const r=c(this.f_.get(s)),o=r.length;let l=1/0,a=-1/0;for(let s=0;s<o;s++){const o=r[s],u=o.Yn;for(;n<e;){const t=h[n],s=t.Yn;if(!(s<u)){l=s;break}n++,i.push(t),a=s,l=1/0}l-u>=t&&u-a>=t&&(i.push(o),a=u)}for(;n<e;n++)i.push(h[n])}return i}}class es{constructor(t){this.y_=t}k_(){return null===this.y_?null:new is(Math.floor(this.y_.gn()),Math.ceil(this.y_.Mn()))}C_(){return this.y_}static x_(){return new es(null)}}var ns,rs,os,ls,as;!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(ns||(ns={}));class us{constructor(t,i,s){this.qe=0,this.T_=null,this.D_=[],this.Ta=null,this.xa=null,this.P_=new hs,this.R_=new Map,this.A_=es.x_(),this.O_=!0,this.L_=new C,this.E_=new C,this.I_=new C,this.B_=null,this.V_=null,this.N_=[],this.us=i,this.Aa=s,this.F_=i.rightOffset,this.W_=i.barSpacing,this.$i=t,this.z_()}F(){return this.us}j_(t){E(this.Aa,t),this.H_(),this.z_()}xh(t,i){var s;E(this.us,t),this.us.fixLeftEdge&&this.U_(),this.us.fixRightEdge&&this.q_(),void 0!==t.barSpacing&&this.$i.Gs(t.barSpacing),void 0!==t.rightOffset&&this.$i.Js(t.rightOffset),void 0!==t.minBarSpacing&&this.$i.Gs(null!==(s=t.barSpacing)&&void 0!==s?s:this.W_),this.H_(),this.z_(),this.I_.m()}vs(t){var i,s;return null!==(s=null===(i=this.D_[t])||void 0===i?void 0:i.ot)&&void 0!==s?s:null}Hi(t){var i;return null!==(i=this.D_[t])&&void 0!==i?i:null}Fl(t,i){if(this.D_.length<1)return null;if(t.o_>this.D_[this.D_.length-1].ot.o_)return i?this.D_.length-1:null;const s=yt(this.D_,t.o_,((t,i)=>t.ot.o_<i));return t.o_<this.D_[s].ot.o_?i?s:null:s}Fi(){return 0===this.qe||0===this.D_.length||null===this.T_}Nn(){return this.Y_(),this.A_.k_()}X_(){return this.Y_(),this.A_.C_()}Z_(){const t=this.Nn();if(null===t)return null;const i={from:t.gn(),to:t.Mn()};return this.K_(i)}K_(t){const i=Math.round(t.from),s=Math.round(t.to),h=f(this.G_()),e=f(this.J_());return{from:f(this.vs(Math.max(h,i))),to:f(this.vs(Math.min(e,s)))}}Q_(t){return{from:f(this.Fl(t.from,!0)),to:f(this.Fl(t.to,!0))}}Xt(){return this.qe}Po(t){if(!isFinite(t)||t<=0)return;if(this.qe===t)return;const i=this.X_(),s=this.qe;if(this.qe=t,this.O_=!0,this.us.lockVisibleTimeRangeOnResize&&0!==s){const i=this.W_*t/s;this.W_=i}if(this.us.fixLeftEdge&&null!==i&&i.gn()<=0){const i=s-t;this.F_-=Math.round(i/this.W_)+1,this.O_=!0}this.tu(),this.iu()}Lt(t){if(this.Fi()||!T(t))return 0;const i=this.su()+this.F_-t;return this.qe-(i+.5)*this.W_-1}jn(t,i){const s=this.su(),h=void 0===i?0:i.from,e=void 0===i?t.length:i.to;for(let n=h;n<e;n++){const i=t[n].ot,h=s+this.F_-i,e=this.qe-(h+.5)*this.W_-1;t[n].nt=e}}nu(t){return Math.ceil(this.eu(t))}Js(t){this.O_=!0,this.F_=t,this.iu(),this.$i.ru(),this.$i.Th()}Kn(){return this.W_}Gs(t){this.hu(t),this.iu(),this.$i.ru(),this.$i.Th()}lu(){return this.F_}Gl(){if(this.Fi())return null;if(null!==this.V_)return this.V_;const t=this.W_,i=5*(this.$i.F().layout.fontSize+4),s=Math.round(i/t),h=f(this.Nn()),e=Math.max(h.gn(),h.gn()-s),n=Math.max(h.Mn(),h.Mn()-s),r=this.P_.g_(t,i),o=this.G_()+s,l=this.J_()-s,a=this.au(),u=this.us.fixLeftEdge||a,c=this.us.fixRightEdge||a;let d=0;for(const f of r){if(!(e<=f.Yn&&f.Yn<=n))continue;let t;d<this.N_.length?(t=this.N_[d],t.ql=this.Lt(f.Yn),t._a=this.ou(f),t.b_=f.b_):(t={_u:!1,ql:this.Lt(f.Yn),_a:this.ou(f),b_:f.b_},this.N_.push(t)),this.W_>i/2&&!a?t._u=!1:t._u=u&&f.Yn<=o||c&&f.Yn>=l,d++}return this.N_.length=d,this.V_=this.N_,this.N_}uu(){this.O_=!0,this.Gs(this.us.barSpacing),this.Js(this.us.rightOffset)}cu(t){this.O_=!0,this.T_=t,this.iu(),this.U_()}du(t,i){const s=this.eu(t),h=this.Kn(),e=h+i*(h/10);this.Gs(e),this.us.rightBarStaysOnScroll||this.Js(this.lu()+(s-this.eu(t)))}eo(t){this.Ta&&this.oo(),null===this.xa&&null===this.B_&&(this.Fi()||(this.xa=t,this.fu()))}ro(t){if(null===this.B_)return;const i=kt(this.qe-t,0,this.qe),s=kt(this.qe-f(this.xa),0,this.qe);0!==i&&0!==s&&this.Gs(this.B_.Kn*i/s)}ho(){null!==this.xa&&(this.xa=null,this.pu())}lo(t){null===this.Ta&&null===this.B_&&(this.Fi()||(this.Ta=t,this.fu()))}ao(t){if(null===this.Ta)return;const i=(this.Ta-t)/this.Kn();this.F_=f(this.B_).lu+i,this.O_=!0,this.iu()}oo(){null!==this.Ta&&(this.Ta=null,this.pu())}vu(){this.mu(this.us.rightOffset)}mu(t,i){if(void 0===i&&(i=400),!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.F_,h=performance.now();this.$i.Xs({bu:t=>(t-h)/i>=1,wu:e=>{const n=(e-h)/i;return n>=1?t:s+(t-s)*n}})}bt(t,i){this.O_=!0,this.D_=t,this.P_.p_(t,i),this.iu()}gu(){return this.L_}Mu(){return this.E_}Su(){return this.I_}su(){return this.T_||0}yu(t){const i=t.d_();this.hu(this.qe/i),this.F_=t.Mn()-this.su(),this.iu(),this.O_=!0,this.$i.ru(),this.$i.Th()}ku(){const t=this.G_(),i=this.J_();null!==t&&null!==i&&this.yu(new is(t,i+this.us.rightOffset))}Cu(t){const i=new is(t.from,t.to);this.yu(i)}Ui(t){return void 0!==this.Aa.timeFormatter?this.Aa.timeFormatter(t.w_):this.xu.Jo(new Date(1e3*t.ot.o_))}au(){const{handleScroll:t,handleScale:i}=this.$i.F();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset.time||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}G_(){return 0===this.D_.length?null:0}J_(){return 0===this.D_.length?null:this.D_.length-1}Tu(t){return(this.qe-1-t)/this.W_}eu(t){const i=this.Tu(t),s=this.su()+this.F_-i;return Math.round(1e6*s)/1e6}hu(t){const i=this.W_;this.W_=t,this.tu(),i!==this.W_&&(this.O_=!0,this.Du())}Y_(){if(!this.O_)return;if(this.O_=!1,this.Fi())return void this.Pu(es.x_());const t=this.su(),i=this.qe/this.W_,s=this.F_+t,h=new is(s-i+1,s);this.Pu(new es(h))}tu(){const t=this.Ru();if(this.W_<t&&(this.W_=t,this.O_=!0),0!==this.qe){const t=.5*this.qe;this.W_>t&&(this.W_=t,this.O_=!0)}}Ru(){return this.us.fixLeftEdge&&this.us.fixRightEdge&&0!==this.D_.length?this.qe/this.D_.length:this.us.minBarSpacing}iu(){const t=this.Au();this.F_>t&&(this.F_=t,this.O_=!0);const i=this.Ou();null!==i&&this.F_<i&&(this.F_=i,this.O_=!0)}Ou(){const t=this.G_(),i=this.T_;return null===t||null===i?null:t-i-1+(this.us.fixLeftEdge?this.qe/this.W_:Math.min(2,this.D_.length))}Au(){return this.us.fixRightEdge?0:this.qe/this.W_-Math.min(2,this.D_.length)}fu(){this.B_={Kn:this.Kn(),lu:this.lu()}}pu(){this.B_=null}ou(t){let i=this.R_.get(t.b_);return void 0===i&&(i=new ts((t=>this.Lu(t))),this.R_.set(t.b_,i)),i.Jo(t)}Lu(t){const i=function(t,i,s){switch(t){case 0:case 10:return i?s?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.b_,this.us.timeVisible,this.us.secondsVisible);return void 0!==this.us.tickMarkFormatter?this.us.tickMarkFormatter(t.w_,i,this.Aa.locale):function(t,i,s){const h={};switch(i){case 0:h.year="numeric";break;case 1:h.month="short";break;case 2:h.day="numeric";break;case 3:h.hour12=!1,h.hour="2-digit",h.minute="2-digit";break;case 4:h.hour12=!1,h.hour="2-digit",h.minute="2-digit",h.second="2-digit"}const e=void 0===t.a_?new Date(1e3*t.o_):new Date(Date.UTC(t.a_.year,t.a_.month-1,t.a_.day));return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()).toLocaleString(s,h)}(t.ot,i,this.Aa.locale)}Pu(t){const i=this.A_;this.A_=t,ss(i.k_(),this.A_.k_())||this.L_.m(),ss(i.C_(),this.A_.C_())||this.E_.m(),this.Du()}Du(){this.V_=null}H_(){this.Du(),this.R_.clear()}z_(){const t=this.Aa.dateFormat;this.us.timeVisible?this.xu=new Hi({t_:t,i_:this.us.secondsVisible?"%h:%m:%s":"%h:%m",s_:"   ",n_:this.Aa.locale}):this.xu=new Qi(t,this.Aa.locale)}U_(){if(!this.us.fixLeftEdge)return;const t=this.G_();if(null===t)return;const i=this.Nn();if(null===i)return;const s=i.gn()-t;if(s<0){const t=this.F_-s-1;this.Js(t)}this.tu()}q_(){this.iu(),this.tu()}}class cs extends U{constructor(t){super(),this.Eu=new Map,this.Et=t}Z(t){}G(t){if(!this.Et.Ct)return;t.save();let i=0;for(const h of this.Et.Iu){if(0===h.ti.length)continue;t.font=h.D;const s=this.Bu(t,h.ti);s>this.Et.Xt?h.du=this.Et.Xt/s:h.du=1,i+=h.Vu*h.du}let s=0;switch(this.Et.Nu){case"top":s=0;break;case"center":s=Math.max((this.Et.Zt-i)/2,0);break;case"bottom":s=Math.max(this.Et.Zt-i,0)}t.fillStyle=this.Et.R;for(const h of this.Et.Iu){t.save();let i=0;switch(this.Et.Fu){case"left":t.textAlign="left",i=h.Vu/2;break;case"center":t.textAlign="center",i=this.Et.Xt/2;break;case"right":t.textAlign="right",i=this.Et.Xt-1-h.Vu/2}t.translate(i,s),t.textBaseline="top",t.font=h.D,t.scale(h.du,h.du),t.fillText(h.ti,0,h.Wu),t.restore(),s+=h.Vu*h.du}t.restore()}Bu(t,i){const s=this.zu(t.font);let h=s.get(i);return void 0===h&&(h=t.measureText(i).width,s.set(i,h)),h}zu(t){let i=this.Eu.get(t);return void 0===i&&(i=new Map,this.Eu.set(t,i)),i}}class fs{constructor(t){this.ft=!0,this.zt={Ct:!1,R:"",Zt:0,Xt:0,Iu:[],Nu:"center",Fu:"center"},this.jt=new cs(this.zt),this.$t=t}bt(){this.ft=!0}gt(t,i){return this.ft&&(this.Mt(t,i),this.ft=!1),this.jt}Mt(t,i){const s=this.$t.F(),h=this.zt;h.Ct=s.visible,h.Ct&&(h.R=s.color,h.Xt=i,h.Zt=t,h.Fu=s.horzAlign,h.Nu=s.vertAlign,h.Iu=[{ti:s.text,D:L(s.fontSize,s.fontFamily,s.fontStyle),Vu:1.2*s.fontSize,Wu:0,du:0}])}}class ds extends st{constructor(t,i){super(),this.us=i,this.ws=new fs(this)}Ps(){return[]}Ds(){return[this.ws]}F(){return this.us}As(){this.ws.bt()}}!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(rs||(rs={}));class ps{constructor(t,i){this.ju=[],this.$u=[],this.qe=0,this.Hu=null,this.Uu=new C,this.qu=new C,this.Yu=null,this.Xu=t,this.us=i,this.Zu=new D(this),this.mo=new us(this,i.timeScale,this.us.localization),this.vt=new et(this,i.crosshair),this.Ku=new Vi(i.crosshair),this.Gu=new ds(this,i.watermark),this.Ju(),this.ju[0].Do(2e3),this.Qu=this.tc(0),this.ic=this.tc(1)}fl(){this.sc(rt.en())}Th(){this.sc(rt.nn())}Tl(){this.sc(new rt(1))}pl(t){const i=this.nc(t);this.sc(i)}ec(){return this.Hu}rc(t){const i=this.Hu;this.Hu=t,null!==i&&this.pl(i.hc),null!==t&&this.pl(t.hc)}F(){return this.us}xh(t){E(this.us,t),this.ju.forEach((i=>i.ko(t))),void 0!==t.timeScale&&this.mo.xh(t.timeScale),void 0!==t.localization&&this.mo.j_(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Uu.m(),this.Qu=this.tc(0),this.ic=this.tc(1),this.fl()}lc(t,i){if("left"===t)return void this.xh({leftPriceScale:i});if("right"===t)return void this.xh({rightPriceScale:i});const s=this.ac(t);null!==s&&(s.Pt.xh(i),this.Uu.m())}ac(t){for(const i of this.ju){const s=i.Co(t);if(null!==s)return{Ht:i,Pt:s}}return null}yt(){return this.mo}oc(){return this.ju}_c(){return this.Gu}uc(){return this.vt}cc(){return this.qu}dc(t,i){t.$a(i),this.ru()}Po(t){this.qe=t,this.mo.Po(this.qe),this.ju.forEach((i=>i.Po(t))),this.ru()}Ju(t){const i=new Gi(this.mo,this);void 0!==t?this.ju.splice(t,0,i):this.ju.push(i);const s=void 0===t?this.ju.length-1:t,h=rt.en();return h.Fs(s,{Ws:0,zs:!0}),this.sc(h),i}Vo(t,i,s){t.Vo(i,s)}No(t,i,s){t.No(i,s),this.vl(),this.sc(this.fc(t,2))}Fo(t,i){t.Fo(i),this.sc(this.fc(t,2))}Wo(t,i,s){i.Va()||t.Wo(i,s)}zo(t,i,s){i.Va()||(t.zo(i,s),this.vl(),this.sc(this.fc(t,2)))}jo(t,i){i.Va()||(t.jo(i),this.sc(this.fc(t,2)))}Ho(t,i){t.Ho(i),this.sc(this.fc(t,2))}vc(t){this.mo.eo(t)}mc(t,i){const s=this.yt();if(s.Fi()||0===i)return;const h=s.Xt();t=Math.max(1,Math.min(t,h)),s.du(t,i),this.ru()}bc(t){this.wc(0),this.gc(t),this.Mc()}Sc(t){this.mo.ro(t),this.ru()}yc(){this.mo.ho(),this.Th()}wc(t){this.mo.lo(t)}gc(t){this.mo.ao(t),this.ru()}Mc(){this.mo.oo(),this.Th()}wt(){return this.$u}kc(t,i,s){this.vt.gs(t,i);let h=NaN,e=this.mo.nu(t);const n=this.mo.Nn();null!==n&&(e=Math.min(Math.max(n.gn(),e),n.Mn()));const r=s.fs(),o=r.xt();null!==o&&(h=r.ps(i,o)),h=this.Ku.Wl(h,e,s),this.vt.ks(e,h,s),this.Tl(),this.qu.m(this.vt.St(),{x:t,y:i})}Cc(){this.uc().xs(),this.Tl(),this.qu.m(null,null)}vl(){const t=this.vt.Ht();if(null!==t){const i=this.vt.Ss(),s=this.vt.ys();this.kc(i,s,t)}this.vt.As()}xc(t,i,s){const h=this.mo.vs(0);void 0!==i&&void 0!==s&&this.mo.bt(i,s);const e=this.mo.vs(0),n=this.mo.su(),r=this.mo.Nn();if(null!==r&&null!==h&&null!==e){const i=r.Lr(n),s=h.o_>e.o_,o=null!==t&&t>n&&!s,l=i&&this.mo.F().shiftVisibleRangeOnNewBar;if(o&&!l){const i=t-n;this.mo.Js(this.mo.lu()-i)}}this.mo.cu(t)}wl(t){null!==t&&t.qo()}Ge(t){const i=this.ju.find((i=>i.Ga().includes(t)));return void 0===i?null:i}ru(){this.Gu.As(),this.ju.forEach((t=>t.qo())),this.vl()}M(){this.ju.forEach((t=>t.M())),this.ju.length=0,this.us.localization.priceFormatter=void 0,this.us.localization.timeFormatter=void 0}Tc(){return this.Zu}ir(){return this.Zu.F()}xo(){return this.Uu}Dc(t,i){const s=this.ju[0],h=this.Pc(i,t,s);return this.$u.push(h),1===this.$u.length?this.fl():this.Th(),h}Rc(t){const i=this.Ge(t),s=this.$u.indexOf(t);u(-1!==s,"Series not found"),this.$u.splice(s,1),f(i).io(t),t.M&&t.M()}dl(t,i){const s=f(this.Ge(t));s.io(t);const h=this.ac(i);if(null===h){const h=t.Xi();s.Ja(t,i,h)}else{const e=h.Ht===s?t.Xi():void 0;h.Ht.Ja(t,i,e)}}ku(){const t=rt.nn();t.Hs(),this.sc(t)}Ac(t){const i=rt.nn();i.Ys(t),this.sc(i)}Ks(){const t=rt.nn();t.Ks(),this.sc(t)}Gs(t){const i=rt.nn();i.Gs(t),this.sc(i)}Js(t){const i=rt.nn();i.Js(t),this.sc(i)}Xs(t){const i=rt.nn();i.Xs(t),this.sc(i)}Us(){const t=rt.nn();t.Us(),this.sc(t)}Oc(){return this.us.rightPriceScale.visible?"right":"left"}Lc(){return this.ic}U(){return this.Qu}Ot(t){const i=this.ic,s=this.Qu;if(i===s)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.Yu||this.Yu.vn!==s||this.Yu.mn!==i)this.Yu={vn:s,mn:i,Ec:new Map};else{const i=this.Yu.Ec.get(t);if(void 0!==i)return i}const h=function(t,i,s){const[h,e,n,r]=y(t),[o,l,a,u]=y(i),c=[m(h+s*(o-h)),m(e+s*(l-e)),m(n+s*(a-n)),v(r+s*(u-r))];return`rgba(${c[0]}, ${c[1]}, ${c[2]}, ${c[3]})`}(s,i,t/100);return this.Yu.Ec.set(t,h),h}fc(t,i){const s=new rt(i);if(null!==t){const h=this.ju.indexOf(t);s.Fs(h,{Ws:i})}return s}nc(t,i){return void 0===i&&(i=2),this.fc(this.Ge(t),i)}sc(t){this.Xu&&this.Xu(t),this.ju.forEach((t=>t.Xo().Dh().bt()))}Pc(t,i,s){const h=new Ti(this,t,i),e=void 0!==t.priceScaleId?t.priceScaleId:this.Oc();return s.Ja(h,e),nt(e)||h.xh(t),h}tc(t){const i=this.us.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}}function ms(t){return!x(t)&&!V(t)}function vs(t){return x(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(os||(os={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(ls||(ls={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(as||(as={}));class gs{constructor(t,i){this.Vt=t,this.Nt=i}hh(t){return this.Vt===t.Vt&&this.Nt===t.Nt}}function bs(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function Ms(t){const i=f(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function ws(t,i){const s=f(t.ownerDocument).createElement("canvas");t.appendChild(s);const e=(void 0===(n={allowDownsampling:!1})&&(n=h),new o(s,n));var n;return e.resizeCanvas({width:i.Vt,height:i.Nt}),e}function ys(t,i){return t.Ic-i.Ic}function _s(t,i,s){const h=(t.Ic-i.Ic)/(t.ot-i.ot);return Math.sign(h)*Math.min(Math.abs(h),s)}class Cs{constructor(t,i,s,h){this.Bc=null,this.Vc=null,this.Nc=null,this.Fc=null,this.Wc=null,this.zc=0,this.jc=0,this.$c=t,this.Hc=i,this.Uc=s,this.rn=h}qc(t,i){if(null!==this.Bc){if(this.Bc.ot===i)return void(this.Bc.Ic=t);if(Math.abs(this.Bc.Ic-t)<this.rn)return}this.Fc=this.Nc,this.Nc=this.Vc,this.Vc=this.Bc,this.Bc={ot:i,Ic:t}}cr(t,i){if(null===this.Bc||null===this.Vc)return;if(i-this.Bc.ot>50)return;let s=0;const h=_s(this.Bc,this.Vc,this.Hc),e=ys(this.Bc,this.Vc),n=[h],r=[e];if(s+=e,null!==this.Nc){const t=_s(this.Vc,this.Nc,this.Hc);if(Math.sign(t)===Math.sign(h)){const i=ys(this.Vc,this.Nc);if(n.push(t),r.push(i),s+=i,null!==this.Fc){const t=_s(this.Nc,this.Fc,this.Hc);if(Math.sign(t)===Math.sign(h)){const i=ys(this.Nc,this.Fc);n.push(t),r.push(i),s+=i}}}}let o=0;for(let l=0;l<n.length;++l)o+=r[l]/s*n[l];Math.abs(o)<this.$c||(this.Wc={Ic:t,ot:i},this.jc=o,this.zc=function(t,i){const s=Math.log(i);return Math.log(1*s/-t)/s}(Math.abs(o),this.Uc))}wu(t){const i=f(this.Wc),s=t-i.ot;return i.Ic+this.jc*(Math.pow(this.Uc,s)-1)/Math.log(this.Uc)}bu(t){return null===this.Wc||this.Yc(t)===this.zc}Yc(t){const i=t-f(this.Wc).ot;return Math.min(i,this.zc)}}const Es="undefined"!=typeof window;function xs(){return!!Es&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function Ts(){return!!Es&&/iPhone|iPad|iPod/.test(window.navigator.platform)}class Vs{constructor(t,i,s){this.Xc=0,this.Zc=null,this.Kc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY},this.Gc=0,this.Jc=null,this.Qc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY},this.td=null,this.sd=!1,this.nd=null,this.ed=null,this.rd=!1,this.hd=!1,this.ld=!1,this.ad=null,this.od=null,this._d=null,this.ud=null,this.dd=null,this.fd=null,this.pd=null,this.vd=0,this.md=!1,this.bd=!1,this.wd=!1,this.gd=0,this.Md=null,this.Sd=!Ts(),this.yd=t=>{this.kd(t)},this.Cd=t=>{if(this.xd(t)){const i=this.Td(t);if(++this.Gc,this.Jc&&this.Gc>1){const{Dd:s}=this.Pd(Rs(t),this.Qc);s<30&&!this.ld&&this.Rd(i,this.Od.Ad),this.Ld()}}else{const i=this.Td(t);if(++this.Xc,this.Zc&&this.Xc>1){const{Dd:s}=this.Pd(Rs(t),this.Kc);s<5&&!this.hd&&this.Ed(i,this.Od.Id),this.Bd()}}},this.Vd=t,this.Od=i,this.us=s,this.Nd()}M(){null!==this.ad&&(this.ad(),this.ad=null),null!==this.od&&(this.od(),this.od=null),null!==this.ud&&(this.ud(),this.ud=null),null!==this.dd&&(this.dd(),this.dd=null),null!==this.fd&&(this.fd(),this.fd=null),null!==this._d&&(this._d(),this._d=null),this.Fd(),this.Bd()}Wd(t){this.ud&&this.ud();const i=this.zd.bind(this);if(this.ud=()=>{this.Vd.removeEventListener("mousemove",i)},this.Vd.addEventListener("mousemove",i),this.xd(t))return;const s=this.Td(t);this.Ed(s,this.Od.jd),this.Sd=!0}Bd(){null!==this.Zc&&clearTimeout(this.Zc),this.Xc=0,this.Zc=null,this.Kc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY}}Ld(){null!==this.Jc&&clearTimeout(this.Jc),this.Gc=0,this.Jc=null,this.Qc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY}}zd(t){if(this.wd||null!==this.ed)return;if(this.xd(t))return;const i=this.Td(t);this.Ed(i,this.Od.$d),this.Sd=!0}Hd(t){const i=ks(t.changedTouches,f(this.Md));if(null===i)return;if(this.gd=Ns(t),null!==this.pd)return;if(this.bd)return;this.md=!0;const s=this.Pd(Rs(i),f(this.ed)),{Ud:h,qd:e,Dd:n}=s;if(this.rd||!(n<5)){if(!this.rd){const t=.5*h,i=e>=t&&!this.us.Yd(),s=t>e&&!this.us.Xd();i||s||(this.bd=!0),this.rd=!0,this.ld=!0,this.Fd(),this.Ld()}if(!this.bd){const s=this.Td(t,i);this.Rd(s,this.Od.Zd),Ss(t)}}}Kd(t){if(0!==t.button)return;const i=this.Pd(Rs(t),f(this.nd)),{Dd:s}=i;if(s>=5&&(this.hd=!0,this.Bd()),this.hd){const i=this.Td(t);this.Ed(i,this.Od.Gd)}}Pd(t,i){const s=Math.abs(i.nt-t.nt),h=Math.abs(i.et-t.et);return{Ud:s,qd:h,Dd:s+h}}Jd(t){let i=ks(t.changedTouches,f(this.Md));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.Md=null,this.gd=Ns(t),this.Fd(),this.ed=null,this.fd&&(this.fd(),this.fd=null);const s=this.Td(t,i);if(this.Rd(s,this.Od.Qd),++this.Gc,this.Jc&&this.Gc>1){const{Dd:t}=this.Pd(Rs(i),this.Qc);t<30&&!this.ld&&this.Rd(s,this.Od.Ad),this.Ld()}else this.ld||(this.Rd(s,this.Od.tf),this.Od.tf&&Ss(t));0===this.Gc&&Ss(t),0===t.touches.length&&this.sd&&(this.sd=!1,Ss(t))}kd(t){if(0!==t.button)return;const i=this.Td(t);if(this.nd=null,this.wd=!1,this.dd&&(this.dd(),this.dd=null),xs()&&this.Vd.ownerDocument.documentElement.removeEventListener("mouseleave",this.yd),!this.xd(t))if(this.Ed(i,this.Od.if),++this.Xc,this.Zc&&this.Xc>1){const{Dd:s}=this.Pd(Rs(t),this.Kc);s<5&&!this.hd&&this.Ed(i,this.Od.Id),this.Bd()}else this.hd||this.Ed(i,this.Od.sf)}Fd(){null!==this.td&&(clearTimeout(this.td),this.td=null)}nf(t){if(null!==this.Md)return;const i=t.changedTouches[0];this.Md=i.identifier,this.gd=Ns(t);const s=this.Vd.ownerDocument.documentElement;this.ld=!1,this.rd=!1,this.bd=!1,this.ed=Rs(i),this.fd&&(this.fd(),this.fd=null);{const i=this.Hd.bind(this),h=this.Jd.bind(this);this.fd=()=>{s.removeEventListener("touchmove",i),s.removeEventListener("touchend",h)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",h,{passive:!1}),this.Fd(),this.td=setTimeout(this.ef.bind(this,t),240)}const h=this.Td(t,i);this.Rd(h,this.Od.rf),this.Jc||(this.Gc=0,this.Jc=setTimeout(this.Ld.bind(this),500),this.Qc=Rs(i))}hf(t){if(0!==t.button)return;const i=this.Vd.ownerDocument.documentElement;xs()&&i.addEventListener("mouseleave",this.yd),this.hd=!1,this.nd=Rs(t),this.dd&&(this.dd(),this.dd=null);{const t=this.Kd.bind(this),s=this.kd.bind(this);this.dd=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",s)}if(this.wd=!0,this.xd(t))return;const s=this.Td(t);this.Ed(s,this.Od.lf),this.Zc||(this.Xc=0,this.Zc=setTimeout(this.Bd.bind(this),500),this.Kc=Rs(t))}Nd(){this.Vd.addEventListener("mouseenter",this.Wd.bind(this)),this.Vd.addEventListener("touchcancel",this.Fd.bind(this));{const t=this.Vd.ownerDocument,i=t=>{this.Od.af&&(t.composed&&this.Vd.contains(t.composedPath()[0])||t.target&&this.Vd.contains(t.target)||this.Od.af())};this.od=()=>{t.removeEventListener("touchstart",i)},this.ad=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}Ts()&&(this._d=()=>{this.Vd.removeEventListener("dblclick",this.Cd)},this.Vd.addEventListener("dblclick",this.Cd)),this.Vd.addEventListener("mouseleave",this._f.bind(this)),this.Vd.addEventListener("touchstart",this.nf.bind(this),{passive:!0}),function(t){Es&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}(this.Vd),this.Vd.addEventListener("mousedown",this.hf.bind(this)),this.uf(),this.Vd.addEventListener("touchmove",(()=>{}),{passive:!1})}uf(){void 0===this.Od.cf&&void 0===this.Od.df&&void 0===this.Od.ff||(this.Vd.addEventListener("touchstart",(t=>this.pf(t.touches)),{passive:!0}),this.Vd.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this.pd&&void 0!==this.Od.df){const i=Fs(t.touches[0],t.touches[1])/this.vd;this.Od.df(this.pd,i),Ss(t)}}),{passive:!1}),this.Vd.addEventListener("touchend",(t=>{this.pf(t.touches)})))}pf(t){1===t.length&&(this.md=!1),2!==t.length||this.md||this.sd?this.vf():this.mf(t)}mf(t){const i=this.Vd.getBoundingClientRect()||{left:0,top:0};this.pd={nt:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,et:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.vd=Fs(t[0],t[1]),void 0!==this.Od.cf&&this.Od.cf(),this.Fd()}vf(){null!==this.pd&&(this.pd=null,void 0!==this.Od.ff&&this.Od.ff())}_f(t){if(this.ud&&this.ud(),this.xd(t))return;if(!this.Sd)return;const i=this.Td(t);this.Ed(i,this.Od.bf),this.Sd=!Ts()}ef(t){const i=ks(t.touches,f(this.Md));if(null===i)return;const s=this.Td(t,i);this.Rd(s,this.Od.wf),this.ld=!0,this.sd=!0}xd(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:Ns(t)<this.gd+500}Rd(t,i){i&&i.call(this.Od,t)}Ed(t,i){i&&i.call(this.Od,t)}Td(t,i){const s=i||t,h=this.Vd.getBoundingClientRect()||{left:0,top:0};return{gf:s.clientX,Mf:s.clientY,Sf:s.pageX,yf:s.pageY,kf:s.screenX,Cf:s.screenY,xf:s.clientX-h.left,Tf:s.clientY-h.top,Df:t.ctrlKey,Pf:t.altKey,Rf:t.shiftKey,Af:t.metaKey,Of:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,Lf:t.type,Ef:s.target,If:t.view,Bf:()=>{"touchstart"!==t.type&&Ss(t)}}}}function Fs(t,i){const s=t.clientX-i.clientX,h=t.clientY-i.clientY;return Math.sqrt(s*s+h*h)}function Ss(t){t.cancelable&&t.preventDefault()}function Rs(t){return{nt:t.pageX,et:t.pageY}}function Ns(t){return t.timeStamp||performance.now()}function ks(t,i){for(let s=0;s<t.length;++s)if(t[s].identifier===i)return t[s];return null}class Ls{constructor(t,i,s,h){this.Vi=null,this.Vf=null,this.Nf=!1,this.Ff=new qt(200),this.Ir=null,this.Wf=0,this.zf=!1,this.jf=()=>{this.zf||this.Qi.$f().Ut().Th()},this.Hf=()=>{this.zf||this.Qi.$f().Ut().Th()},this.Qi=t,this.us=i,this.Ra=i.layout,this.Zu=s,this.Uf="left"===h,this.qf=document.createElement("div"),this.qf.style.height="100%",this.qf.style.overflow="hidden",this.qf.style.width="25px",this.qf.style.left="0",this.qf.style.position="relative",this.Yf=ws(this.qf,new gs(16,16)),this.Yf.subscribeCanvasConfigured(this.jf);const e=this.Yf.canvas;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.Xf=ws(this.qf,new gs(16,16)),this.Xf.subscribeCanvasConfigured(this.Hf);const n=this.Xf.canvas;n.style.position="absolute",n.style.zIndex="2",n.style.left="0",n.style.top="0";const r={lf:this.Zf.bind(this),rf:this.Zf.bind(this),Gd:this.Kf.bind(this),Zd:this.Kf.bind(this),af:this.Gf.bind(this),if:this.Jf.bind(this),Qd:this.Jf.bind(this),Id:this.Qf.bind(this),Ad:this.Qf.bind(this),jd:this.tp.bind(this),bf:this.ip.bind(this)};this.sp=new Vs(this.Xf.canvas,r,{Yd:()=>!1,Xd:()=>!0})}M(){this.sp.M(),this.Xf.unsubscribeCanvasConfigured(this.Hf),this.Xf.destroy(),this.Yf.unsubscribeCanvasConfigured(this.jf),this.Yf.destroy(),null!==this.Vi&&this.Vi.no().v(this),this.Vi=null}np(){return this.qf}T(){return this.Ra.fontSize}ep(){const t=this.Zu.F();return this.Ir!==t.D&&(this.Ff.We(),this.Ir=t.D),t}rp(){if(null===this.Vi)return 0;let t=0;const i=this.ep(),s=Ms(this.Yf.canvas),h=this.Vi.Gl();s.font=this.hp(),h.length>0&&(t=Math.max(this.Ff.Mi(s,h[0]._a),this.Ff.Mi(s,h[h.length-1]._a)));const e=this.lp();for(let l=e.length;l--;){const i=this.Ff.Mi(s,e[l].ti());i>t&&(t=i)}const n=this.Vi.xt();if(null!==n&&null!==this.Vf){const i=this.Vi.ps(1,n),h=this.Vi.ps(this.Vf.Nt-2,n);t=Math.max(t,this.Ff.Mi(s,this.Vi.Wi(Math.floor(Math.min(i,h))+.11111111111111,n)),this.Ff.Mi(s,this.Vi.Wi(Math.ceil(Math.max(i,h))-.11111111111111,n)))}const r=t||34;let o=Math.ceil(i.k+i.C+i.L+i.I+5+r);return o+=o%2,o}ap(t){if(t.Vt<0||t.Nt<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.Vf&&this.Vf.hh(t)||(this.Vf=t,this.zf=!0,this.Yf.resizeCanvas({width:t.Vt,height:t.Nt}),this.Xf.resizeCanvas({width:t.Vt,height:t.Nt}),this.zf=!1,this.qf.style.width=t.Vt+"px",this.qf.style.height=t.Nt+"px",this.qf.style.minWidth=t.Vt+"px")}op(){return f(this.Vf).Vt}Ki(t){this.Vi!==t&&(null!==this.Vi&&this.Vi.no().v(this),this.Vi=t,t.no().l(this.Ma.bind(this),this))}Pt(){return this.Vi}We(){const t=this.Qi._p();this.Qi.$f().Ut().Ho(t,f(this.Pt()))}up(t){if(null===this.Vf)return;if(1!==t){const t=Ms(this.Yf.canvas);this.cp(),this.dp(t,this.Yf.pixelRatio),this.ke(t,this.Yf.pixelRatio),this.fp(t,this.Yf.pixelRatio),this.pp(t,this.Yf.pixelRatio)}const i=Ms(this.Xf.canvas),s=this.Vf.Vt,h=this.Vf.Nt;W(i,this.Xf.pixelRatio,(()=>{i.clearRect(0,0,s,h)})),this.vp(i,this.Xf.pixelRatio)}mp(){return this.Yf.canvas}bt(){var t;null===(t=this.Vi)||void 0===t||t.Gl()}Zf(t){if(null===this.Vi||this.Vi.Fi()||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.$f().Ut(),s=this.Qi._p();this.Nf=!0,i.Vo(s,this.Vi,t.Tf)}Kf(t){if(null===this.Vi||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.$f().Ut(),s=this.Qi._p(),h=this.Vi;i.No(s,h,t.Tf)}Gf(){if(null===this.Vi||!this.us.handleScale.axisPressedMouseMove.price)return;const t=this.Qi.$f().Ut(),i=this.Qi._p(),s=this.Vi;this.Nf&&(this.Nf=!1,t.Fo(i,s))}Jf(t){if(null===this.Vi||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.$f().Ut(),s=this.Qi._p();this.Nf=!1,i.Fo(s,this.Vi)}Qf(t){this.us.handleScale.axisDoubleClickReset.price&&this.We()}tp(t){null!==this.Vi&&(!this.Qi.$f().Ut().F().handleScale.axisPressedMouseMove.price||this.Vi.ih()||this.Vi.Na()||this.bp(1))}ip(t){this.bp(0)}lp(){const t=[],i=null===this.Vi?void 0:this.Vi;return(s=>{for(let h=0;h<s.length;++h){const e=s[h].Ps(this.Qi._p(),i);for(let i=0;i<e.length;i++)t.push(e[i])}})(this.Qi._p().Ga()),t}dp(t,i){if(null===this.Vf)return;const s=this.Vf.Vt,h=this.Vf.Nt;W(t,i,(()=>{const i=this.Qi._p().Ut(),e=i.U(),n=i.Lc();e===n?q(t,0,0,s,h,e):J(t,0,0,s,h,e,n)}))}ke(t,i){if(null===this.Vf||null===this.Vi||!this.Vi.F().borderVisible)return;t.save(),t.fillStyle=this.Vi.F().borderColor;const s=Math.max(1,Math.floor(this.ep().k*i));let h;h=this.Uf?Math.floor(this.Vf.Vt*i)-s:0,t.fillRect(h,0,s,Math.ceil(this.Vf.Nt*i)),t.restore()}fp(t,i){var s;if(null===this.Vf||null===this.Vi)return;const h=this.Vi.Gl();t.save();const e=this.Vi.F();t.strokeStyle=e.borderColor,t.font=this.hp(),t.fillStyle=e.borderColor;const n=this.ep(),r=this.Uf?Math.floor((this.Vf.Vt-n.C)*i):0,o=this.Uf?Math.round(r-n.L*i):Math.round(r+n.C*i+n.L*i),l=Math.max(1,Math.floor(i)),a=Math.floor(.5*i);if(e.borderVisible&&e.ticksVisible){const s=Math.round(n.C*i);t.beginPath();for(const e of h)t.rect(r,Math.round(e.ql*i)-a,s,l);t.fill()}t.fillStyle=null!==(s=e.textColor)&&void 0!==s?s:this.Ra.textColor,t.textAlign=this.Uf?"right":"left",t.textBaseline="middle";const u=h.map((i=>this.Ff.gi(t,i._a)));W(t,i,(()=>{for(let s=h.length;s--;){const e=h[s];t.fillText(e._a,o/i,e.ql+u[s])}})),t.restore()}cp(){if(null===this.Vf||null===this.Vi)return;let t=this.Vf.Nt/2;const i=[],s=this.Vi.Ga().slice(),h=this.Qi._p(),e=this.ep();this.Vi===h.Qe()&&this.Qi._p().Ga().forEach((t=>{h.Je(t)&&s.push(t)}));const n=this.Vi.zl()[0],r=this.Vi;s.forEach((s=>{const e=s.Ps(h,r);e.forEach((t=>{t.Oi(null),t.Li()&&i.push(t)})),n===s&&e.length>0&&(t=e[0].yi())}));const o=i.filter((i=>i.yi()<=t)),l=i.filter((i=>i.yi()>t));if(o.sort(((t,i)=>i.yi()-t.yi())),o.length&&l.length&&l.push(o[0]),l.sort(((t,i)=>t.yi()-i.yi())),i.forEach((t=>t.Oi(t.yi()))),this.Vi.F().alignLabels){for(let t=1;t<o.length;t++){const i=o[t],s=o[t-1],h=s.Zt(e,!1),n=i.yi(),r=s.Ai();n>r-h&&i.Oi(r-h)}for(let t=1;t<l.length;t++){const i=l[t],s=l[t-1],h=s.Zt(e,!0),n=i.yi(),r=s.Ai();n<r+h&&i.Oi(r+h)}}}pp(t,i){if(null===this.Vf)return;t.save();const s=this.Vf,h=this.lp(),e=this.ep(),n=this.Uf?"right":"left";h.forEach((h=>{if(h.Ei()){const r=h.gt(f(this.Vi));t.save(),r.X(t,e,this.Ff,s.Vt,n,i),t.restore()}})),t.restore()}vp(t,i){if(null===this.Vf||null===this.Vi)return;t.save();const s=this.Vf,h=this.Qi.$f().Ut(),e=[],n=this.Qi._p(),r=h.uc().Ps(n,this.Vi);r.length&&e.push(r);const o=this.ep(),l=this.Uf?"right":"left";e.forEach((h=>{h.forEach((h=>{t.save(),h.gt(f(this.Vi)).X(t,o,this.Ff,s.Vt,l,i),t.restore()}))})),t.restore()}bp(t){this.qf.style.cursor=1===t?"ns-resize":"default"}Ma(){const t=this.rp();this.Wf<t&&this.Qi.$f().Ut().fl(),this.Wf=t}hp(){return L(this.Ra.fontSize,this.Ra.fontFamily)}}function Ds(t,i,s,h,e){t.K&&t.K(i,s,h,e)}function Ps(t,i,s,h,e){t.X(i,s,h,e)}function Us(t,i){return t.Ds(i)}function $s(t,i){return t.Gi(i)}function Is(t,i){return void 0!==t.xl?t.xl(i):[]}class Os{constructor(t,i){this.Vf=new gs(0,0),this.wp=null,this.gp=null,this.Mp=null,this.Sp=!1,this.yp=new C,this.kp=0,this.Cp=!1,this.xp=null,this.Tp=!1,this.Dp=null,this.Pp=null,this.zf=!1,this.jf=()=>{this.zf||null===this.Rp||this.$i().Th()},this.Hf=()=>{this.zf||null===this.Rp||this.$i().Th()},this.Ap=t,this.Rp=i,this.Rp.Yo().l(this.Op.bind(this),this,!0),this.Lp=document.createElement("td"),this.Lp.style.padding="0",this.Lp.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.Ep=document.createElement("td"),this.Ep.style.padding="0",this.Ip=document.createElement("td"),this.Ip.style.padding="0",this.Lp.appendChild(s),this.Yf=ws(s,new gs(16,16)),this.Yf.subscribeCanvasConfigured(this.jf);const h=this.Yf.canvas;h.style.position="absolute",h.style.zIndex="1",h.style.left="0",h.style.top="0",this.Xf=ws(s,new gs(16,16)),this.Xf.subscribeCanvasConfigured(this.Hf);const e=this.Xf.canvas;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0",this.Bp=document.createElement("tr"),this.Bp.appendChild(this.Ep),this.Bp.appendChild(this.Lp),this.Bp.appendChild(this.Ip),this.Vp(),this.sp=new Vs(this.Xf.canvas,this,{Yd:()=>null===this.xp&&!this.Ap.F().handleScroll.vertTouchDrag,Xd:()=>null===this.xp&&!this.Ap.F().handleScroll.horzTouchDrag})}M(){null!==this.wp&&this.wp.M(),null!==this.gp&&this.gp.M(),this.Xf.unsubscribeCanvasConfigured(this.Hf),this.Xf.destroy(),this.Yf.unsubscribeCanvasConfigured(this.jf),this.Yf.destroy(),null!==this.Rp&&this.Rp.Yo().v(this),this.sp.M()}_p(){return f(this.Rp)}Np(t){null!==this.Rp&&this.Rp.Yo().v(this),this.Rp=t,null!==this.Rp&&this.Rp.Yo().l(Os.prototype.Op.bind(this),this,!0),this.Vp()}$f(){return this.Ap}np(){return this.Bp}Vp(){if(null!==this.Rp&&(this.Fp(),0!==this.$i().wt().length)){if(null!==this.wp){const t=this.Rp.Io();this.wp.Ki(f(t))}if(null!==this.gp){const t=this.Rp.Bo();this.gp.Ki(f(t))}}}Wp(){null!==this.wp&&this.wp.bt(),null!==this.gp&&this.gp.bt()}To(){return null!==this.Rp?this.Rp.To():0}Do(t){this.Rp&&this.Rp.Do(t)}jd(t){if(!this.Rp)return;this.zp();const i=t.xf,s=t.Tf;this.jp(i,s)}lf(t){this.zp(),this.$p(),this.jp(t.xf,t.Tf)}$d(t){if(!this.Rp)return;this.zp();const i=t.xf,s=t.Tf;this.jp(i,s);const h=this.Br(i,s);this.$i().rc(h&&{hc:h.hc,Hp:h.Hp})}sf(t){null!==this.Rp&&(this.zp(),this.Up(t))}Gd(t){this.zp(),this.qp(t),this.jp(t.xf,t.Tf)}if(t){null!==this.Rp&&(this.zp(),this.Cp=!1,this.Yp(t))}tf(t){null!==this.Rp&&this.Up(t)}wf(t){if(this.Cp=!0,null===this.xp){const i={x:t.xf,y:t.Tf};this.Xp(i,i)}}bf(t){null!==this.Rp&&(this.zp(),this.Rp.Ut().rc(null),this.Zp())}Kp(){return this.yp}cf(){this.kp=1,this.$i().Us()}df(t,i){if(!this.Ap.F().handleScale.pinch)return;const s=5*(i-this.kp);this.kp=i,this.$i().mc(t.nt,s)}rf(t){if(this.Cp=!1,this.Tp=null!==this.xp,this.$p(),null!==this.xp){const i=this.$i().uc();this.Dp={x:i.Kt(),y:i.Gt()},this.xp={x:t.xf,y:t.Tf}}}Zd(t){if(null===this.Rp)return;const i=t.xf,s=t.Tf;if(null===this.xp)this.qp(t);else{this.Tp=!1;const t=f(this.Dp),h=t.x+(i-this.xp.x),e=t.y+(s-this.xp.y);this.jp(h,e)}}Qd(t){0===this.$f().F().trackingMode.exitMode&&(this.Tp=!0),this.Gp(),this.Yp(t)}Br(t,i){const s=this.Rp;if(null===s)return null;const h=s.Ga();for(const e of h){const h=this.Jp(e.Ds(s),t,i);if(null!==h)return{hc:e,If:h.If,Hp:h.Hp}}return null}Qp(t,i){f("left"===i?this.wp:this.gp).ap(new gs(t,this.Vf.Nt))}tv(){return this.Vf}ap(t){if(t.Vt<0||t.Nt<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.Vf.hh(t)||(this.Vf=t,this.zf=!0,this.Yf.resizeCanvas({width:t.Vt,height:t.Nt}),this.Xf.resizeCanvas({width:t.Vt,height:t.Nt}),this.zf=!1,this.Lp.style.width=t.Vt+"px",this.Lp.style.height=t.Nt+"px")}iv(){const t=f(this.Rp);t.Eo(t.Io()),t.Eo(t.Bo());for(const i of t.zl())if(t.Je(i)){const s=i.Pt();null!==s&&t.Eo(s),i.As()}}mp(){return this.Yf.canvas}up(t){if(0===t)return;if(null===this.Rp)return;if(t>1&&this.iv(),null!==this.wp&&this.wp.up(t),null!==this.gp&&this.gp.up(t),1!==t){const t=Ms(this.Yf.canvas);t.save(),this.dp(t,this.Yf.pixelRatio),this.Rp&&(this.sv(t,this.Yf.pixelRatio),this.nv(t,this.Yf.pixelRatio),this.ev(t,this.Yf.pixelRatio,Us),this.ev(t,this.Yf.pixelRatio,$s)),t.restore()}const i=Ms(this.Xf.canvas);i.clearRect(0,0,Math.ceil(this.Vf.Vt*this.Xf.pixelRatio),Math.ceil(this.Vf.Nt*this.Xf.pixelRatio)),this.ev(i,this.Yf.pixelRatio,Is),this.rv(i,this.Xf.pixelRatio)}hv(){return this.wp}lv(){return this.gp}Op(){null!==this.Rp&&this.Rp.Yo().v(this),this.Rp=null}Up(t){const i=t.xf,s=t.Tf;this.yp.g()&&this.yp.m(this.$i().yt().nu(i),{x:i,y:s})}dp(t,i){W(t,i,(()=>{const i=this.$i(),s=i.U(),h=i.Lc();s===h?q(t,0,0,this.Vf.Vt,this.Vf.Nt,h):J(t,0,0,this.Vf.Vt,this.Vf.Nt,s,h)}))}sv(t,i){const s=f(this.Rp),h=s.Xo().Dh().gt(s.Zt(),s.Xt());null!==h&&(t.save(),h.X(t,i,!1),t.restore())}nv(t,i){const s=this.$i()._c();this.av(t,i,Us,Ds,s),this.av(t,i,Us,Ps,s)}rv(t,i){this.av(t,i,Us,Ps,this.$i().uc())}ev(t,i,s){const h=f(this.Rp).Ga();for(const e of h)this.av(t,i,s,Ds,e);for(const e of h)this.av(t,i,s,Ps,e)}av(t,i,s,h,e){const n=f(this.Rp),r=s(e,n),o=n.Zt(),l=n.Xt(),a=n.Ut().ec(),u=null!==a&&a.hc===e,c=null!==a&&u&&void 0!==a.Hp?a.Hp.Vr:void 0;for(const f of r){const s=f.gt(o,l);null!==s&&(t.save(),h(s,t,i,u,c),t.restore())}}Jp(t,i,s){for(const h of t){const t=h.gt(this.Vf.Nt,this.Vf.Vt);if(null!==t&&t.Br){const e=t.Br(i,s);if(null!==e)return{If:h,Hp:e}}}return null}Fp(){if(null===this.Rp)return;const t=this.Ap,i=this.Rp.Io().F().visible,s=this.Rp.Bo().F().visible;i||null===this.wp||(this.Ep.removeChild(this.wp.np()),this.wp.M(),this.wp=null),s||null===this.gp||(this.Ip.removeChild(this.gp.np()),this.gp.M(),this.gp=null);const h=t.Ut().Tc();i&&null===this.wp&&(this.wp=new Ls(this,t.F(),h,"left"),this.Ep.appendChild(this.wp.np())),s&&null===this.gp&&(this.gp=new Ls(this,t.F(),h,"right"),this.Ip.appendChild(this.gp.np()))}ov(t){return t.Of&&this.Cp||null!==this.xp}_v(t){return Math.max(0,Math.min(t,this.Vf.Vt-1))}uv(t){return Math.max(0,Math.min(t,this.Vf.Nt-1))}jp(t,i){this.$i().kc(this._v(t),this.uv(i),f(this.Rp))}Zp(){this.$i().Cc()}Gp(){this.Tp&&(this.xp=null,this.Zp())}Xp(t,i){this.xp=t,this.Tp=!1,this.jp(i.x,i.y);const s=this.$i().uc();this.Dp={x:s.Kt(),y:s.Gt()}}$i(){return this.Ap.Ut()}Yp(t){if(!this.Sp)return;const i=this.$i(),s=this._p();if(i.jo(s,s.fs()),this.Mp=null,this.Sp=!1,i.Mc(),null!==this.Pp){const t=performance.now(),s=i.yt();this.Pp.cr(s.lu(),t),this.Pp.bu(t)||i.Xs(this.Pp)}}zp(){this.xp=null}$p(){if(this.Rp){if(this.$i().Us(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)f(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.Rp.fs().Fi()&&this.$i().yt().Fi()}}qp(t){if(null===this.Rp)return;const i=this.$i(),s=i.yt();if(s.Fi())return;const h=this.Ap.F(),e=h.handleScroll,n=h.kineticScroll;if((!e.pressedMouseMove||t.Of)&&(!e.horzTouchDrag&&!e.vertTouchDrag||!t.Of))return;const r=this.Rp.fs(),o=performance.now();if(null!==this.Mp||this.ov(t)||(this.Mp={x:t.gf,y:t.Mf,o_:o,xf:t.xf,Tf:t.Tf}),null!==this.Mp&&!this.Sp&&(this.Mp.x!==t.gf||this.Mp.y!==t.Mf)){if(t.Of&&n.touch||!t.Of&&n.mouse){const t=s.Kn();this.Pp=new Cs(.2/t,7/t,.997,15/t),this.Pp.qc(s.lu(),this.Mp.o_)}else this.Pp=null;r.Fi()||i.Wo(this.Rp,r,t.Tf),i.wc(t.xf),this.Sp=!0}this.Sp&&(r.Fi()||i.zo(this.Rp,r,t.Tf),i.gc(t.xf),null!==this.Pp&&this.Pp.qc(s.lu(),o))}}class Bs{constructor(t,i,s,h,e){this.ft=!0,this.Vf=new gs(0,0),this.jf=()=>this.up(3),this.Uf="left"===t,this.Zu=s.Tc,this.us=i,this.cv=h,this.dv=e,this.qf=document.createElement("div"),this.qf.style.width="25px",this.qf.style.height="100%",this.qf.style.overflow="hidden",this.Yf=ws(this.qf,new gs(16,16)),this.Yf.subscribeCanvasConfigured(this.jf)}M(){this.Yf.unsubscribeCanvasConfigured(this.jf),this.Yf.destroy()}np(){return this.qf}tv(){return this.Vf}ap(t){if(t.Vt<0||t.Nt<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.Vf.hh(t)||(this.Vf=t,this.Yf.resizeCanvas({width:t.Vt,height:t.Nt}),this.qf.style.width=`${t.Vt}px`,this.qf.style.minWidth=`${t.Vt}px`,this.qf.style.height=`${t.Nt}px`,this.ft=!0)}up(t){if(t<3&&!this.ft)return;if(0===this.Vf.Vt||0===this.Vf.Nt)return;this.ft=!1;const i=Ms(this.Yf.canvas);this.dp(i,this.Yf.pixelRatio),this.ke(i,this.Yf.pixelRatio)}mp(){return this.Yf.canvas}ke(t,i){if(!this.cv())return;const s=this.Vf.Vt;t.save(),t.fillStyle=this.us.timeScale.borderColor;const h=Math.floor(this.Zu.F().k*i),e=this.Uf?Math.round(s*i)-h:0;t.fillRect(e,0,h,h),t.restore()}dp(t,i){W(t,i,(()=>{q(t,0,0,this.Vf.Vt,this.Vf.Nt,this.dv())}))}}function Ys(t,i){return t.b_>i.b_?t:i}class As{constructor(t){this.fv=null,this.pv=null,this.S=null,this.vv=!1,this.Vf=new gs(0,0),this.mv=new C,this.Ff=new qt(5),this.zf=!1,this.jf=()=>{this.zf||this.Ap.Ut().Th()},this.Hf=()=>{this.zf||this.Ap.Ut().Th()},this.Ap=t,this.us=t.F().layout,this.bv=document.createElement("tr"),this.wv=document.createElement("td"),this.wv.style.padding="0",this.gv=document.createElement("td"),this.gv.style.padding="0",this.qf=document.createElement("td"),this.qf.style.height="25px",this.qf.style.padding="0",this.Mv=document.createElement("div"),this.Mv.style.width="100%",this.Mv.style.height="100%",this.Mv.style.position="relative",this.Mv.style.overflow="hidden",this.qf.appendChild(this.Mv),this.Yf=ws(this.Mv,new gs(16,16)),this.Yf.subscribeCanvasConfigured(this.jf);const i=this.Yf.canvas;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this.Xf=ws(this.Mv,new gs(16,16)),this.Xf.subscribeCanvasConfigured(this.Hf);const s=this.Xf.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.bv.appendChild(this.wv),this.bv.appendChild(this.qf),this.bv.appendChild(this.gv),this.Sv(),this.Ap.Ut().xo().l(this.Sv.bind(this),this),this.sp=new Vs(this.Xf.canvas,this,{Yd:()=>!0,Xd:()=>!1})}M(){this.sp.M(),null!==this.fv&&this.fv.M(),null!==this.pv&&this.pv.M(),this.Xf.unsubscribeCanvasConfigured(this.Hf),this.Xf.destroy(),this.Yf.unsubscribeCanvasConfigured(this.jf),this.Yf.destroy()}np(){return this.bv}yv(){return this.fv}kv(){return this.pv}lf(t){if(this.vv)return;this.vv=!0;const i=this.Ap.Ut();!i.yt().Fi()&&this.Ap.F().handleScale.axisPressedMouseMove.time&&i.vc(t.xf)}rf(t){this.lf(t)}af(){const t=this.Ap.Ut();!t.yt().Fi()&&this.vv&&(this.vv=!1,this.Ap.F().handleScale.axisPressedMouseMove.time&&t.yc())}Gd(t){const i=this.Ap.Ut();!i.yt().Fi()&&this.Ap.F().handleScale.axisPressedMouseMove.time&&i.Sc(t.xf)}Zd(t){this.Gd(t)}if(){this.vv=!1;const t=this.Ap.Ut();t.yt().Fi()&&!this.Ap.F().handleScale.axisPressedMouseMove.time||t.yc()}Qd(){this.if()}Id(){this.Ap.F().handleScale.axisDoubleClickReset.time&&this.Ap.Ut().Ks()}Ad(){this.Id()}jd(){this.Ap.Ut().F().handleScale.axisPressedMouseMove.time&&this.bp(1)}bf(){this.bp(0)}tv(){return this.Vf}Cv(){return this.mv}xv(t,i,s){this.Vf&&this.Vf.hh(t)||(this.Vf=t,this.zf=!0,this.Yf.resizeCanvas({width:t.Vt,height:t.Nt}),this.Xf.resizeCanvas({width:t.Vt,height:t.Nt}),this.zf=!1,this.qf.style.width=t.Vt+"px",this.qf.style.height=t.Nt+"px",this.mv.m(t)),null!==this.fv&&this.fv.ap(new gs(i,t.Nt)),null!==this.pv&&this.pv.ap(new gs(s,t.Nt))}Tv(){const t=this.Dv();return Math.ceil(t.k+t.C+t.T+t.B+t.O+t.Pv)}bt(){this.Ap.Ut().yt().Gl()}mp(){return this.Yf.canvas}up(t){if(0===t)return;if(1!==t){const i=Ms(this.Yf.canvas);this.dp(i,this.Yf.pixelRatio),this.ke(i,this.Yf.pixelRatio),this.fp(i,this.Yf.pixelRatio),null!==this.fv&&this.fv.up(t),null!==this.pv&&this.pv.up(t)}const i=Ms(this.Xf.canvas),s=this.Xf.pixelRatio;i.clearRect(0,0,Math.ceil(this.Vf.Vt*s),Math.ceil(this.Vf.Nt*s)),this.Rv([this.Ap.Ut().uc()],i,s)}dp(t,i){W(t,i,(()=>{q(t,0,0,this.Vf.Vt,this.Vf.Nt,this.Ap.Ut().Lc())}))}ke(t,i){if(this.Ap.F().timeScale.borderVisible){t.save(),t.fillStyle=this.Av();const s=Math.max(1,Math.floor(this.Dv().k*i));t.fillRect(0,0,Math.ceil(this.Vf.Vt*i),s),t.restore()}}fp(t,i){const s=this.Ap.Ut().yt(),h=s.Gl();if(!h||0===h.length)return;let e=h.reduce(Ys,h[0]).b_;e>30&&e<50&&(e=30),t.save(),t.strokeStyle=this.Av();const n=this.Dv(),r=n.k+n.C+n.B+n.T/2;t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.Av();const o=Math.max(1,Math.floor(i)),l=Math.floor(.5*i),a=s.F();if(a.borderVisible&&a.ticksVisible){t.beginPath();const s=Math.round(n.C*i);for(let e=h.length;e--;){const n=Math.round(h[e].ql*i);t.rect(n-l,0,o,s)}t.fill()}t.fillStyle=this.$(),W(t,i,(()=>{t.font=this.hp();for(const i of h)if(i.b_<e){const s=i._u?this.Ov(t,i.ql,i._a):i.ql;t.fillText(i._a,s,r)}t.font=this.Lv();for(const i of h)if(i.b_>=e){const s=i._u?this.Ov(t,i.ql,i._a):i.ql;t.fillText(i._a,s,r)}})),t.restore()}Ov(t,i,s){const h=this.Ff.Mi(t,s),e=h/2,n=Math.floor(i-e)+.5;return n<0?i+=Math.abs(0-n):n+h>this.Vf.Vt&&(i-=Math.abs(this.Vf.Vt-(n+h))),i}Rv(t,i,s){const h=this.Dv();for(const e of t)for(const t of e.Ji())i.save(),t.gt().X(i,h,s),i.restore()}Av(){return this.Ap.F().timeScale.borderColor}$(){return this.us.textColor}W(){return this.us.fontSize}hp(){return L(this.W(),this.us.fontFamily)}Lv(){return L(this.W(),this.us.fontFamily,"bold")}Dv(){null===this.S&&(this.S={k:1,V:NaN,B:NaN,O:NaN,ji:NaN,C:5,T:NaN,D:"",zi:new qt,Pv:0});const t=this.S,i=this.hp();if(t.D!==i){const s=this.W();t.T=s,t.D=i,t.B=3*s/12,t.O=3*s/12,t.ji=9*s/12,t.V=0,t.Pv=4*s/12,t.zi.We()}return this.S}bp(t){this.qf.style.cursor=1===t?"ew-resize":"default"}Sv(){const t=this.Ap.Ut(),i=t.F();i.leftPriceScale.visible||null===this.fv||(this.wv.removeChild(this.fv.np()),this.fv.M(),this.fv=null),i.rightPriceScale.visible||null===this.pv||(this.gv.removeChild(this.pv.np()),this.pv.M(),this.pv=null);const s={Tc:this.Ap.Ut().Tc()},h=()=>i.leftPriceScale.borderVisible&&t.yt().F().borderVisible,e=()=>t.Lc();i.leftPriceScale.visible&&null===this.fv&&(this.fv=new Bs("left",i,s,h,e),this.wv.appendChild(this.fv.np())),i.rightPriceScale.visible&&null===this.pv&&(this.pv=new Bs("right",i,s,h,e),this.gv.appendChild(this.pv.np()))}}class zs{constructor(t,i){var s;this.Ev=[],this.Iv=0,this.da=0,this.qe=0,this.Bv=0,this.Vv=0,this.Nv=null,this.Fv=!1,this.yp=new C,this.qu=new C,this.us=i,this.bv=document.createElement("div"),this.bv.classList.add("tv-lightweight-charts"),this.bv.style.overflow="hidden",this.bv.style.width="100%",this.bv.style.height="100%",(s=this.bv).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.Wv=document.createElement("table"),this.Wv.setAttribute("cellspacing","0"),this.bv.appendChild(this.Wv),this.zv=this.jv.bind(this),Ws(this.us)&&this.$v(!0),this.$i=new ps(this.Xu.bind(this),this.us),this.Ut().cc().l(this.Hv.bind(this),this),this.Uv=new As(this),this.Wv.appendChild(this.Uv.np());let h=this.us.width,e=this.us.height;if(0===h||0===e){const i=t.getBoundingClientRect();0===h&&(h=Math.floor(i.width),h-=h%2),0===e&&(e=Math.floor(i.height),e-=e%2)}this.qv(h,e),this.Yv(),t.appendChild(this.bv),this.Xv(),this.$i.yt().Su().l(this.$i.fl.bind(this.$i),this),this.$i.xo().l(this.$i.fl.bind(this.$i),this)}Ut(){return this.$i}F(){return this.us}Zv(){return this.Ev}Kv(){return this.Uv}M(){this.$v(!1),0!==this.Iv&&window.cancelAnimationFrame(this.Iv),this.$i.cc().v(this),this.$i.yt().Su().v(this),this.$i.xo().v(this),this.$i.M();for(const t of this.Ev)this.Wv.removeChild(t.np()),t.Kp().v(this),t.M();this.Ev=[],f(this.Uv).M(),null!==this.bv.parentElement&&this.bv.parentElement.removeChild(this.bv),this.qu.M(),this.yp.M()}qv(t,i,s){if(void 0===s&&(s=!1),this.da===i&&this.qe===t)return;this.da=i,this.qe=t;const h=i+"px",e=t+"px";f(this.bv).style.height=h,f(this.bv).style.width=e,this.Wv.style.height=h,this.Wv.style.width=e,s?this.Gv(rt.en(),performance.now()):this.$i.fl()}up(t){void 0===t&&(t=rt.en());for(let i=0;i<this.Ev.length;i++)this.Ev[i].up(t.$s(i).Ws);this.us.timeScale.visible&&this.Uv.up(t.js())}xh(t){const i=Ws(this.us);this.$i.xh(t);const s=Ws(this.us);s!==i&&this.$v(s),this.Xv();const h=t.width||this.qe,e=t.height||this.da;this.qv(h,e)}Kp(){return this.yp}cc(){return this.qu}Jv(){null!==this.Nv&&(this.Gv(this.Nv,performance.now()),this.Nv=null);const t=this.Ev[0],i=function(t,i){const s=t.createElement("canvas"),h=bs(s);return s.style.width=`${i.Vt}px`,s.style.height=`${i.Nt}px`,s.width=i.Vt*h,s.height=i.Nt*h,s}(document,new gs(this.qe,this.da)),s=Ms(i),h=bs(i);return W(s,h,(()=>{let i=0,h=0;const e=t=>{for(let e=0;e<this.Ev.length;e++){const n=this.Ev[e],r=n.tv().Nt,o=f("left"===t?n.hv():n.lv()),l=o.mp();s.drawImage(l,i,h,o.op(),r),h+=r}};this.Qv()&&(e("left"),i=f(t.hv()).op()),h=0;for(let t=0;t<this.Ev.length;t++){const e=this.Ev[t],n=e.tv(),r=e.mp();s.drawImage(r,i,h,n.Vt,n.Nt),h+=n.Nt}i+=t.tv().Vt,this.tm()&&(h=0,e("right"));const n=t=>{const e=f("left"===t?this.Uv.yv():this.Uv.kv()),n=e.tv(),r=e.mp();s.drawImage(r,i,h,n.Vt,n.Nt)};if(this.us.timeScale.visible){i=0,this.Qv()&&(n("left"),i=f(t.hv()).op());const e=this.Uv.tv(),r=this.Uv.mp();s.drawImage(r,i,h,e.Vt,e.Nt),this.tm()&&(i+=t.tv().Vt,n("right"),s.restore())}})),i}im(t){return("left"!==t||this.Qv())&&("right"!==t||this.tm())?0===this.Ev.length?0:f("left"===t?this.Ev[0].hv():this.Ev[0].lv()).op():0}sm(){let t=0,i=0,s=0;for(const d of this.Ev)this.Qv()&&(i=Math.max(i,f(d.hv()).rp())),this.tm()&&(s=Math.max(s,f(d.lv()).rp())),t+=d.To();const h=this.qe,e=this.da,n=Math.max(h-i-s,0),r=this.us.timeScale.visible;let o=r?this.Uv.Tv():0;o%2&&(o+=1);const l=0+o,a=e<l?0:e-l,u=a/t;let c=0;for(let f=0;f<this.Ev.length;++f){const t=this.Ev[f];t.Np(this.$i.oc()[f]);let h=0,e=0;e=f===this.Ev.length-1?a-c:Math.round(t.To()*u),h=Math.max(e,2),c+=h,t.ap(new gs(n,h)),this.Qv()&&t.Qp(i,"left"),this.tm()&&t.Qp(s,"right"),t._p()&&this.$i.dc(t._p(),h)}this.Uv.xv(new gs(r?n:0,o),r?i:0,r?s:0),this.$i.Po(n),this.Bv!==i&&(this.Bv=i),this.Vv!==s&&(this.Vv=s)}$v(t){t?this.bv.addEventListener("wheel",this.zv,{passive:!1}):this.bv.removeEventListener("wheel",this.zv)}jv(t){let i=t.deltaX/100,s=-t.deltaY/100;if(0!==i&&this.us.handleScroll.mouseWheel||0!==s&&this.us.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,s*=120;break;case t.DOM_DELTA_LINE:i*=32,s*=32}if(0!==s&&this.us.handleScale.mouseWheel){const i=Math.sign(s)*Math.min(1,Math.abs(s)),h=t.clientX-this.bv.getBoundingClientRect().left;this.Ut().mc(h,i)}0!==i&&this.us.handleScroll.mouseWheel&&this.Ut().bc(-80*i)}}Gv(t,i){var s;const h=t.js();3===h&&this.nm(),3!==h&&2!==h||(this.rm(t),this.hm(t,i),this.Uv.bt(),this.Ev.forEach((t=>{t.Wp()})),3===(null===(s=this.Nv)||void 0===s?void 0:s.js())&&(this.Nv.tn(t),this.nm(),this.rm(this.Nv),this.hm(this.Nv,i),t=this.Nv,this.Nv=null)),this.up(t)}hm(t,i){for(const s of t.Qs())this.sn(s,i)}rm(t){const i=this.$i.oc();for(let s=0;s<i.length;s++)t.$s(s).zs&&i[s].Uo()}sn(t,i){const s=this.$i.yt();switch(t.qs){case 0:s.ku();break;case 1:s.Cu(t.Rt);break;case 2:s.Gs(t.Rt);break;case 3:s.Js(t.Rt);break;case 4:s.uu();break;case 5:t.Rt.bu(i)||s.Js(t.Rt.wu(i))}}Xu(t){null!==this.Nv?this.Nv.tn(t):this.Nv=t,this.Fv||(this.Fv=!0,this.Iv=window.requestAnimationFrame((t=>{if(this.Fv=!1,this.Iv=0,null!==this.Nv){const i=this.Nv;this.Nv=null,this.Gv(i,t);for(const s of i.Qs())if(5===s.qs&&!s.Rt.bu(t)){this.Ut().Xs(s.Rt);break}}})))}nm(){this.Yv()}Yv(){const t=this.$i.oc(),i=t.length,s=this.Ev.length;for(let h=i;h<s;h++){const t=c(this.Ev.pop());this.Wv.removeChild(t.np()),t.Kp().v(this),t.M()}for(let h=s;h<i;h++){const i=new Os(this,t[h]);i.Kp().l(this.lm.bind(this),this),this.Ev.push(i),this.Wv.insertBefore(i.np(),this.Uv.np())}for(let h=0;h<i;h++){const i=t[h],s=this.Ev[h];s._p()!==i?s.Np(i):s.Vp()}this.Xv(),this.sm()}am(t,i){var s;const h=new Map;let e;if(null!==t&&this.$i.wt().forEach((i=>{const s=i.Is().$h(t);null!==s&&h.set(i,s)})),null!==t){const i=null===(s=this.$i.yt().Hi(t))||void 0===s?void 0:s.w_;void 0!==i&&(e=i)}const n=this.Ut().ec(),r=null!==n&&n.hc instanceof Ti?n.hc:void 0,o=null!==n&&void 0!==n.Hp?n.Hp.Fr:void 0;return{ot:e,Yn:null!=t?t:void 0,om:null!=i?i:void 0,_m:r,um:h,dm:o}}lm(t,i){this.yp.m((()=>this.am(t,i)))}Hv(t,i){this.qu.m((()=>this.am(t,i)))}Xv(){const t=this.us.timeScale.visible?"":"none";this.Uv.np().style.display=t}Qv(){return this.Ev[0]._p().Io().F().visible}tm(){return this.Ev[0]._p().Bo().F().visible}}function Ws(t){return Boolean(t.handleScroll.mouseWheel||t.handleScale.mouseWheel)}function qs(t,i,s,h){const e=s.value,n={Yn:i,ot:t,Rt:[e,e,e,e],w_:h};return void 0!==s.color&&(n.R=s.color),n}function Xs(t){return void 0!==t.Rt}function js(t){return(i,s,h,e)=>{return void 0===(n=h).open&&void 0===n.value?{ot:i,Yn:s,w_:e}:t(i,s,h,e);var n}}const Gs={Candlestick:js((function(t,i,s,h){const e={Yn:i,ot:t,Rt:[s.open,s.high,s.low,s.close],w_:h};return void 0!==s.color&&(e.R=s.color),void 0!==s.borderColor&&(e.At=s.borderColor),void 0!==s.wickColor&&(e.Ah=s.wickColor),e})),Bar:js((function(t,i,s,h){const e={Yn:i,ot:t,Rt:[s.open,s.high,s.low,s.close],w_:h};return void 0!==s.color&&(e.R=s.color),e})),Area:js((function(t,i,s,h){const e=s.value,n={Yn:i,ot:t,Rt:[e,e,e,e],w_:h};return void 0!==s.lineColor&&(n.lt=s.lineColor),void 0!==s.topColor&&(n.vn=s.topColor),void 0!==s.bottomColor&&(n.mn=s.bottomColor),n})),Baseline:js((function(t,i,s,h){const e=s.value,n={Yn:i,ot:t,Rt:[e,e,e,e],w_:h};return void 0!==s.topLineColor&&(n.be=s.topLineColor),void 0!==s.bottomLineColor&&(n.we=s.bottomLineColor),void 0!==s.topFillColor1&&(n.de=s.topFillColor1),void 0!==s.topFillColor2&&(n.fe=s.topFillColor2),void 0!==s.bottomFillColor1&&(n.pe=s.bottomFillColor1),void 0!==s.bottomFillColor2&&(n.ve=s.bottomFillColor2),n})),Histogram:js(qs),Line:js(qs)};function Js(t){return Gs[t]}function Qs(t){return 60*t*60*1e3}function Zs(t){return 60*t*1e3}const Ks=[{fm:(1,1e3),b_:10},{fm:Zs(1),b_:20},{fm:Zs(5),b_:21},{fm:Zs(30),b_:22},{fm:Qs(1),b_:30},{fm:Qs(3),b_:31},{fm:Qs(6),b_:32},{fm:Qs(12),b_:33}];function Hs(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let s=Ks.length-1;s>=0;--s)if(Math.floor(i.getTime()/Ks[s].fm)!==Math.floor(t.getTime()/Ks[s].fm))return Ks[s].b_;return 0}function th(t,i){if(void 0===i&&(i=0),0===t.length)return;let s=0===i?null:t[i-1].ot.o_,h=null!==s?new Date(1e3*s):null,e=0;for(let n=i;n<t.length;++n){const i=t[n],r=new Date(1e3*i.ot.o_);null!==h&&(i.m_=Hs(r,h)),e+=i.ot.o_-(s||i.ot.o_),s=i.ot.o_,h=r}if(0===i&&t.length>1){const i=Math.ceil(e/(t.length-1)),s=new Date(1e3*(t[0].ot.o_-i));t[0].m_=Hs(new Date(1e3*t[0].ot.o_),s)}}function ih(t){if(!ms(t))throw new Error("time must be of type BusinessDay");const i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{o_:Math.round(i.getTime()/1e3),a_:t}}function sh(t){if(!vs(t))throw new Error("time must be of type isUTCTimestamp");return{o_:t}}function hh(t){return 0===t.length?null:ms(t[0].time)?ih:sh}function eh(t){return vs(t)?sh(t):ms(t)?ih(t):ih(nh(t))}function nh(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function rh(t){V(t.time)&&(t.time=nh(t.time))}function oh(t){return{Yn:0,pm:new Map,Cl:t}}function lh(t){if(void 0!==t&&0!==t.length)return{vm:t[0].ot.o_,bm:t[t.length-1].ot.o_}}function ah(t){let i;return t.forEach((t=>{void 0===i&&(i=t.w_)})),c(i)}function uh(t){void 0===t.w_&&(t.w_=t.time)}class ch{constructor(){this.wm=new Map,this.gm=new Map,this.Mm=new Map,this.Sm=[]}M(){this.wm.clear(),this.gm.clear(),this.Mm.clear(),this.Sm=[]}ym(t,i){let s=0!==this.wm.size,h=!1;const e=this.gm.get(t);if(void 0!==e)if(1===this.gm.size)s=!1,h=!0,this.wm.clear();else for(const o of this.Sm)o.pointData.pm.delete(t)&&(h=!0);let n=[];if(0!==i.length){const s=i;s.forEach((t=>uh(t))),function(t){t.forEach(rh)}(i);const e=f(hh(i)),r=Js(t.Ih());n=s.map((i=>{const s=e(i.time);let n=this.wm.get(s.o_);void 0===n&&(n=oh(s),this.wm.set(s.o_,n),h=!0);const o=r(s,n.Yn,i,i.w_);return n.pm.set(t,o),o}))}s&&this.km(),this.Cm(t,n);let r=-1;if(h){const t=[];this.wm.forEach((i=>{t.push({m_:0,ot:i.Cl,pointData:i,w_:ah(i.pm)})})),t.sort(((t,i)=>t.ot.o_-i.ot.o_)),r=this.xm(t)}return this.Tm(t,r,function(t,i){const s=lh(t),h=lh(i);if(void 0!==s&&void 0!==h)return{bl:s.bm>=h.bm&&s.vm>=h.vm}}(this.gm.get(t),e))}Rc(t){return this.ym(t,[])}Dm(t,i){const s=i;uh(s),rh(i);const h=f(hh([i]))(i.time),e=this.Mm.get(t);if(void 0!==e&&h.o_<e.o_)throw new Error(`Cannot update oldest data, last time=${e.o_}, new time=${h.o_}`);let n=this.wm.get(h.o_);const r=void 0===n;void 0===n&&(n=oh(h),this.wm.set(h.o_,n));const o=Js(t.Ih())(h,n.Yn,i,s.w_);n.pm.set(t,o),this.Pm(t,o);const l={bl:Xs(o)};if(!r)return this.Tm(t,-1,l);const a={m_:0,ot:n.Cl,pointData:n,w_:ah(n.pm)},u=yt(this.Sm,a.ot.o_,((t,i)=>t.ot.o_<i));this.Sm.splice(u,0,a);for(let c=u;c<this.Sm.length;++c)fh(this.Sm[c].pointData,c);return th(this.Sm,u),this.Tm(t,u,l)}Pm(t,i){let s=this.gm.get(t);void 0===s&&(s=[],this.gm.set(t,s));const h=0!==s.length?s[s.length-1]:null;null===h||i.ot.o_>h.ot.o_?Xs(i)&&s.push(i):Xs(i)?s[s.length-1]=i:s.splice(-1,1),this.Mm.set(t,i.ot)}Cm(t,i){0!==i.length?(this.gm.set(t,i.filter(Xs)),this.Mm.set(t,i[i.length-1].ot)):(this.gm.delete(t),this.Mm.delete(t))}km(){for(const t of this.Sm)0===t.pointData.pm.size&&this.wm.delete(t.ot.o_)}xm(t){let i=-1;for(let s=0;s<this.Sm.length&&s<t.length;++s){const h=this.Sm[s],e=t[s];if(h.ot.o_!==e.ot.o_){i=s;break}e.m_=h.m_,fh(e.pointData,s)}if(-1===i&&this.Sm.length!==t.length&&(i=Math.min(this.Sm.length,t.length)),-1===i)return-1;for(let s=i;s<t.length;++s)fh(t[s].pointData,s);return th(t,i),this.Sm=t,i}Rm(){if(0===this.gm.size)return null;let t=0;return this.gm.forEach((i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].Yn))})),t}Tm(t,i,s){const h={Am:new Map,yt:{su:this.Rm()}};if(-1!==i)this.gm.forEach(((i,e)=>{h.Am.set(e,{hr:i,Om:e===t?s:void 0})})),this.gm.has(t)||h.Am.set(t,{hr:[],Om:s}),h.yt.Lm=this.Sm,h.yt.Em=i;else{const i=this.gm.get(t);h.Am.set(t,{hr:i||[],Om:s})}return h}}function fh(t,i){t.Yn=i,t.pm.forEach((t=>{t.Yn=i}))}function dh(t){return{value:t.Rt[3],time:t.w_}}function ph(t){const i=dh(t);return void 0!==t.R&&(i.color=t.R),i}function mh(t){return{open:t.Rt[0],high:t.Rt[1],low:t.Rt[2],close:t.Rt[3],time:t.w_}}const vh={Area:function(t){const i=dh(t);return void 0!==t.lt&&(i.lineColor=t.lt),void 0!==t.vn&&(i.topColor=t.vn),void 0!==t.mn&&(i.bottomColor=t.mn),i},Line:ph,Baseline:function(t){const i=dh(t);return void 0!==t.be&&(i.topLineColor=t.be),void 0!==t.we&&(i.bottomLineColor=t.we),void 0!==t.de&&(i.topFillColor1=t.de),void 0!==t.fe&&(i.topFillColor2=t.fe),void 0!==t.pe&&(i.bottomFillColor1=t.pe),void 0!==t.ve&&(i.bottomFillColor2=t.ve),i},Histogram:ph,Bar:function(t){const i=mh(t);return void 0!==t.R&&(i.color=t.R),i},Candlestick:function(t){const i=mh(t),{R:s,At:h,Ah:e}=t;return void 0!==s&&(i.color=s),void 0!==h&&(i.borderColor=h),void 0!==e&&(i.wickColor=e),i}};function gh(t){return vh[t]}const bh={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2}},Mh={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:k,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},wh={width:0,height:0,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:k},crosshair:{vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:Object.assign({},bh),leftPriceScale:Object.assign(Object.assign({},bh),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},bh),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,ticksVisible:!1},watermark:Mh,localization:{locale:Es?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},yh={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},_h={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},Ch={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Eh={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},xh={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Th={color:"#26a69a",base:0},Vh={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};class Fh{constructor(t,i){this.Im=t,this.Bm=i}applyOptions(t){this.Im.Ut().lc(this.Bm,t)}options(){return this.Vi().F()}width(){return nt(this.Bm)?this.Im.im(this.Bm):0}Vi(){return f(this.Im.Ut().ac(this.Bm)).Pt}}const Sh={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:""};class Rh{constructor(t){this.Mh=t}applyOptions(t){this.Mh.xh(t)}options(){return this.Mh.F()}Vm(){return this.Mh}}class Nh{constructor(t,i,s){this.Tn=t,this.Nm=i,this.Fm=s}priceFormatter(){return this.Tn.Ol()}priceToCoordinate(t){const i=this.Tn.xt();return null===i?null:this.Tn.Pt().Dt(t,i.Rt)}coordinateToPrice(t){const i=this.Tn.xt();return null===i?null:this.Tn.Pt().ps(t,i.Rt)}barsInLogicalRange(t){if(null===t)return null;const i=new es(new is(t.from,t.to)).k_(),s=this.Tn.Is();if(s.Fi())return null;const h=s.$h(i.gn(),1),e=s.$h(i.Mn(),-1),n=f(s.Wh()),r=f(s.Es());if(null!==h&&null!==e&&h.Yn>e.Yn)return{barsBefore:t.from-n,barsAfter:r-t.to};const o={barsBefore:null===h||h.Yn===n?t.from-n:h.Yn-n,barsAfter:null===e||e.Yn===r?r-t.to:r-e.Yn};return null!==h&&null!==e&&(o.from=h.ot.a_||h.ot.o_,o.to=e.ot.a_||e.ot.o_),o}setData(t){this.Tn.Ih(),this.Nm.Wm(this.Tn,t)}update(t){this.Tn.Ih(),this.Nm.zm(this.Tn,t)}dataByIndex(t,i){const s=this.Tn.Is().$h(t,i);return null===s?null:gh(this.seriesType())(s)}setMarkers(t){const i=t.map((t=>Object.assign(Object.assign({},t),{originalTime:t.time,time:eh(t.time)})));this.Tn.gl(i)}markers(){return this.Tn.Ml().map((t=>{const{originalTime:i,time:s}=t,h=function(t,i){var s={};for(var h in t)Object.prototype.hasOwnProperty.call(t,h)&&i.indexOf(h)<0&&(s[h]=t[h]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(h=Object.getOwnPropertySymbols(t);e<h.length;e++)i.indexOf(h[e])<0&&Object.prototype.propertyIsEnumerable.call(t,h[e])&&(s[h[e]]=t[h[e]])}return s}(t,["originalTime","time"]);return Object.assign({time:i},h)}))}applyOptions(t){this.Tn.xh(t)}options(){return S(this.Tn.F())}priceScale(){return this.Fm.priceScale(this.Tn.Pt().Vl())}createPriceLine(t){const i=E(S(Sh),t),s=this.Tn.Sl(i);return new Rh(s)}removePriceLine(t){this.Tn.yl(t.Vm())}seriesType(){return this.Tn.Ih()}}class kh{constructor(t,i){this.jm=new C,this.E_=new C,this.mv=new C,this.$i=t,this.mo=t.yt(),this.Uv=i,this.mo.gu().l(this.$m.bind(this)),this.mo.Mu().l(this.Hm.bind(this)),this.Uv.Cv().l(this.Um.bind(this))}M(){this.mo.gu().v(this),this.mo.Mu().v(this),this.Uv.Cv().v(this),this.jm.M(),this.E_.M(),this.mv.M()}scrollPosition(){return this.mo.lu()}scrollToPosition(t,i){i?this.mo.mu(t,1e3):this.$i.Js(t)}scrollToRealTime(){this.mo.vu()}getVisibleRange(){var t,i;const s=this.mo.Z_();return null===s?null:{from:null!==(t=s.from.a_)&&void 0!==t?t:s.from.o_,to:null!==(i=s.to.a_)&&void 0!==i?i:s.to.o_}}setVisibleRange(t){const i={from:eh(t.from),to:eh(t.to)},s=this.mo.Q_(i);this.$i.Ac(s)}getVisibleLogicalRange(){const t=this.mo.X_();return null===t?null:{from:t.gn(),to:t.Mn()}}setVisibleLogicalRange(t){u(t.from<=t.to,"The from index cannot be after the to index."),this.$i.Ac(t)}resetTimeScale(){this.$i.Ks()}fitContent(){this.$i.ku()}logicalToCoordinate(t){const i=this.$i.yt();return i.Fi()?null:i.Lt(t)}coordinateToLogical(t){return this.mo.Fi()?null:this.mo.nu(t)}timeToCoordinate(t){const i=eh(t),s=this.mo.Fl(i,!1);return null===s?null:this.mo.Lt(s)}coordinateToTime(t){var i;const s=this.$i.yt(),h=s.nu(t),e=s.vs(h);return null===e?null:null!==(i=e.a_)&&void 0!==i?i:e.o_}width(){return this.Uv.tv().Vt}height(){return this.Uv.tv().Nt}subscribeVisibleTimeRangeChange(t){this.jm.l(t)}unsubscribeVisibleTimeRangeChange(t){this.jm.p(t)}subscribeVisibleLogicalRangeChange(t){this.E_.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.E_.p(t)}subscribeSizeChange(t){this.mv.l(t)}unsubscribeSizeChange(t){this.mv.p(t)}applyOptions(t){this.mo.xh(t)}options(){return S(this.mo.F())}$m(){this.jm.g()&&this.jm.m(this.getVisibleRange())}Hm(){this.E_.g()&&this.E_.m(this.getVisibleLogicalRange())}Um(t){this.mv.m(t.Vt,t.Nt)}}function Lh(t){return function(t){if(F(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:{time:i,price:i},axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale){const{axisPressedMouseMove:i,axisDoubleClickReset:s}=t.handleScale;F(i)&&(t.handleScale.axisPressedMouseMove={time:i,price:i}),F(s)&&(t.handleScale.axisDoubleClickReset={time:s,price:s})}const i=t.handleScroll;F(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class Dh{constructor(t,i){this.qm=new ch,this.Ym=new Map,this.Xm=new Map,this.Zm=new C,this.Km=new C;const s=void 0===i?S(wh):E(S(wh),Lh(i));this.Im=new zs(t,s),this.Im.Kp().l((t=>{this.Zm.g()&&this.Zm.m(this.Gm(t()))}),this),this.Im.cc().l((t=>{this.Km.g()&&this.Km.m(this.Gm(t()))}),this);const h=this.Im.Ut();this.Jm=new kh(h,this.Im.Kv())}remove(){this.Im.Kp().v(this),this.Im.cc().v(this),this.Jm.M(),this.Im.M(),this.Ym.clear(),this.Xm.clear(),this.Zm.M(),this.Km.M(),this.qm.M()}resize(t,i,s){this.Im.qv(t,i,s)}addAreaSeries(t){return this.Qm("Area",Eh,t)}addBaselineSeries(t){return this.Qm("Baseline",xh,t)}addBarSeries(t){return this.Qm("Bar",_h,t)}addCandlestickSeries(t){return void 0===t&&(t={}),function(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}(t),this.Qm("Candlestick",yh,t)}addHistogramSeries(t){return this.Qm("Histogram",Th,t)}addLineSeries(t){return this.Qm("Line",Ch,t)}removeSeries(t){const i=c(this.Ym.get(t)),s=this.qm.Rc(i);this.Im.Ut().Rc(i),this.tb(s),this.Ym.delete(t),this.Xm.delete(i)}Wm(t,i){this.tb(this.qm.ym(t,i))}zm(t,i){this.tb(this.qm.Dm(t,i))}subscribeClick(t){this.Zm.l(t)}unsubscribeClick(t){this.Zm.p(t)}subscribeCrosshairMove(t){this.Km.l(t)}unsubscribeCrosshairMove(t){this.Km.p(t)}priceScale(t){return new Fh(this.Im,t)}timeScale(){return this.Jm}applyOptions(t){this.Im.xh(Lh(t))}options(){return this.Im.F()}takeScreenshot(){return this.Im.Jv()}Qm(t,i,s){void 0===s&&(s={}),function(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const s=Math.round(t);if(Math.abs(s-t)<1e-8)return i;t*=10}return i}(i.minMove))}(s.priceFormat);const h=E(S(Vh),S(i),s),e=this.Im.Ut().Dc(t,h),n=new Nh(e,this,this);return this.Ym.set(n,e),this.Xm.set(e,n),n}tb(t){const i=this.Im.Ut();i.xc(t.yt.su,t.yt.Lm,t.yt.Em),t.Am.forEach(((t,i)=>i.tt(t.hr,t.Om))),i.ru()}ib(t){return c(this.Xm.get(t))}Gm(t){const i=new Map;t.um.forEach(((t,s)=>{const h=gh(s.Ih())(t);u(function(t){return void 0!==t.open||void 0!==t.value}(h)),i.set(this.ib(s),h)}));const s=void 0===t._m?void 0:this.ib(t._m);return{time:t.ot,logical:t.Yn,point:t.om,hoveredSeries:s,hoveredMarkerId:t.dm,seriesData:i}}}function Ph(t,i){let s;if(V(t)){const i=document.getElementById(t);u(null!==i,`Cannot find element in DOM with id=${t}`),s=i}else s=t;return new Dh(s,i)}function Uh(){return"4.0.0-dev+202210061515"}}}]);