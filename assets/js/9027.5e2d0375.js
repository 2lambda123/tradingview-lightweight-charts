"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9027],{9027:(t,i,s)=>{s.r(i),s.d(i,{ColorType:()=>cs,CrosshairMode:()=>ht,LastPriceAnimationMode:()=>ls,LineStyle:()=>n,LineType:()=>e,MismatchDirection:()=>xi,PriceLineSource:()=>as,PriceScaleMode:()=>ji,TickMarkType:()=>rs,TrackingModeExitMode:()=>os,createChart:()=>zh,isBusinessDay:()=>ms,isUTCTimestamp:()=>gs,version:()=>Oh});var h={allowDownsampling:!0};var e,n,r,o=function(){function t(t,i){var s=this;this._resolutionMediaQueryList=null,this._resolutionListener=function(t){return s._onResolutionChanged()},this._canvasConfiguredListeners=[],this.canvas=t,this._canvasSize={width:this.canvas.clientWidth,height:this.canvas.clientHeight},this._options=i,this._configureCanvas(),this._installResolutionListener()}return t.prototype.destroy=function(){this._canvasConfiguredListeners.length=0,this._uninstallResolutionListener(),this.canvas=null},Object.defineProperty(t.prototype,"canvasSize",{get:function(){return{width:this._canvasSize.width,height:this._canvasSize.height}},enumerable:!0,configurable:!0}),t.prototype.resizeCanvas=function(t){this._canvasSize={width:t.width,height:t.height},this._configureCanvas()},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");return t.devicePixelRatio>1||this._options.allowDownsampling?t.devicePixelRatio:1},enumerable:!0,configurable:!0}),t.prototype.subscribeCanvasConfigured=function(t){this._canvasConfiguredListeners.push(t)},t.prototype.unsubscribeCanvasConfigured=function(t){this._canvasConfiguredListeners=this._canvasConfiguredListeners.filter((function(i){return i!=t}))},t.prototype._configureCanvas=function(){var t=this.pixelRatio;this.canvas.style.width=this._canvasSize.width+"px",this.canvas.style.height=this._canvasSize.height+"px",this.canvas.width=this._canvasSize.width*t,this.canvas.height=this._canvasSize.height*t,this._emitCanvasConfigured()},t.prototype._emitCanvasConfigured=function(){var t=this;this._canvasConfiguredListeners.forEach((function(i){return i.call(t)}))},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");var i=t.devicePixelRatio;this._resolutionMediaQueryList=t.matchMedia("all and (resolution: "+i+"dppx)"),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},t.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},t.prototype._onResolutionChanged=function(){this._configureCanvas(),this._reinstallResolutionListener()},t}();function l(t,i){const s={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(s)}function a(t,i,s,h){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(s,i+e),t.lineTo(h,i+e),t.stroke()}function c(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function u(t){if(void 0===t)throw new Error("Value is undefined");return t}function f(t){if(null===t)throw new Error("Value is null");return t}function d(t){return f(u(t))}(r=e||(e={}))[r.Simple=0]="Simple",r[r.WithSteps=1]="WithSteps",r[r.Curved=2]="Curved",function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(n||(n={}));const p={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function v(t){return t<0?0:t>255?255:Math.round(t)||0}function m(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const g=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,b=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,w=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,M=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function _(t){(t=t.toLowerCase())in p&&(t=p[t]);{const i=M.exec(t)||w.exec(t);if(i)return[v(parseInt(i[1],10)),v(parseInt(i[2],10)),v(parseInt(i[3],10)),m(i.length<5?1:parseFloat(i[4]))]}{const i=b.exec(t);if(i)return[v(parseInt(i[1],16)),v(parseInt(i[2],16)),v(parseInt(i[3],16)),1]}{const i=g.exec(t);if(i)return[v(17*parseInt(i[1],16)),v(17*parseInt(i[2],16)),v(17*parseInt(i[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function y(t){const i=_(t);return{t:`rgb(${i[0]}, ${i[1]}, ${i[2]})`,i:(s=i,.199*s[0]+.687*s[1]+.114*s[2]>160?"black":"white")};var s}class x{constructor(){this.h=[]}l(t,i,s){const h={o:t,_:i,u:!0===s};this.h.push(h)}p(t){const i=this.h.findIndex((i=>t===i.o));i>-1&&this.h.splice(i,1)}v(t){this.h=this.h.filter((i=>i._!==t))}m(t,i){const s=[...this.h];this.h=this.h.filter((t=>!t.u)),s.forEach((s=>s.o(t,i)))}g(){return this.h.length>0}M(){this.h=[]}}function C(t){for(var i=arguments.length,s=new Array(i>1?i-1:0),h=1;h<i;h++)s[h-1]=arguments[h];for(const e of s)for(const i in e)void 0!==e[i]&&("object"!=typeof e[i]||void 0===t[i]?t[i]=e[i]:C(t[i],e[i]));return t}function F(t){return"number"==typeof t&&isFinite(t)}function S(t){return"number"==typeof t&&t%1==0}function k(t){return"string"==typeof t}function I(t){return"boolean"==typeof t}function L(t){const i=t;if(!i||"object"!=typeof i)return i;let s,h,e;for(h in s=Array.isArray(i)?[]:{},i)i.hasOwnProperty(h)&&(e=i[h],s[h]=e&&"object"==typeof e?L(e):e);return s}function T(t){return null!==t}function N(t){return null===t?void 0:t}const D="-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";function R(t,i,s){return void 0===i&&(i=D),`${s=void 0!==s?`${s} `:""}${t}px ${i}`}class W{constructor(t){this.S={k:1,C:5,T:NaN,D:"",P:"",R:"",A:"",L:0,O:0,B:0,I:0,V:0},this.N=t}F(){const t=this.S,i=this.W(),s=this.j();return t.T===i&&t.P===s||(t.T=i,t.P=s,t.D=R(i,s),t.I=2.5/12*i,t.L=t.I,t.O=i/12*t.C,t.B=i/12*t.C,t.V=0),t.R=this.$(),t.A=this.H(),this.S}$(){return this.N.F().layout.textColor}H(){return this.N.U()}W(){return this.N.F().layout.fontSize}j(){return this.N.F().layout.fontFamily}}class B{constructor(){this.q=[]}Y(t){this.q=t}X(t,i,s,h){this.q.forEach((e=>{t.save(),e.X(t,i,s,h),t.restore()}))}}class E{X(t,i,s,h){t.save(),t.scale(i,i),this.Z(t,s,h),t.restore()}K(t,i,s,h){t.save(),t.scale(i,i),this.G(t,s,h),t.restore()}G(t,i,s){}}class P extends E{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J||null===this.J.it)return;const i=this.J.it,s=this.J,h=h=>{t.beginPath();for(let e=i.to-1;e>=i.from;--e){const i=s.st[e];t.moveTo(i.nt,i.et),t.arc(i.nt,i.et,h,0,2*Math.PI)}t.fill()};s.rt>0&&(t.fillStyle=s.ht,h(s.lt+s.rt)),t.fillStyle=s.ot,h(s.lt)}}function z(){return{st:[{nt:0,et:0,_t:0,ut:0}],ot:"",ht:"",lt:0,rt:0,it:null}}const O={from:0,to:1};class V{constructor(t,i){this.ct=new B,this.dt=[],this.ft=[],this.vt=!0,this.N=t,this.bt=i,this.ct.Y(this.dt)}wt(t){const i=this.N.gt();i.length!==this.dt.length&&(this.ft=i.map(z),this.dt=this.ft.map((t=>{const i=new P;return i.tt(t),i})),this.ct.Y(this.dt)),this.vt=!0}Mt(t,i,s){return this.vt&&(this.St(t),this.vt=!1),this.ct}St(t){const i=this.N.gt(),s=this.bt.yt(),h=this.N.kt();i.forEach(((i,e)=>{var n;const r=this.ft[e],o=i.Ct(s);if(null===o||!i.xt())return void(r.it=null);const l=f(i.Tt());r.ot=o.Dt,r.lt=o.lt,r.rt=o.Pt,r.st[0].ut=o.ut,r.st[0].et=i.At().Rt(o.ut,l.Lt),r.ht=null!==(n=o.Ot)&&void 0!==n?n:this.N.Bt(r.st[0].et/t),r.st[0]._t=s,r.st[0].nt=h.Et(s),r.it=O}))}}class H{constructor(t){this.It=t}X(t,i,s,h){if(null===this.It)return;const e=this.It.Vt.xt,n=this.It.Nt.xt;if(!e&&!n)return;t.save();const r=Math.round(this.It.nt*i),o=Math.round(this.It.et*i),c=Math.ceil(this.It.Ft*i),u=Math.ceil(this.It.Wt*i);t.lineCap="butt",e&&r>=0&&(t.lineWidth=Math.floor(this.It.Vt.rt*i),t.strokeStyle=this.It.Vt.R,t.fillStyle=this.It.Vt.R,l(t,this.It.Vt.zt),function(t,i,s,h){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(i+e,0),t.lineTo(i+e,h),t.stroke()}(t,r,0,u)),n&&o>=0&&(t.lineWidth=Math.floor(this.It.Nt.rt*i),t.strokeStyle=this.It.Nt.R,t.fillStyle=this.It.Nt.R,l(t,this.It.Nt.zt),a(t,o,0,c)),t.restore()}}class X{constructor(t){this.vt=!0,this.jt={Vt:{rt:1,zt:0,R:"",xt:!1},Nt:{rt:1,zt:0,R:"",xt:!1},Ft:0,Wt:0,nt:0,et:0},this.$t=new H(this.jt),this.Ht=t}wt(){this.vt=!0}Mt(t,i){return this.vt&&(this.St(),this.vt=!1),this.$t}St(){const t=this.Ht.xt(),i=f(this.Ht.Ut()),s=i.qt().F().crosshair,h=this.jt;h.Nt.xt=t&&this.Ht.Yt(i),h.Vt.xt=t&&this.Ht.Xt(),h.Nt.rt=s.horzLine.width,h.Nt.zt=s.horzLine.style,h.Nt.R=s.horzLine.color,h.Vt.rt=s.vertLine.width,h.Vt.zt=s.vertLine.style,h.Vt.R=s.vertLine.color,h.Ft=i.Zt(),h.Wt=i.Kt(),h.nt=this.Ht.Gt(),h.et=this.Ht.Jt()}}function q(t,i,s,h,e,n){t.fillRect(i+n,s,h-2*n,n),t.fillRect(i+n,s+e-n,h-2*n,n),t.fillRect(i,s,n,e),t.fillRect(i+h-n,s,n,e)}function A(t,i,s){t.save(),t.scale(i,i),s(),t.restore()}function j(t,i,s,h,e,n){t.save(),t.globalCompositeOperation="copy",t.fillStyle=n,t.fillRect(i,s,h,e),t.restore()}function Z(t,i){return Array.isArray(t)?t.map((t=>0===t?t:t+i)):t+i}function Y(t,i,s,h,e,n){let r,o,l,a;if(Array.isArray(n))if(2===n.length){const t=Math.max(0,n[0]),i=Math.max(0,n[1]);r=t,o=t,l=i,a=i}else{if(4!==n.length)throw new Error("Wrong border radius - it should be like css border radius");r=Math.max(0,n[0]),o=Math.max(0,n[1]),l=Math.max(0,n[2]),a=Math.max(0,n[3])}else{const t=Math.max(0,n);r=t,o=t,l=t,a=t}t.beginPath(),t.moveTo(i+r,s),t.lineTo(i+h-o,s),0!==o&&t.arcTo(i+h,s,i+h,s+o,o),t.lineTo(i+h,s+e-l),0!==l&&t.arcTo(i+h,s+e,i+h-l,s+e,l),t.lineTo(i+a,s+e),0!==a&&t.arcTo(i,s+e,i,s+e-a,a),t.lineTo(i,s+r),0!==r&&t.arcTo(i,s,i+r,s,r)}function $(t,i,s,h,e,n,r,o,l){if(void 0===r&&(r=0),void 0===o&&(o=0),void 0===l&&(l=""),t.save(),!r||!l||l===n)return Y(t,i,s,h,e,o),t.fillStyle=n,t.fill(),void t.restore();const a=r/2;"transparent"!==n&&(Y(t,i+r,s+r,h-2*r,e-2*r,Z(o,-r)),t.fillStyle=n,t.fill()),"transparent"!==l&&(Y(t,i+a,s+a,h-r,e-r,Z(o,-a)),t.lineWidth=r,t.strokeStyle=l,t.closePath(),t.stroke())}function K(t,i,s,h,e,n,r){t.save(),t.globalCompositeOperation="copy";const o=t.createLinearGradient(0,0,0,e);o.addColorStop(0,n),o.addColorStop(1,r),t.fillStyle=o,t.fillRect(i,s,h,e),t.restore()}class U{constructor(t,i){this.tt(t,i)}tt(t,i){this.It=t,this.Qt=i}X(t,i,s,h,e,n){if(!this.It.xt)return;t.font=i.D;const r=this.ti(t,i,s,h,e,n),o=this.It.R||this.Qt.R,l=this.Qt.t;if(t.fillStyle=this.Qt.t,this.It.ii){const s=(i,s)=>{r.si?$(t,r.ni,r.ei,r.ri,r.hi,i,r.li,[r.lt,0,0,r.lt],s):$(t,r.ai,r.ei,r.ri,r.hi,i,r.li,[0,r.lt,r.lt,0],s)};s(l,"transparent"),this.It.oi&&(t.fillStyle=o,t.fillRect(r.ai,r._i,r.ui-r.ai,r.ci)),s("transparent",l),this.It.di&&(t.fillStyle=i.A,t.fillRect(r.si?r.fi-r.li:0,r.ei,r.li,r.pi-r.ei)),t.save(),t.translate(r.vi,(r.ei+r.pi)/2+r.mi),A(t,n,(()=>{t.fillStyle=o,t.fillText(this.It.ii,0,0)})),t.restore()}}Kt(t,i){return this.It.xt?t.T+t.I+t.L:0}ti(t,i,s,h,e,n){const r=this.It.oi||!this.It.bi?i.C:0,o=i.k,l=i.I+this.Qt.wi,a=i.L+this.Qt.gi,c=i.O,u=i.B,f=this.It.ii,d=i.T,p=s.Mi(t,f)*n,v=d+l+a,m=o+c+u+Math.ceil(s.Si(t,f))+r,g=Math.max(1,Math.floor(n));let b=Math.round(v*n);b%2!=g%2&&(b+=1);const w=this.It.yi?Math.max(1,Math.floor(o*n)):0,M=Math.round(m*n),_=Math.round(r*n),y=Math.ceil(h*n),x=Math.ceil(c*n);let C=this.Qt.ki;this.Qt.Ci&&(C=this.Qt.Ci),C=Math.round(C*n)-Math.floor(.5*n);const F=Math.floor(C+g/2-b/2),S=F+b,k="right"===e,I=k?y-w:w,L=y;let T,N,D=I;const R=2*n;return t.textAlign=k?"right":"left",t.textBaseline="middle",k?(D=I-M,T=I-_,N=I-_-x-1):(D=I+M,T=I+_,N=I+_+x),{si:k,ei:F,_i:C,pi:S,ri:M,hi:b,lt:R,li:w,ni:D,ai:I,ui:T,vi:N,ci:g,fi:L,mi:p}}}class Q{constructor(t){this.xi={ki:0,R:"#FFF",t:"#000",gi:0,wi:0},this.Ti={ii:"",xt:!1,oi:!0,bi:!1,Ot:"",R:"#FFF",di:!1,yi:!1},this.Di={ii:"",xt:!1,oi:!1,bi:!0,Ot:"",R:"#FFF",di:!0,yi:!0},this.vt=!0,this.Pi=new(t||U)(this.Ti,this.xi),this.Ri=new(t||U)(this.Di,this.xi)}ii(){return this.Ai(),this.Ti.ii}ki(){return this.Ai(),this.xi.ki}wt(){this.vt=!0}Kt(t,i){return void 0===i&&(i=!1),Math.max(this.Pi.Kt(t,i),this.Ri.Kt(t,i))}Li(){return this.xi.Ci||0}Oi(t){this.xi.Ci=t}Bi(){return this.Ai(),this.Ti.xt||this.Di.xt}Ei(){return this.Ai(),this.Ti.xt}Mt(t){return this.Ai(),this.Ti.oi=this.Ti.oi&&t.F().ticksVisible,this.Di.oi=this.Di.oi&&t.F().ticksVisible,this.Pi.tt(this.Ti,this.xi),this.Ri.tt(this.Di,this.xi),this.Pi}Ii(){return this.Ai(),this.Pi.tt(this.Ti,this.xi),this.Ri.tt(this.Di,this.xi),this.Ri}Ai(){this.vt&&(this.Ti.oi=!0,this.Di.oi=!1,this.Vi(this.Ti,this.Di,this.xi))}}class G extends Q{constructor(t,i,s){super(),this.Ht=t,this.Ni=i,this.Fi=s}Vi(t,i,s){t.xt=!1;const h=this.Ht.F().horzLine;if(!h.labelVisible)return;const e=this.Ni.Tt();if(!this.Ht.xt()||this.Ni.Wi()||null===e)return;const n=y(h.labelBackgroundColor);s.t=n.t,s.R=n.i;const r=2/12*this.Ni.T();s.wi=r,s.gi=r;const o=this.Fi(this.Ni);s.ki=o.ki,t.ii=this.Ni.zi(o.ut,e),t.xt=!0}}const J=/[1-9]/g;class tt{constructor(){this.It=null}tt(t){this.It=t}X(t,i,s){if(null===this.It||!1===this.It.xt||0===this.It.ii.length)return;t.font=i.D;const h=Math.round(i.ji.Si(t,this.It.ii,J));if(h<=0)return;t.save();const e=i.$i,n=h+2*e,r=n/2,o=this.It.Zt;let l=this.It.ki,a=Math.floor(l-r)+.5;a<0?(l+=Math.abs(0-a),a=Math.floor(l-r)+.5):a+n>o&&(l-=Math.abs(o-(a+n)),a=Math.floor(l-r)+.5);const c=a+n,u=Math.ceil(0+i.k+i.C+i.I+i.T+i.L);t.fillStyle=this.It.t;const d=Math.round(a*s),p=Math.round(0*s),v=Math.round(c*s),m=Math.round(u*s),g=Math.round(2*s);if(t.beginPath(),t.moveTo(d,p),t.lineTo(d,m-g),t.arcTo(d,m,d+g,m,g),t.lineTo(v-g,m),t.arcTo(v,m,v,m-g,g),t.lineTo(v,p),t.fill(),this.It.oi){const h=Math.round(this.It.ki*s),e=p,n=Math.round((e+i.C)*s);t.fillStyle=this.It.R;const r=Math.max(1,Math.floor(s)),o=Math.floor(.5*s);t.fillRect(h-o,e,r,n-e)}const b=0+i.k+i.C+i.I+i.T/2;t.textAlign="left",t.textBaseline="middle",t.fillStyle=this.It.R;const w=i.ji.Mi(t,"Apr0");t.translate((a+e)*s,(b+w)*s),A(t,s,(()=>t.fillText(f(this.It).ii,0,0))),t.restore()}}class it{constructor(t,i,s){this.vt=!0,this.$t=new tt,this.jt={xt:!1,t:"#4c525e",R:"white",ii:"",Zt:0,ki:NaN,oi:!0},this.bt=t,this.Hi=i,this.Fi=s}wt(){this.vt=!0}Mt(){return this.vt&&(this.St(),this.vt=!1),this.$t.tt(this.jt),this.$t}St(){const t=this.jt;t.xt=!1;const i=this.bt.F().vertLine;if(!i.labelVisible)return;const s=this.Hi.kt();if(s.Wi())return;t.Zt=s.Zt();const h=this.Fi();if(!h._t)return;t.ki=h.ki;const e=s.Ui(this.bt.yt());t.ii=s.qi(f(e)),t.xt=!0;const n=y(i.labelBackgroundColor);t.t=n.t,t.R=n.i,t.oi=s.F().ticksVisible}}class st{constructor(){this.Yi=null,this.Xi=0}Zi(){return this.Xi}Ki(t){this.Xi=t}At(){return this.Yi}Gi(t){this.Yi=t}Ji(t){return[]}Qi(){return[]}xt(){return!0}}var ht;!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(ht||(ht={}));class et extends st{constructor(t,i){super(),this.ts=null,this.ss=NaN,this.ns=0,this.es=!0,this.rs=new Map,this.hs=!1,this.ls=NaN,this.os=NaN,this._s=NaN,this.us=NaN,this.Hi=t,this.cs=i,this.ds=new V(t,this),this.fs=((t,i)=>s=>{const h=i(),e=t();if(s===f(this.ts).ps())return{ut:e,ki:h};{const t=f(s.Tt());return{ut:s.vs(h,t),ki:h}}})((()=>this.ss),(()=>this.os));const s=((t,i)=>()=>({_t:this.Hi.kt().bs(t()),ki:i()}))((()=>this.ns),(()=>this.Gt()));this.ws=new it(this,t,s),this.gs=new X(this)}F(){return this.cs}Ms(t,i){this._s=t,this.us=i}Ss(){this._s=NaN,this.us=NaN}ys(){return this._s}ks(){return this.us}Cs(t,i,s){this.hs||(this.hs=!0),this.es=!0,this.xs(t,i,s)}yt(){return this.ns}Gt(){return this.ls}Jt(){return this.os}xt(){return this.es}Ts(){this.es=!1,this.Ds(),this.ss=NaN,this.ls=NaN,this.os=NaN,this.ts=null,this.Ss()}Ps(t){return null!==this.ts?[this.gs,this.ds]:[]}Yt(t){return t===this.ts&&this.cs.horzLine.visible}Xt(){return this.cs.vertLine.visible}Rs(t,i){this.es&&this.ts===t||this.rs.clear();const s=[];return this.ts===t&&s.push(this.As(this.rs,i,this.fs)),s}Qi(){return this.es?[this.ws]:[]}Ut(){return this.ts}Ls(){this.gs.wt(),this.rs.forEach((t=>t.wt())),this.ws.wt(),this.ds.wt()}Os(t){return t&&!t.ps().Wi()?t.ps():null}xs(t,i,s){this.Bs(t,i,s)&&this.Ls()}Bs(t,i,s){const h=this.ls,e=this.os,n=this.ss,r=this.ns,o=this.ts,l=this.Os(s);this.ns=t,this.ls=isNaN(t)?NaN:this.Hi.kt().Et(t),this.ts=s;const a=null!==l?l.Tt():null;return null!==l&&null!==a?(this.ss=i,this.os=l.Rt(i,a)):(this.ss=NaN,this.os=NaN),h!==this.ls||e!==this.os||r!==this.ns||n!==this.ss||o!==this.ts}Ds(){const t=this.Hi.gt().map((t=>t.Is().Es())).filter(T),i=0===t.length?null:Math.max(...t);this.ns=null!==i?i:NaN}As(t,i,s){let h=t.get(i);return void 0===h&&(h=new G(this,i,s),t.set(i,h)),h}}function nt(t){return"left"===t||"right"===t}class rt{constructor(t){this.Vs=new Map,this.Ns=[],this.Fs=t}Ws(t,i){const s=function(t,i){return void 0===t?i:{zs:Math.max(t.zs,i.zs),js:t.js||i.js}}(this.Vs.get(t),i);this.Vs.set(t,s)}$s(){return this.Fs}Hs(t){const i=this.Vs.get(t);return void 0===i?{zs:this.Fs}:{zs:Math.max(this.Fs,i.zs),js:i.js}}Us(){this.qs(),this.Ns=[{Ys:0}]}Xs(t){this.qs(),this.Ns=[{Ys:1,Lt:t}]}Zs(t){this.Ks(),this.Ns.push({Ys:5,Lt:t})}qs(){this.Ks(),this.Ns.push({Ys:6})}Gs(){this.qs(),this.Ns=[{Ys:4}]}Js(t){this.qs(),this.Ns.push({Ys:2,Lt:t})}Qs(t){this.qs(),this.Ns.push({Ys:3,Lt:t})}tn(){return this.Ns}sn(t){for(const i of t.Ns)this.nn(i);this.Fs=Math.max(this.Fs,t.Fs),t.Vs.forEach(((t,i)=>{this.Ws(i,t)}))}static en(){return new rt(2)}static rn(){return new rt(3)}nn(t){switch(t.Ys){case 0:this.Us();break;case 1:this.Xs(t.Lt);break;case 2:this.Js(t.Lt);break;case 3:this.Qs(t.Lt);break;case 4:this.Gs();break;case 5:this.Zs(t.Lt);break;case 6:this.Ks()}}Ks(){const t=this.Ns.findIndex((t=>5===t.Ys));-1!==t&&this.Ns.splice(t,1)}}function ot(t,i){if(!F(t))return"n/a";if(!S(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");return 0===i?t.toString():("0000000000000000"+t.toString()).slice(-i)}class lt{constructor(t,i){if(i||(i=1),F(t)&&S(t)||(t=100),t<0)throw new TypeError("invalid base");this.Ni=t,this.hn=i,this.ln()}format(t){const i=t<0?"\u2212":"";return t=Math.abs(t),i+this.an(t)}ln(){if(this.on=0,this.Ni>0&&this.hn>0){let t=this.Ni;for(;t>1;)t/=10,this.on++}}an(t){const i=this.Ni/this.hn;let s=Math.floor(t),h="";const e=void 0!==this.on?this.on:NaN;if(i>1){let n=+(Math.round(t*i)-s*i).toFixed(this.on);n>=i&&(n-=i,s+=1),h="."+ot(+n.toFixed(this.on)*this.hn,e)}else s=Math.round(s*i)/i,e>0&&(h="."+ot(0,e));return s.toFixed(0)+h}}class at extends lt{constructor(t){void 0===t&&(t=100),super(t)}format(t){return`${super.format(t)}%`}}class ct{constructor(t){this._n=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this.un(t):t<999995?i+this.un(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.un(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.un(t/1e9)+"B")}un(t){let i;const s=Math.pow(10,this._n);return i=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this._n).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,((t,i)=>i))}}function ut(t,i,s,h,e,n,r){if(0===i.length||h.from>=i.length)return;const o=i[h.from];let l=n(t,o),a=o;if(h.to-h.from<2){const i=e/2;t.beginPath();const s={nt:o.nt-i,et:o.et},h={nt:o.nt+i,et:o.et};return t.moveTo(s.nt,s.et),t.lineTo(h.nt,h.et),void r(t,l,s,h)}const c=(i,s)=>{r(t,l,a,s),t.beginPath(),l=i,a=s};let u=a;t.beginPath(),t.moveTo(o.nt,o.et);for(let f=h.from+1;f<h.to;++f){u=i[f];const h=n(t,u);switch(s){case 0:t.lineTo(u.nt,u.et);break;case 1:t.lineTo(u.nt,i[f-1].et),h!==l&&(c(h,u),t.lineTo(u.nt,i[f-1].et)),t.lineTo(u.nt,u.et);break;case 2:{const[s,h]=pt(i,f-1,f);t.bezierCurveTo(s.nt,s.et,h.nt,h.et,u.nt,u.et);break}}1!==s&&h!==l&&(c(h,u),t.moveTo(u.nt,u.et))}(a!==u||a===u&&1===s)&&r(t,l,a,u)}function ft(t,i){return{nt:t.nt-i.nt,et:t.et-i.et}}function dt(t,i){return{nt:t.nt/i,et:t.et/i}}function pt(t,i,s){const h=Math.max(0,i-1),e=Math.min(t.length-1,s+1);var n,r;return[(n=t[i],r=dt(ft(t[s],t[h]),6),{nt:n.nt+r.nt,et:n.et+r.et}),ft(t[s],dt(ft(t[e],t[i]),6))]}function vt(t,i,s,h,e){i.lineTo(e.nt,t),i.lineTo(h.nt,t),i.closePath(),i.fillStyle=s,i.fill()}class mt extends E{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J)return;const{st:i,it:s,cn:h,rt:e,zt:n,dn:r,fn:o}=this.J;null!==s&&(t.lineCap="butt",t.lineJoin="round",t.lineWidth=e,l(t,n),t.lineWidth=1,ut(t,i,r,s,h,this.pn.bind(this),vt.bind(null,o)))}}class gt extends mt{constructor(){super(...arguments),this.vn=null}pn(t,i){const s=this.J,{mn:h,bn:e}=i,n=s.wn;if(null!==this.vn&&this.vn.topColor===h&&this.vn.bottomColor===e&&this.vn.bottom===n)return this.vn.fillStyle;const r=t.createLinearGradient(0,0,0,n);return r.addColorStop(0,h),r.addColorStop(1,e),this.vn={topColor:h,bottomColor:e,fillStyle:r,bottom:n},r}}function bt(t,i){t.strokeStyle=i,t.stroke()}class wt extends E{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}Z(t){if(null===this.J)return;const{st:i,it:s,cn:h,dn:e,rt:n,zt:r}=this.J;null!==s&&(t.lineCap="butt",t.lineWidth=n,l(t,r),t.lineJoin="round",ut(t,i,e,s,h,this.gn.bind(this),bt))}}class Mt extends wt{gn(t,i){return i.ot}}function _t(t,i,s,h,e){void 0===h&&(h=0),void 0===e&&(e=t.length);let n=e-h;for(;0<n;){const e=n>>1,r=h+e;s(t[r],i)?(h=r+1,n-=e+1):n=e}return h}function yt(t,i,s,h,e){void 0===h&&(h=0),void 0===e&&(e=t.length);let n=e-h;for(;0<n;){const e=n>>1,r=h+e;s(i,t[r])?n=e:(h=r+1,n-=e+1)}return h}function xt(t,i){return t._t<i}function Ct(t,i){return t<i._t}function Ft(t,i,s){const h=i.Mn(),e=i.Sn(),n=_t(t,h,xt),r=yt(t,e,Ct);if(!s)return{from:n,to:r};let o=n,l=r;return n>0&&n<t.length&&t[n]._t>=h&&(o=n-1),r>0&&r<t.length&&t[r-1]._t<=e&&(l=r+1),{from:o,to:l}}class St{constructor(t,i,s){this.yn=!0,this.kn=!0,this.Cn=!0,this.xn=[],this.Tn=null,this.Dn=t,this.Pn=i,this.Rn=s}wt(t){this.yn=!0,"data"===t&&(this.kn=!0),"options"===t&&(this.Cn=!0)}Mt(t,i){return this.Dn.xt()?(this.An(i,t),null===this.Tn?null:this.Ln):null}On(){this.xn=this.xn.map((t=>Object.assign(Object.assign({},t),this.Dn.En().Bn(t._t))))}In(){this.Tn=null}An(t,i){this.kn&&(this.Vn(),this.kn=!1),this.Cn&&(this.On(),this.Cn=!1),this.yn&&(this.Nn(t,i),this.yn=!1)}Nn(t,i){const s=this.Dn.At(),h=this.Pn.kt();if(this.In(),h.Wi()||s.Wi())return;const e=h.Fn();if(null===e)return;if(0===this.Dn.Is().Wn())return;const n=this.Dn.Tt();null!==n&&(this.Tn=Ft(this.xn,e,this.Rn),this.zn(s,h,n.Lt),this.jn(t,i))}}class kt extends St{constructor(t,i){super(t,i,!0)}zn(t,i,s){i.$n(this.xn,N(this.Tn)),t.Hn(this.xn,s,N(this.Tn))}Un(t,i){return{_t:t,ut:i,nt:NaN,et:NaN}}Vn(){const t=this.Dn.En();this.xn=this.Dn.Is().qn().map((i=>{const s=i.Lt[3];return this.Yn(i.Xn,s,t)}))}}class It extends kt{constructor(t,i){super(t,i),this.Ln=new B,this.Zn=new gt,this.Kn=new Mt,this.Ln.Y([this.Zn,this.Kn])}Yn(t,i,s){return Object.assign(Object.assign({},this.Un(t,i)),s.Bn(t))}jn(t,i){const s=this.Dn.F(),h=s.invertFilledArea?0:i;this.Zn.tt({dn:s.lineType,st:this.xn,zt:s.lineStyle,rt:s.lineWidth,fn:h,wn:i,it:this.Tn,cn:this.Pn.kt().Gn()}),this.Kn.tt({dn:s.lineType,st:this.xn,zt:s.lineStyle,rt:s.lineWidth,it:this.Tn,cn:this.Pn.kt().Gn()})}}class Lt{constructor(){this.It=null,this.Jn=0,this.Qn=0}tt(t){this.It=t}X(t,i,s,h){if(null===this.It||0===this.It.Is.length||null===this.It.it)return;this.Jn=this.te(i),this.Jn>=2&&Math.max(1,Math.floor(i))%2!=this.Jn%2&&this.Jn--,this.Qn=this.It.ie?Math.min(this.Jn,Math.floor(i)):this.Jn;let e=null;const n=this.Qn<=this.Jn&&this.It.Gn>=Math.floor(1.5*i);for(let r=this.It.it.from;r<this.It.it.to;++r){const s=this.It.Is[r];e!==s.se&&(t.fillStyle=s.se,e=s.se);const h=Math.floor(.5*this.Qn),o=Math.round(s.nt*i),l=o-h,a=this.Qn,c=l+a-1,u=Math.min(s.ne,s.ee),f=Math.max(s.ne,s.ee),d=Math.round(u*i)-h,p=Math.round(f*i)+h,v=Math.max(p-d,this.Qn);t.fillRect(l,d,a,v);const m=Math.ceil(1.5*this.Jn);if(n){if(this.It.re){const e=o-m;let n=Math.max(d,Math.round(s.he*i)-h),r=n+a-1;r>d+v-1&&(r=d+v-1,n=r-a+1),t.fillRect(e,n,l-e,r-n+1)}const e=o+m;let n=Math.max(d,Math.round(s.le*i)-h),r=n+a-1;r>d+v-1&&(r=d+v-1,n=r-a+1),t.fillRect(c+1,n,e-c,r-n+1)}}}te(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(f(this.It).Gn,t)))}}class Tt extends St{constructor(t,i){super(t,i,!1)}zn(t,i,s){i.$n(this.xn,N(this.Tn)),t.ae(this.xn,s,N(this.Tn))}oe(t,i,s){return{_t:t,_e:i.Lt[0],ue:i.Lt[1],ce:i.Lt[2],de:i.Lt[3],nt:NaN,he:NaN,ne:NaN,ee:NaN,le:NaN}}Vn(){const t=this.Dn.En();this.xn=this.Dn.Is().qn().map((i=>this.Yn(i.Xn,i,t)))}}class Nt extends Tt{constructor(){super(...arguments),this.Ln=new Lt}Yn(t,i,s){return Object.assign(Object.assign({},this.oe(t,i,s)),s.Bn(t))}jn(){const t=this.Dn.F();this.Ln.tt({Is:this.xn,Gn:this.Pn.kt().Gn(),re:t.openVisible,ie:t.thinBars,it:this.Tn})}}function Dt(t,i,s){return Math.min(Math.max(t,i),s)}function Rt(t,i,s){return i-t<=s}function Wt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function Bt(t){const i=Math.ceil(t);return i%2==0?i-1:i}class Et extends mt{constructor(){super(...arguments),this.vn=null}pn(t,i){const s=this.J,{fe:h,pe:e,ve:n,me:r}=i,{fn:o,wn:l}=s;if(null!==this.vn&&this.vn.topFillColor1===h&&this.vn.topFillColor2===e&&this.vn.bottomFillColor1===n&&this.vn.bottomFillColor2===r&&this.vn.baseLevelCoordinate===o&&this.vn.bottom===l)return this.vn.fillStyle;const a=t.createLinearGradient(0,0,0,l),c=Dt(o/l,0,1);return a.addColorStop(0,h),a.addColorStop(c,e),a.addColorStop(c,n),a.addColorStop(1,r),this.vn={topFillColor1:h,topFillColor2:e,bottomFillColor1:n,bottomFillColor2:r,fillStyle:a,baseLevelCoordinate:o,bottom:l},a}}class Pt extends wt{constructor(){super(...arguments),this.be=null}gn(t,i){const s=this.J,{we:h,ge:e}=i,{fn:n,wn:r}=s;if(null!==this.be&&this.be.topLineColor===h&&this.be.bottomLineColor===e&&this.be.baseLevelCoordinate===n&&this.be.bottom===r)return this.be.strokeStyle;const o=t.createLinearGradient(0,0,0,r),l=Dt(n/r,0,1);return o.addColorStop(0,h),o.addColorStop(l,h),o.addColorStop(l,e),o.addColorStop(1,e),this.be={topLineColor:h,bottomLineColor:e,strokeStyle:o,baseLevelCoordinate:n,bottom:r},o}}class zt extends kt{constructor(t,i){super(t,i),this.Ln=new B,this.Me=new Et,this.Se=new Pt,this.Ln.Y([this.Me,this.Se])}Yn(t,i,s){return Object.assign(Object.assign({},this.Un(t,i)),s.Bn(t))}jn(t,i){const s=this.Dn.Tt();if(null===s)return;const h=this.Dn.F(),e=this.Dn.At().Rt(h.baseValue.price,s.Lt),n=this.Pn.kt().Gn();this.Me.tt({st:this.xn,rt:h.lineWidth,zt:h.lineStyle,dn:h.lineType,fn:e,wn:i,it:this.Tn,cn:n}),this.Se.tt({st:this.xn,rt:h.lineWidth,zt:h.lineStyle,dn:h.lineType,fn:e,wn:i,it:this.Tn,cn:n})}}class Ot{constructor(){this.It=null,this.Jn=0}tt(t){this.It=t}X(t,i,s,h){if(null===this.It||0===this.It.Is.length||null===this.It.it)return;this.Jn=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const s=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),h=Math.floor(t*s*i),e=Math.floor(t*i),n=Math.min(h,e);return Math.max(Math.floor(i),n)}(this.It.Gn,i),this.Jn>=2&&Math.floor(i)%2!=this.Jn%2&&this.Jn--;const e=this.It.Is;this.It.ye&&this.ke(t,e,this.It.it,i),this.It.di&&this.Ce(t,e,this.It.it,this.It.Gn,i);const n=this.xe(i);(!this.It.di||this.Jn>2*n)&&this.Te(t,e,this.It.it,i)}ke(t,i,s,h){if(null===this.It)return;let e="",n=Math.min(Math.floor(h),Math.floor(this.It.Gn*h));n=Math.max(Math.floor(h),Math.min(n,this.Jn));const r=Math.floor(.5*n);let o=null;for(let l=s.from;l<s.to;l++){const s=i[l];s.De!==e&&(t.fillStyle=s.De,e=s.De);const a=Math.round(Math.min(s.he,s.le)*h),c=Math.round(Math.max(s.he,s.le)*h),u=Math.round(s.ne*h),f=Math.round(s.ee*h);let d=Math.round(h*s.nt)-r;const p=d+n-1;null!==o&&(d=Math.max(o+1,d),d=Math.min(d,p));const v=p-d+1;t.fillRect(d,u,v,a-u),t.fillRect(d,c+1,v,f-c),o=p}}xe(t){let i=Math.floor(1*t);this.Jn<=2*i&&(i=Math.floor(.5*(this.Jn-1)));const s=Math.max(Math.floor(t),i);return this.Jn<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}Ce(t,i,s,h,e){if(null===this.It)return;let n="";const r=this.xe(e);let o=null;for(let l=s.from;l<s.to;l++){const s=i[l];s.Pe!==n&&(t.fillStyle=s.Pe,n=s.Pe);let h=Math.round(s.nt*e)-Math.floor(.5*this.Jn);const a=h+this.Jn-1,c=Math.round(Math.min(s.he,s.le)*e),u=Math.round(Math.max(s.he,s.le)*e);if(null!==o&&(h=Math.max(o+1,h),h=Math.min(h,a)),this.It.Gn*e>2*r)q(t,h,c,a-h+1,u-c+1,r);else{const i=a-h+1;t.fillRect(h,c,i,u-c+1)}o=a}}Te(t,i,s,h){if(null===this.It)return;let e="";const n=this.xe(h);for(let r=s.from;r<s.to;r++){const s=i[r];let o=Math.round(Math.min(s.he,s.le)*h),l=Math.round(Math.max(s.he,s.le)*h),a=Math.round(s.nt*h)-Math.floor(.5*this.Jn),c=a+this.Jn-1;if(s.se!==e){const i=s.se;t.fillStyle=i,e=i}this.It.di&&(a+=n,o+=n,c-=n,l-=n),o>l||t.fillRect(a,o,c-a+1,l-o+1)}}}class Vt extends Tt{constructor(){super(...arguments),this.Ln=new Ot}Yn(t,i,s){return Object.assign(Object.assign({},this.oe(t,i,s)),s.Bn(t))}jn(){const t=this.Dn.F();this.Ln.tt({Is:this.xn,Gn:this.Pn.kt().Gn(),ye:t.wickVisible,di:t.borderVisible,it:this.Tn})}}class Ht{constructor(){this.It=null,this.Re=[]}tt(t){this.It=t,this.Re=[]}X(t,i,s,h){if(null===this.It||0===this.It.st.length||null===this.It.it)return;this.Re.length||this.Ae(i);const e=Math.max(1,Math.floor(i)),n=Math.round(this.It.Le*i)-Math.floor(e/2),r=n+e;for(let o=this.It.it.from;o<this.It.it.to;o++){const s=this.It.st[o],h=this.Re[o-this.It.it.from],l=Math.round(s.et*i);let a,c;t.fillStyle=s.se,l<=n?(a=l,c=r):(a=n,c=l-Math.floor(e/2)+e),t.fillRect(h.Mn,a,h.Sn-h.Mn+1,c-a)}}Ae(t){if(null===this.It||0===this.It.st.length||null===this.It.it)return void(this.Re=[]);const i=Math.ceil(this.It.Gn*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.It.Gn*t)-i;this.Re=new Array(this.It.it.to-this.It.it.from);for(let e=this.It.it.from;e<this.It.it.to;e++){const i=this.It.st[e],h=Math.round(i.nt*t);let n,r;if(s%2){const t=(s-1)/2;n=h-t,r=h+t}else{const t=s/2;n=h-t,r=h+t-1}this.Re[e-this.It.it.from]={Mn:n,Sn:r,Oe:h,Be:i.nt*t,_t:i._t}}for(let e=this.It.it.from+1;e<this.It.it.to;e++){const t=this.Re[e-this.It.it.from],s=this.Re[e-this.It.it.from-1];t._t===s._t+1&&t.Mn-s.Sn!==i+1&&(s.Oe>s.Be?s.Sn=t.Mn-i-1:t.Mn=s.Sn+i+1)}let h=Math.ceil(this.It.Gn*t);for(let e=this.It.it.from;e<this.It.it.to;e++){const t=this.Re[e-this.It.it.from];t.Sn<t.Mn&&(t.Sn=t.Mn);const i=t.Sn-t.Mn+1;h=Math.min(i,h)}if(i>0&&h<4)for(let e=this.It.it.from;e<this.It.it.to;e++){const t=this.Re[e-this.It.it.from];t.Sn-t.Mn+1>h&&(t.Oe>t.Be?t.Sn-=1:t.Mn+=1)}}}class Xt extends kt{constructor(){super(...arguments),this.Ln=new Ht}Yn(t,i,s){return Object.assign(Object.assign({},this.Un(t,i)),s.Bn(t))}jn(){const t={st:this.xn,Gn:this.Pn.kt().Gn(),it:this.Tn,Le:this.Dn.At().Rt(this.Dn.F().base,f(this.Dn.Tt()).Lt)};this.Ln.tt(t)}}class qt extends kt{constructor(){super(...arguments),this.Ln=new Mt}Yn(t,i,s){return Object.assign(Object.assign({},this.Un(t,i)),s.Bn(t))}jn(){const t=this.Dn.F(),i={st:this.xn,zt:t.lineStyle,dn:t.lineType,rt:t.lineWidth,it:this.Tn,cn:this.Pn.kt().Gn()};this.Ln.tt(i)}}const At=/[2-9]/g;class jt{constructor(t){void 0===t&&(t=50),this.Ee=0,this.Ie=1,this.Ve=1,this.Ne={},this.Fe=new Map,this.We=t}ze(){this.Ee=0,this.Fe.clear(),this.Ie=1,this.Ve=1,this.Ne={}}Si(t,i,s){return this.je(t,i,s).width}Mi(t,i,s){const h=this.je(t,i,s);return((h.actualBoundingBoxAscent||0)-(h.actualBoundingBoxDescent||0))/2}je(t,i,s){const h=s||At,e=String(i).replace(h,"0");if(this.Fe.has(e))return u(this.Fe.get(e)).$e;if(this.Ee===this.We){const t=this.Ne[this.Ve];delete this.Ne[this.Ve],this.Fe.delete(t),this.Ve++,this.Ee--}t.save(),t.textBaseline="middle";const n=t.measureText(e);return t.restore(),0===n.width&&i.length||(this.Fe.set(e,{$e:n,He:this.Ie}),this.Ne[this.Ie]=e,this.Ee++,this.Ie++),n}}class Zt{constructor(t){this.Ue=null,this.S=null,this.qe="right",this.Ye=0,this.Xe=t}Ze(t,i,s,h){this.Ue=t,this.S=i,this.Ye=s,this.qe=h}X(t,i){null!==this.S&&null!==this.Ue&&this.Ue.X(t,this.S,this.Xe,this.Ye,this.qe,i)}}class Yt{constructor(t,i,s){this.Ke=t,this.Xe=new jt(50),this.Ge=i,this.N=s,this.W=-1,this.$t=new Zt(this.Xe)}Mt(t,i){const s=this.N.Je(this.Ge);if(null===s)return null;const h=s.Qe(this.Ge)?s.tr():this.Ge.At();if(null===h)return null;const e=s.ir(h);if("overlay"===e)return null;const n=this.N.sr();return n.T!==this.W&&(this.W=n.T,this.Xe.ze()),this.$t.Ze(this.Ke.Ii(),n,i,e),this.$t}}class $t{constructor(){this.It=null}tt(t){this.It=t}X(t,i,s,h){if(null===this.It)return;if(!1===this.It.xt)return;const e=Math.round(this.It.et*i);if(e<0||e>Math.ceil(this.It.Kt*i))return;const n=Math.ceil(this.It.Zt*i);t.lineCap="butt",t.strokeStyle=this.It.R,t.lineWidth=Math.floor(this.It.rt*i),l(t,this.It.zt),a(t,e,0,n)}}class Kt{constructor(t){this.nr={Zt:0,Kt:0,et:0,R:"rgba(0, 0, 0, 0)",rt:1,zt:0,xt:!1},this.er=new $t,this.vt=!0,this.Dn=t,this.Pn=t.qt(),this.er.tt(this.nr)}wt(){this.vt=!0}Mt(t,i){return this.Dn.xt()?(this.vt&&(this.rr(t,i),this.vt=!1),this.er):null}}class Ut extends Kt{constructor(t){super(t)}rr(t,i){this.nr.xt=!1;const s=this.Dn.At(),h=s.hr().hr;if(2!==h&&3!==h)return;const e=this.Dn.F();if(!e.baseLineVisible||!this.Dn.xt())return;const n=this.Dn.Tt();null!==n&&(this.nr.xt=!0,this.nr.et=s.Rt(n.Lt,n.Lt),this.nr.Zt=i,this.nr.Kt=t,this.nr.R=e.baseLineColor,this.nr.rt=e.baseLineWidth,this.nr.zt=e.baseLineStyle)}}class Qt{constructor(){this.It=null}tt(t){this.It=t}lr(){return this.It}X(t,i,s,h){const e=this.It;if(null===e)return;t.save();const n=Math.max(1,Math.floor(i)),r=n%2/2,o=Math.round(e.Be.x*i)+r,l=e.Be.y*i;t.fillStyle=e.ar,t.beginPath();const a=Math.max(2,1.5*e._r)*i;t.arc(o,l,a,0,2*Math.PI,!1),t.fill(),t.fillStyle=e.ur,t.beginPath(),t.arc(o,l,e.lt*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=n,t.strokeStyle=e.cr,t.beginPath(),t.arc(o,l,e.lt*i+n/2,0,2*Math.PI,!1),t.stroke(),t.restore()}}const Gt=[{dr:0,pr:.25,vr:4,mr:10,br:.25,wr:0,gr:.4,Mr:.8},{dr:.25,pr:.525,vr:10,mr:14,br:0,wr:0,gr:.8,Mr:0},{dr:.525,pr:1,vr:14,mr:14,br:0,wr:0,gr:0,Mr:0}];function Jt(t,i,s,h){return function(t,i){if("transparent"===t)return t;const s=_(t),h=s[3];return`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${i*h})`}(t,s+(h-s)*i)}function ti(t,i){const s=t%2600/2600;let h;for(const l of Gt)if(s>=l.dr&&s<=l.pr){h=l;break}c(void 0!==h,"Last price animation internal logic error");const e=(s-h.dr)/(h.pr-h.dr);return{ur:Jt(i,e,h.br,h.wr),cr:Jt(i,e,h.gr,h.Mr),lt:(n=e,r=h.vr,o=h.mr,r+(o-r)*n)};var n,r,o}class ii{constructor(t){this.$t=new Qt,this.vt=!0,this.Sr=!0,this.yr=performance.now(),this.kr=this.yr-1,this.Cr=t}Tr(){this.kr=this.yr-1,this.wt()}Dr(){if(this.wt(),2===this.Cr.F().lastPriceAnimation){const t=performance.now(),i=this.kr-t;if(i>0)return void(i<650&&(this.kr+=2600));this.yr=t,this.kr=t+2600}}wt(){this.vt=!0}Pr(){this.Sr=!0}xt(){return 0!==this.Cr.F().lastPriceAnimation}Rr(){switch(this.Cr.F().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.kr}}Mt(t,i){return this.vt?(this.St(t,i),this.vt=!1,this.Sr=!1):this.Sr&&(this.Ar(),this.Sr=!1),this.$t}St(t,i){this.$t.tt(null);const s=this.Cr.qt().kt(),h=s.Fn(),e=this.Cr.Tt();if(null===h||null===e)return;const n=this.Cr.Lr(!0);if(n.Or||!h.Br(n.Xn))return;const r={x:s.Et(n.Xn),y:this.Cr.At().Rt(n.ut,e.Lt)},o=n.R,l=this.Cr.F().lineWidth,a=ti(this.Er(),o);this.$t.tt({ar:o,_r:l,ur:a.ur,cr:a.cr,lt:a.lt,Be:r})}Ar(){const t=this.$t.lr();if(null!==t){const i=ti(this.Er(),t.ar);t.ur=i.ur,t.cr=i.cr,t.lt=i.lt}}Er(){return this.Rr()?performance.now()-this.yr:2599}}function si(t,i){return Bt(Math.min(Math.max(t,12),30)*i)}function hi(t,i){switch(t){case"arrowDown":case"arrowUp":return si(i,1);case"circle":return si(i,.8);case"square":return si(i,.7)}}function ei(t){return function(t){const i=Math.ceil(t);return i%2!=0?i-1:i}(si(t,1))}function ni(t){return Math.max(si(t,.1),3)}function ri(t,i,s,h,e){const n=hi("square",s),r=(n-1)/2,o=t-r,l=i-r;return h>=o&&h<=o+n&&e>=l&&e<=l+n}function oi(t,i,s,h,e){const n=(hi("arrowUp",e)-1)/2,r=(Bt(e/2)-1)/2;i.beginPath(),t?(i.moveTo(s-n,h),i.lineTo(s,h-n),i.lineTo(s+n,h),i.lineTo(s+r,h),i.lineTo(s+r,h+n),i.lineTo(s-r,h+n),i.lineTo(s-r,h)):(i.moveTo(s-n,h),i.lineTo(s,h+n),i.lineTo(s+n,h),i.lineTo(s+r,h),i.lineTo(s+r,h-n),i.lineTo(s-r,h-n),i.lineTo(s-r,h)),i.fill()}class li extends E{constructor(){super(...arguments),this.It=null,this.Xe=new jt,this.W=-1,this.j="",this.Ir=""}tt(t){this.It=t}Ze(t,i){this.W===t&&this.j===i||(this.W=t,this.j=i,this.Ir=R(t,i),this.Xe.ze())}Vr(t,i){if(null===this.It||null===this.It.it)return null;for(let s=this.It.it.from;s<this.It.it.to;s++){const h=this.It.st[s];if(ci(h,t,i))return{Nr:h.Fr,Wr:h.Wr}}return null}Z(t,i,s){if(null!==this.It&&null!==this.It.it){t.textBaseline="middle",t.font=this.Ir;for(let i=this.It.it.from;i<this.It.it.to;i++){const s=this.It.st[i];void 0!==s.ii&&(s.ii.Zt=this.Xe.Si(t,s.ii.zr),s.ii.Kt=this.W),ai(s,t)}}}}function ai(t,i){i.fillStyle=t.R,void 0!==t.ii&&function(t,i,s,h){t.fillText(i,s,h)}(i,t.ii.zr,t.nt-t.ii.Zt/2,t.ii.et),function(t,i){if(0!==t.Wn){switch(t.jr){case"arrowDown":return void oi(!1,i,t.nt,t.et,t.Wn);case"arrowUp":return void oi(!0,i,t.nt,t.et,t.Wn);case"circle":return void function(t,i,s,h){const e=(hi("circle",h)-1)/2;t.beginPath(),t.arc(i,s,e,0,2*Math.PI,!1),t.fill()}(i,t.nt,t.et,t.Wn);case"square":return void function(t,i,s,h){const e=hi("square",h),n=(e-1)/2,r=i-n,o=s-n;t.fillRect(r,o,e,e)}(i,t.nt,t.et,t.Wn)}t.jr}}(t,i)}function ci(t,i,s){return!(void 0===t.ii||!function(t,i,s,h,e,n){const r=h/2;return e>=t&&e<=t+s&&n>=i-r&&n<=i+r}(t.nt,t.ii.et,t.ii.Zt,t.ii.Kt,i,s))||function(t,i,s){if(0===t.Wn)return!1;switch(t.jr){case"arrowDown":case"arrowUp":return function(t,i,s,h,e,n){return ri(i,s,h,e,n)}(0,t.nt,t.et,t.Wn,i,s);case"circle":return function(t,i,s,h,e){const n=2+hi("circle",s)/2,r=t-h,o=i-e;return Math.sqrt(r*r+o*o)<=n}(t.nt,t.et,t.Wn,i,s);case"square":return ri(t.nt,t.et,t.Wn,i,s)}}(t,i,s)}function ui(t,i,s,h,e,n,r,o,l){const a=F(s)?s:s.de,c=F(s)?s:s.ue,u=F(s)?s:s.ce,f=F(i.size)?Math.max(i.size,0):1,d=ei(o.Gn())*f,p=d/2;switch(t.Wn=d,i.position){case"inBar":return t.et=r.Rt(a,l),void(void 0!==t.ii&&(t.ii.et=t.et+p+n+.6*e));case"aboveBar":return t.et=r.Rt(c,l)-p-h.$r,void 0!==t.ii&&(t.ii.et=t.et-p-.6*e,h.$r+=1.2*e),void(h.$r+=d+n);case"belowBar":return t.et=r.Rt(u,l)+p+h.Hr,void 0!==t.ii&&(t.ii.et=t.et+p+n+.6*e,h.Hr+=1.2*e),void(h.Hr+=d+n)}i.position}class fi{constructor(t,i){this.vt=!0,this.Ur=!0,this.qr=!0,this.Yr=null,this.$t=new li,this.Cr=t,this.Hi=i,this.It={st:[],it:null}}wt(t){this.vt=!0,this.qr=!0,"data"===t&&(this.Ur=!0)}Mt(t,i,s){if(!this.Cr.xt())return null;this.vt&&this.Xr();const h=this.Hi.F().layout;return this.$t.Ze(h.fontSize,h.fontFamily),this.$t.tt(this.It),this.$t}Zr(){if(this.qr){if(this.Cr.Kr().length>0){const t=this.Hi.kt().Gn(),i=ni(t),s=1.5*ei(t)+2*i;this.Yr={above:s,below:s}}else this.Yr=null;this.qr=!1}return this.Yr}Xr(){const t=this.Cr.At(),i=this.Hi.kt(),s=this.Cr.Kr();this.Ur&&(this.It.st=s.map((t=>({_t:t.time,nt:0,et:0,Wn:0,jr:t.shape,R:t.color,Fr:t.internalId,Wr:t.id,ii:void 0}))),this.Ur=!1);const h=this.Hi.F().layout;this.It.it=null;const e=i.Fn();if(null===e)return;const n=this.Cr.Tt();if(null===n)return;if(0===this.It.st.length)return;let r=NaN;const o=ni(i.Gn()),l={$r:o,Hr:o};this.It.it=Ft(this.It.st,e,!0);for(let a=this.It.it.from;a<this.It.it.to;a++){const e=s[a];e.time!==r&&(l.$r=o,l.Hr=o,r=e.time);const c=this.It.st[a];c.nt=i.Et(e.time),void 0!==e.text&&e.text.length>0&&(c.ii={zr:e.text,et:0,Zt:0,Kt:0});const u=this.Cr.Gr(e.time);null!==u&&ui(c,e,u,l,h.fontSize,o,t,i,n.Lt)}this.vt=!1}}class di extends Kt{constructor(t){super(t)}rr(t,i){const s=this.nr;s.xt=!1;const h=this.Dn.F();if(!h.priceLineVisible||!this.Dn.xt())return;const e=this.Dn.Lr(0===h.priceLineSource);e.Or||(s.xt=!0,s.et=e.ki,s.R=this.Dn.Jr(e.R),s.Zt=i,s.Kt=t,s.rt=h.priceLineWidth,s.zt=h.priceLineStyle)}}class pi extends Q{constructor(t){super(),this.Ht=t}Vi(t,i,s){t.xt=!1,i.xt=!1;const h=this.Ht;if(!h.xt())return;const e=h.F(),n=e.lastValueVisible,r=""!==h.Qr(),o=0===e.seriesLastValueMode,l=h.Lr(!1);if(l.Or)return;n&&(t.ii=this.th(l,n,o),t.xt=0!==t.ii.length),(r||o)&&(i.ii=this.ih(l,n,r,o),i.xt=i.ii.length>0);const a=h.Jr(l.R),c=y(a);s.t=c.t,s.R=c.i,s.ki=l.ki,i.Ot=h.qt().Bt(l.ki/h.At().Kt()),t.Ot=a,t.R=s.R,i.R=s.R}ih(t,i,s,h){let e="";const n=this.Ht.Qr();return s&&0!==n.length&&(e+=`${n} `),i&&h&&(e+=this.Ht.At().sh()?t.nh:t.eh),e.trim()}th(t,i,s){return i?s?this.Ht.At().sh()?t.eh:t.nh:t.ii:""}}class vi{constructor(t,i){this.rh=t,this.hh=i}lh(t){return null!==t&&this.rh===t.rh&&this.hh===t.hh}ah(){return new vi(this.rh,this.hh)}oh(){return this.rh}_h(){return this.hh}uh(){return this.hh-this.rh}Wi(){return this.hh===this.rh||Number.isNaN(this.hh)||Number.isNaN(this.rh)}sn(t){return null===t?this:new vi(Math.min(this.oh(),t.oh()),Math.max(this._h(),t._h()))}dh(t){if(!F(t))return;if(0==this.hh-this.rh)return;const i=.5*(this.hh+this.rh);let s=this.hh-i,h=this.rh-i;s*=t,h*=t,this.hh=i+s,this.rh=i+h}fh(t){F(t)&&(this.hh+=t,this.rh+=t)}ph(){return{minValue:this.rh,maxValue:this.hh}}static mh(t){return null===t?null:new vi(t.minValue,t.maxValue)}}class mi{constructor(t,i){this.bh=t,this.wh=i||null}gh(){return this.bh}Mh(){return this.wh}ph(){return null===this.bh?null:{priceRange:this.bh.ph(),margins:this.wh||void 0}}static mh(t){return null===t?null:new mi(vi.mh(t.priceRange),t.margins)}}class gi extends Kt{constructor(t,i){super(t),this.Sh=i}rr(t,i){const s=this.nr;s.xt=!1;const h=this.Sh.F();if(!this.Dn.xt()||!h.lineVisible)return;const e=this.Sh.yh();null!==e&&(s.xt=!0,s.et=e,s.R=h.color,s.Zt=i,s.Kt=t,s.rt=h.lineWidth,s.zt=h.lineStyle)}}class bi extends Q{constructor(t,i){super(),this.Cr=t,this.Sh=i}Vi(t,i,s){t.xt=!1,i.xt=!1;const h=this.Sh.F(),e=h.axisLabelVisible,n=""!==h.title,r=this.Cr;if(!e||!r.xt())return;const o=this.Sh.yh();if(null===o)return;n&&(i.ii=h.title,i.xt=!0),i.Ot=r.qt().Bt(o/r.At().Kt()),t.ii=this.kh(h.price),t.xt=!0;const l=y(h.color);s.t=l.t,s.R=l.i,s.ki=o}kh(t){const i=this.Cr.Tt();return null===i?"":this.Cr.At().zi(t,i.Lt)}}class wi{constructor(t,i){this.Cr=t,this.cs=i,this.Ch=new gi(t,this),this.Ke=new bi(t,this),this.xh=new Yt(this.Ke,t,t.qt())}Th(t){C(this.cs,t),this.wt(),this.Cr.qt().Dh()}F(){return this.cs}Ph(){return this.Ch}Rh(){return this.xh}Ah(){return this.Ke}wt(){this.Ch.wt(),this.Ke.wt()}yh(){const t=this.Cr,i=t.At();if(t.qt().kt().Wi()||i.Wi())return null;const s=t.Tt();return null===s?null:i.Rt(this.cs.price,s.Lt)}}class Mi extends st{constructor(t){super(),this.Hi=t}qt(){return this.Hi}}const _i={Bar:(t,i,s,h)=>{var e;const n=i.upColor,r=i.downColor,o=f(t(s,h)),l=d(o.Lt[0])<=d(o.Lt[3]);return{se:null!==(e=o.R)&&void 0!==e?e:l?n:r}},Candlestick:(t,i,s,h)=>{var e,n,r;const o=i.upColor,l=i.downColor,a=i.borderUpColor,c=i.borderDownColor,u=i.wickUpColor,p=i.wickDownColor,v=f(t(s,h)),m=d(v.Lt[0])<=d(v.Lt[3]);return{se:null!==(e=v.R)&&void 0!==e?e:m?o:l,Pe:null!==(n=v.Ot)&&void 0!==n?n:m?a:c,De:null!==(r=v.Lh)&&void 0!==r?r:m?u:p}},Area:(t,i,s,h)=>{var e,n,r,o;const l=f(t(s,h));return{se:null!==(e=l.ot)&&void 0!==e?e:i.lineColor,ot:null!==(n=l.ot)&&void 0!==n?n:i.lineColor,mn:null!==(r=l.mn)&&void 0!==r?r:i.topColor,bn:null!==(o=l.bn)&&void 0!==o?o:i.bottomColor}},Baseline:(t,i,s,h)=>{var e,n,r,o,l,a;const c=f(t(s,h));return{se:c.Lt[3]>=i.baseValue.price?i.topLineColor:i.bottomLineColor,we:null!==(e=c.we)&&void 0!==e?e:i.topLineColor,ge:null!==(n=c.ge)&&void 0!==n?n:i.bottomLineColor,fe:null!==(r=c.fe)&&void 0!==r?r:i.topFillColor1,pe:null!==(o=c.pe)&&void 0!==o?o:i.topFillColor2,ve:null!==(l=c.ve)&&void 0!==l?l:i.bottomFillColor1,me:null!==(a=c.me)&&void 0!==a?a:i.bottomFillColor2}},Line:(t,i,s,h)=>{var e,n;const r=f(t(s,h));return{se:null!==(e=r.R)&&void 0!==e?e:i.color,ot:null!==(n=r.R)&&void 0!==n?n:i.color}},Histogram:(t,i,s,h)=>{var e;return{se:null!==(e=f(t(s,h)).R)&&void 0!==e?e:i.color}}};class yi{constructor(t){this.Oh=(t,i)=>void 0!==i?i.Lt:this.Cr.Is().Bh(t),this.Cr=t,this.Eh=_i[t.Ih()]}Bn(t,i){return this.Eh(this.Oh,this.Cr.F(),t,i)}}var xi;!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.None=0]="None",t[t.NearestRight=1]="NearestRight"}(xi||(xi={}));const Ci=30;class Fi{constructor(){this.Vh=[],this.Nh=new Map,this.Fh=new Map}Wh(){return this.Wn()>0?this.Vh[this.Vh.length-1]:null}zh(){return this.Wn()>0?this.jh(0):null}Es(){return this.Wn()>0?this.jh(this.Vh.length-1):null}Wn(){return this.Vh.length}Wi(){return 0===this.Wn()}Br(t){return null!==this.$h(t,0)}Bh(t){return this.Hh(t)}Hh(t,i){void 0===i&&(i=0);const s=this.$h(t,i);return null===s?null:Object.assign(Object.assign({},this.Uh(s)),{Xn:this.jh(s)})}qn(){return this.Vh}qh(t,i,s){if(this.Wi())return null;let h=null;for(const e of s)h=Si(h,this.Yh(t,i,e));return h}tt(t){this.Fh.clear(),this.Nh.clear(),this.Vh=t}jh(t){return this.Vh[t].Xn}Uh(t){return this.Vh[t]}$h(t,i){const s=this.Xh(t);if(null===s&&0!==i)switch(i){case-1:return this.Zh(t);case 1:return this.Kh(t);default:throw new TypeError("Unknown search mode")}return s}Zh(t){let i=this.Gh(t);return i>0&&(i-=1),i!==this.Vh.length&&this.jh(i)<t?i:null}Kh(t){const i=this.Jh(t);return i!==this.Vh.length&&t<this.jh(i)?i:null}Xh(t){const i=this.Gh(t);return i===this.Vh.length||t<this.Vh[i].Xn?null:i}Gh(t){return _t(this.Vh,t,((t,i)=>t.Xn<i))}Jh(t){return yt(this.Vh,t,((t,i)=>i.Xn>t))}Qh(t,i,s){let h=null;for(let e=t;e<i;e++){const t=this.Vh[e].Lt[s];Number.isNaN(t)||(null===h?h={tl:t,il:t}:(t<h.tl&&(h.tl=t),t>h.il&&(h.il=t)))}return h}Yh(t,i,s){if(this.Wi())return null;let h=null;const e=f(this.zh()),n=f(this.Es()),r=Math.max(t,e),o=Math.min(i,n),l=Math.ceil(r/Ci)*Ci,a=Math.max(l,Math.floor(o/Ci)*Ci);{const t=this.Gh(r),e=this.Jh(Math.min(o,l,i));h=Si(h,this.Qh(t,e,s))}let c=this.Nh.get(s);void 0===c&&(c=new Map,this.Nh.set(s,c));for(let u=Math.max(l+1,r);u<a;u+=Ci){const t=Math.floor(u/Ci);let i=c.get(t);if(void 0===i){const h=this.Gh(t*Ci),e=this.Jh((t+1)*Ci-1);i=this.Qh(h,e,s),c.set(t,i)}h=Si(h,i)}{const t=this.Gh(a),i=this.Jh(o);h=Si(h,this.Qh(t,i,s))}return h}}function Si(t,i){return null===t?i:null===i?t:{tl:Math.min(t.tl,i.tl),il:Math.max(t.il,i.il)}}class ki extends Mi{constructor(t,i,s){super(t),this.It=new Fi,this.Ch=new di(this),this.sl=[],this.nl=new Ut(this),this.el=null,this.rl=null,this.hl=[],this.ll=[],this.al=null,this.cs=i,this.ol=s;const h=new pi(this);this.rs=[h],this.xh=new Yt(h,this,t),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(this.el=new ii(this)),this._l(),this.ul()}M(){null!==this.al&&clearTimeout(this.al)}Jr(t){return this.cs.priceLineColor||t}Lr(t){const i={Or:!0},s=this.At();if(this.qt().kt().Wi()||s.Wi()||this.It.Wi())return i;const h=this.qt().kt().Fn(),e=this.Tt();if(null===h||null===e)return i;let n,r;if(t){const t=this.It.Wh();if(null===t)return i;n=t,r=t.Xn}else{const t=this.It.Hh(h.Sn(),-1);if(null===t)return i;if(n=this.It.Bh(t.Xn),null===n)return i;r=t.Xn}const o=n.Lt[3],l=this.En().Bn(r,{Lt:n}),a=s.Rt(o,e.Lt);return{Or:!1,ut:o,ii:s.zi(o,e.Lt),nh:s.cl(o),eh:s.dl(o,e.Lt),R:l.se,ki:a,Xn:r}}En(){return null!==this.rl||(this.rl=new yi(this)),this.rl}F(){return this.cs}Th(t){const i=t.priceScaleId;void 0!==i&&i!==this.cs.priceScaleId&&this.qt().fl(this,i),C(this.cs,t),void 0!==t.priceFormat&&(this._l(),this.qt().pl()),this.qt().vl(this),this.qt().ml(),this.gs.wt("options")}tt(t,i){this.It.tt(t),this.bl(),this.gs.wt("data"),this.ds.wt("data"),null!==this.el&&(i&&i.wl?this.el.Dr():0===t.length&&this.el.Tr());const s=this.qt().Je(this);this.qt().gl(s),this.qt().vl(this),this.qt().ml(),this.qt().Dh()}Ml(t){this.hl=t,this.bl();const i=this.qt().Je(this);this.ds.wt("data"),this.qt().gl(i),this.qt().vl(this),this.qt().ml(),this.qt().Dh()}Sl(){return this.hl}Kr(){return this.ll}yl(t){const i=new wi(this,t);return this.sl.push(i),this.qt().vl(this),i}kl(t){const i=this.sl.indexOf(t);-1!==i&&this.sl.splice(i,1),this.qt().vl(this)}Ih(){return this.ol}Tt(){const t=this.Cl();return null===t?null:{Lt:t.Lt[3],xl:t._t}}Cl(){const t=this.qt().kt().Fn();if(null===t)return null;const i=t.Mn();return this.It.Hh(i,1)}Is(){return this.It}Gr(t){const i=this.It.Bh(t);return null===i?null:"Bar"===this.ol||"Candlestick"===this.ol?{_e:i.Lt[0],ue:i.Lt[1],ce:i.Lt[2],de:i.Lt[3]}:i.Lt[3]}Tl(t){const i=this.el;return null!==i&&i.xt()?(null===this.al&&i.Rr()&&(this.al=setTimeout((()=>{this.al=null,this.qt().Dl()}),0)),i.Pr(),[i]):[]}Ps(){const t=[];this.Pl()||t.push(this.nl),t.push(this.gs,this.Ch,this.ds);const i=this.sl.map((t=>t.Ph()));return t.push(...i),t}Ji(t){return[this.xh,...this.sl.map((t=>t.Rh()))]}Rs(t,i){if(i!==this.Yi&&!this.Pl())return[];const s=[...this.rs];for(const h of this.sl)s.push(h.Ah());return s}Rl(t,i){if(void 0!==this.cs.autoscaleInfoProvider){const s=this.cs.autoscaleInfoProvider((()=>{const s=this.Al(t,i);return null===s?null:s.ph()}));return mi.mh(s)}return this.Al(t,i)}Ll(){return this.cs.priceFormat.minMove}Ol(){return this.Bl}Ls(){var t;this.gs.wt(),this.ds.wt();for(const i of this.rs)i.wt();for(const i of this.sl)i.wt();this.Ch.wt(),this.nl.wt(),null===(t=this.el)||void 0===t||t.wt()}At(){return f(super.At())}Ct(t){if("Line"!==this.ol&&"Area"!==this.ol&&"Baseline"!==this.ol||!this.cs.crosshairMarkerVisible)return null;const i=this.It.Bh(t);return null===i?null:{ut:i.Lt[3],lt:this.El(),Ot:this.Il(),Pt:this.Vl(),Dt:this.Nl(t)}}Qr(){return this.cs.title}xt(){return this.cs.visible}Pl(){return!nt(this.At().Fl())}Al(t,i){if(!S(t)||!S(i)||this.It.Wi())return null;const s="Line"===this.ol||"Area"===this.ol||"Baseline"===this.ol||"Histogram"===this.ol?[3]:[2,1],h=this.It.qh(t,i,s);let e=null!==h?new vi(h.tl,h.il):null;if("Histogram"===this.Ih()){const t=this.cs.base,i=new vi(t,t);e=null!==e?e.sn(i):i}return new mi(e,this.ds.Zr())}El(){switch(this.ol){case"Line":case"Area":case"Baseline":return this.cs.crosshairMarkerRadius}return 0}Il(){switch(this.ol){case"Line":case"Area":case"Baseline":{const t=this.cs.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}Vl(){switch(this.ol){case"Line":case"Area":case"Baseline":return this.cs.crosshairMarkerBorderWidth}return 0}Nl(t){switch(this.ol){case"Line":case"Area":case"Baseline":{const t=this.cs.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.En().Bn(t).se}_l(){switch(this.cs.priceFormat.type){case"custom":this.Bl={format:this.cs.priceFormat.formatter};break;case"volume":this.Bl=new ct(this.cs.priceFormat.precision);break;case"percent":this.Bl=new at(this.cs.priceFormat.precision);break;default:{const t=Math.pow(10,this.cs.priceFormat.precision);this.Bl=new lt(t,this.cs.priceFormat.minMove*t)}}null!==this.Yi&&this.Yi.Wl()}bl(){const t=this.qt().kt();if(t.Wi()||0===this.It.Wn())return void(this.ll=[]);const i=f(this.It.zh());this.ll=this.hl.map(((s,h)=>{const e=f(t.zl(s.time,!0)),n=e<i?1:-1;return{time:f(this.It.Hh(e,n)).Xn,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:h,text:s.text,size:s.size}}))}ul(){switch(this.ds=new fi(this,this.qt()),this.ol){case"Bar":this.gs=new Nt(this,this.qt());break;case"Candlestick":this.gs=new Vt(this,this.qt());break;case"Line":this.gs=new qt(this,this.qt());break;case"Area":this.gs=new It(this,this.qt());break;case"Baseline":this.gs=new zt(this,this.qt());break;case"Histogram":this.gs=new Xt(this,this.qt());break;default:throw Error("Unknown chart style assigned: "+this.ol)}}}class Ii{constructor(t){this.cs=t}jl(t,i,s){let h=t;if(0===this.cs.mode)return h;const e=s.ps(),n=e.Tt();if(null===n)return h;const r=e.Rt(t,n),o=s.$l().filter((t=>t instanceof ki)).reduce(((t,h)=>{if(s.Qe(h)||!h.xt())return t;const e=h.At(),n=h.Is();if(e.Wi()||!n.Br(i))return t;const r=n.Bh(i);if(null===r)return t;const o=d(h.Tt());return t.concat([e.Rt(r.Lt[3],o.Lt)])}),[]);if(0===o.length)return h;o.sort(((t,i)=>Math.abs(t-r)-Math.abs(i-r)));const l=o[0];return h=e.vs(l,n),h}}class Li{constructor(){this.It=null}tt(t){this.It=t}X(t,i,s,h){if(null===this.It)return;const e=Math.max(1,Math.floor(i));t.lineWidth=e;const n=Math.ceil(this.It.Wt*i),r=Math.ceil(this.It.Ft*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(()=>{const s=f(this.It);if(s.Hl){t.strokeStyle=s.Ul,l(t,s.ql),t.beginPath();for(const h of s.Yl){const s=Math.round(h.Xl*i);t.moveTo(s,-e),t.lineTo(s,n+e)}t.stroke()}if(s.Zl){t.strokeStyle=s.Kl,l(t,s.Gl),t.beginPath();for(const h of s.Jl){const s=Math.round(h.Xl*i);t.moveTo(-e,s),t.lineTo(r+e,s)}t.stroke()}}))}}class Ti{constructor(t){this.$t=new Li,this.vt=!0,this.ts=t}wt(){this.vt=!0}Mt(t,i){if(this.vt){const s=this.ts.qt().F().grid,h={Wt:t,Ft:i,Zl:s.horzLines.visible,Hl:s.vertLines.visible,Kl:s.horzLines.color,Ul:s.vertLines.color,Gl:s.horzLines.style,ql:s.vertLines.style,Jl:this.ts.ps().Ql(),Yl:this.ts.qt().kt().Ql()||[]};this.$t.tt(h),this.vt=!1}return this.$t}}class Ni{constructor(t){this.gs=new Ti(t)}Ph(){return this.gs}}const Di={ta:4,ia:1e-4};function Ri(t,i){const s=100*(t-i)/i;return i<0?-s:s}function Wi(t,i){const s=Ri(t.oh(),i),h=Ri(t._h(),i);return new vi(s,h)}function Bi(t,i){const s=100*(t-i)/i+100;return i<0?-s:s}function Ei(t,i){const s=Bi(t.oh(),i),h=Bi(t._h(),i);return new vi(s,h)}function Pi(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const h=Wt(s+i.ia)+i.ta;return t<0?-h:h}function zi(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const h=Math.pow(10,s-i.ta)-i.ia;return t<0?-h:h}function Oi(t,i){if(null===t)return null;const s=Pi(t.oh(),i),h=Pi(t._h(),i);return new vi(s,h)}function Vi(t,i){if(null===t)return null;const s=zi(t.oh(),i),h=zi(t._h(),i);return new vi(s,h)}function Hi(t){if(null===t)return Di;const i=Math.abs(t._h()-t.oh());if(i>=1||i<1e-15)return Di;const s=Math.ceil(Math.abs(Math.log10(i))),h=Di.ta+s;return{ta:h,ia:1/Math.pow(10,h)}}class Xi{constructor(t,i){if(this.sa=t,this.na=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.sa))this.ea=[2,2.5,2];else{this.ea=[];for(let t=this.sa;1!==t;){if(t%2==0)this.ea.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.ea.push(2,2.5),t/=5}if(this.ea.length>100)throw new Error("something wrong with base")}}}ra(t,i,s){const h=0===this.sa?0:1/this.sa;let e=Math.pow(10,Math.max(0,Math.ceil(Wt(t-i)))),n=0,r=this.na[0];for(;;){const t=Rt(e,h,1e-14)&&e>h+1e-14,i=Rt(e,s*r,1e-14),o=Rt(e,1,1e-14);if(!(t&&i&&o))break;e/=r,r=this.na[++n%this.na.length]}if(e<=h+1e-14&&(e=h),e=Math.max(1,e),this.ea.length>0&&(o=e,1,1e-14,Math.abs(o-1)<1e-14))for(n=0,r=this.ea[0];Rt(e,s*r,1e-14)&&e>h+1e-14;)e/=r,r=this.ea[++n%this.ea.length];var o;return e}}class qi{constructor(t,i,s,h){this.ha=[],this.Ni=t,this.sa=i,this.la=s,this.aa=h}ra(t,i){if(t<i)throw new Error("high < low");const s=this.Ni.Kt(),h=(t-i)*this.oa()/s,e=new Xi(this.sa,[2,2.5,2]),n=new Xi(this.sa,[2,2,2.5]),r=new Xi(this.sa,[2.5,2,2]),o=[];return o.push(e.ra(t,i,h),n.ra(t,i,h),r.ra(t,i,h)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let s=1;s<t.length;++s)t[s]<i&&(i=t[s]);return i}(o)}_a(){const t=this.Ni,i=t.Tt();if(null===i)return void(this.ha=[]);const s=t.Kt(),h=this.la(s-1,i),e=this.la(0,i),n=this.Ni.F().entireTextOnly?this.ua()/2:0,r=n,o=s-1-n,l=Math.max(h,e),a=Math.min(h,e);if(l===a)return void(this.ha=[]);let c=this.ra(l,a),u=l%c;u+=u<0?c:0;const f=l>=a?1:-1;let d=null,p=0;for(let v=l-u;v>a;v-=c){const s=this.aa(v,i,!0);null!==d&&Math.abs(s-d)<this.oa()||s<r||s>o||(p<this.ha.length?(this.ha[p].Xl=s,this.ha[p].ca=t.da(v)):this.ha.push({Xl:s,ca:t.da(v)}),p++,d=s,t.fa()&&(c=this.ra(v*f,a)))}this.ha.length=p}Ql(){return this.ha}ua(){return this.Ni.T()}oa(){return Math.ceil(2.5*this.ua())}}function Ai(t){return t.slice().sort(((t,i)=>f(t.Zi())-f(i.Zi())))}var ji;!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(ji||(ji={}));const Zi=new at,Yi=new lt(100,1);class $i{constructor(t,i,s,h){this.pa=0,this.va=null,this.bh=null,this.ma=null,this.ba={wa:!1,ga:null},this.Ma=0,this.Sa=0,this.ya=new x,this.ka=new x,this.Ca=[],this.xa=null,this.Ta=null,this.Da=null,this.Pa=null,this.Bl=Yi,this.Ra=Hi(null),this.Aa=t,this.cs=i,this.La=s,this.Oa=h,this.Ba=new qi(this,100,this.Ea.bind(this),this.Ia.bind(this))}Fl(){return this.Aa}F(){return this.cs}Th(t){if(C(this.cs,t),this.Wl(),void 0!==t.mode&&this.Va({hr:t.mode}),void 0!==t.scaleMargins){const i=u(t.scaleMargins.top),s=u(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(s<0||s>1||i+s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(i+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+s}`);this.Na(),this.Ta=null}}Fa(){return this.cs.autoScale}fa(){return 1===this.cs.mode}sh(){return 2===this.cs.mode}Wa(){return 3===this.cs.mode}hr(){return{js:this.cs.autoScale,za:this.cs.invertScale,hr:this.cs.mode}}Va(t){const i=this.hr();let s=null;void 0!==t.js&&(this.cs.autoScale=t.js),void 0!==t.hr&&(this.cs.mode=t.hr,2!==t.hr&&3!==t.hr||(this.cs.autoScale=!0),this.ba.wa=!1),1===i.hr&&t.hr!==i.hr&&(function(t,i){if(null===t)return!1;const s=zi(t.oh(),i),h=zi(t._h(),i);return isFinite(s)&&isFinite(h)}(this.bh,this.Ra)?(s=Vi(this.bh,this.Ra),null!==s&&this.ja(s)):this.cs.autoScale=!0),1===t.hr&&t.hr!==i.hr&&(s=Oi(this.bh,this.Ra),null!==s&&this.ja(s));const h=i.hr!==this.cs.mode;h&&(2===i.hr||this.sh())&&this.Wl(),h&&(3===i.hr||this.Wa())&&this.Wl(),void 0!==t.za&&i.za!==t.za&&(this.cs.invertScale=t.za,this.$a()),this.ka.m(i,this.hr())}Ha(){return this.ka}T(){return this.La.fontSize}Kt(){return this.pa}Ua(t){this.pa!==t&&(this.pa=t,this.Na(),this.Ta=null)}qa(){if(this.va)return this.va;const t=this.Kt()-this.Ya()-this.Xa();return this.va=t,t}gh(){return this.Za(),this.bh}ja(t,i){const s=this.bh;(i||null===s&&null!==t||null!==s&&!s.lh(t))&&(this.Ta=null,this.bh=t)}Wi(){return this.Za(),0===this.pa||!this.bh||this.bh.Wi()}Ka(t){return this.za()?t:this.Kt()-1-t}Rt(t,i){return this.sh()?t=Ri(t,i):this.Wa()&&(t=Bi(t,i)),this.Ia(t,i)}Hn(t,i,s){this.Za();const h=this.Xa(),e=f(this.gh()),n=e.oh(),r=e._h(),o=this.qa()-1,l=this.za(),a=o/(r-n),c=void 0===s?0:s.from,u=void 0===s?t.length:s.to,d=this.Ga();for(let f=c;f<u;f++){const s=t[f],e=s.ut;if(isNaN(e))continue;let r=e;null!==d&&(r=d(s.ut,i));const o=h+a*(r-n),c=l?o:this.pa-1-o;s.et=c}}ae(t,i,s){this.Za();const h=this.Xa(),e=f(this.gh()),n=e.oh(),r=e._h(),o=this.qa()-1,l=this.za(),a=o/(r-n),c=void 0===s?0:s.from,u=void 0===s?t.length:s.to,d=this.Ga();for(let f=c;f<u;f++){const s=t[f];let e=s._e,r=s.ue,o=s.ce,c=s.de;null!==d&&(e=d(s._e,i),r=d(s.ue,i),o=d(s.ce,i),c=d(s.de,i));let u=h+a*(e-n),p=l?u:this.pa-1-u;s.he=p,u=h+a*(r-n),p=l?u:this.pa-1-u,s.ne=p,u=h+a*(o-n),p=l?u:this.pa-1-u,s.ee=p,u=h+a*(c-n),p=l?u:this.pa-1-u,s.le=p}}vs(t,i){const s=this.Ea(t,i);return this.Ja(s,i)}Ja(t,i){let s=t;return this.sh()?s=function(t,i){return i<0&&(t=-t),t/100*i+i}(s,i):this.Wa()&&(s=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(s,i)),s}$l(){return this.Ca}Qa(){if(this.xa)return this.xa;let t=[];for(let i=0;i<this.Ca.length;i++){const s=this.Ca[i];null===s.Zi()&&s.Ki(i+1),t.push(s)}return t=Ai(t),this.xa=t,this.xa}io(t){-1===this.Ca.indexOf(t)&&(this.Ca.push(t),this.Wl(),this.so())}no(t){const i=this.Ca.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.Ca.splice(i,1),0===this.Ca.length&&(this.Va({js:!0}),this.ja(null)),this.Wl(),this.so()}Tt(){let t=null;for(const i of this.Ca){const s=i.Tt();null!==s&&(null===t||s.xl<t.xl)&&(t=s)}return null===t?null:t.Lt}za(){return this.cs.invertScale}Ql(){const t=null===this.Tt();if(null!==this.Ta&&(t||this.Ta.eo===t))return this.Ta.Ql;this.Ba._a();const i=this.Ba.Ql();return this.Ta={Ql:i,eo:t},this.ya.m(),i}ro(){return this.ya}ho(t){this.sh()||this.Wa()||null===this.Da&&null===this.ma&&(this.Wi()||(this.Da=this.pa-t,this.ma=f(this.gh()).ah()))}lo(t){if(this.sh()||this.Wa())return;if(null===this.Da)return;this.Va({js:!1}),(t=this.pa-t)<0&&(t=0);let i=(this.Da+.2*(this.pa-1))/(t+.2*(this.pa-1));const s=f(this.ma).ah();i=Math.max(i,.1),s.dh(i),this.ja(s)}ao(){this.sh()||this.Wa()||(this.Da=null,this.ma=null)}oo(t){this.Fa()||null===this.Pa&&null===this.ma&&(this.Wi()||(this.Pa=t,this.ma=f(this.gh()).ah()))}_o(t){if(this.Fa())return;if(null===this.Pa)return;const i=f(this.gh()).uh()/(this.qa()-1);let s=t-this.Pa;this.za()&&(s*=-1);const h=s*i,e=f(this.ma).ah();e.fh(h),this.ja(e,!0),this.Ta=null}uo(){this.Fa()||null!==this.Pa&&(this.Pa=null,this.ma=null)}Ol(){return this.Bl||this.Wl(),this.Bl}zi(t,i){switch(this.cs.mode){case 2:return this.Ol().format(Ri(t,i));case 3:return this.Ol().format(Bi(t,i));default:return this.kh(t)}}da(t){switch(this.cs.mode){case 2:case 3:return this.Ol().format(t);default:return this.kh(t)}}cl(t){return this.kh(t,f(this.co()).Ol())}dl(t,i){return t=Ri(t,i),Zi.format(t)}do(){return this.Ca}fo(t){this.ba={ga:t,wa:!1}}Ls(){this.Ca.forEach((t=>t.Ls()))}Wl(){this.Ta=null;const t=this.co();let i=100;null!==t&&(i=Math.round(1/t.Ll())),this.Bl=Yi,this.sh()?(this.Bl=Zi,i=100):this.Wa()?(this.Bl=new lt(100,1),i=100):null!==t&&(this.Bl=t.Ol()),this.Ba=new qi(this,i,this.Ea.bind(this),this.Ia.bind(this)),this.Ba._a()}so(){this.xa=null}co(){return this.Ca[0]||null}Ya(){return this.za()?this.cs.scaleMargins.bottom*this.Kt()+this.Sa:this.cs.scaleMargins.top*this.Kt()+this.Ma}Xa(){return this.za()?this.cs.scaleMargins.top*this.Kt()+this.Ma:this.cs.scaleMargins.bottom*this.Kt()+this.Sa}Za(){this.ba.wa||(this.ba.wa=!0,this.po())}Na(){this.va=null}Ia(t,i){if(this.Za(),this.Wi())return 0;t=this.fa()&&t?Pi(t,this.Ra):t;const s=f(this.gh()),h=this.Xa()+(this.qa()-1)*(t-s.oh())/s.uh();return this.Ka(h)}Ea(t,i){if(this.Za(),this.Wi())return 0;const s=this.Ka(t),h=f(this.gh()),e=h.oh()+h.uh()*((s-this.Xa())/(this.qa()-1));return this.fa()?zi(e,this.Ra):e}$a(){this.Ta=null,this.Ba._a()}po(){const t=this.ba.ga;if(null===t)return;let i=null;const s=this.do();let h=0,e=0;for(const o of s){if(!o.xt())continue;const s=o.Tt();if(null===s)continue;const n=o.Rl(t.Mn(),t.Sn());let r=n&&n.gh();if(null!==r){switch(this.cs.mode){case 1:r=Oi(r,this.Ra);break;case 2:r=Wi(r,s.Lt);break;case 3:r=Ei(r,s.Lt)}if(i=null===i?r:i.sn(f(r)),null!==n){const t=n.Mh();null!==t&&(h=Math.max(h,t.above),e=Math.max(h,t.below))}}}if(h===this.Ma&&e===this.Sa||(this.Ma=h,this.Sa=e,this.Ta=null,this.Na()),null!==i){if(i.oh()===i._h()){const t=this.co(),s=5*(null===t||this.sh()||this.Wa()?1:t.Ll());this.fa()&&(i=Vi(i,this.Ra)),i=new vi(i.oh()-s,i._h()+s),this.fa()&&(i=Oi(i,this.Ra))}if(this.fa()){const t=Vi(i,this.Ra),s=Hi(t);if(n=s,r=this.Ra,n.ta!==r.ta||n.ia!==r.ia){const h=null!==this.ma?Vi(this.ma,this.Ra):null;this.Ra=s,i=Oi(t,s),null!==h&&(this.ma=Oi(h,s))}}this.ja(i)}else null===this.bh&&(this.ja(new vi(-.5,.5)),this.Ra=Hi(null));var n,r;this.ba.wa=!0}Ga(){return this.sh()?Ri:this.Wa()?Bi:this.fa()?t=>Pi(t,this.Ra):null}kh(t,i){return void 0===this.Oa.priceFormatter?(void 0===i&&(i=this.Ol()),i.format(t)):this.Oa.priceFormatter(t)}}class Ki{constructor(t,i){this.Ca=[],this.vo=new Map,this.pa=0,this.Ye=0,this.mo=1e3,this.xa=null,this.bo=new x,this.wo=t,this.Hi=i,this.Mo=new Ni(this);const s=i.F();this.So=this.yo("left",s.leftPriceScale),this.ko=this.yo("right",s.rightPriceScale),this.So.Ha().l(this.Co.bind(this,this.So),this),this.ko.Ha().l(this.Co.bind(this,this.ko),this),this.xo(s)}xo(t){if(t.leftPriceScale&&this.So.Th(t.leftPriceScale),t.rightPriceScale&&this.ko.Th(t.rightPriceScale),t.localization&&(this.So.Wl(),this.ko.Wl()),t.overlayPriceScales){const i=Array.from(this.vo.values());for(const s of i){const i=f(s[0].At());i.Th(t.overlayPriceScales),t.localization&&i.Wl()}}}To(t){switch(t){case"left":return this.So;case"right":return this.ko}return this.vo.has(t)?u(this.vo.get(t))[0].At():null}M(){this.qt().Do().v(this),this.So.Ha().v(this),this.ko.Ha().v(this),this.Ca.forEach((t=>{t.M&&t.M()})),this.bo.m()}Po(){return this.mo}Ro(t){this.mo=t}qt(){return this.Hi}Zt(){return this.Ye}Kt(){return this.pa}Ao(t){this.Ye=t,this.Lo()}Ua(t){this.pa=t,this.So.Ua(t),this.ko.Ua(t),this.Ca.forEach((i=>{if(this.Qe(i)){const s=i.At();null!==s&&s.Ua(t)}})),this.Lo()}$l(){return this.Ca}Qe(t){const i=t.At();return null===i||this.So!==i&&this.ko!==i}io(t,i,s){const h=void 0!==s?s:this.Bo().Oo+1;this.Eo(t,i,h)}no(t){const i=this.Ca.indexOf(t);c(-1!==i,"removeDataSource: invalid data source"),this.Ca.splice(i,1);const s=f(t.At()).Fl();if(this.vo.has(s)){const i=u(this.vo.get(s)),h=i.indexOf(t);-1!==h&&(i.splice(h,1),0===i.length&&this.vo.delete(s))}const h=t.At();h&&h.$l().indexOf(t)>=0&&h.no(t),null!==h&&(h.so(),this.Io(h)),this.xa=null}ir(t){return t===this.So?"left":t===this.ko?"right":"overlay"}Vo(){return this.So}No(){return this.ko}Fo(t,i){t.ho(i)}Wo(t,i){t.lo(i),this.Lo()}zo(t){t.ao()}jo(t,i){t.oo(i)}$o(t,i){t._o(i),this.Lo()}Ho(t){t.uo()}Lo(){this.Ca.forEach((t=>{t.Ls()}))}ps(){let t=null;return this.Hi.F().rightPriceScale.visible&&0!==this.ko.$l().length?t=this.ko:this.Hi.F().leftPriceScale.visible&&0!==this.So.$l().length?t=this.So:0!==this.Ca.length&&(t=this.Ca[0].At()),null===t&&(t=this.ko),t}tr(){let t=null;return this.Hi.F().rightPriceScale.visible?t=this.ko:this.Hi.F().leftPriceScale.visible&&(t=this.So),t}Io(t){null!==t&&t.Fa()&&this.Uo(t)}qo(t){const i=this.wo.Fn();t.Va({js:!0}),null!==i&&t.fo(i),this.Lo()}Yo(){this.Uo(this.So),this.Uo(this.ko)}Xo(){this.Io(this.So),this.Io(this.ko),this.Ca.forEach((t=>{this.Qe(t)&&this.Io(t.At())})),this.Lo(),this.Hi.Dh()}Qa(){return null===this.xa&&(this.xa=Ai(this.Ca)),this.xa}Zo(){return this.bo}Ko(){return this.Mo}Uo(t){const i=t.do();if(i&&i.length>0&&!this.wo.Wi()){const i=this.wo.Fn();null!==i&&t.fo(i)}t.Ls()}Bo(){const t=this.Qa();if(0===t.length)return{Go:0,Oo:0};let i=0,s=0;for(let h=0;h<t.length;h++){const e=t[h].Zi();null!==e&&(e<i&&(i=e),e>s&&(s=e))}return{Go:i,Oo:s}}Eo(t,i,s){let h=this.To(i);if(null===h&&(h=this.yo(i,this.Hi.F().overlayPriceScales)),this.Ca.push(t),!nt(i)){const s=this.vo.get(i)||[];s.push(t),this.vo.set(i,s)}h.io(t),t.Gi(h),t.Ki(s),this.Io(h),this.xa=null}Co(t,i,s){i.hr!==s.hr&&this.Uo(t)}yo(t,i){const s=Object.assign({visible:!0,autoScale:!0},L(i)),h=new $i(t,s,this.Hi.F().layout,this.Hi.F().localization);return h.Ua(this.Kt()),h}}const Ui=t=>t.getUTCFullYear();class Qi{constructor(t,i){void 0===t&&(t="yyyy-MM-dd"),void 0===i&&(i="default"),this.Jo=t,this.Qo=i}t_(t){return function(t,i,s){return i.replace(/yyyy/g,(t=>ot(Ui(t),4))(t)).replace(/yy/g,(t=>ot(Ui(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,s)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,s)).replace(/MM/g,(t=>ot((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>ot((t=>t.getUTCDate())(t),2))(t))}(t,this.Jo,this.Qo)}}class Gi{constructor(t){this.i_=t||"%h:%m:%s"}t_(t){return this.i_.replace("%h",ot(t.getUTCHours(),2)).replace("%m",ot(t.getUTCMinutes(),2)).replace("%s",ot(t.getUTCSeconds(),2))}}const Ji={s_:"yyyy-MM-dd",n_:"%h:%m:%s",e_:" ",r_:"default"};class ts{constructor(t){void 0===t&&(t={});const i=Object.assign(Object.assign({},Ji),t);this.h_=new Qi(i.s_,i.r_),this.l_=new Gi(i.n_),this.a_=i.e_}t_(t){return`${this.h_.t_(t)}${this.a_}${this.l_.t_(t)}`}}class is{constructor(t,i){void 0===i&&(i=50),this.Ee=0,this.Ie=1,this.Ve=1,this.Fe=new Map,this.Ne=new Map,this.o_=t,this.We=i}t_(t){const i=t._t,s=void 0===i.__?new Date(1e3*i.u_).getTime():new Date(Date.UTC(i.__.year,i.__.month-1,i.__.day)).getTime(),h=this.Fe.get(s);if(void 0!==h)return h.c_;if(this.Ee===this.We){const t=this.Ne.get(this.Ve);this.Ne.delete(this.Ve),this.Fe.delete(u(t)),this.Ve++,this.Ee--}const e=this.o_(t);return this.Fe.set(s,{c_:e,He:this.Ie}),this.Ne.set(this.Ie,s),this.Ee++,this.Ie++,e}}class ss{constructor(t,i){c(t<=i,"right should be >= left"),this.d_=t,this.f_=i}Mn(){return this.d_}Sn(){return this.f_}p_(){return this.f_-this.d_+1}Br(t){return this.d_<=t&&t<=this.f_}lh(t){return this.d_===t.Mn()&&this.f_===t.Sn()}}function hs(t,i){return null===t||null===i?t===i:t.lh(i)}class es{constructor(){this.v_=new Map,this.Fe=null}m_(t,i){this.b_(i),this.Fe=null;for(let s=i;s<t.length;++s){const i=t[s];let h=this.v_.get(i.w_);void 0===h&&(h=[],this.v_.set(i.w_,h)),h.push({Xn:s,_t:i._t,g_:i.w_,M_:i.M_})}}S_(t,i){const s=Math.ceil(i/t);return null!==this.Fe&&this.Fe.y_===s||(this.Fe={Ql:this.k_(s),y_:s}),this.Fe.Ql}b_(t){if(0===t)return void this.v_.clear();const i=[];this.v_.forEach(((s,h)=>{t<=s[0].Xn?i.push(h):s.splice(_t(s,t,(i=>i.Xn<t)),1/0)}));for(const s of i)this.v_.delete(s)}k_(t){let i=[];for(const s of Array.from(this.v_.keys()).sort(((t,i)=>i-t))){if(!this.v_.get(s))continue;const h=i;i=[];const e=h.length;let n=0;const r=u(this.v_.get(s)),o=r.length;let l=1/0,a=-1/0;for(let s=0;s<o;s++){const o=r[s],c=o.Xn;for(;n<e;){const t=h[n],s=t.Xn;if(!(s<c)){l=s;break}n++,i.push(t),a=s,l=1/0}l-c>=t&&c-a>=t&&(i.push(o),a=c)}for(;n<e;n++)i.push(h[n])}return i}}class ns{constructor(t){this.C_=t}x_(){return null===this.C_?null:new ss(Math.floor(this.C_.Mn()),Math.ceil(this.C_.Sn()))}T_(){return this.C_}static D_(){return new ns(null)}}var rs,os,ls,as,cs;!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(rs||(rs={}));class us{constructor(t,i,s){this.Ye=0,this.P_=null,this.R_=[],this.Pa=null,this.Da=null,this.A_=new es,this.L_=new Map,this.O_=ns.D_(),this.B_=!0,this.E_=new x,this.I_=new x,this.V_=new x,this.N_=null,this.F_=null,this.W_=[],this.cs=i,this.Oa=s,this.z_=i.rightOffset,this.j_=i.barSpacing,this.Hi=t,this.H_()}F(){return this.cs}U_(t){C(this.Oa,t),this.q_(),this.H_()}Th(t,i){var s;C(this.cs,t),this.cs.fixLeftEdge&&this.Y_(),this.cs.fixRightEdge&&this.X_(),void 0!==t.barSpacing&&this.Hi.Js(t.barSpacing),void 0!==t.rightOffset&&this.Hi.Qs(t.rightOffset),void 0!==t.minBarSpacing&&this.Hi.Js(null!==(s=t.barSpacing)&&void 0!==s?s:this.j_),this.q_(),this.H_(),this.V_.m()}bs(t){var i,s;return null!==(s=null===(i=this.R_[t])||void 0===i?void 0:i._t)&&void 0!==s?s:null}Ui(t){var i;return null!==(i=this.R_[t])&&void 0!==i?i:null}zl(t,i){if(this.R_.length<1)return null;if(t.u_>this.R_[this.R_.length-1]._t.u_)return i?this.R_.length-1:null;const s=_t(this.R_,t.u_,((t,i)=>t._t.u_<i));return t.u_<this.R_[s]._t.u_?i?s:null:s}Wi(){return 0===this.Ye||0===this.R_.length||null===this.P_}Fn(){return this.Z_(),this.O_.x_()}K_(){return this.Z_(),this.O_.T_()}G_(){const t=this.Fn();if(null===t)return null;const i={from:t.Mn(),to:t.Sn()};return this.J_(i)}J_(t){const i=Math.round(t.from),s=Math.round(t.to),h=f(this.Q_()),e=f(this.tu());return{from:f(this.bs(Math.max(h,i))),to:f(this.bs(Math.min(e,s)))}}iu(t){return{from:f(this.zl(t.from,!0)),to:f(this.zl(t.to,!0))}}Zt(){return this.Ye}Ao(t){if(!isFinite(t)||t<=0)return;if(this.Ye===t)return;const i=this.K_(),s=this.Ye;if(this.Ye=t,this.B_=!0,this.cs.lockVisibleTimeRangeOnResize&&0!==s){const i=this.j_*t/s;this.j_=i}if(this.cs.fixLeftEdge&&null!==i&&i.Mn()<=0){const i=s-t;this.z_-=Math.round(i/this.j_)+1,this.B_=!0}this.su(),this.nu()}Et(t){if(this.Wi()||!S(t))return 0;const i=this.eu()+this.z_-t;return this.Ye-(i+.5)*this.j_-1}$n(t,i){const s=this.eu(),h=void 0===i?0:i.from,e=void 0===i?t.length:i.to;for(let n=h;n<e;n++){const i=t[n]._t,h=s+this.z_-i,e=this.Ye-(h+.5)*this.j_-1;t[n].nt=e}}ru(t){return Math.ceil(this.hu(t))}Qs(t){this.B_=!0,this.z_=t,this.nu(),this.Hi.lu(),this.Hi.Dh()}Gn(){return this.j_}Js(t){this.au(t),this.nu(),this.Hi.lu(),this.Hi.Dh()}ou(){return this.z_}Ql(){if(this.Wi())return null;if(null!==this.F_)return this.F_;const t=this.j_,i=5*(this.Hi.F().layout.fontSize+4),s=Math.round(i/t),h=f(this.Fn()),e=Math.max(h.Mn(),h.Mn()-s),n=Math.max(h.Sn(),h.Sn()-s),r=this.A_.S_(t,i),o=this.Q_()+s,l=this.tu()-s,a=this._u(),c=this.cs.fixLeftEdge||a,u=this.cs.fixRightEdge||a;let d=0;for(const f of r){if(!(e<=f.Xn&&f.Xn<=n))continue;let t;d<this.W_.length?(t=this.W_[d],t.Xl=this.Et(f.Xn),t.ca=this.uu(f),t.g_=f.g_):(t={cu:!1,Xl:this.Et(f.Xn),ca:this.uu(f),g_:f.g_},this.W_.push(t)),this.j_>i/2&&!a?t.cu=!1:t.cu=c&&f.Xn<=o||u&&f.Xn>=l,d++}return this.W_.length=d,this.F_=this.W_,this.W_}du(){this.B_=!0,this.Js(this.cs.barSpacing),this.Qs(this.cs.rightOffset)}fu(t){this.B_=!0,this.P_=t,this.nu(),this.Y_()}pu(t,i){const s=this.hu(t),h=this.Gn(),e=h+i*(h/10);this.Js(e),this.cs.rightBarStaysOnScroll||this.Qs(this.ou()+(s-this.hu(t)))}ho(t){this.Pa&&this.uo(),null===this.Da&&null===this.N_&&(this.Wi()||(this.Da=t,this.vu()))}lo(t){if(null===this.N_)return;const i=Dt(this.Ye-t,0,this.Ye),s=Dt(this.Ye-f(this.Da),0,this.Ye);0!==i&&0!==s&&this.Js(this.N_.Gn*i/s)}ao(){null!==this.Da&&(this.Da=null,this.mu())}oo(t){null===this.Pa&&null===this.N_&&(this.Wi()||(this.Pa=t,this.vu()))}_o(t){if(null===this.Pa)return;const i=(this.Pa-t)/this.Gn();this.z_=f(this.N_).ou+i,this.B_=!0,this.nu()}uo(){null!==this.Pa&&(this.Pa=null,this.mu())}bu(){this.wu(this.cs.rightOffset)}wu(t,i){if(void 0===i&&(i=400),!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.z_,h=performance.now();this.Hi.Zs({gu:t=>(t-h)/i>=1,Mu:e=>{const n=(e-h)/i;return n>=1?t:s+(t-s)*n}})}wt(t,i){this.B_=!0,this.R_=t,this.A_.m_(t,i),this.nu()}Su(){return this.E_}yu(){return this.I_}ku(){return this.V_}eu(){return this.P_||0}Cu(t){const i=t.p_();this.au(this.Ye/i),this.z_=t.Sn()-this.eu(),this.nu(),this.B_=!0,this.Hi.lu(),this.Hi.Dh()}xu(){const t=this.Q_(),i=this.tu();null!==t&&null!==i&&this.Cu(new ss(t,i+this.cs.rightOffset))}Tu(t){const i=new ss(t.from,t.to);this.Cu(i)}qi(t){return void 0!==this.Oa.timeFormatter?this.Oa.timeFormatter(t.M_):this.Du.t_(new Date(1e3*t._t.u_))}_u(){const{handleScroll:t,handleScale:i}=this.Hi.F();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset.time||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}Q_(){return 0===this.R_.length?null:0}tu(){return 0===this.R_.length?null:this.R_.length-1}Pu(t){return(this.Ye-1-t)/this.j_}hu(t){const i=this.Pu(t),s=this.eu()+this.z_-i;return Math.round(1e6*s)/1e6}au(t){const i=this.j_;this.j_=t,this.su(),i!==this.j_&&(this.B_=!0,this.Ru())}Z_(){if(!this.B_)return;if(this.B_=!1,this.Wi())return void this.Au(ns.D_());const t=this.eu(),i=this.Ye/this.j_,s=this.z_+t,h=new ss(s-i+1,s);this.Au(new ns(h))}su(){const t=this.Lu();if(this.j_<t&&(this.j_=t,this.B_=!0),0!==this.Ye){const t=.5*this.Ye;this.j_>t&&(this.j_=t,this.B_=!0)}}Lu(){return this.cs.fixLeftEdge&&this.cs.fixRightEdge&&0!==this.R_.length?this.Ye/this.R_.length:this.cs.minBarSpacing}nu(){const t=this.Ou();this.z_>t&&(this.z_=t,this.B_=!0);const i=this.Bu();null!==i&&this.z_<i&&(this.z_=i,this.B_=!0)}Bu(){const t=this.Q_(),i=this.P_;return null===t||null===i?null:t-i-1+(this.cs.fixLeftEdge?this.Ye/this.j_:Math.min(2,this.R_.length))}Ou(){return this.cs.fixRightEdge?0:this.Ye/this.j_-Math.min(2,this.R_.length)}vu(){this.N_={Gn:this.Gn(),ou:this.ou()}}mu(){this.N_=null}uu(t){let i=this.L_.get(t.g_);return void 0===i&&(i=new is((t=>this.Eu(t))),this.L_.set(t.g_,i)),i.t_(t)}Eu(t){const i=function(t,i,s){switch(t){case 0:case 10:return i?s?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.g_,this.cs.timeVisible,this.cs.secondsVisible);return void 0!==this.cs.tickMarkFormatter?this.cs.tickMarkFormatter(t.M_,i,this.Oa.locale):function(t,i,s){const h={};switch(i){case 0:h.year="numeric";break;case 1:h.month="short";break;case 2:h.day="numeric";break;case 3:h.hour12=!1,h.hour="2-digit",h.minute="2-digit";break;case 4:h.hour12=!1,h.hour="2-digit",h.minute="2-digit",h.second="2-digit"}const e=void 0===t.__?new Date(1e3*t.u_):new Date(Date.UTC(t.__.year,t.__.month-1,t.__.day));return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()).toLocaleString(s,h)}(t._t,i,this.Oa.locale)}Au(t){const i=this.O_;this.O_=t,hs(i.x_(),this.O_.x_())||this.E_.m(),hs(i.T_(),this.O_.T_())||this.I_.m(),this.Ru()}Ru(){this.F_=null}q_(){this.Ru(),this.L_.clear()}H_(){const t=this.Oa.dateFormat;this.cs.timeVisible?this.Du=new ts({s_:t,n_:this.cs.secondsVisible?"%h:%m:%s":"%h:%m",e_:"   ",r_:this.Oa.locale}):this.Du=new Qi(t,this.Oa.locale)}Y_(){if(!this.cs.fixLeftEdge)return;const t=this.Q_();if(null===t)return;const i=this.Fn();if(null===i)return;const s=i.Mn()-t;if(s<0){const t=this.z_-s-1;this.Qs(t)}this.su()}X_(){this.nu(),this.su()}}class fs extends E{constructor(t){super(),this.Iu=new Map,this.It=t}Z(t){}G(t){if(!this.It.xt)return;t.save();let i=0;for(const h of this.It.Vu){if(0===h.ii.length)continue;t.font=h.D;const s=this.Nu(t,h.ii);s>this.It.Zt?h.pu=this.It.Zt/s:h.pu=1,i+=h.Fu*h.pu}let s=0;switch(this.It.Wu){case"top":s=0;break;case"center":s=Math.max((this.It.Kt-i)/2,0);break;case"bottom":s=Math.max(this.It.Kt-i,0)}t.fillStyle=this.It.R;for(const h of this.It.Vu){t.save();let i=0;switch(this.It.zu){case"left":t.textAlign="left",i=h.Fu/2;break;case"center":t.textAlign="center",i=this.It.Zt/2;break;case"right":t.textAlign="right",i=this.It.Zt-1-h.Fu/2}t.translate(i,s),t.textBaseline="top",t.font=h.D,t.scale(h.pu,h.pu),t.fillText(h.ii,0,h.ju),t.restore(),s+=h.Fu*h.pu}t.restore()}Nu(t,i){const s=this.$u(t.font);let h=s.get(i);return void 0===h&&(h=t.measureText(i).width,s.set(i,h)),h}$u(t){let i=this.Iu.get(t);return void 0===i&&(i=new Map,this.Iu.set(t,i)),i}}class ds{constructor(t){this.vt=!0,this.jt={xt:!1,R:"",Kt:0,Zt:0,Vu:[],Wu:"center",zu:"center"},this.$t=new fs(this.jt),this.Ht=t}wt(){this.vt=!0}Mt(t,i){return this.vt&&(this.St(t,i),this.vt=!1),this.$t}St(t,i){const s=this.Ht.F(),h=this.jt;h.xt=s.visible,h.xt&&(h.R=s.color,h.Zt=i,h.Kt=t,h.zu=s.horzAlign,h.Wu=s.vertAlign,h.Vu=[{ii:s.text,D:R(s.fontSize,s.fontFamily,s.fontStyle),Fu:1.2*s.fontSize,ju:0,pu:0}])}}class ps extends st{constructor(t,i){super(),this.cs=i,this.gs=new ds(this)}Rs(){return[]}Ps(){return[this.gs]}F(){return this.cs}Ls(){this.gs.wt()}}!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(os||(os={}));class vs{constructor(t,i){this.Hu=[],this.Uu=[],this.Ye=0,this.qu=null,this.Yu=new x,this.Xu=new x,this.Zu=null,this.Ku=t,this.cs=i,this.Gu=new W(this),this.wo=new us(this,i.timeScale,this.cs.localization),this.bt=new et(this,i.crosshair),this.Ju=new Ii(i.crosshair),this.Qu=new ps(this,i.watermark),this.tc(),this.Hu[0].Ro(2e3),this.ic=this.sc(0),this.nc=this.sc(1)}pl(){this.ec(rt.rn())}Dh(){this.ec(rt.en())}Dl(){this.ec(new rt(1))}vl(t){const i=this.rc(t);this.ec(i)}hc(){return this.qu}lc(t){const i=this.qu;this.qu=t,null!==i&&this.vl(i.ac),null!==t&&this.vl(t.ac)}F(){return this.cs}Th(t){C(this.cs,t),this.Hu.forEach((i=>i.xo(t))),void 0!==t.timeScale&&this.wo.Th(t.timeScale),void 0!==t.localization&&this.wo.U_(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Yu.m(),this.ic=this.sc(0),this.nc=this.sc(1),this.pl()}oc(t,i){if("left"===t)return void this.Th({leftPriceScale:i});if("right"===t)return void this.Th({rightPriceScale:i});const s=this._c(t);null!==s&&(s.At.Th(i),this.Yu.m())}_c(t){for(const i of this.Hu){const s=i.To(t);if(null!==s)return{Ut:i,At:s}}return null}kt(){return this.wo}uc(){return this.Hu}cc(){return this.Qu}dc(){return this.bt}fc(){return this.Xu}vc(t,i){t.Ua(i),this.lu()}Ao(t){this.Ye=t,this.wo.Ao(this.Ye),this.Hu.forEach((i=>i.Ao(t))),this.lu()}tc(t){const i=new Ki(this.wo,this);void 0!==t?this.Hu.splice(t,0,i):this.Hu.push(i);const s=void 0===t?this.Hu.length-1:t,h=rt.rn();return h.Ws(s,{zs:0,js:!0}),this.ec(h),i}Fo(t,i,s){t.Fo(i,s)}Wo(t,i,s){t.Wo(i,s),this.ml(),this.ec(this.mc(t,2))}zo(t,i){t.zo(i),this.ec(this.mc(t,2))}jo(t,i,s){i.Fa()||t.jo(i,s)}$o(t,i,s){i.Fa()||(t.$o(i,s),this.ml(),this.ec(this.mc(t,2)))}Ho(t,i){i.Fa()||(t.Ho(i),this.ec(this.mc(t,2)))}qo(t,i){t.qo(i),this.ec(this.mc(t,2))}bc(t){this.wo.ho(t)}wc(t,i){const s=this.kt();if(s.Wi()||0===i)return;const h=s.Zt();t=Math.max(1,Math.min(t,h)),s.pu(t,i),this.lu()}gc(t){this.Mc(0),this.Sc(t),this.yc()}kc(t){this.wo.lo(t),this.lu()}Cc(){this.wo.ao(),this.Dh()}Mc(t){this.wo.oo(t)}Sc(t){this.wo._o(t),this.lu()}yc(){this.wo.uo(),this.Dh()}gt(){return this.Uu}xc(t,i,s){this.bt.Ms(t,i);let h=NaN,e=this.wo.ru(t);const n=this.wo.Fn();null!==n&&(e=Math.min(Math.max(n.Mn(),e),n.Sn()));const r=s.ps(),o=r.Tt();null!==o&&(h=r.vs(i,o)),h=this.Ju.jl(h,e,s),this.bt.Cs(e,h,s),this.Dl(),this.Xu.m(this.bt.yt(),{x:t,y:i})}Tc(){this.dc().Ts(),this.Dl(),this.Xu.m(null,null)}ml(){const t=this.bt.Ut();if(null!==t){const i=this.bt.ys(),s=this.bt.ks();this.xc(i,s,t)}this.bt.Ls()}Dc(t,i,s){const h=this.wo.bs(0);void 0!==i&&void 0!==s&&this.wo.wt(i,s);const e=this.wo.bs(0),n=this.wo.eu(),r=this.wo.Fn();if(null!==r&&null!==h&&null!==e){const i=r.Br(n),s=h.u_>e.u_,o=null!==t&&t>n&&!s,l=i&&this.wo.F().shiftVisibleRangeOnNewBar;if(o&&!l){const i=t-n;this.wo.Qs(this.wo.ou()-i)}}this.wo.fu(t)}gl(t){null!==t&&t.Xo()}Je(t){const i=this.Hu.find((i=>i.Qa().includes(t)));return void 0===i?null:i}lu(){this.Qu.Ls(),this.Hu.forEach((t=>t.Xo())),this.ml()}M(){this.Hu.forEach((t=>t.M())),this.Hu.length=0,this.cs.localization.priceFormatter=void 0,this.cs.localization.timeFormatter=void 0}Pc(){return this.Gu}sr(){return this.Gu.F()}Do(){return this.Yu}Rc(t,i){const s=this.Hu[0],h=this.Ac(i,t,s);return this.Uu.push(h),1===this.Uu.length?this.pl():this.Dh(),h}Lc(t){const i=this.Je(t),s=this.Uu.indexOf(t);c(-1!==s,"Series not found"),this.Uu.splice(s,1),f(i).no(t),t.M&&t.M()}fl(t,i){const s=f(this.Je(t));s.no(t);const h=this._c(i);if(null===h){const h=t.Zi();s.io(t,i,h)}else{const e=h.Ut===s?t.Zi():void 0;h.Ut.io(t,i,e)}}xu(){const t=rt.en();t.Us(),this.ec(t)}Oc(t){const i=rt.en();i.Xs(t),this.ec(i)}Gs(){const t=rt.en();t.Gs(),this.ec(t)}Js(t){const i=rt.en();i.Js(t),this.ec(i)}Qs(t){const i=rt.en();i.Qs(t),this.ec(i)}Zs(t){const i=rt.en();i.Zs(t),this.ec(i)}qs(){const t=rt.en();t.qs(),this.ec(t)}Bc(){return this.cs.rightPriceScale.visible?"right":"left"}Ec(){return this.nc}U(){return this.ic}Bt(t){const i=this.nc,s=this.ic;if(i===s)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.Zu||this.Zu.mn!==s||this.Zu.bn!==i)this.Zu={mn:s,bn:i,Ic:new Map};else{const i=this.Zu.Ic.get(t);if(void 0!==i)return i}const h=function(t,i,s){const[h,e,n,r]=_(t),[o,l,a,c]=_(i),u=[v(h+s*(o-h)),v(e+s*(l-e)),v(n+s*(a-n)),m(r+s*(c-r))];return`rgba(${u[0]}, ${u[1]}, ${u[2]}, ${u[3]})`}(s,i,t/100);return this.Zu.Ic.set(t,h),h}mc(t,i){const s=new rt(i);if(null!==t){const h=this.Hu.indexOf(t);s.Ws(h,{zs:i})}return s}rc(t,i){return void 0===i&&(i=2),this.mc(this.Je(t),i)}ec(t){this.Ku&&this.Ku(t),this.Hu.forEach((t=>t.Ko().Ph().wt()))}Ac(t,i,s){const h=new ki(this,t,i),e=void 0!==t.priceScaleId?t.priceScaleId:this.Bc();return s.io(h,e),nt(e)||h.Th(t),h}sc(t){const i=this.cs.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}}function ms(t){return!F(t)&&!k(t)}function gs(t){return F(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(ls||(ls={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(as||(as={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(cs||(cs={}));const bs="undefined"!=typeof window;function ws(){return!!bs&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function Ms(){return!!bs&&/iPhone|iPad|iPod/.test(window.navigator.platform)}class _s{constructor(t,i){this.Ft=t,this.Wt=i}lh(t){return this.Ft===t.Ft&&this.Wt===t.Wt}}function ys(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function xs(t){const i=f(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function Cs(t,i){const s=f(t.ownerDocument).createElement("canvas");t.appendChild(s);const e=(void 0===(n={allowDownsampling:!1})&&(n=h),new o(s,n));var n;return e.resizeCanvas({width:i.Ft,height:i.Wt}),e}function Fs(t,i){return t.Vc-i.Vc}function Ss(t,i,s){const h=(t.Vc-i.Vc)/(t._t-i._t);return Math.sign(h)*Math.min(Math.abs(h),s)}class ks{constructor(t,i,s,h){this.Nc=null,this.Fc=null,this.Wc=null,this.zc=null,this.jc=null,this.$c=0,this.Hc=0,this.Uc=t,this.qc=i,this.Yc=s,this.hn=h}Xc(t,i){if(null!==this.Nc){if(this.Nc._t===i)return void(this.Nc.Vc=t);if(Math.abs(this.Nc.Vc-t)<this.hn)return}this.zc=this.Wc,this.Wc=this.Fc,this.Fc=this.Nc,this.Nc={_t:i,Vc:t}}dr(t,i){if(null===this.Nc||null===this.Fc)return;if(i-this.Nc._t>50)return;let s=0;const h=Ss(this.Nc,this.Fc,this.qc),e=Fs(this.Nc,this.Fc),n=[h],r=[e];if(s+=e,null!==this.Wc){const t=Ss(this.Fc,this.Wc,this.qc);if(Math.sign(t)===Math.sign(h)){const i=Fs(this.Fc,this.Wc);if(n.push(t),r.push(i),s+=i,null!==this.zc){const t=Ss(this.Wc,this.zc,this.qc);if(Math.sign(t)===Math.sign(h)){const i=Fs(this.Wc,this.zc);n.push(t),r.push(i),s+=i}}}}let o=0;for(let l=0;l<n.length;++l)o+=r[l]/s*n[l];Math.abs(o)<this.Uc||(this.jc={Vc:t,_t:i},this.Hc=o,this.$c=function(t,i){const s=Math.log(i);return Math.log(1*s/-t)/s}(Math.abs(o),this.Yc))}Mu(t){const i=f(this.jc),s=t-i._t;return i.Vc+this.Hc*(Math.pow(this.Yc,s)-1)/Math.log(this.Yc)}gu(t){return null===this.jc||this.Zc(t)===this.$c}Zc(t){const i=t-f(this.jc)._t;return Math.min(i,this.$c)}}class Is{constructor(t,i,s){this.Kc=0,this.Gc=null,this.Jc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY},this.Qc=0,this.td=null,this.sd={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY},this.nd=null,this.ed=!1,this.rd=null,this.hd=null,this.ld=!1,this.ad=!1,this.od=!1,this._d=null,this.ud=null,this.dd=null,this.fd=null,this.pd=null,this.vd=null,this.md=null,this.bd=0,this.wd=!1,this.gd=!1,this.Md=!1,this.Sd=0,this.yd=null,this.kd=!Ms(),this.Cd=t=>{this.xd(t)},this.Td=t=>{if(this.Dd(t)){const i=this.Pd(t);if(++this.Qc,this.td&&this.Qc>1){const{Rd:s}=this.Ad(Ns(t),this.sd);s<30&&!this.od&&this.Ld(i,this.Bd.Od),this.Ed()}}else{const i=this.Pd(t);if(++this.Kc,this.Gc&&this.Kc>1){const{Rd:s}=this.Ad(Ns(t),this.Jc);s<5&&!this.ad&&this.Id(i,this.Bd.Vd),this.Nd()}}},this.Fd=t,this.Bd=i,this.cs=s,this.Wd()}M(){null!==this._d&&(this._d(),this._d=null),null!==this.ud&&(this.ud(),this.ud=null),null!==this.fd&&(this.fd(),this.fd=null),null!==this.pd&&(this.pd(),this.pd=null),null!==this.vd&&(this.vd(),this.vd=null),null!==this.dd&&(this.dd(),this.dd=null),this.zd(),this.Nd()}jd(t){this.fd&&this.fd();const i=this.$d.bind(this);if(this.fd=()=>{this.Fd.removeEventListener("mousemove",i)},this.Fd.addEventListener("mousemove",i),this.Dd(t))return;const s=this.Pd(t);this.Id(s,this.Bd.Hd),this.kd=!0}Nd(){null!==this.Gc&&clearTimeout(this.Gc),this.Kc=0,this.Gc=null,this.Jc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY}}Ed(){null!==this.td&&clearTimeout(this.td),this.Qc=0,this.td=null,this.sd={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY}}$d(t){if(this.Md||null!==this.hd)return;if(this.Dd(t))return;const i=this.Pd(t);this.Id(i,this.Bd.Ud),this.kd=!0}qd(t){const i=Rs(t.changedTouches,f(this.yd));if(null===i)return;if(this.Sd=Ds(t),null!==this.md)return;if(this.gd)return;this.wd=!0;const s=this.Ad(Ns(i),f(this.hd)),{Yd:h,Xd:e,Rd:n}=s;if(this.ld||!(n<5)){if(!this.ld){const t=.5*h,i=e>=t&&!this.cs.Zd(),s=t>e&&!this.cs.Kd();i||s||(this.gd=!0),this.ld=!0,this.od=!0,this.zd(),this.Ed()}if(!this.gd){const s=this.Pd(t,i);this.Ld(s,this.Bd.Gd),Ts(t)}}}Jd(t){if(0!==t.button)return;const i=this.Ad(Ns(t),f(this.rd)),{Rd:s}=i;if(s>=5&&(this.ad=!0,this.Nd()),this.ad){const i=this.Pd(t);this.Id(i,this.Bd.Qd)}}Ad(t,i){const s=Math.abs(i.nt-t.nt),h=Math.abs(i.et-t.et);return{Yd:s,Xd:h,Rd:s+h}}tf(t){let i=Rs(t.changedTouches,f(this.yd));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.yd=null,this.Sd=Ds(t),this.zd(),this.hd=null,this.vd&&(this.vd(),this.vd=null);const s=this.Pd(t,i);if(this.Ld(s,this.Bd.if),++this.Qc,this.td&&this.Qc>1){const{Rd:t}=this.Ad(Ns(i),this.sd);t<30&&!this.od&&this.Ld(s,this.Bd.Od),this.Ed()}else this.od||(this.Ld(s,this.Bd.sf),this.Bd.sf&&Ts(t));0===this.Qc&&Ts(t),0===t.touches.length&&this.ed&&(this.ed=!1,Ts(t))}xd(t){if(0!==t.button)return;const i=this.Pd(t);if(this.rd=null,this.Md=!1,this.pd&&(this.pd(),this.pd=null),ws()&&this.Fd.ownerDocument.documentElement.removeEventListener("mouseleave",this.Cd),!this.Dd(t))if(this.Id(i,this.Bd.nf),++this.Kc,this.Gc&&this.Kc>1){const{Rd:s}=this.Ad(Ns(t),this.Jc);s<5&&!this.ad&&this.Id(i,this.Bd.Vd),this.Nd()}else this.ad||this.Id(i,this.Bd.ef)}zd(){null!==this.nd&&(clearTimeout(this.nd),this.nd=null)}rf(t){if(null!==this.yd)return;const i=t.changedTouches[0];this.yd=i.identifier,this.Sd=Ds(t);const s=this.Fd.ownerDocument.documentElement;this.od=!1,this.ld=!1,this.gd=!1,this.hd=Ns(i),this.vd&&(this.vd(),this.vd=null);{const i=this.qd.bind(this),h=this.tf.bind(this);this.vd=()=>{s.removeEventListener("touchmove",i),s.removeEventListener("touchend",h)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",h,{passive:!1}),this.zd(),this.nd=setTimeout(this.hf.bind(this,t),240)}const h=this.Pd(t,i);this.Ld(h,this.Bd.lf),this.td||(this.Qc=0,this.td=setTimeout(this.Ed.bind(this),500),this.sd=Ns(i))}af(t){if(0!==t.button)return;const i=this.Fd.ownerDocument.documentElement;ws()&&i.addEventListener("mouseleave",this.Cd),this.ad=!1,this.rd=Ns(t),this.pd&&(this.pd(),this.pd=null);{const t=this.Jd.bind(this),s=this.xd.bind(this);this.pd=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",s)}if(this.Md=!0,this.Dd(t))return;const s=this.Pd(t);this.Id(s,this.Bd._f),this.Gc||(this.Kc=0,this.Gc=setTimeout(this.Nd.bind(this),500),this.Jc=Ns(t))}Wd(){this.Fd.addEventListener("mouseenter",this.jd.bind(this)),this.Fd.addEventListener("touchcancel",this.zd.bind(this));{const t=this.Fd.ownerDocument,i=t=>{this.Bd.uf&&(t.composed&&this.Fd.contains(t.composedPath()[0])||t.target&&this.Fd.contains(t.target)||this.Bd.uf())};this.ud=()=>{t.removeEventListener("touchstart",i)},this._d=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}Ms()&&(this.dd=()=>{this.Fd.removeEventListener("dblclick",this.Td)},this.Fd.addEventListener("dblclick",this.Td)),this.Fd.addEventListener("mouseleave",this.cf.bind(this)),this.Fd.addEventListener("touchstart",this.rf.bind(this),{passive:!0}),function(t){bs&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}(this.Fd),this.Fd.addEventListener("mousedown",this.af.bind(this)),this.df(),this.Fd.addEventListener("touchmove",(()=>{}),{passive:!1})}df(){void 0===this.Bd.ff&&void 0===this.Bd.pf&&void 0===this.Bd.vf||(this.Fd.addEventListener("touchstart",(t=>this.mf(t.touches)),{passive:!0}),this.Fd.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this.md&&void 0!==this.Bd.pf){const i=Ls(t.touches[0],t.touches[1])/this.bd;this.Bd.pf(this.md,i),Ts(t)}}),{passive:!1}),this.Fd.addEventListener("touchend",(t=>{this.mf(t.touches)})))}mf(t){1===t.length&&(this.wd=!1),2!==t.length||this.wd||this.ed?this.bf():this.wf(t)}wf(t){const i=this.Fd.getBoundingClientRect()||{left:0,top:0};this.md={nt:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,et:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.bd=Ls(t[0],t[1]),void 0!==this.Bd.ff&&this.Bd.ff(),this.zd()}bf(){null!==this.md&&(this.md=null,void 0!==this.Bd.vf&&this.Bd.vf())}cf(t){if(this.fd&&this.fd(),this.Dd(t))return;if(!this.kd)return;const i=this.Pd(t);this.Id(i,this.Bd.gf),this.kd=!Ms()}hf(t){const i=Rs(t.touches,f(this.yd));if(null===i)return;const s=this.Pd(t,i);this.Ld(s,this.Bd.Mf),this.od=!0,this.ed=!0}Dd(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:Ds(t)<this.Sd+500}Ld(t,i){i&&i.call(this.Bd,t)}Id(t,i){i&&i.call(this.Bd,t)}Pd(t,i){const s=i||t,h=this.Fd.getBoundingClientRect()||{left:0,top:0};return{Sf:s.clientX,yf:s.clientY,kf:s.pageX,Cf:s.pageY,xf:s.screenX,Tf:s.screenY,Df:s.clientX-h.left,Pf:s.clientY-h.top,Rf:t.ctrlKey,Af:t.altKey,Lf:t.shiftKey,Of:t.metaKey,Bf:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,Ef:t.type,If:s.target,Vf:t.view,Nf:()=>{"touchstart"!==t.type&&Ts(t)}}}}function Ls(t,i){const s=t.clientX-i.clientX,h=t.clientY-i.clientY;return Math.sqrt(s*s+h*h)}function Ts(t){t.cancelable&&t.preventDefault()}function Ns(t){return{nt:t.pageX,et:t.pageY}}function Ds(t){return t.timeStamp||performance.now()}function Rs(t,i){for(let s=0;s<t.length;++s)if(t[s].identifier===i)return t[s];return null}class Ws{constructor(t,i,s,h){this.Ni=null,this.Ff=null,this.Wf=!1,this.zf=new jt(200),this.Ir=null,this.jf=0,this.$f=!1,this.Hf=()=>{this.$f||this.ts.Uf().qt().Dh()},this.qf=()=>{this.$f||this.ts.Uf().qt().Dh()},this.ts=t,this.cs=i,this.La=i.layout,this.Gu=s,this.Yf="left"===h,this.Xf=document.createElement("div"),this.Xf.style.height="100%",this.Xf.style.overflow="hidden",this.Xf.style.width="25px",this.Xf.style.left="0",this.Xf.style.position="relative",this.Zf=Cs(this.Xf,new _s(16,16)),this.Zf.subscribeCanvasConfigured(this.Hf);const e=this.Zf.canvas;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.Kf=Cs(this.Xf,new _s(16,16)),this.Kf.subscribeCanvasConfigured(this.qf);const n=this.Kf.canvas;n.style.position="absolute",n.style.zIndex="2",n.style.left="0",n.style.top="0";const r={_f:this.Gf.bind(this),lf:this.Gf.bind(this),Qd:this.Jf.bind(this),Gd:this.Jf.bind(this),uf:this.Qf.bind(this),nf:this.tp.bind(this),if:this.tp.bind(this),Vd:this.ip.bind(this),Od:this.ip.bind(this),Hd:this.sp.bind(this),gf:this.np.bind(this)};this.ep=new Is(this.Kf.canvas,r,{Zd:()=>!1,Kd:()=>!0})}M(){this.ep.M(),this.Kf.unsubscribeCanvasConfigured(this.qf),this.Kf.destroy(),this.Zf.unsubscribeCanvasConfigured(this.Hf),this.Zf.destroy(),null!==this.Ni&&this.Ni.ro().v(this),this.Ni=null}rp(){return this.Xf}T(){return this.La.fontSize}hp(){const t=this.Gu.F();return this.Ir!==t.D&&(this.zf.ze(),this.Ir=t.D),t}lp(){if(null===this.Ni)return 0;let t=0;const i=this.hp(),s=xs(this.Zf.canvas),h=this.Ni.Ql();s.font=this.ap(),h.length>0&&(t=Math.max(this.zf.Si(s,h[0].ca),this.zf.Si(s,h[h.length-1].ca)));const e=this.op();for(let l=e.length;l--;){const i=this.zf.Si(s,e[l].ii());i>t&&(t=i)}const n=this.Ni.Tt();if(null!==n&&null!==this.Ff){const i=this.Ni.vs(1,n),h=this.Ni.vs(this.Ff.Wt-2,n);t=Math.max(t,this.zf.Si(s,this.Ni.zi(Math.floor(Math.min(i,h))+.11111111111111,n)),this.zf.Si(s,this.Ni.zi(Math.ceil(Math.max(i,h))-.11111111111111,n)))}const r=t||34;let o=Math.ceil(i.k+i.C+i.O+i.B+5+r);return o+=o%2,o}_p(t){if(t.Ft<0||t.Wt<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.Ff&&this.Ff.lh(t)||(this.Ff=t,this.$f=!0,this.Zf.resizeCanvas({width:t.Ft,height:t.Wt}),this.Kf.resizeCanvas({width:t.Ft,height:t.Wt}),this.$f=!1,this.Xf.style.width=t.Ft+"px",this.Xf.style.height=t.Wt+"px",this.Xf.style.minWidth=t.Ft+"px")}up(){return f(this.Ff).Ft}Gi(t){this.Ni!==t&&(null!==this.Ni&&this.Ni.ro().v(this),this.Ni=t,t.ro().l(this.ya.bind(this),this))}At(){return this.Ni}ze(){const t=this.ts.cp();this.ts.Uf().qt().qo(t,f(this.At()))}dp(t){if(null===this.Ff)return;if(1!==t){const t=xs(this.Zf.canvas);this.fp(),this.pp(t,this.Zf.pixelRatio),this.Ce(t,this.Zf.pixelRatio),this.vp(t,this.Zf.pixelRatio),this.mp(t,this.Zf.pixelRatio)}const i=xs(this.Kf.canvas),s=this.Ff.Ft,h=this.Ff.Wt;A(i,this.Kf.pixelRatio,(()=>{i.clearRect(0,0,s,h)})),this.bp(i,this.Kf.pixelRatio)}wp(){return this.Zf.canvas}wt(){var t;null===(t=this.Ni)||void 0===t||t.Ql()}Gf(t){if(null===this.Ni||this.Ni.Wi()||!this.cs.handleScale.axisPressedMouseMove.price)return;const i=this.ts.Uf().qt(),s=this.ts.cp();this.Wf=!0,i.Fo(s,this.Ni,t.Pf)}Jf(t){if(null===this.Ni||!this.cs.handleScale.axisPressedMouseMove.price)return;const i=this.ts.Uf().qt(),s=this.ts.cp(),h=this.Ni;i.Wo(s,h,t.Pf)}Qf(){if(null===this.Ni||!this.cs.handleScale.axisPressedMouseMove.price)return;const t=this.ts.Uf().qt(),i=this.ts.cp(),s=this.Ni;this.Wf&&(this.Wf=!1,t.zo(i,s))}tp(t){if(null===this.Ni||!this.cs.handleScale.axisPressedMouseMove.price)return;const i=this.ts.Uf().qt(),s=this.ts.cp();this.Wf=!1,i.zo(s,this.Ni)}ip(t){this.cs.handleScale.axisDoubleClickReset.price&&this.ze()}sp(t){null!==this.Ni&&(!this.ts.Uf().qt().F().handleScale.axisPressedMouseMove.price||this.Ni.sh()||this.Ni.Wa()||this.gp(1))}np(t){this.gp(0)}op(){const t=[],i=null===this.Ni?void 0:this.Ni;return(s=>{for(let h=0;h<s.length;++h){const e=s[h].Rs(this.ts.cp(),i);for(let i=0;i<e.length;i++)t.push(e[i])}})(this.ts.cp().Qa()),t}pp(t,i){if(null===this.Ff)return;const s=this.Ff.Ft,h=this.Ff.Wt;A(t,i,(()=>{const i=this.ts.cp().qt(),e=i.U(),n=i.Ec();e===n?j(t,0,0,s,h,e):K(t,0,0,s,h,e,n)}))}Ce(t,i){if(null===this.Ff||null===this.Ni||!this.Ni.F().borderVisible)return;t.save(),t.fillStyle=this.Ni.F().borderColor;const s=Math.max(1,Math.floor(this.hp().k*i));let h;h=this.Yf?Math.floor(this.Ff.Ft*i)-s:0,t.fillRect(h,0,s,Math.ceil(this.Ff.Wt*i)),t.restore()}vp(t,i){var s;if(null===this.Ff||null===this.Ni)return;const h=this.Ni.Ql();t.save();const e=this.Ni.F();t.strokeStyle=e.borderColor,t.font=this.ap(),t.fillStyle=e.borderColor;const n=this.hp(),r=this.Yf?Math.floor((this.Ff.Ft-n.C)*i):0,o=this.Yf?Math.round(r-n.O*i):Math.round(r+n.C*i+n.O*i),l=Math.max(1,Math.floor(i)),a=Math.floor(.5*i);if(e.borderVisible&&e.ticksVisible){const s=Math.round(n.C*i);t.beginPath();for(const e of h)t.rect(r,Math.round(e.Xl*i)-a,s,l);t.fill()}t.fillStyle=null!==(s=e.textColor)&&void 0!==s?s:this.La.textColor,t.textAlign=this.Yf?"right":"left",t.textBaseline="middle";const c=h.map((i=>this.zf.Mi(t,i.ca)));A(t,i,(()=>{for(let s=h.length;s--;){const e=h[s];t.fillText(e.ca,o/i,e.Xl+c[s])}})),t.restore()}fp(){if(null===this.Ff||null===this.Ni)return;let t=this.Ff.Wt/2;const i=[],s=this.Ni.Qa().slice(),h=this.ts.cp(),e=this.hp();this.Ni===h.tr()&&this.ts.cp().Qa().forEach((t=>{h.Qe(t)&&s.push(t)}));const n=this.Ni.$l()[0],r=this.Ni;s.forEach((s=>{const e=s.Rs(h,r);e.forEach((t=>{t.Oi(null),t.Bi()&&i.push(t)})),n===s&&e.length>0&&(t=e[0].ki())})),i.forEach((t=>t.Oi(t.ki()))),this.Ni.F().alignLabels&&this.Mp(i,e,t)}Mp(t,i,s){if(null===this.Ff)return;const h=t.filter((t=>t.ki()<=s)),e=t.filter((t=>t.ki()>s));h.sort(((t,i)=>i.ki()-t.ki())),h.length&&e.length&&e.push(h[0]),e.sort(((t,i)=>t.ki()-i.ki()));for(const n of t){const t=Math.floor(n.Kt(i)/2),s=n.ki();s>-t&&s<t&&n.Oi(t),s>this.Ff.Wt-t&&s<this.Ff.Wt+t&&n.Oi(this.Ff.Wt-t)}for(let n=1;n<h.length;n++){const t=h[n],s=h[n-1],e=s.Kt(i,!1),r=t.ki(),o=s.Li();r>o-e&&t.Oi(o-e)}for(let n=1;n<e.length;n++){const t=e[n],s=e[n-1],h=s.Kt(i,!0),r=t.ki(),o=s.Li();r<o+h&&t.Oi(o+h)}}mp(t,i){if(null===this.Ff)return;t.save();const s=this.Ff,h=this.op(),e=this.hp(),n=this.Yf?"right":"left";h.forEach((h=>{if(h.Ei()){const r=h.Mt(f(this.Ni));t.save(),r.X(t,e,this.zf,s.Ft,n,i),t.restore()}})),t.restore()}bp(t,i){if(null===this.Ff||null===this.Ni)return;t.save();const s=this.Ff,h=this.ts.Uf().qt(),e=[],n=this.ts.cp(),r=h.dc().Rs(n,this.Ni);r.length&&e.push(r);const o=this.hp(),l=this.Yf?"right":"left";e.forEach((h=>{h.forEach((h=>{t.save(),h.Mt(f(this.Ni)).X(t,o,this.zf,s.Ft,l,i),t.restore()}))})),t.restore()}gp(t){this.Xf.style.cursor=1===t?"ns-resize":"default"}ya(){const t=this.lp();this.jf<t&&this.ts.Uf().qt().pl(),this.jf=t}ap(){return R(this.La.fontSize,this.La.fontFamily)}}function Bs(t,i,s,h,e){t.K&&t.K(i,s,h,e)}function Es(t,i,s,h,e){t.X(i,s,h,e)}function Ps(t,i){return t.Ps(i)}function zs(t,i){return t.Ji(i)}function Os(t,i){return void 0!==t.Tl?t.Tl(i):[]}class Vs{constructor(t,i){this.Ff=new _s(0,0),this.Sp=null,this.yp=null,this.kp=null,this.Cp=!1,this.xp=new x,this.Tp=0,this.Dp=!1,this.Pp=null,this.Rp=!1,this.Ap=null,this.Lp=null,this.$f=!1,this.Hf=()=>{this.$f||null===this.Op||this.Hi().Dh()},this.qf=()=>{this.$f||null===this.Op||this.Hi().Dh()},this.Bp=t,this.Op=i,this.Op.Zo().l(this.Ep.bind(this),this,!0),this.Ip=document.createElement("td"),this.Ip.style.padding="0",this.Ip.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.Vp=document.createElement("td"),this.Vp.style.padding="0",this.Np=document.createElement("td"),this.Np.style.padding="0",this.Ip.appendChild(s),this.Zf=Cs(s,new _s(16,16)),this.Zf.subscribeCanvasConfigured(this.Hf);const h=this.Zf.canvas;h.style.position="absolute",h.style.zIndex="1",h.style.left="0",h.style.top="0",this.Kf=Cs(s,new _s(16,16)),this.Kf.subscribeCanvasConfigured(this.qf);const e=this.Kf.canvas;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0",this.Fp=document.createElement("tr"),this.Fp.appendChild(this.Vp),this.Fp.appendChild(this.Ip),this.Fp.appendChild(this.Np),this.Wp(),this.ep=new Is(this.Kf.canvas,this,{Zd:()=>null===this.Pp&&!this.Bp.F().handleScroll.vertTouchDrag,Kd:()=>null===this.Pp&&!this.Bp.F().handleScroll.horzTouchDrag})}M(){null!==this.Sp&&this.Sp.M(),null!==this.yp&&this.yp.M(),this.Kf.unsubscribeCanvasConfigured(this.qf),this.Kf.destroy(),this.Zf.unsubscribeCanvasConfigured(this.Hf),this.Zf.destroy(),null!==this.Op&&this.Op.Zo().v(this),this.ep.M()}cp(){return f(this.Op)}zp(t){null!==this.Op&&this.Op.Zo().v(this),this.Op=t,null!==this.Op&&this.Op.Zo().l(Vs.prototype.Ep.bind(this),this,!0),this.Wp()}Uf(){return this.Bp}rp(){return this.Fp}Wp(){if(null!==this.Op&&(this.jp(),0!==this.Hi().gt().length)){if(null!==this.Sp){const t=this.Op.Vo();this.Sp.Gi(f(t))}if(null!==this.yp){const t=this.Op.No();this.yp.Gi(f(t))}}}$p(){null!==this.Sp&&this.Sp.wt(),null!==this.yp&&this.yp.wt()}Po(){return null!==this.Op?this.Op.Po():0}Ro(t){this.Op&&this.Op.Ro(t)}Hd(t){if(!this.Op)return;this.Hp();const i=t.Df,s=t.Pf;this.Up(i,s)}_f(t){this.Hp(),this.qp(),this.Up(t.Df,t.Pf)}Ud(t){if(!this.Op)return;this.Hp();const i=t.Df,s=t.Pf;this.Up(i,s);const h=this.Vr(i,s);this.Hi().lc(h&&{ac:h.ac,Yp:h.Yp})}ef(t){null!==this.Op&&(this.Hp(),this.Xp(t))}Qd(t){this.Hp(),this.Zp(t),this.Up(t.Df,t.Pf)}nf(t){null!==this.Op&&(this.Hp(),this.Dp=!1,this.Kp(t))}sf(t){null!==this.Op&&this.Xp(t)}Mf(t){if(this.Dp=!0,null===this.Pp){const i={x:t.Df,y:t.Pf};this.Gp(i,i)}}gf(t){null!==this.Op&&(this.Hp(),this.Op.qt().lc(null),this.Jp())}Qp(){return this.xp}ff(){this.Tp=1,this.Hi().qs()}pf(t,i){if(!this.Bp.F().handleScale.pinch)return;const s=5*(i-this.Tp);this.Tp=i,this.Hi().wc(t.nt,s)}lf(t){if(this.Dp=!1,this.Rp=null!==this.Pp,this.qp(),null!==this.Pp){const i=this.Hi().dc();this.Ap={x:i.Gt(),y:i.Jt()},this.Pp={x:t.Df,y:t.Pf}}}Gd(t){if(null===this.Op)return;const i=t.Df,s=t.Pf;if(null===this.Pp)this.Zp(t);else{this.Rp=!1;const t=f(this.Ap),h=t.x+(i-this.Pp.x),e=t.y+(s-this.Pp.y);this.Up(h,e)}}if(t){0===this.Uf().F().trackingMode.exitMode&&(this.Rp=!0),this.tv(),this.Kp(t)}Vr(t,i){const s=this.Op;if(null===s)return null;const h=s.Qa();for(const e of h){const h=this.iv(e.Ps(s),t,i);if(null!==h)return{ac:e,Vf:h.Vf,Yp:h.Yp}}return null}sv(t,i){f("left"===i?this.Sp:this.yp)._p(new _s(t,this.Ff.Wt))}nv(){return this.Ff}_p(t){if(t.Ft<0||t.Wt<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.Ff.lh(t)||(this.Ff=t,this.$f=!0,this.Zf.resizeCanvas({width:t.Ft,height:t.Wt}),this.Kf.resizeCanvas({width:t.Ft,height:t.Wt}),this.$f=!1,this.Ip.style.width=t.Ft+"px",this.Ip.style.height=t.Wt+"px")}ev(){const t=f(this.Op);t.Io(t.Vo()),t.Io(t.No());for(const i of t.$l())if(t.Qe(i)){const s=i.At();null!==s&&t.Io(s),i.Ls()}}wp(){return this.Zf.canvas}dp(t){if(0===t)return;if(null===this.Op)return;if(t>1&&this.ev(),null!==this.Sp&&this.Sp.dp(t),null!==this.yp&&this.yp.dp(t),1!==t){const t=xs(this.Zf.canvas);t.save(),this.pp(t,this.Zf.pixelRatio),this.Op&&(this.rv(t,this.Zf.pixelRatio),this.hv(t,this.Zf.pixelRatio),this.lv(t,this.Zf.pixelRatio,Ps),this.lv(t,this.Zf.pixelRatio,zs)),t.restore()}const i=xs(this.Kf.canvas);i.clearRect(0,0,Math.ceil(this.Ff.Ft*this.Kf.pixelRatio),Math.ceil(this.Ff.Wt*this.Kf.pixelRatio)),this.lv(i,this.Zf.pixelRatio,Os),this.av(i,this.Kf.pixelRatio)}ov(){return this.Sp}_v(){return this.yp}Ep(){null!==this.Op&&this.Op.Zo().v(this),this.Op=null}Xp(t){const i=t.Df,s=t.Pf;this.xp.g()&&this.xp.m(this.Hi().kt().ru(i),{x:i,y:s})}pp(t,i){A(t,i,(()=>{const i=this.Hi(),s=i.U(),h=i.Ec();s===h?j(t,0,0,this.Ff.Ft,this.Ff.Wt,h):K(t,0,0,this.Ff.Ft,this.Ff.Wt,s,h)}))}rv(t,i){const s=f(this.Op),h=s.Ko().Ph().Mt(s.Kt(),s.Zt());null!==h&&(t.save(),h.X(t,i,!1),t.restore())}hv(t,i){const s=this.Hi().cc();this.uv(t,i,Ps,Bs,s),this.uv(t,i,Ps,Es,s)}av(t,i){this.uv(t,i,Ps,Es,this.Hi().dc())}lv(t,i,s){const h=f(this.Op).Qa();for(const e of h)this.uv(t,i,s,Bs,e);for(const e of h)this.uv(t,i,s,Es,e)}uv(t,i,s,h,e){const n=f(this.Op),r=s(e,n),o=n.Kt(),l=n.Zt(),a=n.qt().hc(),c=null!==a&&a.ac===e,u=null!==a&&c&&void 0!==a.Yp?a.Yp.Nr:void 0;for(const f of r){const s=f.Mt(o,l);null!==s&&(t.save(),h(s,t,i,c,u),t.restore())}}iv(t,i,s){for(const h of t){const t=h.Mt(this.Ff.Wt,this.Ff.Ft);if(null!==t&&t.Vr){const e=t.Vr(i,s);if(null!==e)return{Vf:h,Yp:e}}}return null}jp(){if(null===this.Op)return;const t=this.Bp,i=this.Op.Vo().F().visible,s=this.Op.No().F().visible;i||null===this.Sp||(this.Vp.removeChild(this.Sp.rp()),this.Sp.M(),this.Sp=null),s||null===this.yp||(this.Np.removeChild(this.yp.rp()),this.yp.M(),this.yp=null);const h=t.qt().Pc();i&&null===this.Sp&&(this.Sp=new Ws(this,t.F(),h,"left"),this.Vp.appendChild(this.Sp.rp())),s&&null===this.yp&&(this.yp=new Ws(this,t.F(),h,"right"),this.Np.appendChild(this.yp.rp()))}cv(t){return t.Bf&&this.Dp||null!==this.Pp}dv(t){return Math.max(0,Math.min(t,this.Ff.Ft-1))}fv(t){return Math.max(0,Math.min(t,this.Ff.Wt-1))}Up(t,i){this.Hi().xc(this.dv(t),this.fv(i),f(this.Op))}Jp(){this.Hi().Tc()}tv(){this.Rp&&(this.Pp=null,this.Jp())}Gp(t,i){this.Pp=t,this.Rp=!1,this.Up(i.x,i.y);const s=this.Hi().dc();this.Ap={x:s.Gt(),y:s.Jt()}}Hi(){return this.Bp.qt()}Kp(t){if(!this.Cp)return;const i=this.Hi(),s=this.cp();if(i.Ho(s,s.ps()),this.kp=null,this.Cp=!1,i.yc(),null!==this.Lp){const t=performance.now(),s=i.kt();this.Lp.dr(s.ou(),t),this.Lp.gu(t)||i.Zs(this.Lp)}}Hp(){this.Pp=null}qp(){if(this.Op){if(this.Hi().qs(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)f(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.Op.ps().Wi()&&this.Hi().kt().Wi()}}Zp(t){if(null===this.Op)return;const i=this.Hi(),s=i.kt();if(s.Wi())return;const h=this.Bp.F(),e=h.handleScroll,n=h.kineticScroll;if((!e.pressedMouseMove||t.Bf)&&(!e.horzTouchDrag&&!e.vertTouchDrag||!t.Bf))return;const r=this.Op.ps(),o=performance.now();if(null!==this.kp||this.cv(t)||(this.kp={x:t.Sf,y:t.yf,u_:o,Df:t.Df,Pf:t.Pf}),null!==this.kp&&!this.Cp&&(this.kp.x!==t.Sf||this.kp.y!==t.yf)){if(t.Bf&&n.touch||!t.Bf&&n.mouse){const t=s.Gn();this.Lp=new ks(.2/t,7/t,.997,15/t),this.Lp.Xc(s.ou(),this.kp.u_)}else this.Lp=null;r.Wi()||i.jo(this.Op,r,t.Pf),i.Mc(t.Df),this.Cp=!0}this.Cp&&(r.Wi()||i.$o(this.Op,r,t.Pf),i.Sc(t.Df),null!==this.Lp&&this.Lp.Xc(s.ou(),o))}}class Hs{constructor(t,i,s,h,e){this.vt=!0,this.Ff=new _s(0,0),this.Hf=()=>this.dp(3),this.Yf="left"===t,this.Gu=s.Pc,this.cs=i,this.pv=h,this.vv=e,this.Xf=document.createElement("div"),this.Xf.style.width="25px",this.Xf.style.height="100%",this.Xf.style.overflow="hidden",this.Zf=Cs(this.Xf,new _s(16,16)),this.Zf.subscribeCanvasConfigured(this.Hf)}M(){this.Zf.unsubscribeCanvasConfigured(this.Hf),this.Zf.destroy()}rp(){return this.Xf}nv(){return this.Ff}_p(t){if(t.Ft<0||t.Wt<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.Ff.lh(t)||(this.Ff=t,this.Zf.resizeCanvas({width:t.Ft,height:t.Wt}),this.Xf.style.width=`${t.Ft}px`,this.Xf.style.minWidth=`${t.Ft}px`,this.Xf.style.height=`${t.Wt}px`,this.vt=!0)}dp(t){if(t<3&&!this.vt)return;if(0===this.Ff.Ft||0===this.Ff.Wt)return;this.vt=!1;const i=xs(this.Zf.canvas);this.pp(i,this.Zf.pixelRatio),this.Ce(i,this.Zf.pixelRatio)}wp(){return this.Zf.canvas}Ce(t,i){if(!this.pv())return;const s=this.Ff.Ft;t.save(),t.fillStyle=this.cs.timeScale.borderColor;const h=Math.floor(this.Gu.F().k*i),e=this.Yf?Math.round(s*i)-h:0;t.fillRect(e,0,h,h),t.restore()}pp(t,i){A(t,i,(()=>{j(t,0,0,this.Ff.Ft,this.Ff.Wt,this.vv())}))}}function Xs(t,i){return t.g_>i.g_?t:i}class qs{constructor(t){this.mv=null,this.bv=null,this.S=null,this.wv=!1,this.Ff=new _s(0,0),this.gv=new x,this.zf=new jt(5),this.$f=!1,this.Hf=()=>{this.$f||this.Bp.qt().Dh()},this.qf=()=>{this.$f||this.Bp.qt().Dh()},this.Bp=t,this.cs=t.F().layout,this.Mv=document.createElement("tr"),this.Sv=document.createElement("td"),this.Sv.style.padding="0",this.yv=document.createElement("td"),this.yv.style.padding="0",this.Xf=document.createElement("td"),this.Xf.style.height="25px",this.Xf.style.padding="0",this.kv=document.createElement("div"),this.kv.style.width="100%",this.kv.style.height="100%",this.kv.style.position="relative",this.kv.style.overflow="hidden",this.Xf.appendChild(this.kv),this.Zf=Cs(this.kv,new _s(16,16)),this.Zf.subscribeCanvasConfigured(this.Hf);const i=this.Zf.canvas;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this.Kf=Cs(this.kv,new _s(16,16)),this.Kf.subscribeCanvasConfigured(this.qf);const s=this.Kf.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.Mv.appendChild(this.Sv),this.Mv.appendChild(this.Xf),this.Mv.appendChild(this.yv),this.Cv(),this.Bp.qt().Do().l(this.Cv.bind(this),this),this.ep=new Is(this.Kf.canvas,this,{Zd:()=>!0,Kd:()=>!1})}M(){this.ep.M(),null!==this.mv&&this.mv.M(),null!==this.bv&&this.bv.M(),this.Kf.unsubscribeCanvasConfigured(this.qf),this.Kf.destroy(),this.Zf.unsubscribeCanvasConfigured(this.Hf),this.Zf.destroy()}rp(){return this.Mv}xv(){return this.mv}Tv(){return this.bv}_f(t){if(this.wv)return;this.wv=!0;const i=this.Bp.qt();!i.kt().Wi()&&this.Bp.F().handleScale.axisPressedMouseMove.time&&i.bc(t.Df)}lf(t){this._f(t)}uf(){const t=this.Bp.qt();!t.kt().Wi()&&this.wv&&(this.wv=!1,this.Bp.F().handleScale.axisPressedMouseMove.time&&t.Cc())}Qd(t){const i=this.Bp.qt();!i.kt().Wi()&&this.Bp.F().handleScale.axisPressedMouseMove.time&&i.kc(t.Df)}Gd(t){this.Qd(t)}nf(){this.wv=!1;const t=this.Bp.qt();t.kt().Wi()&&!this.Bp.F().handleScale.axisPressedMouseMove.time||t.Cc()}if(){this.nf()}Vd(){this.Bp.F().handleScale.axisDoubleClickReset.time&&this.Bp.qt().Gs()}Od(){this.Vd()}Hd(){this.Bp.qt().F().handleScale.axisPressedMouseMove.time&&this.gp(1)}gf(){this.gp(0)}nv(){return this.Ff}Dv(){return this.gv}Pv(t,i,s){this.Ff&&this.Ff.lh(t)||(this.Ff=t,this.$f=!0,this.Zf.resizeCanvas({width:t.Ft,height:t.Wt}),this.Kf.resizeCanvas({width:t.Ft,height:t.Wt}),this.$f=!1,this.Xf.style.width=t.Ft+"px",this.Xf.style.height=t.Wt+"px",this.gv.m(t)),null!==this.mv&&this.mv._p(new _s(i,t.Wt)),null!==this.bv&&this.bv._p(new _s(s,t.Wt))}Rv(){const t=this.Av();return Math.ceil(t.k+t.C+t.T+t.I+t.L+t.Lv)}wt(){this.Bp.qt().kt().Ql()}wp(){return this.Zf.canvas}dp(t){if(0===t)return;if(1!==t){const i=xs(this.Zf.canvas);this.pp(i,this.Zf.pixelRatio),this.Ce(i,this.Zf.pixelRatio),this.vp(i,this.Zf.pixelRatio),null!==this.mv&&this.mv.dp(t),null!==this.bv&&this.bv.dp(t)}const i=xs(this.Kf.canvas),s=this.Kf.pixelRatio;i.clearRect(0,0,Math.ceil(this.Ff.Ft*s),Math.ceil(this.Ff.Wt*s)),this.Ov([this.Bp.qt().dc()],i,s)}pp(t,i){A(t,i,(()=>{j(t,0,0,this.Ff.Ft,this.Ff.Wt,this.Bp.qt().Ec())}))}Ce(t,i){if(this.Bp.F().timeScale.borderVisible){t.save(),t.fillStyle=this.Bv();const s=Math.max(1,Math.floor(this.Av().k*i));t.fillRect(0,0,Math.ceil(this.Ff.Ft*i),s),t.restore()}}vp(t,i){const s=this.Bp.qt().kt(),h=s.Ql();if(!h||0===h.length)return;let e=h.reduce(Xs,h[0]).g_;e>30&&e<50&&(e=30),t.save(),t.strokeStyle=this.Bv();const n=this.Av(),r=n.k+n.C+n.I+n.T/2;t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.Bv();const o=Math.max(1,Math.floor(i)),l=Math.floor(.5*i),a=s.F();if(a.borderVisible&&a.ticksVisible){t.beginPath();const s=Math.round(n.C*i);for(let e=h.length;e--;){const n=Math.round(h[e].Xl*i);t.rect(n-l,0,o,s)}t.fill()}t.fillStyle=this.$(),A(t,i,(()=>{t.font=this.ap();for(const i of h)if(i.g_<e){const s=i.cu?this.Ev(t,i.Xl,i.ca):i.Xl;t.fillText(i.ca,s,r)}t.font=this.Iv();for(const i of h)if(i.g_>=e){const s=i.cu?this.Ev(t,i.Xl,i.ca):i.Xl;t.fillText(i.ca,s,r)}})),t.restore()}Ev(t,i,s){const h=this.zf.Si(t,s),e=h/2,n=Math.floor(i-e)+.5;return n<0?i+=Math.abs(0-n):n+h>this.Ff.Ft&&(i-=Math.abs(this.Ff.Ft-(n+h))),i}Ov(t,i,s){const h=this.Av();for(const e of t)for(const t of e.Qi())i.save(),t.Mt().X(i,h,s),i.restore()}Bv(){return this.Bp.F().timeScale.borderColor}$(){return this.cs.textColor}W(){return this.cs.fontSize}ap(){return R(this.W(),this.cs.fontFamily)}Iv(){return R(this.W(),this.cs.fontFamily,"bold")}Av(){null===this.S&&(this.S={k:1,V:NaN,I:NaN,L:NaN,$i:NaN,C:5,T:NaN,D:"",ji:new jt,Lv:0});const t=this.S,i=this.ap();if(t.D!==i){const s=this.W();t.T=s,t.D=i,t.I=3*s/12,t.L=3*s/12,t.$i=9*s/12,t.V=0,t.Lv=4*s/12,t.ji.ze()}return this.S}gp(t){this.Xf.style.cursor=1===t?"ew-resize":"default"}Cv(){const t=this.Bp.qt(),i=t.F();i.leftPriceScale.visible||null===this.mv||(this.Sv.removeChild(this.mv.rp()),this.mv.M(),this.mv=null),i.rightPriceScale.visible||null===this.bv||(this.yv.removeChild(this.bv.rp()),this.bv.M(),this.bv=null);const s={Pc:this.Bp.qt().Pc()},h=()=>i.leftPriceScale.borderVisible&&t.kt().F().borderVisible,e=()=>t.Ec();i.leftPriceScale.visible&&null===this.mv&&(this.mv=new Hs("left",i,s,h,e),this.Sv.appendChild(this.mv.rp())),i.rightPriceScale.visible&&null===this.bv&&(this.bv=new Hs("right",i,s,h,e),this.yv.appendChild(this.bv.rp()))}}const As=!!navigator.userAgentData&&navigator.userAgentData.brands.some((t=>t.brand.includes("Chromium")))&&((null===(js=null===navigator||void 0===navigator?void 0:navigator.userAgentData)||void 0===js?void 0:js.platform)?"Windows"===navigator.userAgentData.platform:navigator.userAgent.toLowerCase().indexOf("win")>=0);var js;class Zs{constructor(t,i){var s;this.Vv=[],this.Nv=0,this.pa=0,this.Ye=0,this.Fv=0,this.Wv=0,this.zv=null,this.jv=!1,this.xp=new x,this.Xu=new x,this.cs=i,this.Mv=document.createElement("div"),this.Mv.classList.add("tv-lightweight-charts"),this.Mv.style.overflow="hidden",this.Mv.style.width="100%",this.Mv.style.height="100%",(s=this.Mv).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.$v=document.createElement("table"),this.$v.setAttribute("cellspacing","0"),this.Mv.appendChild(this.$v),this.Hv=this.Uv.bind(this),Ys(this.cs)&&this.qv(!0),this.Hi=new vs(this.Ku.bind(this),this.cs),this.qt().fc().l(this.Yv.bind(this),this),this.Xv=new qs(this),this.$v.appendChild(this.Xv.rp());let h=this.cs.width,e=this.cs.height;if(0===h||0===e){const i=t.getBoundingClientRect();0===h&&(h=Math.floor(i.width),h-=h%2),0===e&&(e=Math.floor(i.height),e-=e%2)}this.Zv(h,e),this.Kv(),t.appendChild(this.Mv),this.Gv(),this.Hi.kt().ku().l(this.Hi.pl.bind(this.Hi),this),this.Hi.Do().l(this.Hi.pl.bind(this.Hi),this)}qt(){return this.Hi}F(){return this.cs}Jv(){return this.Vv}Qv(){return this.Xv}M(){this.qv(!1),0!==this.Nv&&window.cancelAnimationFrame(this.Nv),this.Hi.fc().v(this),this.Hi.kt().ku().v(this),this.Hi.Do().v(this),this.Hi.M();for(const t of this.Vv)this.$v.removeChild(t.rp()),t.Qp().v(this),t.M();this.Vv=[],f(this.Xv).M(),null!==this.Mv.parentElement&&this.Mv.parentElement.removeChild(this.Mv),this.Xu.M(),this.xp.M()}Zv(t,i,s){if(void 0===s&&(s=!1),this.pa===i&&this.Ye===t)return;this.pa=i,this.Ye=t;const h=i+"px",e=t+"px";f(this.Mv).style.height=h,f(this.Mv).style.width=e,this.$v.style.height=h,this.$v.style.width=e,s?this.tm(rt.rn(),performance.now()):this.Hi.pl()}dp(t){void 0===t&&(t=rt.rn());for(let i=0;i<this.Vv.length;i++)this.Vv[i].dp(t.Hs(i).zs);this.cs.timeScale.visible&&this.Xv.dp(t.$s())}Th(t){const i=Ys(this.cs);this.Hi.Th(t);const s=Ys(this.cs);s!==i&&this.qv(s),this.Gv();const h=t.width||this.Ye,e=t.height||this.pa;this.Zv(h,e)}Qp(){return this.xp}fc(){return this.Xu}im(){null!==this.zv&&(this.tm(this.zv,performance.now()),this.zv=null);const t=this.Vv[0],i=function(t,i){const s=t.createElement("canvas"),h=ys(s);return s.style.width=`${i.Ft}px`,s.style.height=`${i.Wt}px`,s.width=i.Ft*h,s.height=i.Wt*h,s}(document,new _s(this.Ye,this.pa)),s=xs(i),h=ys(i);return A(s,h,(()=>{let i=0,h=0;const e=t=>{for(let e=0;e<this.Vv.length;e++){const n=this.Vv[e],r=n.nv().Wt,o=f("left"===t?n.ov():n._v()),l=o.wp();s.drawImage(l,i,h,o.up(),r),h+=r}};this.sm()&&(e("left"),i=f(t.ov()).up()),h=0;for(let t=0;t<this.Vv.length;t++){const e=this.Vv[t],n=e.nv(),r=e.wp();s.drawImage(r,i,h,n.Ft,n.Wt),h+=n.Wt}i+=t.nv().Ft,this.nm()&&(h=0,e("right"));const n=t=>{const e=f("left"===t?this.Xv.xv():this.Xv.Tv()),n=e.nv(),r=e.wp();s.drawImage(r,i,h,n.Ft,n.Wt)};if(this.cs.timeScale.visible){i=0,this.sm()&&(n("left"),i=f(t.ov()).up());const e=this.Xv.nv(),r=this.Xv.wp();s.drawImage(r,i,h,e.Ft,e.Wt),this.nm()&&(i+=t.nv().Ft,n("right"),s.restore())}})),i}rm(t){return("left"!==t||this.sm())&&("right"!==t||this.nm())?0===this.Vv.length?0:f("left"===t?this.Vv[0].ov():this.Vv[0]._v()).up():0}hm(){let t=0,i=0,s=0;for(const d of this.Vv)this.sm()&&(i=Math.max(i,f(d.ov()).lp())),this.nm()&&(s=Math.max(s,f(d._v()).lp())),t+=d.Po();const h=this.Ye,e=this.pa,n=Math.max(h-i-s,0),r=this.cs.timeScale.visible;let o=r?this.Xv.Rv():0;o%2&&(o+=1);const l=0+o,a=e<l?0:e-l,c=a/t;let u=0;for(let f=0;f<this.Vv.length;++f){const t=this.Vv[f];t.zp(this.Hi.uc()[f]);let h=0,e=0;e=f===this.Vv.length-1?a-u:Math.round(t.Po()*c),h=Math.max(e,2),u+=h,t._p(new _s(n,h)),this.sm()&&t.sv(i,"left"),this.nm()&&t.sv(s,"right"),t.cp()&&this.Hi.vc(t.cp(),h)}this.Xv.Pv(new _s(r?n:0,o),r?i:0,r?s:0),this.Hi.Ao(n),this.Fv!==i&&(this.Fv=i),this.Wv!==s&&(this.Wv=s)}qv(t){t?this.Mv.addEventListener("wheel",this.Hv,{passive:!1}):this.Mv.removeEventListener("wheel",this.Hv)}lm(t){switch(t.deltaMode){case t.DOM_DELTA_PAGE:return 120;case t.DOM_DELTA_LINE:return 32}return As?1/window.devicePixelRatio:1}Uv(t){if(!(0!==t.deltaX&&this.cs.handleScroll.mouseWheel||0!==t.deltaY&&this.cs.handleScale.mouseWheel))return;const i=this.lm(t),s=i*t.deltaX/100,h=-i*t.deltaY/100;if(t.cancelable&&t.preventDefault(),0!==h&&this.cs.handleScale.mouseWheel){const i=Math.sign(h)*Math.min(1,Math.abs(h)),s=t.clientX-this.Mv.getBoundingClientRect().left;this.qt().wc(s,i)}0!==s&&this.cs.handleScroll.mouseWheel&&this.qt().gc(-80*s)}tm(t,i){var s;const h=t.$s();3===h&&this.am(),3!==h&&2!==h||(this.om(t),this._m(t,i),this.Xv.wt(),this.Vv.forEach((t=>{t.$p()})),3===(null===(s=this.zv)||void 0===s?void 0:s.$s())&&(this.zv.sn(t),this.am(),this.om(this.zv),this._m(this.zv,i),t=this.zv,this.zv=null)),this.dp(t)}_m(t,i){for(const s of t.tn())this.nn(s,i)}om(t){const i=this.Hi.uc();for(let s=0;s<i.length;s++)t.Hs(s).js&&i[s].Yo()}nn(t,i){const s=this.Hi.kt();switch(t.Ys){case 0:s.xu();break;case 1:s.Tu(t.Lt);break;case 2:s.Js(t.Lt);break;case 3:s.Qs(t.Lt);break;case 4:s.du();break;case 5:t.Lt.gu(i)||s.Qs(t.Lt.Mu(i))}}Ku(t){null!==this.zv?this.zv.sn(t):this.zv=t,this.jv||(this.jv=!0,this.Nv=window.requestAnimationFrame((t=>{if(this.jv=!1,this.Nv=0,null!==this.zv){const i=this.zv;this.zv=null,this.tm(i,t);for(const s of i.tn())if(5===s.Ys&&!s.Lt.gu(t)){this.qt().Zs(s.Lt);break}}})))}am(){this.Kv()}Kv(){const t=this.Hi.uc(),i=t.length,s=this.Vv.length;for(let h=i;h<s;h++){const t=u(this.Vv.pop());this.$v.removeChild(t.rp()),t.Qp().v(this),t.M()}for(let h=s;h<i;h++){const i=new Vs(this,t[h]);i.Qp().l(this.um.bind(this),this),this.Vv.push(i),this.$v.insertBefore(i.rp(),this.Xv.rp())}for(let h=0;h<i;h++){const i=t[h],s=this.Vv[h];s.cp()!==i?s.zp(i):s.Wp()}this.Gv(),this.hm()}dm(t,i){var s;const h=new Map;let e;if(null!==t&&this.Hi.gt().forEach((i=>{const s=i.Is().Hh(t);null!==s&&h.set(i,s)})),null!==t){const i=null===(s=this.Hi.kt().Ui(t))||void 0===s?void 0:s.M_;void 0!==i&&(e=i)}const n=this.qt().hc(),r=null!==n&&n.ac instanceof ki?n.ac:void 0,o=null!==n&&void 0!==n.Yp?n.Yp.Wr:void 0;return{_t:e,Xn:null!=t?t:void 0,fm:null!=i?i:void 0,pm:r,vm:h,bm:o}}um(t,i){this.xp.m((()=>this.dm(t,i)))}Yv(t,i){this.Xu.m((()=>this.dm(t,i)))}Gv(){const t=this.cs.timeScale.visible?"":"none";this.Xv.rp().style.display=t}sm(){return this.Vv[0].cp().Vo().F().visible}nm(){return this.Vv[0].cp().No().F().visible}}function Ys(t){return Boolean(t.handleScroll.mouseWheel||t.handleScale.mouseWheel)}function $s(t,i,s,h){const e=s.value,n={Xn:i,_t:t,Lt:[e,e,e,e],M_:h};return void 0!==s.color&&(n.R=s.color),n}function Ks(t){return void 0!==t.Lt}function Us(t){return(i,s,h,e)=>{return void 0===(n=h).open&&void 0===n.value?{_t:i,Xn:s,M_:e}:t(i,s,h,e);var n}}const Qs={Candlestick:Us((function(t,i,s,h){const e={Xn:i,_t:t,Lt:[s.open,s.high,s.low,s.close],M_:h};return void 0!==s.color&&(e.R=s.color),void 0!==s.borderColor&&(e.Ot=s.borderColor),void 0!==s.wickColor&&(e.Lh=s.wickColor),e})),Bar:Us((function(t,i,s,h){const e={Xn:i,_t:t,Lt:[s.open,s.high,s.low,s.close],M_:h};return void 0!==s.color&&(e.R=s.color),e})),Area:Us((function(t,i,s,h){const e=s.value,n={Xn:i,_t:t,Lt:[e,e,e,e],M_:h};return void 0!==s.lineColor&&(n.ot=s.lineColor),void 0!==s.topColor&&(n.mn=s.topColor),void 0!==s.bottomColor&&(n.bn=s.bottomColor),n})),Baseline:Us((function(t,i,s,h){const e=s.value,n={Xn:i,_t:t,Lt:[e,e,e,e],M_:h};return void 0!==s.topLineColor&&(n.we=s.topLineColor),void 0!==s.bottomLineColor&&(n.ge=s.bottomLineColor),void 0!==s.topFillColor1&&(n.fe=s.topFillColor1),void 0!==s.topFillColor2&&(n.pe=s.topFillColor2),void 0!==s.bottomFillColor1&&(n.ve=s.bottomFillColor1),void 0!==s.bottomFillColor2&&(n.me=s.bottomFillColor2),n})),Histogram:Us($s),Line:Us($s)};function Gs(t){return Qs[t]}function Js(t){return 60*t*60*1e3}function th(t){return 60*t*1e3}const ih=[{wm:(1,1e3),g_:10},{wm:th(1),g_:20},{wm:th(5),g_:21},{wm:th(30),g_:22},{wm:Js(1),g_:30},{wm:Js(3),g_:31},{wm:Js(6),g_:32},{wm:Js(12),g_:33}];function sh(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let s=ih.length-1;s>=0;--s)if(Math.floor(i.getTime()/ih[s].wm)!==Math.floor(t.getTime()/ih[s].wm))return ih[s].g_;return 0}function hh(t,i){if(void 0===i&&(i=0),0===t.length)return;let s=0===i?null:t[i-1]._t.u_,h=null!==s?new Date(1e3*s):null,e=0;for(let n=i;n<t.length;++n){const i=t[n],r=new Date(1e3*i._t.u_);null!==h&&(i.w_=sh(r,h)),e+=i._t.u_-(s||i._t.u_),s=i._t.u_,h=r}if(0===i&&t.length>1){const i=Math.ceil(e/(t.length-1)),s=new Date(1e3*(t[0]._t.u_-i));t[0].w_=sh(new Date(1e3*t[0]._t.u_),s)}}function eh(t){if(!ms(t))throw new Error("time must be of type BusinessDay");const i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{u_:Math.round(i.getTime()/1e3),__:t}}function nh(t){if(!gs(t))throw new Error("time must be of type isUTCTimestamp");return{u_:t}}function rh(t){return 0===t.length?null:ms(t[0].time)?eh:nh}function oh(t){return gs(t)?nh(t):ms(t)?eh(t):eh(lh(t))}function lh(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function ah(t){k(t.time)&&(t.time=lh(t.time))}function ch(t){return{Xn:0,gm:new Map,xl:t}}function uh(t){if(void 0!==t&&0!==t.length)return{Mm:t[0]._t.u_,Sm:t[t.length-1]._t.u_}}function fh(t){let i;return t.forEach((t=>{void 0===i&&(i=t.M_)})),u(i)}function dh(t){void 0===t.M_&&(t.M_=t.time)}class ph{constructor(){this.ym=new Map,this.km=new Map,this.Cm=new Map,this.xm=[]}M(){this.ym.clear(),this.km.clear(),this.Cm.clear(),this.xm=[]}Tm(t,i){let s=0!==this.ym.size,h=!1;const e=this.km.get(t);if(void 0!==e)if(1===this.km.size)s=!1,h=!0,this.ym.clear();else for(const o of this.xm)o.pointData.gm.delete(t)&&(h=!0);let n=[];if(0!==i.length){const s=i;s.forEach((t=>dh(t))),function(t){t.forEach(ah)}(i);const e=f(rh(i)),r=Gs(t.Ih());n=s.map((i=>{const s=e(i.time);let n=this.ym.get(s.u_);void 0===n&&(n=ch(s),this.ym.set(s.u_,n),h=!0);const o=r(s,n.Xn,i,i.M_);return n.gm.set(t,o),o}))}s&&this.Dm(),this.Pm(t,n);let r=-1;if(h){const t=[];this.ym.forEach((i=>{t.push({w_:0,_t:i.xl,pointData:i,M_:fh(i.gm)})})),t.sort(((t,i)=>t._t.u_-i._t.u_)),r=this.Rm(t)}return this.Am(t,r,function(t,i){const s=uh(t),h=uh(i);if(void 0!==s&&void 0!==h)return{wl:s.Sm>=h.Sm&&s.Mm>=h.Mm}}(this.km.get(t),e))}Lc(t){return this.Tm(t,[])}Lm(t,i){const s=i;dh(s),ah(i);const h=f(rh([i]))(i.time),e=this.Cm.get(t);if(void 0!==e&&h.u_<e.u_)throw new Error(`Cannot update oldest data, last time=${e.u_}, new time=${h.u_}`);let n=this.ym.get(h.u_);const r=void 0===n;void 0===n&&(n=ch(h),this.ym.set(h.u_,n));const o=Gs(t.Ih())(h,n.Xn,i,s.M_);n.gm.set(t,o),this.Om(t,o);const l={wl:Ks(o)};if(!r)return this.Am(t,-1,l);const a={w_:0,_t:n.xl,pointData:n,M_:fh(n.gm)},c=_t(this.xm,a._t.u_,((t,i)=>t._t.u_<i));this.xm.splice(c,0,a);for(let u=c;u<this.xm.length;++u)vh(this.xm[u].pointData,u);return hh(this.xm,c),this.Am(t,c,l)}Om(t,i){let s=this.km.get(t);void 0===s&&(s=[],this.km.set(t,s));const h=0!==s.length?s[s.length-1]:null;null===h||i._t.u_>h._t.u_?Ks(i)&&s.push(i):Ks(i)?s[s.length-1]=i:s.splice(-1,1),this.Cm.set(t,i._t)}Pm(t,i){0!==i.length?(this.km.set(t,i.filter(Ks)),this.Cm.set(t,i[i.length-1]._t)):(this.km.delete(t),this.Cm.delete(t))}Dm(){for(const t of this.xm)0===t.pointData.gm.size&&this.ym.delete(t._t.u_)}Rm(t){let i=-1;for(let s=0;s<this.xm.length&&s<t.length;++s){const h=this.xm[s],e=t[s];if(h._t.u_!==e._t.u_){i=s;break}e.w_=h.w_,vh(e.pointData,s)}if(-1===i&&this.xm.length!==t.length&&(i=Math.min(this.xm.length,t.length)),-1===i)return-1;for(let s=i;s<t.length;++s)vh(t[s].pointData,s);return hh(t,i),this.xm=t,i}Bm(){if(0===this.km.size)return null;let t=0;return this.km.forEach((i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].Xn))})),t}Am(t,i,s){const h={Em:new Map,kt:{eu:this.Bm()}};if(-1!==i)this.km.forEach(((i,e)=>{h.Em.set(e,{lr:i,Im:e===t?s:void 0})})),this.km.has(t)||h.Em.set(t,{lr:[],Im:s}),h.kt.Vm=this.xm,h.kt.Nm=i;else{const i=this.km.get(t);h.Em.set(t,{lr:i||[],Im:s})}return h}}function vh(t,i){t.Xn=i,t.gm.forEach((t=>{t.Xn=i}))}function mh(t){return{value:t.Lt[3],time:t.M_}}function gh(t){const i=mh(t);return void 0!==t.R&&(i.color=t.R),i}function bh(t){return{open:t.Lt[0],high:t.Lt[1],low:t.Lt[2],close:t.Lt[3],time:t.M_}}const wh={Area:function(t){const i=mh(t);return void 0!==t.ot&&(i.lineColor=t.ot),void 0!==t.mn&&(i.topColor=t.mn),void 0!==t.bn&&(i.bottomColor=t.bn),i},Line:gh,Baseline:function(t){const i=mh(t);return void 0!==t.we&&(i.topLineColor=t.we),void 0!==t.ge&&(i.bottomLineColor=t.ge),void 0!==t.fe&&(i.topFillColor1=t.fe),void 0!==t.pe&&(i.topFillColor2=t.pe),void 0!==t.ve&&(i.bottomFillColor1=t.ve),void 0!==t.me&&(i.bottomFillColor2=t.me),i},Histogram:gh,Bar:function(t){const i=bh(t);return void 0!==t.R&&(i.color=t.R),i},Candlestick:function(t){const i=bh(t),{R:s,Ot:h,Lh:e}=t;return void 0!==s&&(i.color=s),void 0!==h&&(i.borderColor=h),void 0!==e&&(i.wickColor=e),i}};function Mh(t){return wh[t]}const _h={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2}},yh={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:D,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},xh={width:0,height:0,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:D},crosshair:{vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:Object.assign({},_h),leftPriceScale:Object.assign(Object.assign({},_h),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},_h),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,ticksVisible:!1},watermark:yh,localization:{locale:bs?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},Ch={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Fh={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},Sh={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},kh={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",invertFilledArea:!1,lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Ih={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Lh={color:"#26a69a",base:0},Th={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};class Nh{constructor(t,i){this.Fm=t,this.Wm=i}applyOptions(t){this.Fm.qt().oc(this.Wm,t)}options(){return this.Ni().F()}width(){return nt(this.Wm)?this.Fm.rm(this.Wm):0}Ni(){return f(this.Fm.qt()._c(this.Wm)).At}}const Dh={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:""};class Rh{constructor(t){this.Sh=t}applyOptions(t){this.Sh.Th(t)}options(){return this.Sh.F()}zm(){return this.Sh}}class Wh{constructor(t,i,s){this.Dn=t,this.jm=i,this.$m=s}priceFormatter(){return this.Dn.Ol()}priceToCoordinate(t){const i=this.Dn.Tt();return null===i?null:this.Dn.At().Rt(t,i.Lt)}coordinateToPrice(t){const i=this.Dn.Tt();return null===i?null:this.Dn.At().vs(t,i.Lt)}barsInLogicalRange(t){if(null===t)return null;const i=new ns(new ss(t.from,t.to)).x_(),s=this.Dn.Is();if(s.Wi())return null;const h=s.Hh(i.Mn(),1),e=s.Hh(i.Sn(),-1),n=f(s.zh()),r=f(s.Es());if(null!==h&&null!==e&&h.Xn>e.Xn)return{barsBefore:t.from-n,barsAfter:r-t.to};const o={barsBefore:null===h||h.Xn===n?t.from-n:h.Xn-n,barsAfter:null===e||e.Xn===r?r-t.to:r-e.Xn};return null!==h&&null!==e&&(o.from=h._t.__||h._t.u_,o.to=e._t.__||e._t.u_),o}setData(t){this.Dn.Ih(),this.jm.Hm(this.Dn,t)}update(t){this.Dn.Ih(),this.jm.Um(this.Dn,t)}dataByIndex(t,i){const s=this.Dn.Is().Hh(t,i);return null===s?null:Mh(this.seriesType())(s)}setMarkers(t){const i=t.map((t=>Object.assign(Object.assign({},t),{originalTime:t.time,time:oh(t.time)})));this.Dn.Ml(i)}markers(){return this.Dn.Sl().map((t=>{const{originalTime:i,time:s}=t,h=function(t,i){var s={};for(var h in t)Object.prototype.hasOwnProperty.call(t,h)&&i.indexOf(h)<0&&(s[h]=t[h]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(h=Object.getOwnPropertySymbols(t);e<h.length;e++)i.indexOf(h[e])<0&&Object.prototype.propertyIsEnumerable.call(t,h[e])&&(s[h[e]]=t[h[e]])}return s}(t,["originalTime","time"]);return Object.assign({time:i},h)}))}applyOptions(t){this.Dn.Th(t)}options(){return L(this.Dn.F())}priceScale(){return this.$m.priceScale(this.Dn.At().Fl())}createPriceLine(t){const i=C(L(Dh),t),s=this.Dn.yl(i);return new Rh(s)}removePriceLine(t){this.Dn.kl(t.zm())}seriesType(){return this.Dn.Ih()}}class Bh{constructor(t,i){this.qm=new x,this.I_=new x,this.gv=new x,this.Hi=t,this.wo=t.kt(),this.Xv=i,this.wo.Su().l(this.Ym.bind(this)),this.wo.yu().l(this.Xm.bind(this)),this.Xv.Dv().l(this.Zm.bind(this))}M(){this.wo.Su().v(this),this.wo.yu().v(this),this.Xv.Dv().v(this),this.qm.M(),this.I_.M(),this.gv.M()}scrollPosition(){return this.wo.ou()}scrollToPosition(t,i){i?this.wo.wu(t,1e3):this.Hi.Qs(t)}scrollToRealTime(){this.wo.bu()}getVisibleRange(){var t,i;const s=this.wo.G_();return null===s?null:{from:null!==(t=s.from.__)&&void 0!==t?t:s.from.u_,to:null!==(i=s.to.__)&&void 0!==i?i:s.to.u_}}setVisibleRange(t){const i={from:oh(t.from),to:oh(t.to)},s=this.wo.iu(i);this.Hi.Oc(s)}getVisibleLogicalRange(){const t=this.wo.K_();return null===t?null:{from:t.Mn(),to:t.Sn()}}setVisibleLogicalRange(t){c(t.from<=t.to,"The from index cannot be after the to index."),this.Hi.Oc(t)}resetTimeScale(){this.Hi.Gs()}fitContent(){this.Hi.xu()}logicalToCoordinate(t){const i=this.Hi.kt();return i.Wi()?null:i.Et(t)}coordinateToLogical(t){return this.wo.Wi()?null:this.wo.ru(t)}timeToCoordinate(t){const i=oh(t),s=this.wo.zl(i,!1);return null===s?null:this.wo.Et(s)}coordinateToTime(t){var i;const s=this.Hi.kt(),h=s.ru(t),e=s.bs(h);return null===e?null:null!==(i=e.__)&&void 0!==i?i:e.u_}width(){return this.Xv.nv().Ft}height(){return this.Xv.nv().Wt}subscribeVisibleTimeRangeChange(t){this.qm.l(t)}unsubscribeVisibleTimeRangeChange(t){this.qm.p(t)}subscribeVisibleLogicalRangeChange(t){this.I_.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.I_.p(t)}subscribeSizeChange(t){this.gv.l(t)}unsubscribeSizeChange(t){this.gv.p(t)}applyOptions(t){this.wo.Th(t)}options(){return L(this.wo.F())}Ym(){this.qm.g()&&this.qm.m(this.getVisibleRange())}Xm(){this.I_.g()&&this.I_.m(this.getVisibleLogicalRange())}Zm(t){this.gv.m(t.Ft,t.Wt)}}function Eh(t){return function(t){if(I(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:{time:i,price:i},axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale){const{axisPressedMouseMove:i,axisDoubleClickReset:s}=t.handleScale;I(i)&&(t.handleScale.axisPressedMouseMove={time:i,price:i}),I(s)&&(t.handleScale.axisDoubleClickReset={time:s,price:s})}const i=t.handleScroll;I(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class Ph{constructor(t,i){this.Km=new ph,this.Gm=new Map,this.Jm=new Map,this.Qm=new x,this.tb=new x;const s=void 0===i?L(xh):C(L(xh),Eh(i));this.Fm=new Zs(t,s),this.Fm.Qp().l((t=>{this.Qm.g()&&this.Qm.m(this.ib(t()))}),this),this.Fm.fc().l((t=>{this.tb.g()&&this.tb.m(this.ib(t()))}),this);const h=this.Fm.qt();this.sb=new Bh(h,this.Fm.Qv())}remove(){this.Fm.Qp().v(this),this.Fm.fc().v(this),this.sb.M(),this.Fm.M(),this.Gm.clear(),this.Jm.clear(),this.Qm.M(),this.tb.M(),this.Km.M()}resize(t,i,s){this.Fm.Zv(t,i,s)}addAreaSeries(t){return this.nb("Area",kh,t)}addBaselineSeries(t){return this.nb("Baseline",Ih,t)}addBarSeries(t){return this.nb("Bar",Fh,t)}addCandlestickSeries(t){return void 0===t&&(t={}),function(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}(t),this.nb("Candlestick",Ch,t)}addHistogramSeries(t){return this.nb("Histogram",Lh,t)}addLineSeries(t){return this.nb("Line",Sh,t)}removeSeries(t){const i=u(this.Gm.get(t)),s=this.Km.Lc(i);this.Fm.qt().Lc(i),this.eb(s),this.Gm.delete(t),this.Jm.delete(i)}Hm(t,i){this.eb(this.Km.Tm(t,i))}Um(t,i){this.eb(this.Km.Lm(t,i))}subscribeClick(t){this.Qm.l(t)}unsubscribeClick(t){this.Qm.p(t)}subscribeCrosshairMove(t){this.tb.l(t)}unsubscribeCrosshairMove(t){this.tb.p(t)}priceScale(t){return new Nh(this.Fm,t)}timeScale(){return this.sb}applyOptions(t){this.Fm.Th(Eh(t))}options(){return this.Fm.F()}takeScreenshot(){return this.Fm.im()}nb(t,i,s){void 0===s&&(s={}),function(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const s=Math.round(t);if(Math.abs(s-t)<1e-8)return i;t*=10}return i}(i.minMove))}(s.priceFormat);const h=C(L(Th),L(i),s),e=this.Fm.qt().Rc(t,h),n=new Wh(e,this,this);return this.Gm.set(n,e),this.Jm.set(e,n),n}eb(t){const i=this.Fm.qt();i.Dc(t.kt.eu,t.kt.Vm,t.kt.Nm),t.Em.forEach(((t,i)=>i.tt(t.lr,t.Im))),i.lu()}rb(t){return u(this.Jm.get(t))}ib(t){const i=new Map;t.vm.forEach(((t,s)=>{const h=Mh(s.Ih())(t);c(function(t){return void 0!==t.open||void 0!==t.value}(h)),i.set(this.rb(s),h)}));const s=void 0===t.pm?void 0:this.rb(t.pm);return{time:t._t,logical:t.Xn,point:t.fm,hoveredSeries:s,hoveredMarkerId:t.bm,seriesData:i}}}function zh(t,i){let s;if(k(t)){const i=document.getElementById(t);c(null!==i,`Cannot find element in DOM with id=${t}`),s=i}else s=t;return new Ph(s,i)}function Oh(){return"4.0.0-dev+202212141245"}}}]);