"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9027],{9027:(t,i,s)=>{s.r(i),s.d(i,{ColorType:()=>as,CrosshairMode:()=>ht,LastPriceAnimationMode:()=>os,LineStyle:()=>n,LineType:()=>e,MismatchDirection:()=>Ci,PriceLineSource:()=>ls,PriceScaleMode:()=>Wi,TickMarkType:()=>ns,TrackingModeExitMode:()=>rs,createChart:()=>Bh,isBusinessDay:()=>vs,isUTCTimestamp:()=>ms,version:()=>kh});var h={allowDownsampling:!0};var e,n,r,o=function(){function t(t,i){var s=this;this._resolutionMediaQueryList=null,this._resolutionListener=function(t){return s._onResolutionChanged()},this._canvasConfiguredListeners=[],this.canvas=t,this._canvasSize={width:this.canvas.clientWidth,height:this.canvas.clientHeight},this._options=i,this._configureCanvas(),this._installResolutionListener()}return t.prototype.destroy=function(){this._canvasConfiguredListeners.length=0,this._uninstallResolutionListener(),this.canvas=null},Object.defineProperty(t.prototype,"canvasSize",{get:function(){return{width:this._canvasSize.width,height:this._canvasSize.height}},enumerable:!0,configurable:!0}),t.prototype.resizeCanvas=function(t){this._canvasSize={width:t.width,height:t.height},this._configureCanvas()},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");return t.devicePixelRatio>1||this._options.allowDownsampling?t.devicePixelRatio:1},enumerable:!0,configurable:!0}),t.prototype.subscribeCanvasConfigured=function(t){this._canvasConfiguredListeners.push(t)},t.prototype.unsubscribeCanvasConfigured=function(t){this._canvasConfiguredListeners=this._canvasConfiguredListeners.filter((function(i){return i!=t}))},t.prototype._configureCanvas=function(){var t=this.pixelRatio;this.canvas.style.width=this._canvasSize.width+"px",this.canvas.style.height=this._canvasSize.height+"px",this.canvas.width=this._canvasSize.width*t,this.canvas.height=this._canvasSize.height*t,this._emitCanvasConfigured()},t.prototype._emitCanvasConfigured=function(){var t=this;this._canvasConfiguredListeners.forEach((function(i){return i.call(t)}))},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");var i=t.devicePixelRatio;this._resolutionMediaQueryList=t.matchMedia("all and (resolution: "+i+"dppx)"),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},t.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},t.prototype._onResolutionChanged=function(){this._configureCanvas(),this._reinstallResolutionListener()},t}();function l(t,i){const s={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(s)}function a(t,i,s,h){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(s,i+e),t.lineTo(h,i+e),t.stroke()}function u(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function c(t){if(void 0===t)throw new Error("Value is undefined");return t}function f(t){if(null===t)throw new Error("Value is null");return t}function d(t){return f(c(t))}(r=e||(e={}))[r.Simple=0]="Simple",r[r.WithSteps=1]="WithSteps",r[r.Curved=2]="Curved",function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(n||(n={}));const p={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function v(t){return t<0?0:t>255?255:Math.round(t)||0}function m(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const g=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,b=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,w=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,M=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function _(t){(t=t.toLowerCase())in p&&(t=p[t]);{const i=M.exec(t)||w.exec(t);if(i)return[v(parseInt(i[1],10)),v(parseInt(i[2],10)),v(parseInt(i[3],10)),m(i.length<5?1:parseFloat(i[4]))]}{const i=b.exec(t);if(i)return[v(parseInt(i[1],16)),v(parseInt(i[2],16)),v(parseInt(i[3],16)),1]}{const i=g.exec(t);if(i)return[v(17*parseInt(i[1],16)),v(17*parseInt(i[2],16)),v(17*parseInt(i[3],16)),1]}throw new Error("Cannot parse color: "+t)}function y(t){const i=_(t);return{t:"rgb("+i[0]+", "+i[1]+", "+i[2]+")",i:(s=i,.199*s[0]+.687*s[1]+.114*s[2]>160?"black":"white")};var s}class C{constructor(){this.h=[]}l(t,i,s){const h={o:t,_:i,u:!0===s};this.h.push(h)}p(t){const i=this.h.findIndex((i=>t===i.o));i>-1&&this.h.splice(i,1)}v(t){this.h=this.h.filter((i=>i._!==t))}m(t,i){const s=[...this.h];this.h=this.h.filter((t=>!t.u)),s.forEach((s=>s.o(t,i)))}g(){return this.h.length>0}M(){this.h=[]}}function E(t){for(var i=arguments.length,s=new Array(i>1?i-1:0),h=1;h<i;h++)s[h-1]=arguments[h];for(const e of s)for(const i in e)void 0!==e[i]&&("object"!=typeof e[i]||void 0===t[i]?t[i]=e[i]:E(t[i],e[i]));return t}function S(t){return"number"==typeof t&&isFinite(t)}function x(t){return"number"==typeof t&&t%1==0}function R(t){return"string"==typeof t}function F(t){return"boolean"==typeof t}function T(t){const i=t;if(!i||"object"!=typeof i)return i;let s,h,e;for(h in s=Array.isArray(i)?[]:{},i)i.hasOwnProperty(h)&&(e=i[h],s[h]=e&&"object"==typeof e?T(e):e);return s}function L(t){return null!==t}function P(t){return null===t?void 0:t}const N="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function V(t,i,s){return void 0===i&&(i=N),(s=void 0!==s?s+" ":"")+t+"px "+i}class B{constructor(t){this.S={k:1,C:5,T:NaN,D:"",P:"",R:"",O:"",A:0,L:0,I:0,V:0,B:0},this.N=t}F(){const t=this.S,i=this.W(),s=this.j();return t.T===i&&t.P===s||(t.T=i,t.P=s,t.D=V(i,s),t.V=2.5/12*i,t.A=t.V,t.L=i/12*t.C,t.I=i/12*t.C,t.B=0),t.R=this.$(),t.O=this.H(),this.S}$(){return this.N.F().layout.textColor}H(){return this.N.U()}W(){return this.N.F().layout.fontSize}j(){return this.N.F().layout.fontFamily}}class k{constructor(){this.q=[]}Y(t){this.q=t}X(t,i,s,h){this.q.forEach((e=>{t.save(),e.X(t,i,s,h),t.restore()}))}}class U{X(t,i,s,h){t.save(),t.scale(i,i),this.K(t,s,h),t.restore()}Z(t,i,s,h){t.save(),t.scale(i,i),this.G(t,s,h),t.restore()}G(t,i,s){}}class I extends U{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}K(t){if(null===this.J||null===this.J.it)return;const i=this.J.it,s=this.J,h=h=>{t.beginPath();for(let e=i.to-1;e>=i.from;--e){const i=s.st[e];t.moveTo(i.nt,i.et),t.arc(i.nt,i.et,h,0,2*Math.PI)}t.fill()};t.fillStyle=s.rt,h(s.ht+2),t.fillStyle=s.lt,h(s.ht)}}function D(){return{st:[{nt:0,et:0,ot:0,_t:0}],lt:"",rt:"",ht:0,it:null}}const z={from:0,to:1};class O{constructor(t,i){this.ut=new k,this.ct=[],this.dt=[],this.ft=!0,this.N=t,this.vt=i,this.ut.Y(this.ct)}bt(t){const i=this.N.wt();i.length!==this.ct.length&&(this.dt=i.map(D),this.ct=this.dt.map((t=>{const i=new I;return i.tt(t),i})),this.ut.Y(this.ct)),this.ft=!0}gt(t,i,s){return this.ft&&(this.Mt(t),this.ft=!1),this.ut}Mt(t){const i=this.N.wt(),s=this.vt.St(),h=this.N.yt();i.forEach(((i,e)=>{var n;const r=this.dt[e],o=i.kt(s);if(null===o||!i.Ct())return void(r.it=null);const l=f(i.xt());r.lt=o.Tt,r.ht=o.ht,r.st[0]._t=o._t,r.st[0].et=i.Pt().Dt(o._t,l.Rt),r.rt=null!==(n=o.Ot)&&void 0!==n?n:this.N.At(r.st[0].et/t),r.st[0].ot=s,r.st[0].nt=h.Lt(s),r.it=z}))}}class j{constructor(t){this.Et=t}X(t,i,s,h){if(null===this.Et)return;const e=this.Et.It.Ct,n=this.Et.Vt.Ct;if(!e&&!n)return;t.save();const r=Math.round(this.Et.nt*i),o=Math.round(this.Et.et*i),u=Math.ceil(this.Et.Bt*i),c=Math.ceil(this.Et.Nt*i);t.lineCap="butt",e&&r>=0&&(t.lineWidth=Math.floor(this.Et.It.Ft*i),t.strokeStyle=this.Et.It.R,t.fillStyle=this.Et.It.R,l(t,this.Et.It.Wt),function(t,i,s,h){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(i+e,0),t.lineTo(i+e,h),t.stroke()}(t,r,0,c)),n&&o>=0&&(t.lineWidth=Math.floor(this.Et.Vt.Ft*i),t.strokeStyle=this.Et.Vt.R,t.fillStyle=this.Et.Vt.R,l(t,this.Et.Vt.Wt),a(t,o,0,u)),t.restore()}}class q{constructor(t){this.ft=!0,this.zt={It:{Ft:1,Wt:0,R:"",Ct:!1},Vt:{Ft:1,Wt:0,R:"",Ct:!1},Bt:0,Nt:0,nt:0,et:0},this.jt=new j(this.zt),this.$t=t}bt(){this.ft=!0}gt(t,i){return this.ft&&(this.Mt(),this.ft=!1),this.jt}Mt(){const t=this.$t.Ct(),i=f(this.$t.Ht()),s=i.Ut().F().crosshair,h=this.zt;h.Vt.Ct=t&&this.$t.qt(i),h.It.Ct=t&&this.$t.Yt(),h.Vt.Ft=s.horzLine.width,h.Vt.Wt=s.horzLine.style,h.Vt.R=s.horzLine.color,h.It.Ft=s.vertLine.width,h.It.Wt=s.vertLine.style,h.It.R=s.vertLine.color,h.Bt=i.Xt(),h.Nt=i.Kt(),h.nt=this.$t.Zt(),h.et=this.$t.Gt()}}function $(t,i,s,h,e,n){t.fillRect(i+n,s,h-2*n,n),t.fillRect(i+n,s+e-n,h-2*n,n),t.fillRect(i,s,n,e),t.fillRect(i+h-n,s,n,e)}function W(t,i,s){t.save(),t.scale(i,i),s(),t.restore()}function A(t,i,s,h,e,n){t.save(),t.globalCompositeOperation="copy",t.fillStyle=n,t.fillRect(i,s,h,e),t.restore()}function Y(t,i){return Array.isArray(t)?t.map((t=>0===t?t:t+i)):t+i}function X(t,i,s,h,e,n){let r,o,l,a;if(Array.isArray(n))if(2===n.length){const t=Math.max(0,n[0]),i=Math.max(0,n[1]);r=t,o=t,l=i,a=i}else{if(4!==n.length)throw new Error("Wrong border radius - it should be like css border radius");r=Math.max(0,n[0]),o=Math.max(0,n[1]),l=Math.max(0,n[2]),a=Math.max(0,n[3])}else{const t=Math.max(0,n);r=t,o=t,l=t,a=t}t.beginPath(),t.moveTo(i+r,s),t.lineTo(i+h-o,s),0!==o&&t.arcTo(i+h,s,i+h,s+o,o),t.lineTo(i+h,s+e-l),0!==l&&t.arcTo(i+h,s+e,i+h-l,s+e,l),t.lineTo(i+a,s+e),0!==a&&t.arcTo(i,s+e,i,s+e-a,a),t.lineTo(i,s+r),0!==r&&t.arcTo(i,s,i+r,s,r)}function K(t,i,s,h,e,n,r,o,l){if(void 0===r&&(r=0),void 0===o&&(o=0),void 0===l&&(l=""),t.save(),!r||!l||l===n)return X(t,i,s,h,e,o),t.fillStyle=n,t.fill(),void t.restore();const a=r/2;"transparent"!==n&&(X(t,i+r,s+r,h-2*r,e-2*r,Y(o,-r)),t.fillStyle=n,t.fill()),"transparent"!==l&&(X(t,i+a,s+a,h-r,e-r,Y(o,-a)),t.lineWidth=r,t.strokeStyle=l,t.closePath(),t.stroke())}function Q(t,i,s,h,e,n,r){t.save(),t.globalCompositeOperation="copy";const o=t.createLinearGradient(0,0,0,e);o.addColorStop(0,n),o.addColorStop(1,r),t.fillStyle=o,t.fillRect(i,s,h,e),t.restore()}class Z{constructor(t,i){this.tt(t,i)}tt(t,i){this.Et=t,this.Jt=i}X(t,i,s,h,e,n){if(!this.Et.Ct)return;t.font=i.D;const r=this.Qt(t,i,s,h,e,n),o=this.Et.R||this.Jt.R,l=this.Jt.t;if(t.fillStyle=this.Jt.t,this.Et.ti){const s=(i,s)=>{r.ii?K(t,r.si,r.ni,r.ei,r.ri,i,r.hi,[r.ht,0,0,r.ht],s):K(t,r.li,r.ni,r.ei,r.ri,i,r.hi,[0,r.ht,r.ht,0],s)};s(l,"transparent"),this.Et.ai&&(t.fillStyle=o,t.fillRect(r.li,r.oi,r._i-r.li,r.ui)),s("transparent",l),this.Et.ci&&(t.fillStyle=i.O,t.fillRect(r.ii?r.di-r.hi:0,r.ni,r.hi,r.fi-r.ni)),t.save(),t.translate(r.pi,(r.ni+r.fi)/2+r.vi),W(t,n,(()=>{t.fillStyle=o,t.fillText(this.Et.ti,0,0)})),t.restore()}}Kt(t,i){return this.Et.Ct?t.T+t.V+t.A:0}Qt(t,i,s,h,e,n){const r=this.Et.ai||!this.Et.mi?i.C:0,o=i.k,l=i.V+this.Jt.bi,a=i.A+this.Jt.wi,u=i.L,c=i.I,f=this.Et.ti,d=i.T,p=s.gi(t,f)*n,v=d+l+a,m=o+u+c+Math.ceil(s.Mi(t,f))+r,g=Math.max(1,Math.floor(n));let b=Math.round(v*n);b%2!=g%2&&(b+=1);const w=this.Et.Si?Math.max(1,Math.floor(o*n)):0,M=Math.round(m*n),_=Math.round(r*n),y=Math.ceil(h*n),C=Math.ceil(u*n);let E=this.Jt.yi;this.Jt.ki&&(E=this.Jt.ki),E=Math.round(E*n)-Math.floor(.5*n);const S=Math.floor(E+g/2-b/2),x=S+b,R="right"===e,F=R?y-w:w,T=y;let L,P,N=F;const V=2*n;return t.textAlign=R?"right":"left",t.textBaseline="middle",R?(N=F-M,L=F-_,P=F-_-C-1):(N=F+M,L=F+_,P=F+_+C),{ii:R,ni:S,oi:E,fi:x,ei:M,ri:b,ht:V,hi:w,si:N,li:F,_i:L,pi:P,ui:g,di:T,vi:p}}}class G{constructor(t){this.Ci={yi:0,R:"#FFF",t:"#000",wi:0,bi:0},this.xi={ti:"",Ct:!1,ai:!0,mi:!1,Ot:"",R:"#FFF",ci:!1,Si:!1},this.Ti={ti:"",Ct:!1,ai:!1,mi:!0,Ot:"",R:"#FFF",ci:!0,Si:!0},this.ft=!0,this.Di=new(t||Z)(this.xi,this.Ci),this.Pi=new(t||Z)(this.Ti,this.Ci)}ti(){return this.Ri(),this.xi.ti}yi(){return this.Ri(),this.Ci.yi}bt(){this.ft=!0}Kt(t,i){return void 0===i&&(i=!1),Math.max(this.Di.Kt(t,i),this.Pi.Kt(t,i))}Oi(){return this.Ci.ki||0}Ai(t){this.Ci.ki=t}Li(){return this.Ri(),this.xi.Ct||this.Ti.Ct}Ei(){return this.Ri(),this.xi.Ct}gt(t){return this.Ri(),this.xi.ai=this.xi.ai&&t.F().ticksVisible,this.Ti.ai=this.Ti.ai&&t.F().ticksVisible,this.Di.tt(this.xi,this.Ci),this.Pi.tt(this.Ti,this.Ci),this.Di}Ii(){return this.Ri(),this.Di.tt(this.xi,this.Ci),this.Pi.tt(this.Ti,this.Ci),this.Pi}Ri(){this.ft&&(this.xi.ai=!0,this.Ti.ai=!1,this.Vi(this.xi,this.Ti,this.Ci))}}class J extends G{constructor(t,i,s){super(),this.$t=t,this.Bi=i,this.Ni=s}Vi(t,i,s){t.Ct=!1;const h=this.$t.F().horzLine;if(!h.labelVisible)return;const e=this.Bi.xt();if(!this.$t.Ct()||this.Bi.Fi()||null===e)return;const n=y(h.labelBackgroundColor);s.t=n.t,s.R=n.i;const r=2/12*this.Bi.T();s.bi=r,s.wi=r;const o=this.Ni(this.Bi);s.yi=o.yi,t.ti=this.Bi.Wi(o._t,e),t.Ct=!0}}const H=/[1-9]/g;class tt{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,s){if(null===this.Et||!1===this.Et.Ct||0===this.Et.ti.length)return;t.font=i.D;const h=Math.round(i.zi.Mi(t,this.Et.ti,H));if(h<=0)return;t.save();const e=i.ji,n=h+2*e,r=n/2,o=this.Et.Xt;let l=this.Et.yi,a=Math.floor(l-r)+.5;a<0?(l+=Math.abs(0-a),a=Math.floor(l-r)+.5):a+n>o&&(l-=Math.abs(o-(a+n)),a=Math.floor(l-r)+.5);const u=a+n,c=Math.ceil(0+i.k+i.C+i.V+i.T+i.A);t.fillStyle=this.Et.t;const d=Math.round(a*s),p=Math.round(0*s),v=Math.round(u*s),m=Math.round(c*s),g=Math.round(2*s);if(t.beginPath(),t.moveTo(d,p),t.lineTo(d,m-g),t.arcTo(d,m,d+g,m,g),t.lineTo(v-g,m),t.arcTo(v,m,v,m-g,g),t.lineTo(v,p),t.fill(),this.Et.ai){const h=Math.round(this.Et.yi*s),e=p,n=Math.round((e+i.C)*s);t.fillStyle=this.Et.R;const r=Math.max(1,Math.floor(s)),o=Math.floor(.5*s);t.fillRect(h-o,e,r,n-e)}const b=0+i.k+i.C+i.V+i.T/2;t.textAlign="left",t.textBaseline="middle",t.fillStyle=this.Et.R;const w=i.zi.gi(t,"Apr0");t.translate((a+e)*s,(b+w)*s),W(t,s,(()=>t.fillText(f(this.Et).ti,0,0))),t.restore()}}class it{constructor(t,i,s){this.ft=!0,this.jt=new tt,this.zt={Ct:!1,t:"#4c525e",R:"white",ti:"",Xt:0,yi:NaN,ai:!0},this.vt=t,this.$i=i,this.Ni=s}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.jt.tt(this.zt),this.jt}Mt(){const t=this.zt;t.Ct=!1;const i=this.vt.F().vertLine;if(!i.labelVisible)return;const s=this.$i.yt();if(s.Fi())return;t.Xt=s.Xt();const h=this.Ni();if(!h.ot)return;t.yi=h.yi;const e=s.Hi(this.vt.St());t.ti=s.Ui(f(e)),t.Ct=!0;const n=y(i.labelBackgroundColor);t.t=n.t,t.R=n.i,t.ai=s.F().ticksVisible}}class st{constructor(){this.qi=null,this.Yi=0}Xi(){return this.Yi}Ki(t){this.Yi=t}Pt(){return this.qi}Zi(t){this.qi=t}Gi(t){return[]}Ji(){return[]}Ct(){return!0}}var ht;!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(ht||(ht={}));class et extends st{constructor(t,i){super(),this.Qi=null,this.ts=NaN,this.ss=0,this.ns=!0,this.es=new Map,this.rs=!1,this.hs=NaN,this.ls=NaN,this.os=NaN,this._s=NaN,this.$i=t,this.us=i,this.cs=new O(t,this),this.ds=((t,i)=>s=>{const h=i(),e=t();if(s===f(this.Qi).fs())return{_t:e,yi:h};{const t=f(s.xt());return{_t:s.ps(h,t),yi:h}}})((()=>this.ts),(()=>this.ls));const s=((t,i)=>()=>({ot:this.$i.yt().vs(t()),yi:i()}))((()=>this.ss),(()=>this.Zt()));this.bs=new it(this,t,s),this.ws=new q(this)}F(){return this.us}gs(t,i){this.os=t,this._s=i}Ms(){this.os=NaN,this._s=NaN}Ss(){return this.os}ys(){return this._s}ks(t,i,s){this.rs||(this.rs=!0),this.ns=!0,this.Cs(t,i,s)}St(){return this.ss}Zt(){return this.hs}Gt(){return this.ls}Ct(){return this.ns}xs(){this.ns=!1,this.Ts(),this.ts=NaN,this.hs=NaN,this.ls=NaN,this.Qi=null,this.Ms()}Ds(t){return null!==this.Qi?[this.ws,this.cs]:[]}qt(t){return t===this.Qi&&this.us.horzLine.visible}Yt(){return this.us.vertLine.visible}Ps(t,i){this.ns&&this.Qi===t||this.es.clear();const s=[];return this.Qi===t&&s.push(this.Rs(this.es,i,this.ds)),s}Ji(){return this.ns?[this.bs]:[]}Ht(){return this.Qi}Os(){this.ws.bt(),this.es.forEach((t=>t.bt())),this.bs.bt(),this.cs.bt()}As(t){return t&&!t.fs().Fi()?t.fs():null}Cs(t,i,s){this.Ls(t,i,s)&&this.Os()}Ls(t,i,s){const h=this.hs,e=this.ls,n=this.ts,r=this.ss,o=this.Qi,l=this.As(s);this.ss=t,this.hs=isNaN(t)?NaN:this.$i.yt().Lt(t),this.Qi=s;const a=null!==l?l.xt():null;return null!==l&&null!==a?(this.ts=i,this.ls=l.Dt(i,a)):(this.ts=NaN,this.ls=NaN),h!==this.hs||e!==this.ls||r!==this.ss||n!==this.ts||o!==this.Qi}Ts(){const t=this.$i.wt().map((t=>t.Is().Es())).filter(L),i=0===t.length?null:Math.max(...t);this.ss=null!==i?i:NaN}Rs(t,i,s){let h=t.get(i);return void 0===h&&(h=new J(this,i,s),t.set(i,h)),h}}function nt(t){return"left"===t||"right"===t}class rt{constructor(t){this.Vs=new Map,this.Bs=[],this.Ns=t}Fs(t,i){const s=function(t,i){return void 0===t?i:{Ws:Math.max(t.Ws,i.Ws),zs:t.zs||i.zs}}(this.Vs.get(t),i);this.Vs.set(t,s)}js(){return this.Ns}$s(t){const i=this.Vs.get(t);return void 0===i?{Ws:this.Ns}:{Ws:Math.max(this.Ns,i.Ws),zs:i.zs}}Hs(){this.Bs=[{Us:0}]}qs(t){this.Bs=[{Us:1,Rt:t}]}Ys(){this.Bs=[{Us:4}]}Xs(t){this.Bs.push({Us:2,Rt:t})}Ks(t){this.Bs.push({Us:3,Rt:t})}Zs(){return this.Bs}Gs(t){for(const i of t.Bs)this.Js(i);this.Ns=Math.max(this.Ns,t.Ns),t.Vs.forEach(((t,i)=>{this.Fs(i,t)}))}Js(t){switch(t.Us){case 0:this.Hs();break;case 1:this.qs(t.Rt);break;case 2:this.Xs(t.Rt);break;case 3:this.Ks(t.Rt);break;case 4:this.Ys()}}}function ot(t,i){if(!S(t))return"n/a";if(!x(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");return 0===i?t.toString():("0000000000000000"+t.toString()).slice(-i)}class lt{constructor(t,i){if(i||(i=1),S(t)&&x(t)||(t=100),t<0)throw new TypeError("invalid base");this.Bi=t,this.Qs=i,this.tn()}format(t){const i=t<0?"\u2212":"";return t=Math.abs(t),i+this.sn(t)}tn(){if(this.nn=0,this.Bi>0&&this.Qs>0){let t=this.Bi;for(;t>1;)t/=10,this.nn++}}sn(t){const i=this.Bi/this.Qs;let s=Math.floor(t),h="";const e=void 0!==this.nn?this.nn:NaN;if(i>1){let n=+(Math.round(t*i)-s*i).toFixed(this.nn);n>=i&&(n-=i,s+=1),h="."+ot(+n.toFixed(this.nn)*this.Qs,e)}else s=Math.round(s*i)/i,e>0&&(h="."+ot(0,e));return s.toFixed(0)+h}}class at extends lt{constructor(t){void 0===t&&(t=100),super(t)}format(t){return super.format(t)+"%"}}class ut{constructor(t){this.en=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this.rn(t):t<999995?i+this.rn(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.rn(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.rn(t/1e9)+"B")}rn(t){let i;const s=Math.pow(10,this.en);return i=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this.en).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,((t,i)=>i))}}function ct(t,i,s,h,e,n,r){if(0===i.length||h.from>=i.length)return;const o=i[h.from];let l=n(t,o),a=o;if(h.to-h.from<2){const i=e/2;t.beginPath();const s={nt:o.nt-i,et:o.et},h={nt:o.nt+i,et:o.et};return t.moveTo(s.nt,s.et),t.lineTo(h.nt,h.et),void r(t,l,s,h)}const u=(i,s)=>{r(t,l,a,s),t.beginPath(),l=i,a=s};let c=a;t.beginPath(),t.moveTo(o.nt,o.et);for(let f=h.from+1;f<h.to;++f){c=i[f];const h=n(t,c);switch(s){case 0:t.lineTo(c.nt,c.et);break;case 1:t.lineTo(c.nt,i[f-1].et),h!==l&&(u(h,c),t.lineTo(c.nt,i[f-1].et)),t.lineTo(c.nt,c.et);break;case 2:{const[s,h]=pt(i,f-1,f);t.bezierCurveTo(s.nt,s.et,h.nt,h.et,c.nt,c.et);break}}1!==s&&h!==l&&(u(h,c),t.moveTo(c.nt,c.et))}(a!==c||a===c&&1===s)&&r(t,l,a,c)}function ft(t,i){return{nt:t.nt-i.nt,et:t.et-i.et}}function dt(t,i){return{nt:t.nt/i,et:t.et/i}}function pt(t,i,s){const h=Math.max(0,i-1),e=Math.min(t.length-1,s+1);var n,r;return[(n=t[i],r=dt(ft(t[s],t[h]),6),{nt:n.nt+r.nt,et:n.et+r.et}),ft(t[s],dt(ft(t[e],t[i]),6))]}function vt(t,i,s,h,e){i.lineTo(e.nt,t),i.lineTo(h.nt,t),i.closePath(),i.fillStyle=s,i.fill()}class mt extends U{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}K(t){if(null===this.J)return;const{st:i,it:s,hn:h,Ft:e,Wt:n,ln:r,an:o}=this.J;null!==s&&(t.lineCap="butt",t.lineJoin="round",t.lineWidth=e,l(t,n),t.lineWidth=1,ct(t,i,r,s,h,this.on.bind(this),vt.bind(null,o)))}}class gt extends mt{constructor(){super(...arguments),this._n=null}on(t,i){const s=this.J,{un:h,cn:e}=i,n=s.dn;if(null!==this._n&&this._n.topColor===h&&this._n.bottomColor===e&&this._n.bottom===n)return this._n.fillStyle;const r=t.createLinearGradient(0,0,0,n);return r.addColorStop(0,h),r.addColorStop(1,e),this._n={topColor:h,bottomColor:e,fillStyle:r,bottom:n},r}}function bt(t,i){t.strokeStyle=i,t.stroke()}class wt extends U{constructor(){super(...arguments),this.J=null}tt(t){this.J=t}K(t){if(null===this.J)return;const{st:i,it:s,hn:h,ln:e,Ft:n,Wt:r}=this.J;null!==s&&(t.lineCap="butt",t.lineWidth=n,l(t,r),t.lineJoin="round",ct(t,i,e,s,h,this.fn.bind(this),bt))}}class Mt extends wt{fn(t,i){return i.lt}}function _t(t,i,s,h,e){void 0===h&&(h=0),void 0===e&&(e=t.length);let n=e-h;for(;0<n;){const e=n>>1,r=h+e;s(t[r],i)?(h=r+1,n-=e+1):n=e}return h}function yt(t,i,s,h,e){void 0===h&&(h=0),void 0===e&&(e=t.length);let n=e-h;for(;0<n;){const e=n>>1,r=h+e;s(i,t[r])?n=e:(h=r+1,n-=e+1)}return h}function Ct(t,i){return t.ot<i}function Et(t,i){return t<i.ot}function St(t,i,s){const h=i.pn(),e=i.vn(),n=_t(t,h,Ct),r=yt(t,e,Et);if(!s)return{from:n,to:r};let o=n,l=r;return n>0&&n<t.length&&t[n].ot>=h&&(o=n-1),r>0&&r<t.length&&t[r-1].ot<=e&&(l=r+1),{from:o,to:l}}class xt{constructor(t,i,s){this.mn=!0,this.bn=!0,this.wn=!0,this.gn=[],this.Mn=null,this.Sn=t,this.yn=i,this.kn=s}bt(t){this.mn=!0,"data"===t&&(this.bn=!0),"options"===t&&(this.wn=!0)}gt(t,i){return this.Sn.Ct()?(this.Cn(i,t),null===this.Mn?null:this.xn):null}Tn(){this.gn=this.gn.map((t=>Object.assign(Object.assign({},t),this.Sn.Pn().Dn(t.ot))))}Rn(){this.Mn=null}Cn(t,i){this.bn&&(this.On(),this.bn=!1),this.wn&&(this.Tn(),this.wn=!1),this.mn&&(this.An(t,i),this.mn=!1)}An(t,i){const s=this.Sn.Pt(),h=this.yn.yt();if(this.Rn(),h.Fi()||s.Fi())return;const e=h.Ln();if(null===e)return;if(0===this.Sn.Is().En())return;const n=this.Sn.xt();null!==n&&(this.Mn=St(this.gn,e,this.kn),this.In(s,h,n.Rt),this.Vn(t,i))}}class Rt extends xt{constructor(t,i){super(t,i,!0)}In(t,i,s){i.Bn(this.gn,P(this.Mn)),t.Nn(this.gn,s,P(this.Mn))}Fn(t,i){return{ot:t,_t:i,nt:NaN,et:NaN}}On(){const t=this.Sn.Pn();this.gn=this.Sn.Is().Wn().map((i=>{const s=i.Rt[3];return this.zn(i.jn,s,t)}))}}class Ft extends Rt{constructor(t,i){super(t,i),this.xn=new k,this.$n=new gt,this.Hn=new Mt,this.xn.Y([this.$n,this.Hn])}zn(t,i,s){return Object.assign(Object.assign({},this.Fn(t,i)),s.Dn(t))}Vn(t,i){const s=this.Sn.F();this.$n.tt({ln:s.lineType,st:this.gn,Wt:s.lineStyle,Ft:s.lineWidth,an:i,dn:i,it:this.Mn,hn:this.yn.yt().Un()}),this.Hn.tt({ln:s.lineType,st:this.gn,Wt:s.lineStyle,Ft:s.lineWidth,it:this.Mn,hn:this.yn.yt().Un()})}}class Tt{constructor(){this.Et=null,this.qn=0,this.Yn=0}tt(t){this.Et=t}X(t,i,s,h){if(null===this.Et||0===this.Et.Is.length||null===this.Et.it)return;this.qn=this.Xn(i),this.qn>=2&&Math.max(1,Math.floor(i))%2!=this.qn%2&&this.qn--,this.Yn=this.Et.Kn?Math.min(this.qn,Math.floor(i)):this.qn;let e=null;const n=this.Yn<=this.qn&&this.Et.Un>=Math.floor(1.5*i);for(let r=this.Et.it.from;r<this.Et.it.to;++r){const s=this.Et.Is[r];e!==s.Zn&&(t.fillStyle=s.Zn,e=s.Zn);const h=Math.floor(.5*this.Yn),o=Math.round(s.nt*i),l=o-h,a=this.Yn,u=l+a-1,c=Math.min(s.Gn,s.Jn),f=Math.max(s.Gn,s.Jn),d=Math.round(c*i)-h,p=Math.round(f*i)+h,v=Math.max(p-d,this.Yn);t.fillRect(l,d,a,v);const m=Math.ceil(1.5*this.qn);if(n){if(this.Et.Qn){const e=o-m;let n=Math.max(d,Math.round(s.te*i)-h),r=n+a-1;r>d+v-1&&(r=d+v-1,n=r-a+1),t.fillRect(e,n,l-e,r-n+1)}const e=o+m;let n=Math.max(d,Math.round(s.ie*i)-h),r=n+a-1;r>d+v-1&&(r=d+v-1,n=r-a+1),t.fillRect(u+1,n,e-u,r-n+1)}}}Xn(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(f(this.Et).Un,t)))}}class Lt extends xt{constructor(t,i){super(t,i,!1)}In(t,i,s){i.Bn(this.gn,P(this.Mn)),t.se(this.gn,s,P(this.Mn))}ne(t,i,s){return{ot:t,ee:i.Rt[0],re:i.Rt[1],he:i.Rt[2],le:i.Rt[3],nt:NaN,te:NaN,Gn:NaN,Jn:NaN,ie:NaN}}On(){const t=this.Sn.Pn();this.gn=this.Sn.Is().Wn().map((i=>this.zn(i.jn,i,t)))}}class Pt extends Lt{constructor(){super(...arguments),this.xn=new Tt}zn(t,i,s){return Object.assign(Object.assign({},this.ne(t,i,s)),s.Dn(t))}Vn(){const t=this.Sn.F();this.xn.tt({Is:this.gn,Un:this.yn.yt().Un(),Qn:t.openVisible,Kn:t.thinBars,it:this.Mn})}}function Nt(t,i,s){return Math.min(Math.max(t,i),s)}function Vt(t,i,s){return i-t<=s}function Bt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function kt(t){const i=Math.ceil(t);return i%2==0?i-1:i}class Ut extends mt{constructor(){super(...arguments),this._n=null}on(t,i){const s=this.J,{ae:h,oe:e,_e:n,ue:r}=i,{an:o,dn:l}=s;if(null!==this._n&&this._n.topFillColor1===h&&this._n.topFillColor2===e&&this._n.bottomFillColor1===n&&this._n.bottomFillColor2===r&&this._n.baseLevelCoordinate===o&&this._n.bottom===l)return this._n.fillStyle;const a=t.createLinearGradient(0,0,0,l),u=Nt(o/l,0,1);return a.addColorStop(0,h),a.addColorStop(u,e),a.addColorStop(u,n),a.addColorStop(1,r),this._n={topFillColor1:h,topFillColor2:e,bottomFillColor1:n,bottomFillColor2:r,fillStyle:a,baseLevelCoordinate:o,bottom:l},a}}class It extends wt{constructor(){super(...arguments),this.ce=null}fn(t,i){const s=this.J,{de:h,fe:e}=i,{an:n,dn:r}=s;if(null!==this.ce&&this.ce.topLineColor===h&&this.ce.bottomLineColor===e&&this.ce.baseLevelCoordinate===n&&this.ce.bottom===r)return this.ce.strokeStyle;const o=t.createLinearGradient(0,0,0,r),l=Nt(n/r,0,1);return o.addColorStop(0,h),o.addColorStop(l,h),o.addColorStop(l,e),o.addColorStop(1,e),this.ce={topLineColor:h,bottomLineColor:e,strokeStyle:o,baseLevelCoordinate:n,bottom:r},o}}class Dt extends Rt{constructor(t,i){super(t,i),this.xn=new k,this.pe=new Ut,this.ve=new It,this.xn.Y([this.pe,this.ve])}zn(t,i,s){return Object.assign(Object.assign({},this.Fn(t,i)),s.Dn(t))}Vn(t,i){const s=this.Sn.xt();if(null===s)return;const h=this.Sn.F(),e=this.Sn.Pt().Dt(h.baseValue.price,s.Rt),n=this.yn.yt().Un();this.pe.tt({st:this.gn,Ft:h.lineWidth,Wt:h.lineStyle,ln:h.lineType,an:e,dn:i,it:this.Mn,hn:n}),this.ve.tt({st:this.gn,Ft:h.lineWidth,Wt:h.lineStyle,ln:h.lineType,an:e,dn:i,it:this.Mn,hn:n})}}class zt{constructor(){this.Et=null,this.qn=0}tt(t){this.Et=t}X(t,i,s,h){if(null===this.Et||0===this.Et.Is.length||null===this.Et.it)return;this.qn=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const s=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),h=Math.floor(t*s*i),e=Math.floor(t*i),n=Math.min(h,e);return Math.max(Math.floor(i),n)}(this.Et.Un,i),this.qn>=2&&Math.floor(i)%2!=this.qn%2&&this.qn--;const e=this.Et.Is;this.Et.me&&this.be(t,e,this.Et.it,i),this.Et.ci&&this.we(t,e,this.Et.it,this.Et.Un,i);const n=this.ge(i);(!this.Et.ci||this.qn>2*n)&&this.Me(t,e,this.Et.it,i)}be(t,i,s,h){if(null===this.Et)return;let e="",n=Math.min(Math.floor(h),Math.floor(this.Et.Un*h));n=Math.max(Math.floor(h),Math.min(n,this.qn));const r=Math.floor(.5*n);let o=null;for(let l=s.from;l<s.to;l++){const s=i[l];s.Se!==e&&(t.fillStyle=s.Se,e=s.Se);const a=Math.round(Math.min(s.te,s.ie)*h),u=Math.round(Math.max(s.te,s.ie)*h),c=Math.round(s.Gn*h),f=Math.round(s.Jn*h);let d=Math.round(h*s.nt)-r;const p=d+n-1;null!==o&&(d=Math.max(o+1,d),d=Math.min(d,p));const v=p-d+1;t.fillRect(d,c,v,a-c),t.fillRect(d,u+1,v,f-u),o=p}}ge(t){let i=Math.floor(1*t);this.qn<=2*i&&(i=Math.floor(.5*(this.qn-1)));const s=Math.max(Math.floor(t),i);return this.qn<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}we(t,i,s,h,e){if(null===this.Et)return;let n="";const r=this.ge(e);let o=null;for(let l=s.from;l<s.to;l++){const s=i[l];s.ye!==n&&(t.fillStyle=s.ye,n=s.ye);let h=Math.round(s.nt*e)-Math.floor(.5*this.qn);const a=h+this.qn-1,u=Math.round(Math.min(s.te,s.ie)*e),c=Math.round(Math.max(s.te,s.ie)*e);if(null!==o&&(h=Math.max(o+1,h),h=Math.min(h,a)),this.Et.Un*e>2*r)$(t,h,u,a-h+1,c-u+1,r);else{const i=a-h+1;t.fillRect(h,u,i,c-u+1)}o=a}}Me(t,i,s,h){if(null===this.Et)return;let e="";const n=this.ge(h);for(let r=s.from;r<s.to;r++){const s=i[r];let o=Math.round(Math.min(s.te,s.ie)*h),l=Math.round(Math.max(s.te,s.ie)*h),a=Math.round(s.nt*h)-Math.floor(.5*this.qn),u=a+this.qn-1;if(s.Zn!==e){const i=s.Zn;t.fillStyle=i,e=i}this.Et.ci&&(a+=n,o+=n,u-=n,l-=n),o>l||t.fillRect(a,o,u-a+1,l-o+1)}}}class Ot extends Lt{constructor(){super(...arguments),this.xn=new zt}zn(t,i,s){return Object.assign(Object.assign({},this.ne(t,i,s)),s.Dn(t))}Vn(){const t=this.Sn.F();this.xn.tt({Is:this.gn,Un:this.yn.yt().Un(),me:t.wickVisible,ci:t.borderVisible,it:this.Mn})}}class jt{constructor(){this.Et=null,this.ke=[]}tt(t){this.Et=t,this.ke=[]}X(t,i,s,h){if(null===this.Et||0===this.Et.st.length||null===this.Et.it)return;this.ke.length||this.Ce(i);const e=Math.max(1,Math.floor(i)),n=Math.round(this.Et.xe*i)-Math.floor(e/2),r=n+e;for(let o=this.Et.it.from;o<this.Et.it.to;o++){const s=this.Et.st[o],h=this.ke[o-this.Et.it.from],l=Math.round(s.et*i);let a,u;t.fillStyle=s.Zn,l<=n?(a=l,u=r):(a=n,u=l-Math.floor(e/2)+e),t.fillRect(h.pn,a,h.vn-h.pn+1,u-a)}}Ce(t){if(null===this.Et||0===this.Et.st.length||null===this.Et.it)return void(this.ke=[]);const i=Math.ceil(this.Et.Un*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.Et.Un*t)-i;this.ke=new Array(this.Et.it.to-this.Et.it.from);for(let e=this.Et.it.from;e<this.Et.it.to;e++){const i=this.Et.st[e],h=Math.round(i.nt*t);let n,r;if(s%2){const t=(s-1)/2;n=h-t,r=h+t}else{const t=s/2;n=h-t,r=h+t-1}this.ke[e-this.Et.it.from]={pn:n,vn:r,Te:h,De:i.nt*t,ot:i.ot}}for(let e=this.Et.it.from+1;e<this.Et.it.to;e++){const t=this.ke[e-this.Et.it.from],s=this.ke[e-this.Et.it.from-1];t.ot===s.ot+1&&t.pn-s.vn!==i+1&&(s.Te>s.De?s.vn=t.pn-i-1:t.pn=s.vn+i+1)}let h=Math.ceil(this.Et.Un*t);for(let e=this.Et.it.from;e<this.Et.it.to;e++){const t=this.ke[e-this.Et.it.from];t.vn<t.pn&&(t.vn=t.pn);const i=t.vn-t.pn+1;h=Math.min(i,h)}if(i>0&&h<4)for(let e=this.Et.it.from;e<this.Et.it.to;e++){const t=this.ke[e-this.Et.it.from];t.vn-t.pn+1>h&&(t.Te>t.De?t.vn-=1:t.pn+=1)}}}class qt extends Rt{constructor(){super(...arguments),this.xn=new jt}zn(t,i,s){return Object.assign(Object.assign({},this.Fn(t,i)),s.Dn(t))}Vn(){const t={st:this.gn,Un:this.yn.yt().Un(),it:this.Mn,xe:this.Sn.Pt().Dt(this.Sn.F().base,f(this.Sn.xt()).Rt)};this.xn.tt(t)}}class $t extends Rt{constructor(){super(...arguments),this.xn=new Mt}zn(t,i,s){return Object.assign(Object.assign({},this.Fn(t,i)),s.Dn(t))}Vn(){const t=this.Sn.F(),i={st:this.gn,Wt:t.lineStyle,ln:t.lineType,Ft:t.lineWidth,it:this.Mn,hn:this.yn.yt().Un()};this.xn.tt(i)}}const Wt=/[2-9]/g;class At{constructor(t){void 0===t&&(t=50),this.Pe=0,this.Re=1,this.Oe=1,this.Ae={},this.Le=new Map,this.Ee=t}Ie(){this.Pe=0,this.Le.clear(),this.Re=1,this.Oe=1,this.Ae={}}Mi(t,i,s){return this.Ve(t,i,s).width}gi(t,i,s){const h=this.Ve(t,i,s);return((h.actualBoundingBoxAscent||0)-(h.actualBoundingBoxDescent||0))/2}Ve(t,i,s){const h=s||Wt,e=String(i).replace(h,"0");if(this.Le.has(e))return c(this.Le.get(e)).Be;if(this.Pe===this.Ee){const t=this.Ae[this.Oe];delete this.Ae[this.Oe],this.Le.delete(t),this.Oe++,this.Pe--}t.save(),t.textBaseline="middle";const n=t.measureText(e);return t.restore(),0===n.width&&i.length||(this.Le.set(e,{Be:n,Ne:this.Re}),this.Ae[this.Re]=e,this.Pe++,this.Re++),n}}class Yt{constructor(t){this.Fe=null,this.S=null,this.We="right",this.ze=0,this.je=t}$e(t,i,s,h){this.Fe=t,this.S=i,this.ze=s,this.We=h}X(t,i){null!==this.S&&null!==this.Fe&&this.Fe.X(t,this.S,this.je,this.ze,this.We,i)}}class Xt{constructor(t,i,s){this.He=t,this.je=new At(50),this.Ue=i,this.N=s,this.W=-1,this.jt=new Yt(this.je)}gt(t,i){const s=this.N.qe(this.Ue);if(null===s)return null;const h=s.Ye(this.Ue)?s.Xe():this.Ue.Pt();if(null===h)return null;const e=s.Ke(h);if("overlay"===e)return null;const n=this.N.Ze();return n.T!==this.W&&(this.W=n.T,this.je.Ie()),this.jt.$e(this.He.Ii(),n,i,e),this.jt}}class Kt{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,s,h){if(null===this.Et)return;if(!1===this.Et.Ct)return;const e=Math.round(this.Et.et*i);if(e<0||e>Math.ceil(this.Et.Kt*i))return;const n=Math.ceil(this.Et.Xt*i);t.lineCap="butt",t.strokeStyle=this.Et.R,t.lineWidth=Math.floor(this.Et.Ft*i),l(t,this.Et.Wt),a(t,e,0,n)}}class Qt{constructor(t){this.Ge={Xt:0,Kt:0,et:0,R:"rgba(0, 0, 0, 0)",Ft:1,Wt:0,Ct:!1},this.Je=new Kt,this.ft=!0,this.Sn=t,this.yn=t.Ut(),this.Je.tt(this.Ge)}bt(){this.ft=!0}gt(t,i){return this.Sn.Ct()?(this.ft&&(this.Qe(t,i),this.ft=!1),this.Je):null}}class Zt extends Qt{constructor(t){super(t)}Qe(t,i){this.Ge.Ct=!1;const s=this.Sn.Pt(),h=s.tr().tr;if(2!==h&&3!==h)return;const e=this.Sn.F();if(!e.baseLineVisible||!this.Sn.Ct())return;const n=this.Sn.xt();null!==n&&(this.Ge.Ct=!0,this.Ge.et=s.Dt(n.Rt,n.Rt),this.Ge.Xt=i,this.Ge.Kt=t,this.Ge.R=e.baseLineColor,this.Ge.Ft=e.baseLineWidth,this.Ge.Wt=e.baseLineStyle)}}class Gt{constructor(){this.Et=null}tt(t){this.Et=t}ir(){return this.Et}X(t,i,s,h){const e=this.Et;if(null===e)return;t.save();const n=Math.max(1,Math.floor(i)),r=n%2/2,o=Math.round(e.De.x*i)+r,l=e.De.y*i;t.fillStyle=e.sr,t.beginPath();const a=Math.max(2,1.5*e.nr)*i;t.arc(o,l,a,0,2*Math.PI,!1),t.fill(),t.fillStyle=e.er,t.beginPath(),t.arc(o,l,e.ht*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=n,t.strokeStyle=e.rr,t.beginPath(),t.arc(o,l,e.ht*i+n/2,0,2*Math.PI,!1),t.stroke(),t.restore()}}const Jt=[{hr:0,lr:.25,ar:4,_r:10,ur:.25,cr:0,dr:.4,pr:.8},{hr:.25,lr:.525,ar:10,_r:14,ur:0,cr:0,dr:.8,pr:0},{hr:.525,lr:1,ar:14,_r:14,ur:0,cr:0,dr:0,pr:0}];function Ht(t,i,s,h){return function(t,i){if("transparent"===t)return t;const s=_(t),h=s[3];return"rgba("+s[0]+", "+s[1]+", "+s[2]+", "+i*h+")"}(t,s+(h-s)*i)}function ti(t,i){const s=t%2600/2600;let h;for(const l of Jt)if(s>=l.hr&&s<=l.lr){h=l;break}u(void 0!==h,"Last price animation internal logic error");const e=(s-h.hr)/(h.lr-h.hr);return{er:Ht(i,e,h.ur,h.cr),rr:Ht(i,e,h.dr,h.pr),ht:(n=e,r=h.ar,o=h._r,r+(o-r)*n)};var n,r,o}class ii{constructor(t){this.jt=new Gt,this.ft=!0,this.vr=!0,this.mr=performance.now(),this.br=this.mr-1,this.wr=t}gr(){this.br=this.mr-1,this.bt()}Mr(){if(this.bt(),2===this.wr.F().lastPriceAnimation){const t=performance.now(),i=this.br-t;if(i>0)return void(i<650&&(this.br+=2600));this.mr=t,this.br=t+2600}}bt(){this.ft=!0}Sr(){this.vr=!0}Ct(){return 0!==this.wr.F().lastPriceAnimation}yr(){switch(this.wr.F().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.br}}gt(t,i){return this.ft?(this.Mt(t,i),this.ft=!1,this.vr=!1):this.vr&&(this.kr(),this.vr=!1),this.jt}Mt(t,i){this.jt.tt(null);const s=this.wr.Ut().yt(),h=s.Ln(),e=this.wr.xt();if(null===h||null===e)return;const n=this.wr.Cr(!0);if(n.Tr||!h.Dr(n.jn))return;const r={x:s.Lt(n.jn),y:this.wr.Pt().Dt(n._t,e.Rt)},o=n.R,l=this.wr.F().lineWidth,a=ti(this.Pr(),o);this.jt.tt({sr:o,nr:l,er:a.er,rr:a.rr,ht:a.ht,De:r})}kr(){const t=this.jt.ir();if(null!==t){const i=ti(this.Pr(),t.sr);t.er=i.er,t.rr=i.rr,t.ht=i.ht}}Pr(){return this.yr()?performance.now()-this.mr:2599}}function si(t,i){return kt(Math.min(Math.max(t,12),30)*i)}function hi(t,i){switch(t){case"arrowDown":case"arrowUp":return si(i,1);case"circle":return si(i,.8);case"square":return si(i,.7)}}function ei(t){return function(t){const i=Math.ceil(t);return i%2!=0?i-1:i}(si(t,1))}function ni(t){return Math.max(si(t,.1),3)}function ri(t,i,s,h,e){const n=hi("square",s),r=(n-1)/2,o=t-r,l=i-r;return h>=o&&h<=o+n&&e>=l&&e<=l+n}function oi(t,i,s,h,e){const n=(hi("arrowUp",e)-1)/2,r=(kt(e/2)-1)/2;i.beginPath(),t?(i.moveTo(s-n,h),i.lineTo(s,h-n),i.lineTo(s+n,h),i.lineTo(s+r,h),i.lineTo(s+r,h+n),i.lineTo(s-r,h+n),i.lineTo(s-r,h)):(i.moveTo(s-n,h),i.lineTo(s,h+n),i.lineTo(s+n,h),i.lineTo(s+r,h),i.lineTo(s+r,h-n),i.lineTo(s-r,h-n),i.lineTo(s-r,h)),i.fill()}class li extends U{constructor(){super(...arguments),this.Et=null,this.je=new At,this.W=-1,this.j="",this.Rr=""}tt(t){this.Et=t}$e(t,i){this.W===t&&this.j===i||(this.W=t,this.j=i,this.Rr=V(t,i),this.je.Ie())}Or(t,i){if(null===this.Et||null===this.Et.it)return null;for(let s=this.Et.it.from;s<this.Et.it.to;s++){const h=this.Et.st[s];if(ui(h,t,i))return{Ar:h.Lr,Er:h.Er}}return null}K(t,i,s){if(null!==this.Et&&null!==this.Et.it){t.textBaseline="middle",t.font=this.Rr;for(let i=this.Et.it.from;i<this.Et.it.to;i++){const s=this.Et.st[i];void 0!==s.ti&&(s.ti.Xt=this.je.Mi(t,s.ti.Ir),s.ti.Kt=this.W),ai(s,t)}}}}function ai(t,i){i.fillStyle=t.R,void 0!==t.ti&&function(t,i,s,h){t.fillText(i,s,h)}(i,t.ti.Ir,t.nt-t.ti.Xt/2,t.ti.et),function(t,i){if(0!==t.En){switch(t.Vr){case"arrowDown":return void oi(!1,i,t.nt,t.et,t.En);case"arrowUp":return void oi(!0,i,t.nt,t.et,t.En);case"circle":return void function(t,i,s,h){const e=(hi("circle",h)-1)/2;t.beginPath(),t.arc(i,s,e,0,2*Math.PI,!1),t.fill()}(i,t.nt,t.et,t.En);case"square":return void function(t,i,s,h){const e=hi("square",h),n=(e-1)/2,r=i-n,o=s-n;t.fillRect(r,o,e,e)}(i,t.nt,t.et,t.En)}t.Vr}}(t,i)}function ui(t,i,s){return!(void 0===t.ti||!function(t,i,s,h,e,n){const r=h/2;return e>=t&&e<=t+s&&n>=i-r&&n<=i+r}(t.nt,t.ti.et,t.ti.Xt,t.ti.Kt,i,s))||function(t,i,s){if(0===t.En)return!1;switch(t.Vr){case"arrowDown":case"arrowUp":return function(t,i,s,h,e,n){return ri(i,s,h,e,n)}(0,t.nt,t.et,t.En,i,s);case"circle":return function(t,i,s,h,e){const n=2+hi("circle",s)/2,r=t-h,o=i-e;return Math.sqrt(r*r+o*o)<=n}(t.nt,t.et,t.En,i,s);case"square":return ri(t.nt,t.et,t.En,i,s)}}(t,i,s)}function ci(t,i,s,h,e,n,r,o,l){const a=S(s)?s:s.le,u=S(s)?s:s.re,c=S(s)?s:s.he,f=S(i.size)?Math.max(i.size,0):1,d=ei(o.Un())*f,p=d/2;switch(t.En=d,i.position){case"inBar":return t.et=r.Dt(a,l),void(void 0!==t.ti&&(t.ti.et=t.et+p+n+.6*e));case"aboveBar":return t.et=r.Dt(u,l)-p-h.Br,void 0!==t.ti&&(t.ti.et=t.et-p-.6*e,h.Br+=1.2*e),void(h.Br+=d+n);case"belowBar":return t.et=r.Dt(c,l)+p+h.Nr,void 0!==t.ti&&(t.ti.et=t.et+p+n+.6*e,h.Nr+=1.2*e),void(h.Nr+=d+n)}i.position}class fi{constructor(t,i){this.ft=!0,this.Fr=!0,this.Wr=!0,this.zr=null,this.jt=new li,this.wr=t,this.$i=i,this.Et={st:[],it:null}}bt(t){this.ft=!0,this.Wr=!0,"data"===t&&(this.Fr=!0)}gt(t,i,s){if(!this.wr.Ct())return null;this.ft&&this.jr();const h=this.$i.F().layout;return this.jt.$e(h.fontSize,h.fontFamily),this.jt.tt(this.Et),this.jt}$r(){if(this.Wr){if(this.wr.Hr().length>0){const t=this.$i.yt().Un(),i=ni(t),s=1.5*ei(t)+2*i;this.zr={above:s,below:s}}else this.zr=null;this.Wr=!1}return this.zr}jr(){const t=this.wr.Pt(),i=this.$i.yt(),s=this.wr.Hr();this.Fr&&(this.Et.st=s.map((t=>({ot:t.time,nt:0,et:0,En:0,Vr:t.shape,R:t.color,Lr:t.internalId,Er:t.id,ti:void 0}))),this.Fr=!1);const h=this.$i.F().layout;this.Et.it=null;const e=i.Ln();if(null===e)return;const n=this.wr.xt();if(null===n)return;if(0===this.Et.st.length)return;let r=NaN;const o=ni(i.Un()),l={Br:o,Nr:o};this.Et.it=St(this.Et.st,e,!0);for(let a=this.Et.it.from;a<this.Et.it.to;a++){const e=s[a];e.time!==r&&(l.Br=o,l.Nr=o,r=e.time);const u=this.Et.st[a];u.nt=i.Lt(e.time),void 0!==e.text&&e.text.length>0&&(u.ti={Ir:e.text,et:0,Xt:0,Kt:0});const c=this.wr.Ur(e.time);null!==c&&ci(u,e,c,l,h.fontSize,o,t,i,n.Rt)}this.ft=!1}}class di extends Qt{constructor(t){super(t)}Qe(t,i){const s=this.Ge;s.Ct=!1;const h=this.Sn.F();if(!h.priceLineVisible||!this.Sn.Ct())return;const e=this.Sn.Cr(0===h.priceLineSource);e.Tr||(s.Ct=!0,s.et=e.yi,s.R=this.Sn.qr(e.R),s.Xt=i,s.Kt=t,s.Ft=h.priceLineWidth,s.Wt=h.priceLineStyle)}}class pi extends G{constructor(t){super(),this.$t=t}Vi(t,i,s){t.Ct=!1,i.Ct=!1;const h=this.$t;if(!h.Ct())return;const e=h.F(),n=e.lastValueVisible,r=""!==h.Yr(),o=0===e.seriesLastValueMode,l=h.Cr(!1);if(l.Tr)return;n&&(t.ti=this.Xr(l,n,o),t.Ct=0!==t.ti.length),(r||o)&&(i.ti=this.Kr(l,n,r,o),i.Ct=i.ti.length>0);const a=h.qr(l.R),u=y(a);s.t=u.t,s.R=u.i,s.yi=l.yi,i.Ot=h.Ut().At(l.yi/h.Pt().Kt()),t.Ot=a,t.R=s.R,i.R=s.R}Kr(t,i,s,h){let e="";const n=this.$t.Yr();return s&&0!==n.length&&(e+=n+" "),i&&h&&(e+=this.$t.Pt().Zr()?t.Gr:t.Jr),e.trim()}Xr(t,i,s){return i?s?this.$t.Pt().Zr()?t.Jr:t.Gr:t.ti:""}}class vi{constructor(t,i){this.Qr=t,this.th=i}ih(t){return null!==t&&this.Qr===t.Qr&&this.th===t.th}sh(){return new vi(this.Qr,this.th)}nh(){return this.Qr}eh(){return this.th}rh(){return this.th-this.Qr}Fi(){return this.th===this.Qr||Number.isNaN(this.th)||Number.isNaN(this.Qr)}Gs(t){return null===t?this:new vi(Math.min(this.nh(),t.nh()),Math.max(this.eh(),t.eh()))}hh(t){if(!S(t))return;if(0==this.th-this.Qr)return;const i=.5*(this.th+this.Qr);let s=this.th-i,h=this.Qr-i;s*=t,h*=t,this.th=i+s,this.Qr=i+h}lh(t){S(t)&&(this.th+=t,this.Qr+=t)}ah(){return{minValue:this.Qr,maxValue:this.th}}static oh(t){return null===t?null:new vi(t.minValue,t.maxValue)}}class mi{constructor(t,i){this._h=t,this.uh=i||null}dh(){return this._h}fh(){return this.uh}ah(){return null===this._h?null:{priceRange:this._h.ah(),margins:this.uh||void 0}}static oh(t){return null===t?null:new mi(vi.oh(t.priceRange),t.margins)}}class gi extends Qt{constructor(t,i){super(t),this.ph=i}Qe(t,i){const s=this.Ge;s.Ct=!1;const h=this.ph.F();if(!this.Sn.Ct()||!h.lineVisible)return;const e=this.ph.mh();null!==e&&(s.Ct=!0,s.et=e,s.R=h.color,s.Xt=i,s.Kt=t,s.Ft=h.lineWidth,s.Wt=h.lineStyle)}}class bi extends G{constructor(t,i){super(),this.wr=t,this.ph=i}Vi(t,i,s){t.Ct=!1,i.Ct=!1;const h=this.ph.F(),e=h.axisLabelVisible,n=""!==h.title,r=this.wr;if(!e||!r.Ct())return;const o=this.ph.mh();if(null===o)return;n&&(i.ti=h.title,i.Ct=!0),i.Ot=r.Ut().At(o/r.Pt().Kt()),t.ti=this.bh(h.price),t.Ct=!0;const l=y(h.color);s.t=l.t,s.R=l.i,s.yi=o}bh(t){const i=this.wr.xt();return null===i?"":this.wr.Pt().Wi(t,i.Rt)}}class wi{constructor(t,i){this.wr=t,this.us=i,this.wh=new gi(t,this),this.He=new bi(t,this),this.gh=new Xt(this.He,t,t.Ut())}Mh(t){E(this.us,t),this.bt(),this.wr.Ut().Sh()}F(){return this.us}yh(){return this.wh}kh(){return this.gh}Ch(){return this.He}bt(){this.wh.bt(),this.He.bt()}mh(){const t=this.wr,i=t.Pt();if(t.Ut().yt().Fi()||i.Fi())return null;const s=t.xt();return null===s?null:i.Dt(this.us.price,s.Rt)}}class Mi extends st{constructor(t){super(),this.$i=t}Ut(){return this.$i}}const _i={Bar:(t,i,s,h)=>{var e;const n=i.upColor,r=i.downColor,o=f(t(s,h)),l=d(o.Rt[0])<=d(o.Rt[3]);return{Zn:null!==(e=o.R)&&void 0!==e?e:l?n:r}},Candlestick:(t,i,s,h)=>{var e,n,r;const o=i.upColor,l=i.downColor,a=i.borderUpColor,u=i.borderDownColor,c=i.wickUpColor,p=i.wickDownColor,v=f(t(s,h)),m=d(v.Rt[0])<=d(v.Rt[3]);return{Zn:null!==(e=v.R)&&void 0!==e?e:m?o:l,ye:null!==(n=v.Ot)&&void 0!==n?n:m?a:u,Se:null!==(r=v.xh)&&void 0!==r?r:m?c:p}},Area:(t,i,s,h)=>{var e,n,r,o;const l=f(t(s,h));return{Zn:null!==(e=l.lt)&&void 0!==e?e:i.lineColor,lt:null!==(n=l.lt)&&void 0!==n?n:i.lineColor,un:null!==(r=l.un)&&void 0!==r?r:i.topColor,cn:null!==(o=l.cn)&&void 0!==o?o:i.bottomColor}},Baseline:(t,i,s,h)=>{var e,n,r,o,l,a;const u=f(t(s,h));return{Zn:u.Rt[3]>=i.baseValue.price?i.topLineColor:i.bottomLineColor,de:null!==(e=u.de)&&void 0!==e?e:i.topLineColor,fe:null!==(n=u.fe)&&void 0!==n?n:i.bottomLineColor,ae:null!==(r=u.ae)&&void 0!==r?r:i.topFillColor1,oe:null!==(o=u.oe)&&void 0!==o?o:i.topFillColor2,_e:null!==(l=u._e)&&void 0!==l?l:i.bottomFillColor1,ue:null!==(a=u.ue)&&void 0!==a?a:i.bottomFillColor2}},Line:(t,i,s,h)=>{var e,n;const r=f(t(s,h));return{Zn:null!==(e=r.R)&&void 0!==e?e:i.color,lt:null!==(n=r.R)&&void 0!==n?n:i.color}},Histogram:(t,i,s,h)=>{var e;return{Zn:null!==(e=f(t(s,h)).R)&&void 0!==e?e:i.color}}};class yi{constructor(t){this.Th=(t,i)=>void 0!==i?i.Rt:this.wr.Is().Dh(t),this.wr=t,this.Ph=_i[t.Rh()]}Dn(t,i){return this.Ph(this.Th,this.wr.F(),t,i)}}var Ci;!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.None=0]="None",t[t.NearestRight=1]="NearestRight"}(Ci||(Ci={}));class Ei{constructor(){this.Oh=[],this.Ah=new Map,this.Lh=new Map}Eh(){return this.En()>0?this.Oh[this.Oh.length-1]:null}Ih(){return this.En()>0?this.Vh(0):null}Es(){return this.En()>0?this.Vh(this.Oh.length-1):null}En(){return this.Oh.length}Fi(){return 0===this.En()}Dr(t){return null!==this.Bh(t,0)}Dh(t){return this.Nh(t)}Nh(t,i){void 0===i&&(i=0);const s=this.Bh(t,i);return null===s?null:Object.assign(Object.assign({},this.Fh(s)),{jn:this.Vh(s)})}Wn(){return this.Oh}Wh(t,i,s){if(this.Fi())return null;let h=null;for(const e of s)h=Si(h,this.zh(t,i,e));return h}tt(t){this.Lh.clear(),this.Ah.clear(),this.Oh=t}Vh(t){return this.Oh[t].jn}Fh(t){return this.Oh[t]}Bh(t,i){const s=this.jh(t);if(null===s&&0!==i)switch(i){case-1:return this.$h(t);case 1:return this.Hh(t);default:throw new TypeError("Unknown search mode")}return s}$h(t){let i=this.Uh(t);return i>0&&(i-=1),i!==this.Oh.length&&this.Vh(i)<t?i:null}Hh(t){const i=this.qh(t);return i!==this.Oh.length&&t<this.Vh(i)?i:null}jh(t){const i=this.Uh(t);return i===this.Oh.length||t<this.Oh[i].jn?null:i}Uh(t){return _t(this.Oh,t,((t,i)=>t.jn<i))}qh(t){return yt(this.Oh,t,((t,i)=>i.jn>t))}Yh(t,i,s){let h=null;for(let e=t;e<i;e++){const t=this.Oh[e].Rt[s];Number.isNaN(t)||(null===h?h={Xh:t,Kh:t}:(t<h.Xh&&(h.Xh=t),t>h.Kh&&(h.Kh=t)))}return h}zh(t,i,s){if(this.Fi())return null;let h=null;const e=f(this.Ih()),n=f(this.Es()),r=Math.max(t,e),o=Math.min(i,n),l=30*Math.ceil(r/30),a=Math.max(l,30*Math.floor(o/30));{const t=this.Uh(r),e=this.qh(Math.min(o,l,i));h=Si(h,this.Yh(t,e,s))}let u=this.Ah.get(s);void 0===u&&(u=new Map,this.Ah.set(s,u));for(let c=Math.max(l+1,r);c<a;c+=30){const t=Math.floor(c/30);let i=u.get(t);if(void 0===i){const h=this.Uh(30*t),e=this.qh(30*(t+1)-1);i=this.Yh(h,e,s),u.set(t,i)}h=Si(h,i)}{const t=this.Uh(a),i=this.qh(o);h=Si(h,this.Yh(t,i,s))}return h}}function Si(t,i){return null===t?i:null===i?t:{Xh:Math.min(t.Xh,i.Xh),Kh:Math.max(t.Kh,i.Kh)}}class xi extends Mi{constructor(t,i,s){super(t),this.Et=new Ei,this.wh=new di(this),this.Zh=[],this.Gh=new Zt(this),this.Jh=null,this.Qh=null,this.tl=[],this.il=[],this.sl=null,this.us=i,this.nl=s;const h=new pi(this);this.es=[h],this.gh=new Xt(h,this,t),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(this.Jh=new ii(this)),this.el(),this.rl()}M(){null!==this.sl&&clearTimeout(this.sl)}qr(t){return this.us.priceLineColor||t}Cr(t){const i={Tr:!0},s=this.Pt();if(this.Ut().yt().Fi()||s.Fi()||this.Et.Fi())return i;const h=this.Ut().yt().Ln(),e=this.xt();if(null===h||null===e)return i;let n,r;if(t){const t=this.Et.Eh();if(null===t)return i;n=t,r=t.jn}else{const t=this.Et.Nh(h.vn(),-1);if(null===t)return i;if(n=this.Et.Dh(t.jn),null===n)return i;r=t.jn}const o=n.Rt[3],l=this.Pn().Dn(r,{Rt:n}),a=s.Dt(o,e.Rt);return{Tr:!1,_t:o,ti:s.Wi(o,e.Rt),Gr:s.hl(o),Jr:s.ll(o,e.Rt),R:l.Zn,yi:a,jn:r}}Pn(){return null!==this.Qh||(this.Qh=new yi(this)),this.Qh}F(){return this.us}Mh(t){const i=t.priceScaleId;void 0!==i&&i!==this.us.priceScaleId&&this.Ut().al(this,i),E(this.us,t),void 0!==t.priceFormat&&(this.el(),this.Ut().ol()),this.Ut()._l(this),this.Ut().ul(),this.ws.bt("options")}tt(t,i){this.Et.tt(t),this.cl(),this.ws.bt("data"),this.cs.bt("data"),null!==this.Jh&&(i&&i.dl?this.Jh.Mr():0===t.length&&this.Jh.gr());const s=this.Ut().qe(this);this.Ut().fl(s),this.Ut()._l(this),this.Ut().ul(),this.Ut().Sh()}pl(t){this.tl=t,this.cl();const i=this.Ut().qe(this);this.cs.bt("data"),this.Ut().fl(i),this.Ut()._l(this),this.Ut().ul(),this.Ut().Sh()}vl(){return this.tl}Hr(){return this.il}ml(t){const i=new wi(this,t);return this.Zh.push(i),this.Ut()._l(this),i}bl(t){const i=this.Zh.indexOf(t);-1!==i&&this.Zh.splice(i,1),this.Ut()._l(this)}Rh(){return this.nl}xt(){const t=this.wl();return null===t?null:{Rt:t.Rt[3],gl:t.ot}}wl(){const t=this.Ut().yt().Ln();if(null===t)return null;const i=t.pn();return this.Et.Nh(i,1)}Is(){return this.Et}Ur(t){const i=this.Et.Dh(t);return null===i?null:"Bar"===this.nl||"Candlestick"===this.nl?{ee:i.Rt[0],re:i.Rt[1],he:i.Rt[2],le:i.Rt[3]}:i.Rt[3]}Ml(t){const i=this.Jh;return null!==i&&i.Ct()?(null===this.sl&&i.yr()&&(this.sl=setTimeout((()=>{this.sl=null,this.Ut().Sl()}),0)),i.Sr(),[i]):[]}Ds(){const t=[];this.yl()||t.push(this.Gh),t.push(this.ws,this.wh,this.cs);const i=this.Zh.map((t=>t.yh()));return t.push(...i),t}Gi(t){return[this.gh,...this.Zh.map((t=>t.kh()))]}Ps(t,i){if(i!==this.qi&&!this.yl())return[];const s=[...this.es];for(const h of this.Zh)s.push(h.Ch());return s}kl(t,i){if(void 0!==this.us.autoscaleInfoProvider){const s=this.us.autoscaleInfoProvider((()=>{const s=this.Cl(t,i);return null===s?null:s.ah()}));return mi.oh(s)}return this.Cl(t,i)}xl(){return this.us.priceFormat.minMove}Tl(){return this.Dl}Os(){var t;this.ws.bt(),this.cs.bt();for(const i of this.es)i.bt();for(const i of this.Zh)i.bt();this.wh.bt(),this.Gh.bt(),null===(t=this.Jh)||void 0===t||t.bt()}Pt(){return f(super.Pt())}kt(t){if("Line"!==this.nl&&"Area"!==this.nl&&"Baseline"!==this.nl||!this.us.crosshairMarkerVisible)return null;const i=this.Et.Dh(t);return null===i?null:{_t:i.Rt[3],ht:this.Pl(),Ot:this.Rl(),Tt:this.Ol(t)}}Yr(){return this.us.title}Ct(){return this.us.visible}yl(){return!nt(this.Pt().Al())}Cl(t,i){if(!x(t)||!x(i)||this.Et.Fi())return null;const s="Line"===this.nl||"Area"===this.nl||"Baseline"===this.nl||"Histogram"===this.nl?[3]:[2,1],h=this.Et.Wh(t,i,s);let e=null!==h?new vi(h.Xh,h.Kh):null;if("Histogram"===this.Rh()){const t=this.us.base,i=new vi(t,t);e=null!==e?e.Gs(i):i}return new mi(e,this.cs.$r())}Pl(){switch(this.nl){case"Line":case"Area":case"Baseline":return this.us.crosshairMarkerRadius}return 0}Rl(){switch(this.nl){case"Line":case"Area":case"Baseline":{const t=this.us.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}Ol(t){switch(this.nl){case"Line":case"Area":case"Baseline":{const t=this.us.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.Pn().Dn(t).Zn}el(){switch(this.us.priceFormat.type){case"custom":this.Dl={format:this.us.priceFormat.formatter};break;case"volume":this.Dl=new ut(this.us.priceFormat.precision);break;case"percent":this.Dl=new at(this.us.priceFormat.precision);break;default:{const t=Math.pow(10,this.us.priceFormat.precision);this.Dl=new lt(t,this.us.priceFormat.minMove*t)}}null!==this.qi&&this.qi.Ll()}cl(){const t=this.Ut().yt();if(t.Fi()||0===this.Et.En())return void(this.il=[]);const i=f(this.Et.Ih());this.il=this.tl.map(((s,h)=>{const e=f(t.El(s.time,!0)),n=e<i?1:-1;return{time:f(this.Et.Nh(e,n)).jn,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:h,text:s.text,size:s.size}}))}rl(){switch(this.cs=new fi(this,this.Ut()),this.nl){case"Bar":this.ws=new Pt(this,this.Ut());break;case"Candlestick":this.ws=new Ot(this,this.Ut());break;case"Line":this.ws=new $t(this,this.Ut());break;case"Area":this.ws=new Ft(this,this.Ut());break;case"Baseline":this.ws=new Dt(this,this.Ut());break;case"Histogram":this.ws=new qt(this,this.Ut());break;default:throw Error("Unknown chart style assigned: "+this.nl)}}}class Ri{constructor(t){this.us=t}Il(t,i,s){let h=t;if(0===this.us.mode)return h;const e=s.fs(),n=e.xt();if(null===n)return h;const r=e.Dt(t,n),o=s.Vl().filter((t=>t instanceof xi)).reduce(((t,h)=>{if(s.Ye(h)||!h.Ct())return t;const e=h.Pt(),n=h.Is();if(e.Fi()||!n.Dr(i))return t;const r=n.Dh(i);if(null===r)return t;const o=d(h.xt());return t.concat([e.Dt(r.Rt[3],o.Rt)])}),[]);if(0===o.length)return h;o.sort(((t,i)=>Math.abs(t-r)-Math.abs(i-r)));const l=o[0];return h=e.ps(l,n),h}}class Fi{constructor(){this.Et=null}tt(t){this.Et=t}X(t,i,s,h){if(null===this.Et)return;const e=Math.max(1,Math.floor(i));t.lineWidth=e;const n=Math.ceil(this.Et.Nt*i),r=Math.ceil(this.Et.Bt*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(()=>{const s=f(this.Et);if(s.Bl){t.strokeStyle=s.Nl,l(t,s.Fl),t.beginPath();for(const h of s.Wl){const s=Math.round(h.zl*i);t.moveTo(s,-e),t.lineTo(s,n+e)}t.stroke()}if(s.jl){t.strokeStyle=s.$l,l(t,s.Hl),t.beginPath();for(const h of s.Ul){const s=Math.round(h.zl*i);t.moveTo(-e,s),t.lineTo(r+e,s)}t.stroke()}}))}}class Ti{constructor(t){this.jt=new Fi,this.ft=!0,this.Qi=t}bt(){this.ft=!0}gt(t,i){if(this.ft){const s=this.Qi.Ut().F().grid,h={Nt:t,Bt:i,jl:s.horzLines.visible,Bl:s.vertLines.visible,$l:s.horzLines.color,Nl:s.vertLines.color,Hl:s.horzLines.style,Fl:s.vertLines.style,Ul:this.Qi.fs().ql(),Wl:this.Qi.Ut().yt().ql()||[]};this.jt.tt(h),this.ft=!1}return this.jt}}class Li{constructor(t){this.ws=new Ti(t)}yh(){return this.ws}}const Pi={Yl:4,Xl:1e-4};function Ni(t,i){const s=100*(t-i)/i;return i<0?-s:s}function Vi(t,i){const s=Ni(t.nh(),i),h=Ni(t.eh(),i);return new vi(s,h)}function Bi(t,i){const s=100*(t-i)/i+100;return i<0?-s:s}function ki(t,i){const s=Bi(t.nh(),i),h=Bi(t.eh(),i);return new vi(s,h)}function Ui(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const h=Bt(s+i.Xl)+i.Yl;return t<0?-h:h}function Ii(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const h=Math.pow(10,s-i.Yl)-i.Xl;return t<0?-h:h}function Di(t,i){if(null===t)return null;const s=Ui(t.nh(),i),h=Ui(t.eh(),i);return new vi(s,h)}function zi(t,i){if(null===t)return null;const s=Ii(t.nh(),i),h=Ii(t.eh(),i);return new vi(s,h)}function Oi(t){if(null===t)return Pi;const i=Math.abs(t.eh()-t.nh());if(i>=1||i<1e-15)return Pi;const s=Math.ceil(Math.abs(Math.log10(i))),h=Pi.Yl+s;return{Yl:h,Xl:1/Math.pow(10,h)}}class ji{constructor(t,i){if(this.Kl=t,this.Zl=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.Kl))this.Gl=[2,2.5,2];else{this.Gl=[];for(let t=this.Kl;1!==t;){if(t%2==0)this.Gl.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.Gl.push(2,2.5),t/=5}if(this.Gl.length>100)throw new Error("something wrong with base")}}}Jl(t,i,s){const h=0===this.Kl?0:1/this.Kl;let e=Math.pow(10,Math.max(0,Math.ceil(Bt(t-i)))),n=0,r=this.Zl[0];for(;;){const t=Vt(e,h,1e-14)&&e>h+1e-14,i=Vt(e,s*r,1e-14),o=Vt(e,1,1e-14);if(!(t&&i&&o))break;e/=r,r=this.Zl[++n%this.Zl.length]}if(e<=h+1e-14&&(e=h),e=Math.max(1,e),this.Gl.length>0&&(o=e,1,1e-14,Math.abs(o-1)<1e-14))for(n=0,r=this.Gl[0];Vt(e,s*r,1e-14)&&e>h+1e-14;)e/=r,r=this.Gl[++n%this.Gl.length];var o;return e}}class qi{constructor(t,i,s,h){this.Ql=[],this.Bi=t,this.Kl=i,this.ta=s,this.ia=h}Jl(t,i){if(t<i)throw new Error("high < low");const s=this.Bi.Kt(),h=(t-i)*this.sa()/s,e=new ji(this.Kl,[2,2.5,2]),n=new ji(this.Kl,[2,2,2.5]),r=new ji(this.Kl,[2.5,2,2]),o=[];return o.push(e.Jl(t,i,h),n.Jl(t,i,h),r.Jl(t,i,h)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let s=1;s<t.length;++s)t[s]<i&&(i=t[s]);return i}(o)}na(){const t=this.Bi,i=t.xt();if(null===i)return void(this.Ql=[]);const s=t.Kt(),h=this.ta(s-1,i),e=this.ta(0,i),n=this.Bi.F().entireTextOnly?this.ea()/2:0,r=n,o=s-1-n,l=Math.max(h,e),a=Math.min(h,e);if(l===a)return void(this.Ql=[]);let u=this.Jl(l,a),c=l%u;c+=c<0?u:0;const f=l>=a?1:-1;let d=null,p=0;for(let v=l-c;v>a;v-=u){const s=this.ia(v,i,!0);null!==d&&Math.abs(s-d)<this.sa()||s<r||s>o||(p<this.Ql.length?(this.Ql[p].zl=s,this.Ql[p].ra=t.ha(v)):this.Ql.push({zl:s,ra:t.ha(v)}),p++,d=s,t.la()&&(u=this.Jl(v*f,a)))}this.Ql.length=p}ql(){return this.Ql}ea(){return this.Bi.T()}sa(){return Math.ceil(2.5*this.ea())}}function $i(t){return t.slice().sort(((t,i)=>f(t.Xi())-f(i.Xi())))}var Wi;!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(Wi||(Wi={}));const Ai=new at,Yi=new lt(100,1);class Xi{constructor(t,i,s,h){this.aa=0,this.oa=null,this._h=null,this._a=null,this.ua={ca:!1,da:null},this.fa=0,this.pa=0,this.va=new C,this.ma=new C,this.ba=[],this.wa=null,this.ga=null,this.Ma=null,this.Sa=null,this.Dl=Yi,this.ya=Oi(null),this.ka=t,this.us=i,this.Ca=s,this.xa=h,this.Ta=new qi(this,100,this.Da.bind(this),this.Pa.bind(this))}Al(){return this.ka}F(){return this.us}Mh(t){if(E(this.us,t),this.Ll(),void 0!==t.mode&&this.Ra({tr:t.mode}),void 0!==t.scaleMargins){const i=c(t.scaleMargins.top),s=c(t.scaleMargins.bottom);if(i<0||i>1)throw new Error("Invalid top margin - expect value between 0 and 1, given="+i);if(s<0||s>1||i+s>1)throw new Error("Invalid bottom margin - expect value between 0 and 1, given="+s);if(i+s>1)throw new Error("Invalid margins - sum of margins must be less than 1, given="+(i+s));this.Oa(),this.ga=null}}Aa(){return this.us.autoScale}la(){return 1===this.us.mode}Zr(){return 2===this.us.mode}La(){return 3===this.us.mode}tr(){return{zs:this.us.autoScale,Ea:this.us.invertScale,tr:this.us.mode}}Ra(t){const i=this.tr();let s=null;void 0!==t.zs&&(this.us.autoScale=t.zs),void 0!==t.tr&&(this.us.mode=t.tr,2!==t.tr&&3!==t.tr||(this.us.autoScale=!0),this.ua.ca=!1),1===i.tr&&t.tr!==i.tr&&(function(t,i){if(null===t)return!1;const s=Ii(t.nh(),i),h=Ii(t.eh(),i);return isFinite(s)&&isFinite(h)}(this._h,this.ya)?(s=zi(this._h,this.ya),null!==s&&this.Ia(s)):this.us.autoScale=!0),1===t.tr&&t.tr!==i.tr&&(s=Di(this._h,this.ya),null!==s&&this.Ia(s));const h=i.tr!==this.us.mode;h&&(2===i.tr||this.Zr())&&this.Ll(),h&&(3===i.tr||this.La())&&this.Ll(),void 0!==t.Ea&&i.Ea!==t.Ea&&(this.us.invertScale=t.Ea,this.Va()),this.ma.m(i,this.tr())}Ba(){return this.ma}T(){return this.Ca.fontSize}Kt(){return this.aa}Na(t){this.aa!==t&&(this.aa=t,this.Oa(),this.ga=null)}Fa(){if(this.oa)return this.oa;const t=this.Kt()-this.Wa()-this.za();return this.oa=t,t}dh(){return this.ja(),this._h}Ia(t,i){const s=this._h;(i||null===s&&null!==t||null!==s&&!s.ih(t))&&(this.ga=null,this._h=t)}Fi(){return this.ja(),0===this.aa||!this._h||this._h.Fi()}$a(t){return this.Ea()?t:this.Kt()-1-t}Dt(t,i){return this.Zr()?t=Ni(t,i):this.La()&&(t=Bi(t,i)),this.Pa(t,i)}Nn(t,i,s){this.ja();const h=this.za(),e=f(this.dh()),n=e.nh(),r=e.eh(),o=this.Fa()-1,l=this.Ea(),a=o/(r-n),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.Ha();for(let f=u;f<c;f++){const s=t[f],e=s._t;if(isNaN(e))continue;let r=e;null!==d&&(r=d(s._t,i));const o=h+a*(r-n),u=l?o:this.aa-1-o;s.et=u}}se(t,i,s){this.ja();const h=this.za(),e=f(this.dh()),n=e.nh(),r=e.eh(),o=this.Fa()-1,l=this.Ea(),a=o/(r-n),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.Ha();for(let f=u;f<c;f++){const s=t[f];let e=s.ee,r=s.re,o=s.he,u=s.le;null!==d&&(e=d(s.ee,i),r=d(s.re,i),o=d(s.he,i),u=d(s.le,i));let c=h+a*(e-n),p=l?c:this.aa-1-c;s.te=p,c=h+a*(r-n),p=l?c:this.aa-1-c,s.Gn=p,c=h+a*(o-n),p=l?c:this.aa-1-c,s.Jn=p,c=h+a*(u-n),p=l?c:this.aa-1-c,s.ie=p}}ps(t,i){const s=this.Da(t,i);return this.Ua(s,i)}Ua(t,i){let s=t;return this.Zr()?s=function(t,i){return i<0&&(t=-t),t/100*i+i}(s,i):this.La()&&(s=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(s,i)),s}Vl(){return this.ba}qa(){if(this.wa)return this.wa;let t=[];for(let i=0;i<this.ba.length;i++){const s=this.ba[i];null===s.Xi()&&s.Ki(i+1),t.push(s)}return t=$i(t),this.wa=t,this.wa}Ya(t){-1===this.ba.indexOf(t)&&(this.ba.push(t),this.Ll(),this.Xa())}Ka(t){const i=this.ba.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.ba.splice(i,1),0===this.ba.length&&(this.Ra({zs:!0}),this.Ia(null)),this.Ll(),this.Xa()}xt(){let t=null;for(const i of this.ba){const s=i.xt();null!==s&&(null===t||s.gl<t.gl)&&(t=s)}return null===t?null:t.Rt}Ea(){return this.us.invertScale}ql(){const t=null===this.xt();if(null!==this.ga&&(t||this.ga.Za===t))return this.ga.ql;this.Ta.na();const i=this.Ta.ql();return this.ga={ql:i,Za:t},this.va.m(),i}Ga(){return this.va}Ja(t){this.Zr()||this.La()||null===this.Ma&&null===this._a&&(this.Fi()||(this.Ma=this.aa-t,this._a=f(this.dh()).sh()))}Qa(t){if(this.Zr()||this.La())return;if(null===this.Ma)return;this.Ra({zs:!1}),(t=this.aa-t)<0&&(t=0);let i=(this.Ma+.2*(this.aa-1))/(t+.2*(this.aa-1));const s=f(this._a).sh();i=Math.max(i,.1),s.hh(i),this.Ia(s)}io(){this.Zr()||this.La()||(this.Ma=null,this._a=null)}so(t){this.Aa()||null===this.Sa&&null===this._a&&(this.Fi()||(this.Sa=t,this._a=f(this.dh()).sh()))}no(t){if(this.Aa())return;if(null===this.Sa)return;const i=f(this.dh()).rh()/(this.Fa()-1);let s=t-this.Sa;this.Ea()&&(s*=-1);const h=s*i,e=f(this._a).sh();e.lh(h),this.Ia(e,!0),this.ga=null}eo(){this.Aa()||null!==this.Sa&&(this.Sa=null,this._a=null)}Tl(){return this.Dl||this.Ll(),this.Dl}Wi(t,i){switch(this.us.mode){case 2:return this.Tl().format(Ni(t,i));case 3:return this.Tl().format(Bi(t,i));default:return this.bh(t)}}ha(t){switch(this.us.mode){case 2:case 3:return this.Tl().format(t);default:return this.bh(t)}}hl(t){return this.bh(t,f(this.ro()).Tl())}ll(t,i){return t=Ni(t,i),Ai.format(t)}ho(){return this.ba}lo(t){this.ua={da:t,ca:!1}}Os(){this.ba.forEach((t=>t.Os()))}Ll(){this.ga=null;const t=this.ro();let i=100;null!==t&&(i=Math.round(1/t.xl())),this.Dl=Yi,this.Zr()?(this.Dl=Ai,i=100):this.La()?(this.Dl=new lt(100,1),i=100):null!==t&&(this.Dl=t.Tl()),this.Ta=new qi(this,i,this.Da.bind(this),this.Pa.bind(this)),this.Ta.na()}Xa(){this.wa=null}ro(){return this.ba[0]||null}Wa(){return this.Ea()?this.us.scaleMargins.bottom*this.Kt()+this.pa:this.us.scaleMargins.top*this.Kt()+this.fa}za(){return this.Ea()?this.us.scaleMargins.top*this.Kt()+this.fa:this.us.scaleMargins.bottom*this.Kt()+this.pa}ja(){this.ua.ca||(this.ua.ca=!0,this.ao())}Oa(){this.oa=null}Pa(t,i){if(this.ja(),this.Fi())return 0;t=this.la()&&t?Ui(t,this.ya):t;const s=f(this.dh()),h=this.za()+(this.Fa()-1)*(t-s.nh())/s.rh();return this.$a(h)}Da(t,i){if(this.ja(),this.Fi())return 0;const s=this.$a(t),h=f(this.dh()),e=h.nh()+h.rh()*((s-this.za())/(this.Fa()-1));return this.la()?Ii(e,this.ya):e}Va(){this.ga=null,this.Ta.na()}ao(){const t=this.ua.da;if(null===t)return;let i=null;const s=this.ho();let h=0,e=0;for(const o of s){if(!o.Ct())continue;const s=o.xt();if(null===s)continue;const n=o.kl(t.pn(),t.vn());let r=n&&n.dh();if(null!==r){switch(this.us.mode){case 1:r=Di(r,this.ya);break;case 2:r=Vi(r,s.Rt);break;case 3:r=ki(r,s.Rt)}if(i=null===i?r:i.Gs(f(r)),null!==n){const t=n.fh();null!==t&&(h=Math.max(h,t.above),e=Math.max(h,t.below))}}}if(h===this.fa&&e===this.pa||(this.fa=h,this.pa=e,this.ga=null,this.Oa()),null!==i){if(i.nh()===i.eh()){const t=this.ro(),s=5*(null===t||this.Zr()||this.La()?1:t.xl());this.la()&&(i=zi(i,this.ya)),i=new vi(i.nh()-s,i.eh()+s),this.la()&&(i=Di(i,this.ya))}if(this.la()){const t=zi(i,this.ya),s=Oi(t);if(n=s,r=this.ya,n.Yl!==r.Yl||n.Xl!==r.Xl){const h=null!==this._a?zi(this._a,this.ya):null;this.ya=s,i=Di(t,s),null!==h&&(this._a=Di(h,s))}}this.Ia(i)}else null===this._h&&(this.Ia(new vi(-.5,.5)),this.ya=Oi(null));var n,r;this.ua.ca=!0}Ha(){return this.Zr()?Ni:this.La()?Bi:this.la()?t=>Ui(t,this.ya):null}bh(t,i){return void 0===this.xa.priceFormatter?(void 0===i&&(i=this.Tl()),i.format(t)):this.xa.priceFormatter(t)}}class Ki{constructor(t,i){this.ba=[],this.oo=new Map,this.aa=0,this.ze=0,this._o=1e3,this.wa=null,this.uo=new C,this.co=t,this.$i=i,this.do=new Li(this);const s=i.F();this.fo=this.po("left",s.leftPriceScale),this.vo=this.po("right",s.rightPriceScale),this.fo.Ba().l(this.mo.bind(this,this.fo),this),this.vo.Ba().l(this.mo.bind(this,this.vo),this),this.bo(s)}bo(t){if(t.leftPriceScale&&this.fo.Mh(t.leftPriceScale),t.rightPriceScale&&this.vo.Mh(t.rightPriceScale),t.localization&&(this.fo.Ll(),this.vo.Ll()),t.overlayPriceScales){const i=Array.from(this.oo.values());for(const s of i){const i=f(s[0].Pt());i.Mh(t.overlayPriceScales),t.localization&&i.Ll()}}}wo(t){switch(t){case"left":return this.fo;case"right":return this.vo}return this.oo.has(t)?c(this.oo.get(t))[0].Pt():null}M(){this.Ut().Mo().v(this),this.fo.Ba().v(this),this.vo.Ba().v(this),this.ba.forEach((t=>{t.M&&t.M()})),this.uo.m()}So(){return this._o}yo(t){this._o=t}Ut(){return this.$i}Xt(){return this.ze}Kt(){return this.aa}ko(t){this.ze=t,this.Co()}Na(t){this.aa=t,this.fo.Na(t),this.vo.Na(t),this.ba.forEach((i=>{if(this.Ye(i)){const s=i.Pt();null!==s&&s.Na(t)}})),this.Co()}Vl(){return this.ba}Ye(t){const i=t.Pt();return null===i||this.fo!==i&&this.vo!==i}Ya(t,i,s){const h=void 0!==s?s:this.To().xo+1;this.Do(t,i,h)}Ka(t){const i=this.ba.indexOf(t);u(-1!==i,"removeDataSource: invalid data source"),this.ba.splice(i,1);const s=f(t.Pt()).Al();if(this.oo.has(s)){const i=c(this.oo.get(s)),h=i.indexOf(t);-1!==h&&(i.splice(h,1),0===i.length&&this.oo.delete(s))}const h=t.Pt();h&&h.Vl().indexOf(t)>=0&&h.Ka(t),null!==h&&(h.Xa(),this.Po(h)),this.wa=null}Ke(t){return t===this.fo?"left":t===this.vo?"right":"overlay"}Ro(){return this.fo}Oo(){return this.vo}Ao(t,i){t.Ja(i)}Lo(t,i){t.Qa(i),this.Co()}Eo(t){t.io()}Io(t,i){t.so(i)}Vo(t,i){t.no(i),this.Co()}Bo(t){t.eo()}Co(){this.ba.forEach((t=>{t.Os()}))}fs(){let t=null;return this.$i.F().rightPriceScale.visible&&0!==this.vo.Vl().length?t=this.vo:this.$i.F().leftPriceScale.visible&&0!==this.fo.Vl().length?t=this.fo:0!==this.ba.length&&(t=this.ba[0].Pt()),null===t&&(t=this.vo),t}Xe(){let t=null;return this.$i.F().rightPriceScale.visible?t=this.vo:this.$i.F().leftPriceScale.visible&&(t=this.fo),t}Po(t){null!==t&&t.Aa()&&this.No(t)}Fo(t){const i=this.co.Ln();t.Ra({zs:!0}),null!==i&&t.lo(i),this.Co()}Wo(){this.No(this.fo),this.No(this.vo)}zo(){this.Po(this.fo),this.Po(this.vo),this.ba.forEach((t=>{this.Ye(t)&&this.Po(t.Pt())})),this.Co(),this.$i.Sh()}qa(){return null===this.wa&&(this.wa=$i(this.ba)),this.wa}jo(){return this.uo}$o(){return this.do}No(t){const i=t.ho();if(i&&i.length>0&&!this.co.Fi()){const i=this.co.Ln();null!==i&&t.lo(i)}t.Os()}To(){const t=this.qa();if(0===t.length)return{Ho:0,xo:0};let i=0,s=0;for(let h=0;h<t.length;h++){const e=t[h].Xi();null!==e&&(e<i&&(i=e),e>s&&(s=e))}return{Ho:i,xo:s}}Do(t,i,s){let h=this.wo(i);if(null===h&&(h=this.po(i,this.$i.F().overlayPriceScales)),this.ba.push(t),!nt(i)){const s=this.oo.get(i)||[];s.push(t),this.oo.set(i,s)}h.Ya(t),t.Zi(h),t.Ki(s),this.Po(h),this.wa=null}mo(t,i,s){i.tr!==s.tr&&this.No(t)}po(t,i){const s=Object.assign({visible:!0,autoScale:!0},T(i)),h=new Xi(t,s,this.$i.F().layout,this.$i.F().localization);return h.Na(this.Kt()),h}}const Qi=t=>t.getUTCFullYear();class Zi{constructor(t,i){void 0===t&&(t="yyyy-MM-dd"),void 0===i&&(i="default"),this.Uo=t,this.qo=i}Yo(t){return function(t,i,s){return i.replace(/yyyy/g,(t=>ot(Qi(t),4))(t)).replace(/yy/g,(t=>ot(Qi(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,s)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,s)).replace(/MM/g,(t=>ot((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>ot((t=>t.getUTCDate())(t),2))(t))}(t,this.Uo,this.qo)}}class Gi{constructor(t){this.Xo=t||"%h:%m:%s"}Yo(t){return this.Xo.replace("%h",ot(t.getUTCHours(),2)).replace("%m",ot(t.getUTCMinutes(),2)).replace("%s",ot(t.getUTCSeconds(),2))}}const Ji={Ko:"yyyy-MM-dd",Zo:"%h:%m:%s",Go:" ",Jo:"default"};class Hi{constructor(t){void 0===t&&(t={});const i=Object.assign(Object.assign({},Ji),t);this.Qo=new Zi(i.Ko,i.Jo),this.t_=new Gi(i.Zo),this.i_=i.Go}Yo(t){return""+this.Qo.Yo(t)+this.i_+this.t_.Yo(t)}}class ts{constructor(t,i){void 0===i&&(i=50),this.Pe=0,this.Re=1,this.Oe=1,this.Le=new Map,this.Ae=new Map,this.s_=t,this.Ee=i}Yo(t){const i=t.ot,s=void 0===i.n_?new Date(1e3*i.e_).getTime():new Date(Date.UTC(i.n_.year,i.n_.month-1,i.n_.day)).getTime(),h=this.Le.get(s);if(void 0!==h)return h.r_;if(this.Pe===this.Ee){const t=this.Ae.get(this.Oe);this.Ae.delete(this.Oe),this.Le.delete(c(t)),this.Oe++,this.Pe--}const e=this.s_(t);return this.Le.set(s,{r_:e,Ne:this.Re}),this.Ae.set(this.Re,s),this.Pe++,this.Re++,e}}class is{constructor(t,i){u(t<=i,"right should be >= left"),this.h_=t,this.l_=i}pn(){return this.h_}vn(){return this.l_}a_(){return this.l_-this.h_+1}Dr(t){return this.h_<=t&&t<=this.l_}ih(t){return this.h_===t.pn()&&this.l_===t.vn()}}function ss(t,i){return null===t||null===i?t===i:t.ih(i)}class hs{constructor(){this.o_=new Map,this.Le=null}__(t,i){this.u_(i),this.Le=null;for(let s=i;s<t.length;++s){const i=t[s];let h=this.o_.get(i.c_);void 0===h&&(h=[],this.o_.set(i.c_,h)),h.push({jn:s,ot:i.ot,d_:i.c_,f_:i.f_})}}p_(t,i){const s=Math.ceil(i/t);return null!==this.Le&&this.Le.v_===s||(this.Le={ql:this.m_(s),v_:s}),this.Le.ql}u_(t){if(0===t)return void this.o_.clear();const i=[];this.o_.forEach(((s,h)=>{t<=s[0].jn?i.push(h):s.splice(_t(s,t,(i=>i.jn<t)),1/0)}));for(const s of i)this.o_.delete(s)}m_(t){let i=[];for(const s of Array.from(this.o_.keys()).sort(((t,i)=>i-t))){if(!this.o_.get(s))continue;const h=i;i=[];const e=h.length;let n=0;const r=c(this.o_.get(s)),o=r.length;let l=1/0,a=-1/0;for(let s=0;s<o;s++){const o=r[s],u=o.jn;for(;n<e;){const t=h[n],s=t.jn;if(!(s<u)){l=s;break}n++,i.push(t),a=s,l=1/0}l-u>=t&&u-a>=t&&(i.push(o),a=u)}for(;n<e;n++)i.push(h[n])}return i}}class es{constructor(t){this.b_=t}w_(){return null===this.b_?null:new is(Math.floor(this.b_.pn()),Math.ceil(this.b_.vn()))}g_(){return this.b_}static M_(){return new es(null)}}var ns,rs,os,ls,as;!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(ns||(ns={}));class us{constructor(t,i,s){this.ze=0,this.S_=null,this.y_=[],this.Sa=null,this.Ma=null,this.k_=new hs,this.C_=new Map,this.x_=es.M_(),this.T_=!0,this.D_=new C,this.P_=new C,this.R_=new C,this.O_=null,this.A_=null,this.L_=[],this.us=i,this.xa=s,this.E_=i.rightOffset,this.I_=i.barSpacing,this.$i=t,this.V_()}F(){return this.us}B_(t){E(this.xa,t),this.N_(),this.V_()}Mh(t,i){var s;E(this.us,t),this.us.fixLeftEdge&&this.F_(),this.us.fixRightEdge&&this.W_(),void 0!==t.barSpacing&&this.$i.Xs(t.barSpacing),void 0!==t.rightOffset&&this.$i.Ks(t.rightOffset),void 0!==t.minBarSpacing&&this.$i.Xs(null!==(s=t.barSpacing)&&void 0!==s?s:this.I_),this.N_(),this.V_(),this.R_.m()}vs(t){var i,s;return null!==(s=null===(i=this.y_[t])||void 0===i?void 0:i.ot)&&void 0!==s?s:null}Hi(t){var i;return null!==(i=this.y_[t])&&void 0!==i?i:null}El(t,i){if(this.y_.length<1)return null;if(t.e_>this.y_[this.y_.length-1].ot.e_)return i?this.y_.length-1:null;const s=_t(this.y_,t.e_,((t,i)=>t.ot.e_<i));return t.e_<this.y_[s].ot.e_?i?s:null:s}Fi(){return 0===this.ze||0===this.y_.length||null===this.S_}Ln(){return this.z_(),this.x_.w_()}j_(){return this.z_(),this.x_.g_()}H_(){const t=this.Ln();if(null===t)return null;const i={from:t.pn(),to:t.vn()};return this.U_(i)}U_(t){const i=Math.round(t.from),s=Math.round(t.to),h=f(this.q_()),e=f(this.Y_());return{from:f(this.vs(Math.max(h,i))),to:f(this.vs(Math.min(e,s)))}}X_(t){return{from:f(this.El(t.from,!0)),to:f(this.El(t.to,!0))}}Xt(){return this.ze}ko(t){if(!isFinite(t)||t<=0)return;if(this.ze===t)return;const i=this.j_(),s=this.ze;if(this.ze=t,this.T_=!0,this.us.lockVisibleTimeRangeOnResize&&0!==s){const i=this.I_*t/s;this.I_=i}if(this.us.fixLeftEdge&&null!==i&&i.pn()<=0){const i=s-t;this.E_-=Math.round(i/this.I_)+1,this.T_=!0}this.K_(),this.Z_()}Lt(t){if(this.Fi()||!x(t))return 0;const i=this.G_()+this.E_-t;return this.ze-(i+.5)*this.I_-1}Bn(t,i){const s=this.G_(),h=void 0===i?0:i.from,e=void 0===i?t.length:i.to;for(let n=h;n<e;n++){const i=t[n].ot,h=s+this.E_-i,e=this.ze-(h+.5)*this.I_-1;t[n].nt=e}}J_(t){return Math.ceil(this.Q_(t))}Ks(t){this.T_=!0,this.E_=t,this.Z_(),this.$i.tu(),this.$i.Sh()}Un(){return this.I_}Xs(t){this.iu(t),this.Z_(),this.$i.tu(),this.$i.Sh()}su(){return this.E_}ql(){if(this.Fi())return null;if(null!==this.A_)return this.A_;const t=this.I_,i=5*(this.$i.F().layout.fontSize+4),s=Math.round(i/t),h=f(this.Ln()),e=Math.max(h.pn(),h.pn()-s),n=Math.max(h.vn(),h.vn()-s),r=this.k_.p_(t,i),o=this.q_()+s,l=this.Y_()-s,a=this.nu(),u=this.us.fixLeftEdge||a,c=this.us.fixRightEdge||a;let d=0;for(const f of r){if(!(e<=f.jn&&f.jn<=n))continue;let t;d<this.L_.length?(t=this.L_[d],t.zl=this.Lt(f.jn),t.ra=this.eu(f),t.d_=f.d_):(t={ru:!1,zl:this.Lt(f.jn),ra:this.eu(f),d_:f.d_},this.L_.push(t)),this.I_>i/2&&!a?t.ru=!1:t.ru=u&&f.jn<=o||c&&f.jn>=l,d++}return this.L_.length=d,this.A_=this.L_,this.L_}hu(){this.T_=!0,this.Xs(this.us.barSpacing),this.Ks(this.us.rightOffset)}lu(t){this.T_=!0,this.S_=t,this.Z_(),this.F_()}au(t,i){const s=this.Q_(t),h=this.Un(),e=h+i*(h/10);this.Xs(e),this.us.rightBarStaysOnScroll||this.Ks(this.su()+(s-this.Q_(t)))}Ja(t){this.Sa&&this.eo(),null===this.Ma&&null===this.O_&&(this.Fi()||(this.Ma=t,this.ou()))}Qa(t){if(null===this.O_)return;const i=Nt(this.ze-t,0,this.ze),s=Nt(this.ze-f(this.Ma),0,this.ze);0!==i&&0!==s&&this.Xs(this.O_.Un*i/s)}io(){null!==this.Ma&&(this.Ma=null,this._u())}so(t){null===this.Sa&&null===this.O_&&(this.Fi()||(this.Sa=t,this.ou()))}no(t){if(null===this.Sa)return;const i=(this.Sa-t)/this.Un();this.E_=f(this.O_).su+i,this.T_=!0,this.Z_()}eo(){null!==this.Sa&&(this.Sa=null,this._u())}uu(){this.cu(this.us.rightOffset)}cu(t,i){if(void 0===i&&(i=400),!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.E_,h=performance.now(),e=()=>{const n=(performance.now()-h)/i,r=n>=1,o=r?t:s+(t-s)*n;this.Ks(o),r||setTimeout(e,20)};e()}bt(t,i){this.T_=!0,this.y_=t,this.k_.__(t,i),this.Z_()}du(){return this.D_}fu(){return this.P_}pu(){return this.R_}G_(){return this.S_||0}vu(t){const i=t.a_();this.iu(this.ze/i),this.E_=t.vn()-this.G_(),this.Z_(),this.T_=!0,this.$i.tu(),this.$i.Sh()}mu(){const t=this.q_(),i=this.Y_();null!==t&&null!==i&&this.vu(new is(t,i+this.us.rightOffset))}bu(t){const i=new is(t.from,t.to);this.vu(i)}Ui(t){return void 0!==this.xa.timeFormatter?this.xa.timeFormatter(t.f_):this.wu.Yo(new Date(1e3*t.ot.e_))}nu(){const{handleScroll:t,handleScale:i}=this.$i.F();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset.time||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}q_(){return 0===this.y_.length?null:0}Y_(){return 0===this.y_.length?null:this.y_.length-1}gu(t){return(this.ze-1-t)/this.I_}Q_(t){const i=this.gu(t),s=this.G_()+this.E_-i;return Math.round(1e6*s)/1e6}iu(t){const i=this.I_;this.I_=t,this.K_(),i!==this.I_&&(this.T_=!0,this.Mu())}z_(){if(!this.T_)return;if(this.T_=!1,this.Fi())return void this.Su(es.M_());const t=this.G_(),i=this.ze/this.I_,s=this.E_+t,h=new is(s-i+1,s);this.Su(new es(h))}K_(){const t=this.yu();if(this.I_<t&&(this.I_=t,this.T_=!0),0!==this.ze){const t=.5*this.ze;this.I_>t&&(this.I_=t,this.T_=!0)}}yu(){return this.us.fixLeftEdge&&this.us.fixRightEdge&&0!==this.y_.length?this.ze/this.y_.length:this.us.minBarSpacing}Z_(){const t=this.ku();this.E_>t&&(this.E_=t,this.T_=!0);const i=this.Cu();null!==i&&this.E_<i&&(this.E_=i,this.T_=!0)}Cu(){const t=this.q_(),i=this.S_;return null===t||null===i?null:t-i-1+(this.us.fixLeftEdge?this.ze/this.I_:Math.min(2,this.y_.length))}ku(){return this.us.fixRightEdge?0:this.ze/this.I_-Math.min(2,this.y_.length)}ou(){this.O_={Un:this.Un(),su:this.su()}}_u(){this.O_=null}eu(t){let i=this.C_.get(t.d_);return void 0===i&&(i=new ts((t=>this.xu(t))),this.C_.set(t.d_,i)),i.Yo(t)}xu(t){const i=function(t,i,s){switch(t){case 0:case 10:return i?s?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.d_,this.us.timeVisible,this.us.secondsVisible);return void 0!==this.us.tickMarkFormatter?this.us.tickMarkFormatter(t.f_,i,this.xa.locale):function(t,i,s){const h={};switch(i){case 0:h.year="numeric";break;case 1:h.month="short";break;case 2:h.day="numeric";break;case 3:h.hour12=!1,h.hour="2-digit",h.minute="2-digit";break;case 4:h.hour12=!1,h.hour="2-digit",h.minute="2-digit",h.second="2-digit"}const e=void 0===t.n_?new Date(1e3*t.e_):new Date(Date.UTC(t.n_.year,t.n_.month-1,t.n_.day));return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()).toLocaleString(s,h)}(t.ot,i,this.xa.locale)}Su(t){const i=this.x_;this.x_=t,ss(i.w_(),this.x_.w_())||this.D_.m(),ss(i.g_(),this.x_.g_())||this.P_.m(),this.Mu()}Mu(){this.A_=null}N_(){this.Mu(),this.C_.clear()}V_(){const t=this.xa.dateFormat;this.us.timeVisible?this.wu=new Hi({Ko:t,Zo:this.us.secondsVisible?"%h:%m:%s":"%h:%m",Go:"   ",Jo:this.xa.locale}):this.wu=new Zi(t,this.xa.locale)}F_(){if(!this.us.fixLeftEdge)return;const t=this.q_();if(null===t)return;const i=this.Ln();if(null===i)return;const s=i.pn()-t;if(s<0){const t=this.E_-s-1;this.Ks(t)}this.K_()}W_(){this.Z_(),this.K_()}}class cs extends U{constructor(t){super(),this.Tu=new Map,this.Et=t}K(t){}G(t){if(!this.Et.Ct)return;t.save();let i=0;for(const h of this.Et.Du){if(0===h.ti.length)continue;t.font=h.D;const s=this.Pu(t,h.ti);s>this.Et.Xt?h.au=this.Et.Xt/s:h.au=1,i+=h.Ru*h.au}let s=0;switch(this.Et.Ou){case"top":s=0;break;case"center":s=Math.max((this.Et.Kt-i)/2,0);break;case"bottom":s=Math.max(this.Et.Kt-i,0)}t.fillStyle=this.Et.R;for(const h of this.Et.Du){t.save();let i=0;switch(this.Et.Au){case"left":t.textAlign="left",i=h.Ru/2;break;case"center":t.textAlign="center",i=this.Et.Xt/2;break;case"right":t.textAlign="right",i=this.Et.Xt-1-h.Ru/2}t.translate(i,s),t.textBaseline="top",t.font=h.D,t.scale(h.au,h.au),t.fillText(h.ti,0,h.Lu),t.restore(),s+=h.Ru*h.au}t.restore()}Pu(t,i){const s=this.Eu(t.font);let h=s.get(i);return void 0===h&&(h=t.measureText(i).width,s.set(i,h)),h}Eu(t){let i=this.Tu.get(t);return void 0===i&&(i=new Map,this.Tu.set(t,i)),i}}class fs{constructor(t){this.ft=!0,this.zt={Ct:!1,R:"",Kt:0,Xt:0,Du:[],Ou:"center",Au:"center"},this.jt=new cs(this.zt),this.$t=t}bt(){this.ft=!0}gt(t,i){return this.ft&&(this.Mt(t,i),this.ft=!1),this.jt}Mt(t,i){const s=this.$t.F(),h=this.zt;h.Ct=s.visible,h.Ct&&(h.R=s.color,h.Xt=i,h.Kt=t,h.Au=s.horzAlign,h.Ou=s.vertAlign,h.Du=[{ti:s.text,D:V(s.fontSize,s.fontFamily,s.fontStyle),Ru:1.2*s.fontSize,Lu:0,au:0}])}}class ds extends st{constructor(t,i){super(),this.us=i,this.ws=new fs(this)}Ps(){return[]}Ds(){return[this.ws]}F(){return this.us}Os(){this.ws.bt()}}!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(rs||(rs={}));class ps{constructor(t,i){this.Iu=[],this.Vu=[],this.ze=0,this.Bu=null,this.Nu=null,this.Fu=new C,this.Wu=new C,this.zu=null,this.ju=t,this.us=i,this.$u=new B(this),this.co=new us(this,i.timeScale,this.us.localization),this.vt=new et(this,i.crosshair),this.Hu=new Ri(i.crosshair),this.Uu=new ds(this,i.watermark),this.qu(),this.Iu[0].yo(2e3),this.Yu=this.Xu(0),this.Ku=this.Xu(1)}ol(){this.Zu(new rt(3))}Sh(){this.Zu(new rt(2))}Sl(){this.Zu(new rt(1))}_l(t){const i=this.Gu(t);this.Zu(i)}Ju(){return this.Nu}Qu(t){const i=this.Nu;this.Nu=t,null!==i&&this._l(i.tc),null!==t&&this._l(t.tc)}F(){return this.us}Mh(t){E(this.us,t),this.Iu.forEach((i=>i.bo(t))),void 0!==t.timeScale&&this.co.Mh(t.timeScale),void 0!==t.localization&&this.co.B_(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Fu.m(),this.Yu=this.Xu(0),this.Ku=this.Xu(1),this.ol()}ic(t,i){if("left"===t)return void this.Mh({leftPriceScale:i});if("right"===t)return void this.Mh({rightPriceScale:i});const s=this.sc(t);null!==s&&(s.Pt.Mh(i),this.Fu.m())}sc(t){for(const i of this.Iu){const s=i.wo(t);if(null!==s)return{Ht:i,Pt:s}}return null}yt(){return this.co}nc(){return this.Iu}ec(){return this.Uu}rc(){return this.vt}hc(){return this.Wu}lc(t,i){t.Na(i),this.tu()}ko(t){this.ze=t,this.co.ko(this.ze),this.Iu.forEach((i=>i.ko(t))),this.tu()}qu(t){const i=new Ki(this.co,this);void 0!==t?this.Iu.splice(t,0,i):this.Iu.push(i);const s=void 0===t?this.Iu.length-1:t,h=new rt(3);return h.Fs(s,{Ws:0,zs:!0}),this.Zu(h),i}Ao(t,i,s){t.Ao(i,s)}Lo(t,i,s){t.Lo(i,s),this.ul(),this.Zu(this.ac(t,2))}Eo(t,i){t.Eo(i),this.Zu(this.ac(t,2))}Io(t,i,s){i.Aa()||t.Io(i,s)}Vo(t,i,s){i.Aa()||(t.Vo(i,s),this.ul(),this.Zu(this.ac(t,2)))}Bo(t,i){i.Aa()||(t.Bo(i),this.Zu(this.ac(t,2)))}Fo(t,i){t.Fo(i),this.Zu(this.ac(t,2))}oc(t){this.co.Ja(t)}_c(t,i){const s=this.yt();if(s.Fi()||0===i)return;const h=s.Xt();t=Math.max(1,Math.min(t,h)),s.au(t,i),this.tu()}uc(t){this.cc(0),this.dc(t),this.fc()}vc(t){this.co.Qa(t),this.tu()}mc(){this.co.io(),this.Sh()}cc(t){this.Bu=t,this.co.so(t)}dc(t){let i=!1;return null!==this.Bu&&Math.abs(t-this.Bu)>20&&(this.Bu=null,i=!0),this.co.no(t),this.tu(),i}fc(){this.co.eo(),this.Sh(),this.Bu=null}wt(){return this.Vu}bc(t,i,s){this.vt.gs(t,i);let h=NaN,e=this.co.J_(t);const n=this.co.Ln();null!==n&&(e=Math.min(Math.max(n.pn(),e),n.vn()));const r=s.fs(),o=r.xt();null!==o&&(h=r.ps(i,o)),h=this.Hu.Il(h,e,s),this.vt.ks(e,h,s),this.Sl(),this.Wu.m(this.vt.St(),{x:t,y:i})}wc(){this.rc().xs(),this.Sl(),this.Wu.m(null,null)}ul(){const t=this.vt.Ht();if(null!==t){const i=this.vt.Ss(),s=this.vt.ys();this.bc(i,s,t)}this.vt.Os()}gc(t,i,s){const h=this.co.vs(0);void 0!==i&&void 0!==s&&this.co.bt(i,s);const e=this.co.vs(0),n=this.co.G_(),r=this.co.Ln();if(null!==r&&null!==h&&null!==e){const i=r.Dr(n),s=h.e_>e.e_,o=null!==t&&t>n&&!s,l=i&&this.co.F().shiftVisibleRangeOnNewBar;if(o&&!l){const i=t-n;this.co.Ks(this.co.su()-i)}}this.co.lu(t)}fl(t){null!==t&&t.zo()}qe(t){const i=this.Iu.find((i=>i.qa().includes(t)));return void 0===i?null:i}tu(){this.Uu.Os(),this.Iu.forEach((t=>t.zo())),this.ul()}M(){this.Iu.forEach((t=>t.M())),this.Iu.length=0,this.us.localization.priceFormatter=void 0,this.us.localization.timeFormatter=void 0}Mc(){return this.$u}Ze(){return this.$u.F()}Mo(){return this.Fu}Sc(t,i){const s=this.Iu[0],h=this.yc(i,t,s);return this.Vu.push(h),1===this.Vu.length?this.ol():this.Sh(),h}kc(t){const i=this.qe(t),s=this.Vu.indexOf(t);u(-1!==s,"Series not found"),this.Vu.splice(s,1),f(i).Ka(t),t.M&&t.M()}al(t,i){const s=f(this.qe(t));s.Ka(t);const h=this.sc(i);if(null===h){const h=t.Xi();s.Ya(t,i,h)}else{const e=h.Ht===s?t.Xi():void 0;h.Ht.Ya(t,i,e)}}mu(){const t=new rt(2);t.Hs(),this.Zu(t)}Cc(t){const i=new rt(2);i.qs(t),this.Zu(i)}Ys(){const t=new rt(2);t.Ys(),this.Zu(t)}Xs(t){const i=new rt(2);i.Xs(t),this.Zu(i)}Ks(t){const i=new rt(2);i.Ks(t),this.Zu(i)}xc(){return this.us.rightPriceScale.visible?"right":"left"}Tc(){return this.Ku}U(){return this.Yu}At(t){const i=this.Ku,s=this.Yu;if(i===s)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.zu||this.zu.un!==s||this.zu.cn!==i)this.zu={un:s,cn:i,Dc:new Map};else{const i=this.zu.Dc.get(t);if(void 0!==i)return i}const h=function(t,i,s){const[h,e,n,r]=_(t),[o,l,a,u]=_(i),c=[v(h+s*(o-h)),v(e+s*(l-e)),v(n+s*(a-n)),m(r+s*(u-r))];return"rgba("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+")"}(s,i,t/100);return this.zu.Dc.set(t,h),h}ac(t,i){const s=new rt(i);if(null!==t){const h=this.Iu.indexOf(t);s.Fs(h,{Ws:i})}return s}Gu(t,i){return void 0===i&&(i=2),this.ac(this.qe(t),i)}Zu(t){this.ju&&this.ju(t),this.Iu.forEach((t=>t.$o().yh().bt()))}yc(t,i,s){const h=new xi(this,t,i),e=void 0!==t.priceScaleId?t.priceScaleId:this.xc();return s.Ya(h,e),nt(e)||h.Mh(t),h}Xu(t){const i=this.us.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}}function vs(t){return!S(t)&&!R(t)}function ms(t){return S(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(os||(os={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(ls||(ls={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(as||(as={}));class gs{constructor(t,i){this.Bt=t,this.Nt=i}ih(t){return this.Bt===t.Bt&&this.Nt===t.Nt}}function bs(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function ws(t){const i=f(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function Ms(t,i){const s=f(t.ownerDocument).createElement("canvas");t.appendChild(s);const e=(void 0===(n={allowDownsampling:!1})&&(n=h),new o(s,n));var n;return e.resizeCanvas({width:i.Bt,height:i.Nt}),e}function _s(t,i){return t.Pc-i.Pc}function ys(t,i,s){const h=(t.Pc-i.Pc)/(t.ot-i.ot);return Math.sign(h)*Math.min(Math.abs(h),s)}class Cs{constructor(t,i,s,h){this.Rc=null,this.Oc=null,this.Ac=null,this.Lc=null,this.Ec=null,this.Ic=0,this.Vc=0,this.Bc=!1,this.Nc=t,this.Fc=i,this.Wc=s,this.Qs=h}zc(t,i){if(null!==this.Rc){if(this.Rc.ot===i)return void(this.Rc.Pc=t);if(Math.abs(this.Rc.Pc-t)<this.Qs)return}this.Lc=this.Ac,this.Ac=this.Oc,this.Oc=this.Rc,this.Rc={ot:i,Pc:t}}hr(t,i){if(null===this.Rc||null===this.Oc)return;if(i-this.Rc.ot>50)return;let s=0;const h=ys(this.Rc,this.Oc,this.Fc),e=_s(this.Rc,this.Oc),n=[h],r=[e];if(s+=e,null!==this.Ac){const t=ys(this.Oc,this.Ac,this.Fc);if(Math.sign(t)===Math.sign(h)){const i=_s(this.Oc,this.Ac);if(n.push(t),r.push(i),s+=i,null!==this.Lc){const t=ys(this.Ac,this.Lc,this.Fc);if(Math.sign(t)===Math.sign(h)){const i=_s(this.Ac,this.Lc);n.push(t),r.push(i),s+=i}}}}let o=0;for(let l=0;l<n.length;++l)o+=r[l]/s*n[l];Math.abs(o)<this.Nc||(this.Ec={Pc:t,ot:i},this.Vc=o,this.Ic=function(t,i){const s=Math.log(i);return Math.log(1*s/-t)/s}(Math.abs(o),this.Wc))}jc(t){const i=f(this.Ec),s=t-i.ot;return i.Pc+this.Vc*(Math.pow(this.Wc,s)-1)/Math.log(this.Wc)}$c(t){return null===this.Ec||this.Hc(t)===this.Ic}Uc(){return this.Bc}qc(){this.Bc=!0}Hc(t){const i=t-f(this.Ec).ot;return Math.min(i,this.Ic)}}const Es="undefined"!=typeof window;function Ss(){return!!Es&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function xs(){return!!Es&&/iPhone|iPad|iPod/.test(window.navigator.platform)}class Rs{constructor(t,i,s){this.Yc=0,this.Xc=null,this.Kc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY},this.Zc=0,this.Gc=null,this.Jc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY},this.Qc=null,this.td=!1,this.sd=null,this.nd=null,this.ed=!1,this.rd=!1,this.hd=!1,this.ld=null,this.ad=null,this.od=null,this._d=null,this.ud=null,this.dd=null,this.fd=null,this.pd=0,this.vd=!1,this.md=!1,this.bd=!1,this.wd=0,this.gd=null,this.Md=!xs(),this.Sd=t=>{this.yd(t)},this.kd=t=>{if(this.Cd(t)){const i=this.xd(t);if(++this.Zc,this.Gc&&this.Zc>1){const{Td:s}=this.Dd(Ls(t),this.Jc);s<30&&!this.hd&&this.Pd(i,this.Od.Rd),this.Ad()}}else{const i=this.xd(t);if(++this.Yc,this.Xc&&this.Yc>1){const{Td:s}=this.Dd(Ls(t),this.Kc);s<5&&!this.rd&&this.Ld(i,this.Od.Ed),this.Id()}}},this.Vd=t,this.Od=i,this.us=s,this.Bd()}M(){null!==this.ld&&(this.ld(),this.ld=null),null!==this.ad&&(this.ad(),this.ad=null),null!==this._d&&(this._d(),this._d=null),null!==this.ud&&(this.ud(),this.ud=null),null!==this.dd&&(this.dd(),this.dd=null),null!==this.od&&(this.od(),this.od=null),this.Nd(),this.Id()}Fd(t){this._d&&this._d();const i=this.Wd.bind(this);if(this._d=()=>{this.Vd.removeEventListener("mousemove",i)},this.Vd.addEventListener("mousemove",i),this.Cd(t))return;const s=this.xd(t);this.Ld(s,this.Od.zd),this.Md=!0}Id(){null!==this.Xc&&clearTimeout(this.Xc),this.Yc=0,this.Xc=null,this.Kc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY}}Ad(){null!==this.Gc&&clearTimeout(this.Gc),this.Zc=0,this.Gc=null,this.Jc={nt:Number.NEGATIVE_INFINITY,et:Number.POSITIVE_INFINITY}}Wd(t){if(this.bd||null!==this.nd)return;if(this.Cd(t))return;const i=this.xd(t);this.Ld(i,this.Od.jd),this.Md=!0}$d(t){const i=Ns(t.changedTouches,f(this.gd));if(null===i)return;if(this.wd=Ps(t),null!==this.fd)return;if(this.md)return;this.vd=!0;const s=this.Dd(Ls(i),f(this.nd)),{Hd:h,Ud:e,Td:n}=s;if(this.ed||!(n<5)){if(!this.ed){const t=.5*h,i=e>=t&&!this.us.qd(),s=t>e&&!this.us.Yd();i||s||(this.md=!0),this.ed=!0,this.hd=!0,this.Nd(),this.Ad()}if(!this.md){const s=this.xd(t,i);this.Pd(s,this.Od.Xd),Ts(t)}}}Kd(t){if(0!==t.button)return;const i=this.Dd(Ls(t),f(this.sd)),{Td:s}=i;if(s>=5&&(this.rd=!0,this.Id()),this.rd){const i=this.xd(t);this.Ld(i,this.Od.Zd)}}Dd(t,i){const s=Math.abs(i.nt-t.nt),h=Math.abs(i.et-t.et);return{Hd:s,Ud:h,Td:s+h}}Gd(t){let i=Ns(t.changedTouches,f(this.gd));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.gd=null,this.wd=Ps(t),this.Nd(),this.nd=null,this.dd&&(this.dd(),this.dd=null);const s=this.xd(t,i);if(this.Pd(s,this.Od.Jd),++this.Zc,this.Gc&&this.Zc>1){const{Td:t}=this.Dd(Ls(i),this.Jc);t<30&&!this.hd&&this.Pd(s,this.Od.Rd),this.Ad()}else this.hd||(this.Pd(s,this.Od.Qd),this.Od.Qd&&Ts(t));0===this.Zc&&Ts(t),0===t.touches.length&&this.td&&(this.td=!1,Ts(t))}yd(t){if(0!==t.button)return;const i=this.xd(t);if(this.sd=null,this.bd=!1,this.ud&&(this.ud(),this.ud=null),Ss()&&this.Vd.ownerDocument.documentElement.removeEventListener("mouseleave",this.Sd),!this.Cd(t))if(this.Ld(i,this.Od.tf),++this.Yc,this.Xc&&this.Yc>1){const{Td:s}=this.Dd(Ls(t),this.Kc);s<5&&!this.rd&&this.Ld(i,this.Od.Ed),this.Id()}else this.rd||this.Ld(i,this.Od.if)}Nd(){null!==this.Qc&&(clearTimeout(this.Qc),this.Qc=null)}sf(t){if(null!==this.gd)return;const i=t.changedTouches[0];this.gd=i.identifier,this.wd=Ps(t);const s=this.Vd.ownerDocument.documentElement;this.hd=!1,this.ed=!1,this.md=!1,this.nd=Ls(i),this.dd&&(this.dd(),this.dd=null);{const i=this.$d.bind(this),h=this.Gd.bind(this);this.dd=()=>{s.removeEventListener("touchmove",i),s.removeEventListener("touchend",h)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",h,{passive:!1}),this.Nd(),this.Qc=setTimeout(this.nf.bind(this,t),240)}const h=this.xd(t,i);this.Pd(h,this.Od.ef),this.Gc||(this.Zc=0,this.Gc=setTimeout(this.Ad.bind(this),500),this.Jc=Ls(i))}rf(t){if(0!==t.button)return;const i=this.Vd.ownerDocument.documentElement;Ss()&&i.addEventListener("mouseleave",this.Sd),this.rd=!1,this.sd=Ls(t),this.ud&&(this.ud(),this.ud=null);{const t=this.Kd.bind(this),s=this.yd.bind(this);this.ud=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",s)}if(this.bd=!0,this.Cd(t))return;const s=this.xd(t);this.Ld(s,this.Od.hf),this.Xc||(this.Yc=0,this.Xc=setTimeout(this.Id.bind(this),500),this.Kc=Ls(t))}Bd(){this.Vd.addEventListener("mouseenter",this.Fd.bind(this)),this.Vd.addEventListener("touchcancel",this.Nd.bind(this));{const t=this.Vd.ownerDocument,i=t=>{this.Od.lf&&(t.composed&&this.Vd.contains(t.composedPath()[0])||t.target&&this.Vd.contains(t.target)||this.Od.lf())};this.ad=()=>{t.removeEventListener("touchstart",i)},this.ld=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}xs()&&(this.od=()=>{this.Vd.removeEventListener("dblclick",this.kd)},this.Vd.addEventListener("dblclick",this.kd)),this.Vd.addEventListener("mouseleave",this.af.bind(this)),this.Vd.addEventListener("touchstart",this.sf.bind(this),{passive:!0}),function(t){Es&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}(this.Vd),this.Vd.addEventListener("mousedown",this.rf.bind(this)),this._f(),this.Vd.addEventListener("touchmove",(()=>{}),{passive:!1})}_f(){void 0===this.Od.uf&&void 0===this.Od.cf&&void 0===this.Od.df||(this.Vd.addEventListener("touchstart",(t=>this.ff(t.touches)),{passive:!0}),this.Vd.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this.fd&&void 0!==this.Od.cf){const i=Fs(t.touches[0],t.touches[1])/this.pd;this.Od.cf(this.fd,i),Ts(t)}}),{passive:!1}),this.Vd.addEventListener("touchend",(t=>{this.ff(t.touches)})))}ff(t){1===t.length&&(this.vd=!1),2!==t.length||this.vd||this.td?this.pf():this.vf(t)}vf(t){const i=this.Vd.getBoundingClientRect()||{left:0,top:0};this.fd={nt:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,et:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.pd=Fs(t[0],t[1]),void 0!==this.Od.uf&&this.Od.uf(),this.Nd()}pf(){null!==this.fd&&(this.fd=null,void 0!==this.Od.df&&this.Od.df())}af(t){if(this._d&&this._d(),this.Cd(t))return;if(!this.Md)return;const i=this.xd(t);this.Ld(i,this.Od.mf),this.Md=!xs()}nf(t){const i=Ns(t.touches,f(this.gd));if(null===i)return;const s=this.xd(t,i);this.Pd(s,this.Od.bf),this.hd=!0,this.td=!0}Cd(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:Ps(t)<this.wd+500}Pd(t,i){i&&i.call(this.Od,t)}Ld(t,i){i&&i.call(this.Od,t)}xd(t,i){const s=i||t,h=this.Vd.getBoundingClientRect()||{left:0,top:0};return{wf:s.clientX,gf:s.clientY,Mf:s.pageX,Sf:s.pageY,yf:s.screenX,kf:s.screenY,Cf:s.clientX-h.left,xf:s.clientY-h.top,Tf:t.ctrlKey,Df:t.altKey,Pf:t.shiftKey,Rf:t.metaKey,Of:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,Af:t.type,Lf:s.target,Ef:t.view,If:()=>{"touchstart"!==t.type&&Ts(t)}}}}function Fs(t,i){const s=t.clientX-i.clientX,h=t.clientY-i.clientY;return Math.sqrt(s*s+h*h)}function Ts(t){t.cancelable&&t.preventDefault()}function Ls(t){return{nt:t.pageX,et:t.pageY}}function Ps(t){return t.timeStamp||performance.now()}function Ns(t,i){for(let s=0;s<t.length;++s)if(t[s].identifier===i)return t[s];return null}class Vs{constructor(t,i,s,h){this.Bi=null,this.Vf=null,this.Bf=!1,this.Nf=new At(200),this.Rr=null,this.Ff=0,this.Wf=!1,this.zf=()=>{this.Wf||this.Qi.jf().Ut().Sh()},this.$f=()=>{this.Wf||this.Qi.jf().Ut().Sh()},this.Qi=t,this.us=i,this.Ca=i.layout,this.$u=s,this.Hf="left"===h,this.Uf=document.createElement("div"),this.Uf.style.height="100%",this.Uf.style.overflow="hidden",this.Uf.style.width="25px",this.Uf.style.left="0",this.Uf.style.position="relative",this.qf=Ms(this.Uf,new gs(16,16)),this.qf.subscribeCanvasConfigured(this.zf);const e=this.qf.canvas;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.Yf=Ms(this.Uf,new gs(16,16)),this.Yf.subscribeCanvasConfigured(this.$f);const n=this.Yf.canvas;n.style.position="absolute",n.style.zIndex="2",n.style.left="0",n.style.top="0";const r={hf:this.Xf.bind(this),ef:this.Xf.bind(this),Zd:this.Kf.bind(this),Xd:this.Kf.bind(this),lf:this.Zf.bind(this),tf:this.Gf.bind(this),Jd:this.Gf.bind(this),Ed:this.Jf.bind(this),Rd:this.Jf.bind(this),zd:this.Qf.bind(this),mf:this.tp.bind(this)};this.ip=new Rs(this.Yf.canvas,r,{qd:()=>!1,Yd:()=>!0})}M(){this.ip.M(),this.Yf.unsubscribeCanvasConfigured(this.$f),this.Yf.destroy(),this.qf.unsubscribeCanvasConfigured(this.zf),this.qf.destroy(),null!==this.Bi&&this.Bi.Ga().v(this),this.Bi=null}sp(){return this.Uf}T(){return this.Ca.fontSize}np(){const t=this.$u.F();return this.Rr!==t.D&&(this.Nf.Ie(),this.Rr=t.D),t}ep(){if(null===this.Bi)return 0;let t=0;const i=this.np(),s=ws(this.qf.canvas),h=this.Bi.ql();s.font=this.rp(),h.length>0&&(t=Math.max(this.Nf.Mi(s,h[0].ra),this.Nf.Mi(s,h[h.length-1].ra)));const e=this.hp();for(let l=e.length;l--;){const i=this.Nf.Mi(s,e[l].ti());i>t&&(t=i)}const n=this.Bi.xt();if(null!==n&&null!==this.Vf){const i=this.Bi.ps(1,n),h=this.Bi.ps(this.Vf.Nt-2,n);t=Math.max(t,this.Nf.Mi(s,this.Bi.Wi(Math.floor(Math.min(i,h))+.11111111111111,n)),this.Nf.Mi(s,this.Bi.Wi(Math.ceil(Math.max(i,h))-.11111111111111,n)))}const r=t||34;let o=Math.ceil(i.k+i.C+i.L+i.I+5+r);return o+=o%2,o}lp(t){if(t.Bt<0||t.Nt<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.Vf&&this.Vf.ih(t)||(this.Vf=t,this.Wf=!0,this.qf.resizeCanvas({width:t.Bt,height:t.Nt}),this.Yf.resizeCanvas({width:t.Bt,height:t.Nt}),this.Wf=!1,this.Uf.style.width=t.Bt+"px",this.Uf.style.height=t.Nt+"px",this.Uf.style.minWidth=t.Bt+"px")}ap(){return f(this.Vf).Bt}Zi(t){this.Bi!==t&&(null!==this.Bi&&this.Bi.Ga().v(this),this.Bi=t,t.Ga().l(this.va.bind(this),this))}Pt(){return this.Bi}Ie(){const t=this.Qi.op();this.Qi.jf().Ut().Fo(t,f(this.Pt()))}_p(t){if(null===this.Vf)return;if(1!==t){const t=ws(this.qf.canvas);this.up(),this.cp(t,this.qf.pixelRatio),this.we(t,this.qf.pixelRatio),this.dp(t,this.qf.pixelRatio),this.fp(t,this.qf.pixelRatio)}const i=ws(this.Yf.canvas),s=this.Vf.Bt,h=this.Vf.Nt;W(i,this.Yf.pixelRatio,(()=>{i.clearRect(0,0,s,h)})),this.pp(i,this.Yf.pixelRatio)}vp(){return this.qf.canvas}bt(){var t;null===(t=this.Bi)||void 0===t||t.ql()}Xf(t){if(null===this.Bi||this.Bi.Fi()||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.jf().Ut(),s=this.Qi.op();this.Bf=!0,i.Ao(s,this.Bi,t.xf)}Kf(t){if(null===this.Bi||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.jf().Ut(),s=this.Qi.op(),h=this.Bi;i.Lo(s,h,t.xf)}Zf(){if(null===this.Bi||!this.us.handleScale.axisPressedMouseMove.price)return;const t=this.Qi.jf().Ut(),i=this.Qi.op(),s=this.Bi;this.Bf&&(this.Bf=!1,t.Eo(i,s))}Gf(t){if(null===this.Bi||!this.us.handleScale.axisPressedMouseMove.price)return;const i=this.Qi.jf().Ut(),s=this.Qi.op();this.Bf=!1,i.Eo(s,this.Bi)}Jf(t){this.us.handleScale.axisDoubleClickReset.price&&this.Ie()}Qf(t){null!==this.Bi&&(!this.Qi.jf().Ut().F().handleScale.axisPressedMouseMove.price||this.Bi.Zr()||this.Bi.La()||this.mp(1))}tp(t){this.mp(0)}hp(){const t=[],i=null===this.Bi?void 0:this.Bi;return(s=>{for(let h=0;h<s.length;++h){const e=s[h].Ps(this.Qi.op(),i);for(let i=0;i<e.length;i++)t.push(e[i])}})(this.Qi.op().qa()),t}cp(t,i){if(null===this.Vf)return;const s=this.Vf.Bt,h=this.Vf.Nt;W(t,i,(()=>{const i=this.Qi.op().Ut(),e=i.U(),n=i.Tc();e===n?A(t,0,0,s,h,e):Q(t,0,0,s,h,e,n)}))}we(t,i){if(null===this.Vf||null===this.Bi||!this.Bi.F().borderVisible)return;t.save(),t.fillStyle=this.Bi.F().borderColor;const s=Math.max(1,Math.floor(this.np().k*i));let h;h=this.Hf?Math.floor(this.Vf.Bt*i)-s:0,t.fillRect(h,0,s,Math.ceil(this.Vf.Nt*i)),t.restore()}dp(t,i){var s;if(null===this.Vf||null===this.Bi)return;const h=this.Bi.ql();t.save();const e=this.Bi.F();t.strokeStyle=e.borderColor,t.font=this.rp(),t.fillStyle=e.borderColor;const n=this.np(),r=this.Hf?Math.floor((this.Vf.Bt-n.C)*i):0,o=this.Hf?Math.round(r-n.L*i):Math.round(r+n.C*i+n.L*i),l=Math.max(1,Math.floor(i)),a=Math.floor(.5*i);if(e.borderVisible&&e.ticksVisible){const s=Math.round(n.C*i);t.beginPath();for(const e of h)t.rect(r,Math.round(e.zl*i)-a,s,l);t.fill()}t.fillStyle=null!==(s=e.textColor)&&void 0!==s?s:this.Ca.textColor,t.textAlign=this.Hf?"right":"left",t.textBaseline="middle";const u=h.map((i=>this.Nf.gi(t,i.ra)));W(t,i,(()=>{for(let s=h.length;s--;){const e=h[s];t.fillText(e.ra,o/i,e.zl+u[s])}})),t.restore()}up(){if(null===this.Vf||null===this.Bi)return;let t=this.Vf.Nt/2;const i=[],s=this.Bi.qa().slice(),h=this.Qi.op(),e=this.np();this.Bi===h.Xe()&&this.Qi.op().qa().forEach((t=>{h.Ye(t)&&s.push(t)}));const n=this.Bi.Vl()[0],r=this.Bi;s.forEach((s=>{const e=s.Ps(h,r);e.forEach((t=>{t.Ai(null),t.Li()&&i.push(t)})),n===s&&e.length>0&&(t=e[0].yi())}));const o=i.filter((i=>i.yi()<=t)),l=i.filter((i=>i.yi()>t));if(o.sort(((t,i)=>i.yi()-t.yi())),o.length&&l.length&&l.push(o[0]),l.sort(((t,i)=>t.yi()-i.yi())),i.forEach((t=>t.Ai(t.yi()))),this.Bi.F().alignLabels){for(let t=1;t<o.length;t++){const i=o[t],s=o[t-1],h=s.Kt(e,!1),n=i.yi(),r=s.Oi();n>r-h&&i.Ai(r-h)}for(let t=1;t<l.length;t++){const i=l[t],s=l[t-1],h=s.Kt(e,!0),n=i.yi(),r=s.Oi();n<r+h&&i.Ai(r+h)}}}fp(t,i){if(null===this.Vf)return;t.save();const s=this.Vf,h=this.hp(),e=this.np(),n=this.Hf?"right":"left";h.forEach((h=>{if(h.Ei()){const r=h.gt(f(this.Bi));t.save(),r.X(t,e,this.Nf,s.Bt,n,i),t.restore()}})),t.restore()}pp(t,i){if(null===this.Vf||null===this.Bi)return;t.save();const s=this.Vf,h=this.Qi.jf().Ut(),e=[],n=this.Qi.op(),r=h.rc().Ps(n,this.Bi);r.length&&e.push(r);const o=this.np(),l=this.Hf?"right":"left";e.forEach((h=>{h.forEach((h=>{t.save(),h.gt(f(this.Bi)).X(t,o,this.Nf,s.Bt,l,i),t.restore()}))})),t.restore()}mp(t){this.Uf.style.cursor=1===t?"ns-resize":"default"}va(){const t=this.ep();this.Ff<t&&this.Qi.jf().Ut().ol(),this.Ff=t}rp(){return V(this.Ca.fontSize,this.Ca.fontFamily)}}function Bs(t,i,s,h,e){t.Z&&t.Z(i,s,h,e)}function ks(t,i,s,h,e){t.X(i,s,h,e)}function Us(t,i){return t.Ds(i)}function Is(t,i){return t.Gi(i)}function Ds(t,i){return void 0!==t.Ml?t.Ml(i):[]}class zs{constructor(t,i){this.Vf=new gs(0,0),this.bp=null,this.wp=null,this.gp=null,this.Mp=!1,this.Sp=new C,this.yp=0,this.kp=!1,this.Cp=null,this.xp=!1,this.Tp=null,this.Dp=null,this.Wf=!1,this.zf=()=>{this.Wf||null===this.Pp||this.$i().Sh()},this.$f=()=>{this.Wf||null===this.Pp||this.$i().Sh()},this.Rp=t,this.Pp=i,this.Pp.jo().l(this.Op.bind(this),this,!0),this.Ap=document.createElement("td"),this.Ap.style.padding="0",this.Ap.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.Lp=document.createElement("td"),this.Lp.style.padding="0",this.Ep=document.createElement("td"),this.Ep.style.padding="0",this.Ap.appendChild(s),this.qf=Ms(s,new gs(16,16)),this.qf.subscribeCanvasConfigured(this.zf);const h=this.qf.canvas;h.style.position="absolute",h.style.zIndex="1",h.style.left="0",h.style.top="0",this.Yf=Ms(s,new gs(16,16)),this.Yf.subscribeCanvasConfigured(this.$f);const e=this.Yf.canvas;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0",this.Ip=document.createElement("tr"),this.Ip.appendChild(this.Lp),this.Ip.appendChild(this.Ap),this.Ip.appendChild(this.Ep),this.Vp(),this.ip=new Rs(this.Yf.canvas,this,{qd:()=>null===this.Cp&&!this.Rp.F().handleScroll.vertTouchDrag,Yd:()=>null===this.Cp&&!this.Rp.F().handleScroll.horzTouchDrag})}M(){null!==this.bp&&this.bp.M(),null!==this.wp&&this.wp.M(),this.Yf.unsubscribeCanvasConfigured(this.$f),this.Yf.destroy(),this.qf.unsubscribeCanvasConfigured(this.zf),this.qf.destroy(),null!==this.Pp&&this.Pp.jo().v(this),this.ip.M()}op(){return f(this.Pp)}Bp(t){null!==this.Pp&&this.Pp.jo().v(this),this.Pp=t,null!==this.Pp&&this.Pp.jo().l(zs.prototype.Op.bind(this),this,!0),this.Vp()}jf(){return this.Rp}sp(){return this.Ip}Vp(){if(null!==this.Pp&&(this.Np(),0!==this.$i().wt().length)){if(null!==this.bp){const t=this.Pp.Ro();this.bp.Zi(f(t))}if(null!==this.wp){const t=this.Pp.Oo();this.wp.Zi(f(t))}}}Fp(){null!==this.bp&&this.bp.bt(),null!==this.wp&&this.wp.bt()}So(){return null!==this.Pp?this.Pp.So():0}yo(t){this.Pp&&this.Pp.yo(t)}zd(t){if(!this.Pp)return;this.Wp();const i=t.Cf,s=t.xf;this.zp(i,s)}hf(t){this.Wp(),this.jp(),this.zp(t.Cf,t.xf)}jd(t){if(!this.Pp)return;this.Wp();const i=t.Cf,s=t.xf;this.zp(i,s);const h=this.Or(i,s);this.$i().Qu(h&&{tc:h.tc,$p:h.$p})}if(t){null!==this.Pp&&(this.Wp(),this.Hp(t))}Zd(t){this.Wp(),this.Up(t),this.zp(t.Cf,t.xf)}tf(t){null!==this.Pp&&(this.Wp(),this.kp=!1,this.qp(t))}Qd(t){null!==this.Pp&&this.Hp(t)}bf(t){if(this.kp=!0,null===this.Cp){const i={x:t.Cf,y:t.xf};this.Yp(i,i)}}mf(t){null!==this.Pp&&(this.Wp(),this.Pp.Ut().Qu(null),this.Xp())}Kp(){return this.Sp}uf(){this.yp=1,this.Zp()}cf(t,i){if(!this.Rp.F().handleScale.pinch)return;const s=5*(i-this.yp);this.yp=i,this.$i()._c(t.nt,s)}ef(t){if(this.kp=!1,this.xp=null!==this.Cp,this.jp(),null!==this.Cp){const i=this.$i().rc();this.Tp={x:i.Zt(),y:i.Gt()},this.Cp={x:t.Cf,y:t.xf}}}Xd(t){if(null===this.Pp)return;const i=t.Cf,s=t.xf;if(null===this.Cp)this.Up(t);else{this.xp=!1;const t=f(this.Tp),h=t.x+(i-this.Cp.x),e=t.y+(s-this.Cp.y);this.zp(h,e)}}Jd(t){0===this.jf().F().trackingMode.exitMode&&(this.xp=!0),this.Gp(),this.qp(t)}Or(t,i){const s=this.Pp;if(null===s)return null;const h=s.qa();for(const e of h){const h=this.Jp(e.Ds(s),t,i);if(null!==h)return{tc:e,Ef:h.Ef,$p:h.$p}}return null}Qp(t,i){f("left"===i?this.bp:this.wp).lp(new gs(t,this.Vf.Nt))}tv(){return this.Vf}lp(t){if(t.Bt<0||t.Nt<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.Vf.ih(t)||(this.Vf=t,this.Wf=!0,this.qf.resizeCanvas({width:t.Bt,height:t.Nt}),this.Yf.resizeCanvas({width:t.Bt,height:t.Nt}),this.Wf=!1,this.Ap.style.width=t.Bt+"px",this.Ap.style.height=t.Nt+"px")}iv(){const t=f(this.Pp);t.Po(t.Ro()),t.Po(t.Oo());for(const i of t.Vl())if(t.Ye(i)){const s=i.Pt();null!==s&&t.Po(s),i.Os()}}vp(){return this.qf.canvas}_p(t){if(0===t)return;if(null===this.Pp)return;if(t>1&&this.iv(),null!==this.bp&&this.bp._p(t),null!==this.wp&&this.wp._p(t),1!==t){const t=ws(this.qf.canvas);t.save(),this.cp(t,this.qf.pixelRatio),this.Pp&&(this.sv(t,this.qf.pixelRatio),this.nv(t,this.qf.pixelRatio),this.ev(t,this.qf.pixelRatio,Us),this.ev(t,this.qf.pixelRatio,Is)),t.restore()}const i=ws(this.Yf.canvas);i.clearRect(0,0,Math.ceil(this.Vf.Bt*this.Yf.pixelRatio),Math.ceil(this.Vf.Nt*this.Yf.pixelRatio)),this.ev(i,this.qf.pixelRatio,Ds),this.rv(i,this.Yf.pixelRatio)}hv(){return this.bp}lv(){return this.wp}Op(){null!==this.Pp&&this.Pp.jo().v(this),this.Pp=null}Hp(t){const i=t.Cf,s=t.xf;this.Sp.g()&&this.Sp.m(this.$i().yt().J_(i),{x:i,y:s})}cp(t,i){W(t,i,(()=>{const i=this.$i(),s=i.U(),h=i.Tc();s===h?A(t,0,0,this.Vf.Bt,this.Vf.Nt,h):Q(t,0,0,this.Vf.Bt,this.Vf.Nt,s,h)}))}sv(t,i){const s=f(this.Pp),h=s.$o().yh().gt(s.Kt(),s.Xt());null!==h&&(t.save(),h.X(t,i,!1),t.restore())}nv(t,i){const s=this.$i().ec();this.av(t,i,Us,Bs,s),this.av(t,i,Us,ks,s)}rv(t,i){this.av(t,i,Us,ks,this.$i().rc())}ev(t,i,s){const h=f(this.Pp).qa();for(const e of h)this.av(t,i,s,Bs,e);for(const e of h)this.av(t,i,s,ks,e)}av(t,i,s,h,e){const n=f(this.Pp),r=s(e,n),o=n.Kt(),l=n.Xt(),a=n.Ut().Ju(),u=null!==a&&a.tc===e,c=null!==a&&u&&void 0!==a.$p?a.$p.Ar:void 0;for(const f of r){const s=f.gt(o,l);null!==s&&(t.save(),h(s,t,i,u,c),t.restore())}}Jp(t,i,s){for(const h of t){const t=h.gt(this.Vf.Nt,this.Vf.Bt);if(null!==t&&t.Or){const e=t.Or(i,s);if(null!==e)return{Ef:h,$p:e}}}return null}Np(){if(null===this.Pp)return;const t=this.Rp,i=this.Pp.Ro().F().visible,s=this.Pp.Oo().F().visible;i||null===this.bp||(this.Lp.removeChild(this.bp.sp()),this.bp.M(),this.bp=null),s||null===this.wp||(this.Ep.removeChild(this.wp.sp()),this.wp.M(),this.wp=null);const h=t.Ut().Mc();i&&null===this.bp&&(this.bp=new Vs(this,t.F(),h,"left"),this.Lp.appendChild(this.bp.sp())),s&&null===this.wp&&(this.wp=new Vs(this,t.F(),h,"right"),this.Ep.appendChild(this.wp.sp()))}ov(t){return t.Of&&this.kp||null!==this.Cp}_v(t){return Math.max(0,Math.min(t,this.Vf.Bt-1))}uv(t){return Math.max(0,Math.min(t,this.Vf.Nt-1))}zp(t,i){this.$i().bc(this._v(t),this.uv(i),f(this.Pp))}Xp(){this.$i().wc()}Gp(){this.xp&&(this.Cp=null,this.Xp())}Yp(t,i){this.Cp=t,this.xp=!1,this.zp(i.x,i.y);const s=this.$i().rc();this.Tp={x:s.Zt(),y:s.Gt()}}$i(){return this.Rp.Ut()}cv(){const t=this.$i(),i=this.op(),s=i.fs();t.Bo(i,s),t.fc(),this.gp=null,this.Mp=!1}qp(t){if(!this.Mp)return;const i=performance.now();if(null!==this.Dp&&this.Dp.hr(t.Cf,i),null===this.Dp||this.Dp.$c(i))return void this.cv();const s=this.$i(),h=s.yt(),e=this.Dp,n=()=>{if(e.Uc())return;const t=performance.now();let i=e.$c(t);if(!e.Uc()){const n=h.su();s.dc(e.jc(t)),n===h.su()&&(i=!0,this.Dp=null)}i?this.cv():requestAnimationFrame(n)};requestAnimationFrame(n)}Wp(){this.Cp=null}jp(){if(this.Pp){if(this.Zp(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)f(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.Pp.fs().Fi()&&this.$i().yt().Fi()}}Up(t){if(null===this.Pp)return;const i=this.$i();if(i.yt().Fi())return;const s=this.Rp.F(),h=s.handleScroll,e=s.kineticScroll;if((!h.pressedMouseMove||t.Of)&&(!h.horzTouchDrag&&!h.vertTouchDrag||!t.Of))return;const n=this.Pp.fs(),r=performance.now();null!==this.gp||this.ov(t)||(this.gp={x:t.wf,y:t.gf,e_:r,Cf:t.Cf,xf:t.xf}),null!==this.Dp&&this.Dp.zc(t.Cf,r),null===this.gp||this.Mp||this.gp.x===t.wf&&this.gp.y===t.gf||(null===this.Dp&&(t.Of&&e.touch||!t.Of&&e.mouse)&&(this.Dp=new Cs(.2,7,.997,15),this.Dp.zc(this.gp.Cf,this.gp.e_),this.Dp.zc(t.Cf,r)),n.Fi()||i.Io(this.Pp,n,t.xf),i.cc(t.Cf),this.Mp=!0),this.Mp&&(n.Fi()||i.Vo(this.Pp,n,t.xf),i.dc(t.Cf))}Zp(){const t=performance.now(),i=null===this.Dp||this.Dp.$c(t);null!==this.Dp&&(i||this.cv()),null!==this.Dp&&(this.Dp.qc(),this.Dp=null)}}class Os{constructor(t,i,s,h,e){this.ft=!0,this.Vf=new gs(0,0),this.zf=()=>this._p(3),this.Hf="left"===t,this.$u=s.Mc,this.us=i,this.dv=h,this.fv=e,this.Uf=document.createElement("div"),this.Uf.style.width="25px",this.Uf.style.height="100%",this.Uf.style.overflow="hidden",this.qf=Ms(this.Uf,new gs(16,16)),this.qf.subscribeCanvasConfigured(this.zf)}M(){this.qf.unsubscribeCanvasConfigured(this.zf),this.qf.destroy()}sp(){return this.Uf}tv(){return this.Vf}lp(t){if(t.Bt<0||t.Nt<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.Vf.ih(t)||(this.Vf=t,this.qf.resizeCanvas({width:t.Bt,height:t.Nt}),this.Uf.style.width=t.Bt+"px",this.Uf.style.minWidth=t.Bt+"px",this.Uf.style.height=t.Nt+"px",this.ft=!0)}_p(t){if(t<3&&!this.ft)return;if(0===this.Vf.Bt||0===this.Vf.Nt)return;this.ft=!1;const i=ws(this.qf.canvas);this.cp(i,this.qf.pixelRatio),this.we(i,this.qf.pixelRatio)}vp(){return this.qf.canvas}we(t,i){if(!this.dv())return;const s=this.Vf.Bt;t.save(),t.fillStyle=this.us.timeScale.borderColor;const h=Math.floor(this.$u.F().k*i),e=this.Hf?Math.round(s*i)-h:0;t.fillRect(e,0,h,h),t.restore()}cp(t,i){W(t,i,(()=>{A(t,0,0,this.Vf.Bt,this.Vf.Nt,this.fv())}))}}function js(t,i){return t.d_>i.d_?t:i}class qs{constructor(t){this.pv=null,this.vv=null,this.S=null,this.mv=!1,this.Vf=new gs(0,0),this.bv=new C,this.Nf=new At(5),this.Wf=!1,this.zf=()=>{this.Wf||this.Rp.Ut().Sh()},this.$f=()=>{this.Wf||this.Rp.Ut().Sh()},this.Rp=t,this.us=t.F().layout,this.wv=document.createElement("tr"),this.gv=document.createElement("td"),this.gv.style.padding="0",this.Mv=document.createElement("td"),this.Mv.style.padding="0",this.Uf=document.createElement("td"),this.Uf.style.height="25px",this.Uf.style.padding="0",this.Sv=document.createElement("div"),this.Sv.style.width="100%",this.Sv.style.height="100%",this.Sv.style.position="relative",this.Sv.style.overflow="hidden",this.Uf.appendChild(this.Sv),this.qf=Ms(this.Sv,new gs(16,16)),this.qf.subscribeCanvasConfigured(this.zf);const i=this.qf.canvas;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this.Yf=Ms(this.Sv,new gs(16,16)),this.Yf.subscribeCanvasConfigured(this.$f);const s=this.Yf.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.wv.appendChild(this.gv),this.wv.appendChild(this.Uf),this.wv.appendChild(this.Mv),this.yv(),this.Rp.Ut().Mo().l(this.yv.bind(this),this),this.ip=new Rs(this.Yf.canvas,this,{qd:()=>!0,Yd:()=>!1})}M(){this.ip.M(),null!==this.pv&&this.pv.M(),null!==this.vv&&this.vv.M(),this.Yf.unsubscribeCanvasConfigured(this.$f),this.Yf.destroy(),this.qf.unsubscribeCanvasConfigured(this.zf),this.qf.destroy()}sp(){return this.wv}kv(){return this.pv}Cv(){return this.vv}hf(t){if(this.mv)return;this.mv=!0;const i=this.Rp.Ut();!i.yt().Fi()&&this.Rp.F().handleScale.axisPressedMouseMove.time&&i.oc(t.Cf)}ef(t){this.hf(t)}lf(){const t=this.Rp.Ut();!t.yt().Fi()&&this.mv&&(this.mv=!1,this.Rp.F().handleScale.axisPressedMouseMove.time&&t.mc())}Zd(t){const i=this.Rp.Ut();!i.yt().Fi()&&this.Rp.F().handleScale.axisPressedMouseMove.time&&i.vc(t.Cf)}Xd(t){this.Zd(t)}tf(){this.mv=!1;const t=this.Rp.Ut();t.yt().Fi()&&!this.Rp.F().handleScale.axisPressedMouseMove.time||t.mc()}Jd(){this.tf()}Ed(){this.Rp.F().handleScale.axisDoubleClickReset.time&&this.Rp.Ut().Ys()}Rd(){this.Ed()}zd(){this.Rp.Ut().F().handleScale.axisPressedMouseMove.time&&this.mp(1)}mf(){this.mp(0)}tv(){return this.Vf}xv(){return this.bv}Tv(t,i,s){this.Vf&&this.Vf.ih(t)||(this.Vf=t,this.Wf=!0,this.qf.resizeCanvas({width:t.Bt,height:t.Nt}),this.Yf.resizeCanvas({width:t.Bt,height:t.Nt}),this.Wf=!1,this.Uf.style.width=t.Bt+"px",this.Uf.style.height=t.Nt+"px",this.bv.m(t)),null!==this.pv&&this.pv.lp(new gs(i,t.Nt)),null!==this.vv&&this.vv.lp(new gs(s,t.Nt))}Dv(){const t=this.Pv();return Math.ceil(t.k+t.C+t.T+t.V+t.A+t.Rv)}bt(){this.Rp.Ut().yt().ql()}vp(){return this.qf.canvas}_p(t){if(0===t)return;if(1!==t){const i=ws(this.qf.canvas);this.cp(i,this.qf.pixelRatio),this.we(i,this.qf.pixelRatio),this.dp(i,this.qf.pixelRatio),null!==this.pv&&this.pv._p(t),null!==this.vv&&this.vv._p(t)}const i=ws(this.Yf.canvas),s=this.Yf.pixelRatio;i.clearRect(0,0,Math.ceil(this.Vf.Bt*s),Math.ceil(this.Vf.Nt*s)),this.Ov([this.Rp.Ut().rc()],i,s)}cp(t,i){W(t,i,(()=>{A(t,0,0,this.Vf.Bt,this.Vf.Nt,this.Rp.Ut().Tc())}))}we(t,i){if(this.Rp.F().timeScale.borderVisible){t.save(),t.fillStyle=this.Av();const s=Math.max(1,Math.floor(this.Pv().k*i));t.fillRect(0,0,Math.ceil(this.Vf.Bt*i),s),t.restore()}}dp(t,i){const s=this.Rp.Ut().yt(),h=s.ql();if(!h||0===h.length)return;let e=h.reduce(js,h[0]).d_;e>30&&e<50&&(e=30),t.save(),t.strokeStyle=this.Av();const n=this.Pv(),r=n.k+n.C+n.V+n.T/2;t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.Av();const o=Math.max(1,Math.floor(i)),l=Math.floor(.5*i),a=s.F();if(a.borderVisible&&a.ticksVisible){t.beginPath();const s=Math.round(n.C*i);for(let e=h.length;e--;){const n=Math.round(h[e].zl*i);t.rect(n-l,0,o,s)}t.fill()}t.fillStyle=this.$(),W(t,i,(()=>{t.font=this.rp();for(const i of h)if(i.d_<e){const s=i.ru?this.Lv(t,i.zl,i.ra):i.zl;t.fillText(i.ra,s,r)}t.font=this.Ev();for(const i of h)if(i.d_>=e){const s=i.ru?this.Lv(t,i.zl,i.ra):i.zl;t.fillText(i.ra,s,r)}})),t.restore()}Lv(t,i,s){const h=this.Nf.Mi(t,s),e=h/2,n=Math.floor(i-e)+.5;return n<0?i+=Math.abs(0-n):n+h>this.Vf.Bt&&(i-=Math.abs(this.Vf.Bt-(n+h))),i}Ov(t,i,s){const h=this.Pv();for(const e of t)for(const t of e.Ji())i.save(),t.gt().X(i,h,s),i.restore()}Av(){return this.Rp.F().timeScale.borderColor}$(){return this.us.textColor}W(){return this.us.fontSize}rp(){return V(this.W(),this.us.fontFamily)}Ev(){return V(this.W(),this.us.fontFamily,"bold")}Pv(){null===this.S&&(this.S={k:1,B:NaN,V:NaN,A:NaN,ji:NaN,C:5,T:NaN,D:"",zi:new At,Rv:0});const t=this.S,i=this.rp();if(t.D!==i){const s=this.W();t.T=s,t.D=i,t.V=3*s/12,t.A=3*s/12,t.ji=9*s/12,t.B=0,t.Rv=4*s/12,t.zi.Ie()}return this.S}mp(t){this.Uf.style.cursor=1===t?"ew-resize":"default"}yv(){const t=this.Rp.Ut(),i=t.F();i.leftPriceScale.visible||null===this.pv||(this.gv.removeChild(this.pv.sp()),this.pv.M(),this.pv=null),i.rightPriceScale.visible||null===this.vv||(this.Mv.removeChild(this.vv.sp()),this.vv.M(),this.vv=null);const s={Mc:this.Rp.Ut().Mc()},h=()=>i.leftPriceScale.borderVisible&&t.yt().F().borderVisible,e=()=>t.Tc();i.leftPriceScale.visible&&null===this.pv&&(this.pv=new Os("left",i,s,h,e),this.gv.appendChild(this.pv.sp())),i.rightPriceScale.visible&&null===this.vv&&(this.vv=new Os("right",i,s,h,e),this.Mv.appendChild(this.vv.sp()))}}class $s{constructor(t,i){var s;this.Iv=[],this.Vv=0,this.aa=0,this.ze=0,this.Bv=0,this.Nv=0,this.Fv=null,this.Wv=!1,this.Sp=new C,this.Wu=new C,this.us=i,this.wv=document.createElement("div"),this.wv.classList.add("tv-lightweight-charts"),this.wv.style.overflow="hidden",this.wv.style.width="100%",this.wv.style.height="100%",(s=this.wv).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.zv=document.createElement("table"),this.zv.setAttribute("cellspacing","0"),this.wv.appendChild(this.zv),this.jv=this.$v.bind(this),this.wv.addEventListener("wheel",this.jv,{passive:!1}),this.$i=new ps(this.ju.bind(this),this.us),this.Ut().hc().l(this.Hv.bind(this),this),this.Uv=new qs(this),this.zv.appendChild(this.Uv.sp());let h=this.us.width,e=this.us.height;if(0===h||0===e){const i=t.getBoundingClientRect();0===h&&(h=Math.floor(i.width),h-=h%2),0===e&&(e=Math.floor(i.height),e-=e%2)}this.qv(h,e),this.Yv(),t.appendChild(this.wv),this.Xv(),this.$i.yt().pu().l(this.$i.ol.bind(this.$i),this),this.$i.Mo().l(this.$i.ol.bind(this.$i),this)}Ut(){return this.$i}F(){return this.us}Kv(){return this.Iv}Zv(){return this.Uv}M(){this.wv.removeEventListener("wheel",this.jv),0!==this.Vv&&window.cancelAnimationFrame(this.Vv),this.$i.hc().v(this),this.$i.yt().pu().v(this),this.$i.Mo().v(this),this.$i.M();for(const t of this.Iv)this.zv.removeChild(t.sp()),t.Kp().v(this),t.M();this.Iv=[],f(this.Uv).M(),null!==this.wv.parentElement&&this.wv.parentElement.removeChild(this.wv),this.Wu.M(),this.Sp.M()}qv(t,i,s){if(void 0===s&&(s=!1),this.aa===i&&this.ze===t)return;this.aa=i,this.ze=t;const h=i+"px",e=t+"px";f(this.wv).style.height=h,f(this.wv).style.width=e,this.zv.style.height=h,this.zv.style.width=e,s?this.Gv(new rt(3)):this.$i.ol()}_p(t){void 0===t&&(t=new rt(3));for(let i=0;i<this.Iv.length;i++)this.Iv[i]._p(t.$s(i).Ws);this.us.timeScale.visible&&this.Uv._p(t.js())}Mh(t){this.$i.Mh(t),this.Xv();const i=t.width||this.ze,s=t.height||this.aa;this.qv(i,s)}Kp(){return this.Sp}hc(){return this.Wu}Jv(){null!==this.Fv&&(this.Gv(this.Fv),this.Fv=null);const t=this.Iv[0],i=function(t,i){const s=t.createElement("canvas"),h=bs(s);return s.style.width=i.Bt+"px",s.style.height=i.Nt+"px",s.width=i.Bt*h,s.height=i.Nt*h,s}(document,new gs(this.ze,this.aa)),s=ws(i),h=bs(i);return W(s,h,(()=>{let i=0,h=0;const e=t=>{for(let e=0;e<this.Iv.length;e++){const n=this.Iv[e],r=n.tv().Nt,o=f("left"===t?n.hv():n.lv()),l=o.vp();s.drawImage(l,i,h,o.ap(),r),h+=r}};this.Qv()&&(e("left"),i=f(t.hv()).ap()),h=0;for(let t=0;t<this.Iv.length;t++){const e=this.Iv[t],n=e.tv(),r=e.vp();s.drawImage(r,i,h,n.Bt,n.Nt),h+=n.Nt}i+=t.tv().Bt,this.tm()&&(h=0,e("right"));const n=t=>{const e=f("left"===t?this.Uv.kv():this.Uv.Cv()),n=e.tv(),r=e.vp();s.drawImage(r,i,h,n.Bt,n.Nt)};if(this.us.timeScale.visible){i=0,this.Qv()&&(n("left"),i=f(t.hv()).ap());const e=this.Uv.tv(),r=this.Uv.vp();s.drawImage(r,i,h,e.Bt,e.Nt),this.tm()&&(i+=t.tv().Bt,n("right"),s.restore())}})),i}im(t){return("left"!==t||this.Qv())&&("right"!==t||this.tm())?0===this.Iv.length?0:f("left"===t?this.Iv[0].hv():this.Iv[0].lv()).ap():0}sm(){let t=0,i=0,s=0;for(const d of this.Iv)this.Qv()&&(i=Math.max(i,f(d.hv()).ep())),this.tm()&&(s=Math.max(s,f(d.lv()).ep())),t+=d.So();const h=this.ze,e=this.aa,n=Math.max(h-i-s,0),r=this.us.timeScale.visible;let o=r?this.Uv.Dv():0;o%2&&(o+=1);const l=0+o,a=e<l?0:e-l,u=a/t;let c=0;for(let f=0;f<this.Iv.length;++f){const t=this.Iv[f];t.Bp(this.$i.nc()[f]);let h=0,e=0;e=f===this.Iv.length-1?a-c:Math.round(t.So()*u),h=Math.max(e,2),c+=h,t.lp(new gs(n,h)),this.Qv()&&t.Qp(i,"left"),this.tm()&&t.Qp(s,"right"),t.op()&&this.$i.lc(t.op(),h)}this.Uv.Tv(new gs(r?n:0,o),r?i:0,r?s:0),this.$i.ko(n),this.Bv!==i&&(this.Bv=i),this.Nv!==s&&(this.Nv=s)}$v(t){let i=t.deltaX/100,s=-t.deltaY/100;if(0!==i&&this.us.handleScroll.mouseWheel||0!==s&&this.us.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,s*=120;break;case t.DOM_DELTA_LINE:i*=32,s*=32}if(0!==s&&this.us.handleScale.mouseWheel){const i=Math.sign(s)*Math.min(1,Math.abs(s)),h=t.clientX-this.wv.getBoundingClientRect().left;this.Ut()._c(h,i)}0!==i&&this.us.handleScroll.mouseWheel&&this.Ut().uc(-80*i)}}Gv(t){var i;const s=t.js();3===s&&this.nm(),3!==s&&2!==s||(this.rm(t),this.hm(t),this.Uv.bt(),this.Iv.forEach((t=>{t.Fp()})),3===(null===(i=this.Fv)||void 0===i?void 0:i.js())&&(this.Fv.Gs(t),this.nm(),this.rm(this.Fv),this.hm(this.Fv),t=this.Fv,this.Fv=null)),this._p(t)}hm(t){const i=t.Zs();for(const s of i)this.Js(s)}rm(t){const i=this.$i.nc();for(let s=0;s<i.length;s++)t.$s(s).zs&&i[s].Wo()}Js(t){const i=this.$i.yt();switch(t.Us){case 0:i.mu();break;case 1:i.bu(t.Rt);break;case 2:i.Xs(t.Rt);break;case 3:i.Ks(t.Rt);break;case 4:i.hu()}}ju(t){null!==this.Fv?this.Fv.Gs(t):this.Fv=t,this.Wv||(this.Wv=!0,this.Vv=window.requestAnimationFrame((()=>{if(this.Wv=!1,this.Vv=0,null!==this.Fv){const t=this.Fv;this.Fv=null,this.Gv(t)}})))}nm(){this.Yv()}Yv(){const t=this.$i.nc(),i=t.length,s=this.Iv.length;for(let h=i;h<s;h++){const t=c(this.Iv.pop());this.zv.removeChild(t.sp()),t.Kp().v(this),t.M()}for(let h=s;h<i;h++){const i=new zs(this,t[h]);i.Kp().l(this.lm.bind(this),this),this.Iv.push(i),this.zv.insertBefore(i.sp(),this.Uv.sp())}for(let h=0;h<i;h++){const i=t[h],s=this.Iv[h];s.op()!==i?s.Bp(i):s.Vp()}this.Xv(),this.sm()}am(t,i){var s;const h=new Map;let e;if(null!==t&&this.$i.wt().forEach((i=>{const s=i.Is().Nh(t);null!==s&&h.set(i,s)})),null!==t){const i=null===(s=this.$i.yt().Hi(t))||void 0===s?void 0:s.f_;void 0!==i&&(e=i)}const n=this.Ut().Ju(),r=null!==n&&n.tc instanceof xi?n.tc:void 0,o=null!==n&&void 0!==n.$p?n.$p.Er:void 0;return{ot:e,jn:null!=t?t:void 0,om:null!=i?i:void 0,_m:r,um:h,dm:o}}lm(t,i){this.Sp.m((()=>this.am(t,i)))}Hv(t,i){this.Wu.m((()=>this.am(t,i)))}Xv(){const t=this.us.timeScale.visible?"":"none";this.Uv.sp().style.display=t}Qv(){return this.Iv[0].op().Ro().F().visible}tm(){return this.Iv[0].op().Oo().F().visible}}function Ws(t,i,s,h){const e=s.value,n={jn:i,ot:t,Rt:[e,e,e,e],f_:h};return void 0!==s.color&&(n.R=s.color),n}function As(t){return void 0!==t.Rt}function Ys(t){return(i,s,h,e)=>{return void 0===(n=h).open&&void 0===n.value?{ot:i,jn:s,f_:e}:t(i,s,h,e);var n}}const Xs={Candlestick:Ys((function(t,i,s,h){const e={jn:i,ot:t,Rt:[s.open,s.high,s.low,s.close],f_:h};return void 0!==s.color&&(e.R=s.color),void 0!==s.borderColor&&(e.Ot=s.borderColor),void 0!==s.wickColor&&(e.xh=s.wickColor),e})),Bar:Ys((function(t,i,s,h){const e={jn:i,ot:t,Rt:[s.open,s.high,s.low,s.close],f_:h};return void 0!==s.color&&(e.R=s.color),e})),Area:Ys((function(t,i,s,h){const e=s.value,n={jn:i,ot:t,Rt:[e,e,e,e],f_:h};return void 0!==s.lineColor&&(n.lt=s.lineColor),void 0!==s.topColor&&(n.un=s.topColor),void 0!==s.bottomColor&&(n.cn=s.bottomColor),n})),Baseline:Ys((function(t,i,s,h){const e=s.value,n={jn:i,ot:t,Rt:[e,e,e,e],f_:h};return void 0!==s.topLineColor&&(n.de=s.topLineColor),void 0!==s.bottomLineColor&&(n.fe=s.bottomLineColor),void 0!==s.topFillColor1&&(n.ae=s.topFillColor1),void 0!==s.topFillColor2&&(n.oe=s.topFillColor2),void 0!==s.bottomFillColor1&&(n._e=s.bottomFillColor1),void 0!==s.bottomFillColor2&&(n.ue=s.bottomFillColor2),n})),Histogram:Ys(Ws),Line:Ys(Ws)};function Ks(t){return Xs[t]}function Qs(t){return 60*t*60*1e3}function Zs(t){return 60*t*1e3}const Gs=[{fm:(1,1e3),d_:10},{fm:Zs(1),d_:20},{fm:Zs(5),d_:21},{fm:Zs(30),d_:22},{fm:Qs(1),d_:30},{fm:Qs(3),d_:31},{fm:Qs(6),d_:32},{fm:Qs(12),d_:33}];function Js(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let s=Gs.length-1;s>=0;--s)if(Math.floor(i.getTime()/Gs[s].fm)!==Math.floor(t.getTime()/Gs[s].fm))return Gs[s].d_;return 0}function Hs(t,i){if(void 0===i&&(i=0),0===t.length)return;let s=0===i?null:t[i-1].ot.e_,h=null!==s?new Date(1e3*s):null,e=0;for(let n=i;n<t.length;++n){const i=t[n],r=new Date(1e3*i.ot.e_);null!==h&&(i.c_=Js(r,h)),e+=i.ot.e_-(s||i.ot.e_),s=i.ot.e_,h=r}if(0===i&&t.length>1){const i=Math.ceil(e/(t.length-1)),s=new Date(1e3*(t[0].ot.e_-i));t[0].c_=Js(new Date(1e3*t[0].ot.e_),s)}}function th(t){if(!vs(t))throw new Error("time must be of type BusinessDay");const i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{e_:Math.round(i.getTime()/1e3),n_:t}}function ih(t){if(!ms(t))throw new Error("time must be of type isUTCTimestamp");return{e_:t}}function sh(t){return 0===t.length?null:vs(t[0].time)?th:ih}function hh(t){return ms(t)?ih(t):vs(t)?th(t):th(eh(t))}function eh(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error("Invalid date string="+t+", expected format=yyyy-mm-dd");return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function nh(t){R(t.time)&&(t.time=eh(t.time))}function rh(t){return{jn:0,pm:new Map,gl:t}}function oh(t){if(void 0!==t&&0!==t.length)return{vm:t[0].ot.e_,bm:t[t.length-1].ot.e_}}function lh(t){let i;return t.forEach((t=>{void 0===i&&(i=t.f_)})),c(i)}function ah(t){void 0===t.f_&&(t.f_=t.time)}class uh{constructor(){this.wm=new Map,this.gm=new Map,this.Mm=new Map,this.Sm=[]}M(){this.wm.clear(),this.gm.clear(),this.Mm.clear(),this.Sm=[]}ym(t,i){let s=0!==this.wm.size,h=!1;const e=this.gm.get(t);if(void 0!==e)if(1===this.gm.size)s=!1,h=!0,this.wm.clear();else for(const o of this.Sm)o.pointData.pm.delete(t)&&(h=!0);let n=[];if(0!==i.length){const s=i;s.forEach((t=>ah(t))),function(t){t.forEach(nh)}(i);const e=f(sh(i)),r=Ks(t.Rh());n=s.map((i=>{const s=e(i.time);let n=this.wm.get(s.e_);void 0===n&&(n=rh(s),this.wm.set(s.e_,n),h=!0);const o=r(s,n.jn,i,i.f_);return n.pm.set(t,o),o}))}s&&this.km(),this.Cm(t,n);let r=-1;if(h){const t=[];this.wm.forEach((i=>{t.push({c_:0,ot:i.gl,pointData:i,f_:lh(i.pm)})})),t.sort(((t,i)=>t.ot.e_-i.ot.e_)),r=this.xm(t)}return this.Tm(t,r,function(t,i){const s=oh(t),h=oh(i);if(void 0!==s&&void 0!==h)return{dl:s.bm>=h.bm&&s.vm>=h.vm}}(this.gm.get(t),e))}kc(t){return this.ym(t,[])}Dm(t,i){const s=i;ah(s),nh(i);const h=f(sh([i]))(i.time),e=this.Mm.get(t);if(void 0!==e&&h.e_<e.e_)throw new Error("Cannot update oldest data, last time="+e.e_+", new time="+h.e_);let n=this.wm.get(h.e_);const r=void 0===n;void 0===n&&(n=rh(h),this.wm.set(h.e_,n));const o=Ks(t.Rh())(h,n.jn,i,s.f_);n.pm.set(t,o),this.Pm(t,o);const l={dl:As(o)};if(!r)return this.Tm(t,-1,l);const a={c_:0,ot:n.gl,pointData:n,f_:lh(n.pm)},u=_t(this.Sm,a.ot.e_,((t,i)=>t.ot.e_<i));this.Sm.splice(u,0,a);for(let c=u;c<this.Sm.length;++c)ch(this.Sm[c].pointData,c);return Hs(this.Sm,u),this.Tm(t,u,l)}Pm(t,i){let s=this.gm.get(t);void 0===s&&(s=[],this.gm.set(t,s));const h=0!==s.length?s[s.length-1]:null;null===h||i.ot.e_>h.ot.e_?As(i)&&s.push(i):As(i)?s[s.length-1]=i:s.splice(-1,1),this.Mm.set(t,i.ot)}Cm(t,i){0!==i.length?(this.gm.set(t,i.filter(As)),this.Mm.set(t,i[i.length-1].ot)):(this.gm.delete(t),this.Mm.delete(t))}km(){for(const t of this.Sm)0===t.pointData.pm.size&&this.wm.delete(t.ot.e_)}xm(t){let i=-1;for(let s=0;s<this.Sm.length&&s<t.length;++s){const h=this.Sm[s],e=t[s];if(h.ot.e_!==e.ot.e_){i=s;break}e.c_=h.c_,ch(e.pointData,s)}if(-1===i&&this.Sm.length!==t.length&&(i=Math.min(this.Sm.length,t.length)),-1===i)return-1;for(let s=i;s<t.length;++s)ch(t[s].pointData,s);return Hs(t,i),this.Sm=t,i}Rm(){if(0===this.gm.size)return null;let t=0;return this.gm.forEach((i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].jn))})),t}Tm(t,i,s){const h={Om:new Map,yt:{G_:this.Rm()}};if(-1!==i)this.gm.forEach(((i,e)=>{h.Om.set(e,{ir:i,Am:e===t?s:void 0})})),this.gm.has(t)||h.Om.set(t,{ir:[],Am:s}),h.yt.Lm=this.Sm,h.yt.Em=i;else{const i=this.gm.get(t);h.Om.set(t,{ir:i||[],Am:s})}return h}}function ch(t,i){t.jn=i,t.pm.forEach((t=>{t.jn=i}))}function fh(t){return{value:t.Rt[3],time:t.f_}}function dh(t){const i=fh(t);return void 0!==t.R&&(i.color=t.R),i}function ph(t){return{open:t.Rt[0],high:t.Rt[1],low:t.Rt[2],close:t.Rt[3],time:t.f_}}const vh={Area:function(t){const i=fh(t);return void 0!==t.lt&&(i.lineColor=t.lt),void 0!==t.un&&(i.topColor=t.un),void 0!==t.cn&&(i.bottomColor=t.cn),i},Line:dh,Baseline:function(t){const i=fh(t);return void 0!==t.de&&(i.topLineColor=t.de),void 0!==t.fe&&(i.bottomLineColor=t.fe),void 0!==t.ae&&(i.topFillColor1=t.ae),void 0!==t.oe&&(i.topFillColor2=t.oe),void 0!==t._e&&(i.bottomFillColor1=t._e),void 0!==t.ue&&(i.bottomFillColor2=t.ue),i},Histogram:dh,Bar:function(t){const i=ph(t);return void 0!==t.R&&(i.color=t.R),i},Candlestick:function(t){const i=ph(t),{R:s,Ot:h,xh:e}=t;return void 0!==s&&(i.color=s),void 0!==h&&(i.borderColor=h),void 0!==e&&(i.wickColor=e),i}};function mh(t){return vh[t]}const gh={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2}},bh={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:N,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},wh={width:0,height:0,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:N},crosshair:{vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:Object.assign({},gh),leftPriceScale:Object.assign(Object.assign({},gh),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},gh),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,ticksVisible:!1},watermark:bh,localization:{locale:Es?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},Mh={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},_h={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},yh={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Ch={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Eh={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Sh={color:"#26a69a",base:0},xh={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};class Rh{constructor(t,i){this.Im=t,this.Vm=i}applyOptions(t){this.Im.Ut().ic(this.Vm,t)}options(){return this.Bi().F()}width(){return nt(this.Vm)?this.Im.im(this.Vm):0}Bi(){return f(this.Im.Ut().sc(this.Vm)).Pt}}const Fh={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:""};class Th{constructor(t){this.ph=t}applyOptions(t){this.ph.Mh(t)}options(){return this.ph.F()}Bm(){return this.ph}}class Lh{constructor(t,i,s){this.Sn=t,this.Nm=i,this.Fm=s}priceFormatter(){return this.Sn.Tl()}priceToCoordinate(t){const i=this.Sn.xt();return null===i?null:this.Sn.Pt().Dt(t,i.Rt)}coordinateToPrice(t){const i=this.Sn.xt();return null===i?null:this.Sn.Pt().ps(t,i.Rt)}barsInLogicalRange(t){if(null===t)return null;const i=new es(new is(t.from,t.to)).w_(),s=this.Sn.Is();if(s.Fi())return null;const h=s.Nh(i.pn(),1),e=s.Nh(i.vn(),-1),n=f(s.Ih()),r=f(s.Es());if(null!==h&&null!==e&&h.jn>e.jn)return{barsBefore:t.from-n,barsAfter:r-t.to};const o={barsBefore:null===h||h.jn===n?t.from-n:h.jn-n,barsAfter:null===e||e.jn===r?r-t.to:r-e.jn};return null!==h&&null!==e&&(o.from=h.ot.n_||h.ot.e_,o.to=e.ot.n_||e.ot.e_),o}setData(t){this.Sn.Rh(),this.Nm.Wm(this.Sn,t)}update(t){this.Sn.Rh(),this.Nm.zm(this.Sn,t)}dataByIndex(t,i){const s=this.Sn.Is().Nh(t,i);return null===s?null:mh(this.seriesType())(s)}setMarkers(t){const i=t.map((t=>Object.assign(Object.assign({},t),{originalTime:t.time,time:hh(t.time)})));this.Sn.pl(i)}markers(){return this.Sn.vl().map((t=>{const{originalTime:i,time:s}=t,h=function(t,i){var s={};for(var h in t)Object.prototype.hasOwnProperty.call(t,h)&&i.indexOf(h)<0&&(s[h]=t[h]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(h=Object.getOwnPropertySymbols(t);e<h.length;e++)i.indexOf(h[e])<0&&Object.prototype.propertyIsEnumerable.call(t,h[e])&&(s[h[e]]=t[h[e]])}return s}(t,["originalTime","time"]);return Object.assign({time:i},h)}))}applyOptions(t){this.Sn.Mh(t)}options(){return T(this.Sn.F())}priceScale(){return this.Fm.priceScale(this.Sn.Pt().Al())}createPriceLine(t){const i=E(T(Fh),t),s=this.Sn.ml(i);return new Th(s)}removePriceLine(t){this.Sn.bl(t.Bm())}seriesType(){return this.Sn.Rh()}}class Ph{constructor(t,i){this.jm=new C,this.P_=new C,this.bv=new C,this.$i=t,this.co=t.yt(),this.Uv=i,this.co.du().l(this.$m.bind(this)),this.co.fu().l(this.Hm.bind(this)),this.Uv.xv().l(this.Um.bind(this))}M(){this.co.du().v(this),this.co.fu().v(this),this.Uv.xv().v(this),this.jm.M(),this.P_.M(),this.bv.M()}scrollPosition(){return this.co.su()}scrollToPosition(t,i){i?this.co.cu(t,1e3):this.$i.Ks(t)}scrollToRealTime(){this.co.uu()}getVisibleRange(){var t,i;const s=this.co.H_();return null===s?null:{from:null!==(t=s.from.n_)&&void 0!==t?t:s.from.e_,to:null!==(i=s.to.n_)&&void 0!==i?i:s.to.e_}}setVisibleRange(t){const i={from:hh(t.from),to:hh(t.to)},s=this.co.X_(i);this.$i.Cc(s)}getVisibleLogicalRange(){const t=this.co.j_();return null===t?null:{from:t.pn(),to:t.vn()}}setVisibleLogicalRange(t){u(t.from<=t.to,"The from index cannot be after the to index."),this.$i.Cc(t)}resetTimeScale(){this.$i.Ys()}fitContent(){this.$i.mu()}logicalToCoordinate(t){const i=this.$i.yt();return i.Fi()?null:i.Lt(t)}coordinateToLogical(t){return this.co.Fi()?null:this.co.J_(t)}timeToCoordinate(t){const i=hh(t),s=this.co.El(i,!1);return null===s?null:this.co.Lt(s)}coordinateToTime(t){var i;const s=this.$i.yt(),h=s.J_(t),e=s.vs(h);return null===e?null:null!==(i=e.n_)&&void 0!==i?i:e.e_}width(){return this.Uv.tv().Bt}height(){return this.Uv.tv().Nt}subscribeVisibleTimeRangeChange(t){this.jm.l(t)}unsubscribeVisibleTimeRangeChange(t){this.jm.p(t)}subscribeVisibleLogicalRangeChange(t){this.P_.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.P_.p(t)}subscribeSizeChange(t){this.bv.l(t)}unsubscribeSizeChange(t){this.bv.p(t)}applyOptions(t){this.co.Mh(t)}options(){return T(this.co.F())}$m(){this.jm.g()&&this.jm.m(this.getVisibleRange())}Hm(){this.P_.g()&&this.P_.m(this.getVisibleLogicalRange())}Um(t){this.bv.m(t.Bt,t.Nt)}}function Nh(t){return function(t){if(F(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:{time:i,price:i},axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale){const{axisPressedMouseMove:i,axisDoubleClickReset:s}=t.handleScale;F(i)&&(t.handleScale.axisPressedMouseMove={time:i,price:i}),F(s)&&(t.handleScale.axisDoubleClickReset={time:s,price:s})}const i=t.handleScroll;F(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class Vh{constructor(t,i){this.qm=new uh,this.Ym=new Map,this.Xm=new Map,this.Km=new C,this.Zm=new C;const s=void 0===i?T(wh):E(T(wh),Nh(i));this.Im=new $s(t,s),this.Im.Kp().l((t=>{this.Km.g()&&this.Km.m(this.Gm(t()))}),this),this.Im.hc().l((t=>{this.Zm.g()&&this.Zm.m(this.Gm(t()))}),this);const h=this.Im.Ut();this.Jm=new Ph(h,this.Im.Zv())}remove(){this.Im.Kp().v(this),this.Im.hc().v(this),this.Jm.M(),this.Im.M(),this.Ym.clear(),this.Xm.clear(),this.Km.M(),this.Zm.M(),this.qm.M()}resize(t,i,s){this.Im.qv(t,i,s)}addAreaSeries(t){return this.Qm("Area",Ch,t)}addBaselineSeries(t){return this.Qm("Baseline",Eh,t)}addBarSeries(t){return this.Qm("Bar",_h,t)}addCandlestickSeries(t){return void 0===t&&(t={}),function(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}(t),this.Qm("Candlestick",Mh,t)}addHistogramSeries(t){return this.Qm("Histogram",Sh,t)}addLineSeries(t){return this.Qm("Line",yh,t)}removeSeries(t){const i=c(this.Ym.get(t)),s=this.qm.kc(i);this.Im.Ut().kc(i),this.tb(s),this.Ym.delete(t),this.Xm.delete(i)}Wm(t,i){this.tb(this.qm.ym(t,i))}zm(t,i){this.tb(this.qm.Dm(t,i))}subscribeClick(t){this.Km.l(t)}unsubscribeClick(t){this.Km.p(t)}subscribeCrosshairMove(t){this.Zm.l(t)}unsubscribeCrosshairMove(t){this.Zm.p(t)}priceScale(t){return new Rh(this.Im,t)}timeScale(){return this.Jm}applyOptions(t){this.Im.Mh(Nh(t))}options(){return this.Im.F()}takeScreenshot(){return this.Im.Jv()}Qm(t,i,s){void 0===s&&(s={}),function(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const s=Math.round(t);if(Math.abs(s-t)<1e-8)return i;t*=10}return i}(i.minMove))}(s.priceFormat);const h=E(T(xh),T(i),s),e=this.Im.Ut().Sc(t,h),n=new Lh(e,this,this);return this.Ym.set(n,e),this.Xm.set(e,n),n}tb(t){const i=this.Im.Ut();i.gc(t.yt.G_,t.yt.Lm,t.yt.Em),t.Om.forEach(((t,i)=>i.tt(t.ir,t.Am))),i.tu()}ib(t){return c(this.Xm.get(t))}Gm(t){const i=new Map;t.um.forEach(((t,s)=>{const h=mh(s.Rh())(t);u(function(t){return void 0!==t.open||void 0!==t.value}(h)),i.set(this.ib(s),h)}));const s=void 0===t._m?void 0:this.ib(t._m);return{time:t.ot,logical:t.jn,point:t.om,hoveredSeries:s,hoveredMarkerId:t.dm,seriesData:i}}}function Bh(t,i){let s;if(R(t)){const i=document.getElementById(t);u(null!==i,"Cannot find element in DOM with id="+t),s=i}else s=t;return new Vh(s,i)}function kh(){return"4.0.0-dev+202208121128"}}}]);